<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

class ZipHandler { public static function zip($v8ffefb2396, $v2f63d69850, $v5d3813882f = null) { if (!extension_loaded('zip') || !file_exists($v8ffefb2396)) return false; $v5980af40b1 = new ZipArchive(); if (!$v5980af40b1->open($v2f63d69850, ZIPARCHIVE::CREATE)) return false; $v8ffefb2396 = str_replace('\\', '/', realpath($v8ffefb2396)); $v0d6bc97c92 = $v5d3813882f && array_key_exists("include_source_folder", $v5d3813882f) ? $v5d3813882f["include_source_folder"] : true; $v9063a1749f = $v5d3813882f && isset($v5d3813882f["exclude_files"]) ? $v5d3813882f["exclude_files"] : null; if ($v9063a1749f) { $v9063a1749f = is_array($v9063a1749f) ? $v9063a1749f : array($v9063a1749f); foreach ($v9063a1749f as $pd69fb7d0 => $v7dffdb5a5b) { if (file_exists($v7dffdb5a5b)) $v9063a1749f[$pd69fb7d0] = realpath($v7dffdb5a5b); else unset($v9063a1749f[$pd69fb7d0]); } } if (is_dir($v8ffefb2396) === true) { $pdcf670f6 = ""; if ($v0d6bc97c92) { $pdcf670f6 = basename($v8ffefb2396) . '/'; $v5980af40b1->addEmptyDir($pdcf670f6); } $v6ee393d9fb = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($v8ffefb2396), RecursiveIteratorIterator::SELF_FIRST); foreach ($v6ee393d9fb as $v7dffdb5a5b) { $v7dffdb5a5b = str_replace('\\', '/', $v7dffdb5a5b); if ( in_array(substr($v7dffdb5a5b, strrpos($v7dffdb5a5b, '/') + 1), array('.', '..')) ) continue 1; $v7dffdb5a5b = realpath($v7dffdb5a5b); $v250a1176c9 = str_replace($v8ffefb2396 . '/', '', $v7dffdb5a5b); $v166ebe3503 = false; if ($v9063a1749f) foreach ($v9063a1749f as $pb936ab92) if ((strpos($v7dffdb5a5b, $pb936ab92) === 0) || (is_dir($v7dffdb5a5b) && $v7dffdb5a5b . "/" == $pb936ab92)) { $v166ebe3503 = true; break; } if ($v166ebe3503) continue 1; else if (is_dir($v7dffdb5a5b) === true) $v5980af40b1->addEmptyDir($pdcf670f6 . $v250a1176c9 . '/'); else if (is_file($v7dffdb5a5b) === true) $v5980af40b1->addFromString($pdcf670f6 . $v250a1176c9, file_get_contents($v7dffdb5a5b)); } } else if (is_file($v8ffefb2396) === true) $v5980af40b1->addFromString(basename($v8ffefb2396), file_get_contents($v8ffefb2396)); return $v5980af40b1->close(); } public static function unzip($v8ffefb2396, $v2f63d69850) { $v5980af40b1 = new ZipArchive(); $v5c1c342594 = $v5980af40b1->open($v8ffefb2396) === true; if ($v5c1c342594) { $v5c1c342594 = $v5980af40b1->extractTo($v2f63d69850); $v5980af40b1->close(); } return $v5c1c342594; } public static function addFileToZip($v5f0471d66c, $v5db73158c9, $v6e94d1341c = "") { $v5980af40b1 = new ZipArchive(); $v5c1c342594 = false; if ($v5db73158c9 && file_exists($v5f0471d66c) && file_exists($v5db73158c9) && $v5980af40b1->open($v5f0471d66c) === true) { $v5c1c342594 = true; $v5db73158c9 = str_replace('\\', '/', realpath($v5db73158c9)); if (is_dir($v5db73158c9) === true) { $v6ee393d9fb = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($v5db73158c9), RecursiveIteratorIterator::SELF_FIRST); foreach ($v6ee393d9fb as $v7dffdb5a5b) { $v7dffdb5a5b = str_replace('\\', '/', $v7dffdb5a5b); if ( in_array(substr($v7dffdb5a5b, strrpos($v7dffdb5a5b, '/') + 1), array('.', '..')) ) continue 1; $v7dffdb5a5b = realpath($v7dffdb5a5b); if (is_dir($v7dffdb5a5b) === true) $v5980af40b1->addEmptyDir($v6e94d1341c . str_replace($v5db73158c9 . '/', '', $v7dffdb5a5b . '/')); else if (is_file($v7dffdb5a5b) === true) $v5980af40b1->addFromString($v6e94d1341c . str_replace($v5db73158c9 . '/', '', $v7dffdb5a5b), file_get_contents($v7dffdb5a5b)); } } else if (is_file($v5db73158c9) === true) $v5980af40b1->addFromString($v6e94d1341c . basename($v5db73158c9), file_get_contents($v5db73158c9)); $v5980af40b1->close(); } return $v5c1c342594; } public static function renameFileInZip($v5f0471d66c, $v2c5062f1e7, $v91a962d917) { $v5980af40b1 = new ZipArchive(); $v2c5062f1e7 = trim($v2c5062f1e7); $v91a962d917 = trim($v91a962d917); $v5c1c342594 = false; if ($v2c5062f1e7 && $v91a962d917 && $v5f0471d66c && file_exists($v5f0471d66c) && $v5980af40b1->open($v5f0471d66c) === true) { $pa3a96819 = $v2c5062f1e7 . (substr($v2c5062f1e7, -1) != '/' ? '/' : ''); $pdc859970 = $v91a962d917 . (substr($v91a962d917, -1) != '/' ? '/' : ''); for ($v43dd7d0051 = 0; $v43dd7d0051 < $v5980af40b1->numFiles; $v43dd7d0051++) { $v7dffdb5a5b = $v5980af40b1->getNameIndex($v43dd7d0051); $pedcc3a33 = substr($v7dffdb5a5b, -1) == "/"; if (!$pedcc3a33 && $v7dffdb5a5b == $v2c5062f1e7) { $v5980af40b1->renameIndex($v43dd7d0051, $v91a962d917); $v5c1c342594 = true; break; } else if (strpos($v7dffdb5a5b, $pa3a96819) === 0) { $v71178be245 = str_replace(substr($v7dffdb5a5b, 0, strlen($pa3a96819)), $pdc859970, $v7dffdb5a5b); $v5980af40b1->renameIndex($v43dd7d0051, $v71178be245); $v5c1c342594 = true; } } $v5980af40b1->close(); } return $v5c1c342594; } } 