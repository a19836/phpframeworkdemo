<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include get_lib("org.phpframework.bean.Bean"); include get_lib("org.phpframework.bean.exception.BeanFactoryException"); include get_lib("org.phpframework.bean.BeanSettingsFileFactory"); class BeanFactory { const AK = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtec+xMxVPOgL2KiCALkF"; private $v52b4591032 = array(); private $v1e9dc98c41 = array(); private $pc5a892eb = array(); private $v9956857107 = array(); private $v399583365c = array(); private $pa89cbc14 = array(); private $v19ed750c63; public function __construct() { $this->v19ed750c63 = new BeanSettingsFileFactory(); } public function getSettingsFromFile($pf3dc0762) { $pc5a892eb = $this->pc5a892eb; $pc5a892eb["objs"] = is_array($pc5a892eb["objs"]) ? array_merge($this->v52b4591032, $pc5a892eb["objs"]) : $this->v52b4591032; $pc5a892eb["vars"] = is_array($pc5a892eb["vars"]) ? array_merge($this->v52b4591032["vars"], $pc5a892eb["vars"]) : $this->v52b4591032["vars"]; $v30857f7eca = $this->v19ed750c63->getSettingsFromFile($pf3dc0762, $pc5a892eb); return $v30857f7eca; } public function getBeansFromSettings($v30857f7eca, &$pa89cbc14 = false) { $v1e9dc98c41 = array(); $pc37695cb = $v30857f7eca ? count($v30857f7eca) : 0; for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pe5a746ff = $v30857f7eca[$v43dd7d0051]; if(isset($pe5a746ff["import"])) { $v42d290f6d8 = $this->getSettingsFromFile($pe5a746ff["import"]); $pb0c76152 = $this->getBeansFromSettings($v42d290f6d8, $pa89cbc14); $v1e9dc98c41 = array_merge($v1e9dc98c41, $pb0c76152); } else if(isset($pe5a746ff["bean"])) { $v182f7d984b = $pe5a746ff["bean"]; if (!empty($v182f7d984b["extend"]) && empty($v182f7d984b["bean_to_extend"])) { $v141779ec29 = count($v182f7d984b["extend"]); for ($v9d27441e80 = 0; $v9d27441e80 < $v141779ec29; $v9d27441e80++) { $v7a699fe3cd = $v182f7d984b["extend"][$v9d27441e80]; $v182f7d984b["bean_to_extend"][$v7a699fe3cd] = self::getBeanSettingsByName($v30857f7eca, $v7a699fe3cd); } } $v1e9dc98c41[ $v182f7d984b["name"] ] = new Bean($v182f7d984b["name"], $v182f7d984b["path"], $v182f7d984b["constructor_args"], $v182f7d984b["properties"], $v182f7d984b["functions"], array("path_prefix" => $v182f7d984b["path_prefix"], "extension" => $v182f7d984b["extension"], "bean_to_extend" => $v182f7d984b["bean_to_extend"], "namespace" => $v182f7d984b["namespace"], "class_name" => $v182f7d984b["class_name"])); $pa89cbc14[] = array("type" => "bean", "name" => $v182f7d984b["name"]); } else if(isset($pe5a746ff["var"])) { $v182f7d984b = $pe5a746ff["var"]; $this->v52b4591032[ $v182f7d984b["name"] ] = $v182f7d984b["value"]; } else if(isset($pe5a746ff["function"])) { $pa051dc1c = new BeanFunction($pe5a746ff["function"]["name"], $pe5a746ff["function"]["parameters"], $pe5a746ff["function"]["reference"], array("namespace" => $pe5a746ff["function"]["namespace"])); $pa89cbc14[] = array("type" => "function", "function" => $pa051dc1c); } else launch_exception(new BeanFactoryException(1, $v43dd7d0051)); } return $v1e9dc98c41; } public function init($v539082ff30) { $v30857f7eca = array(); if($v539082ff30["external_vars"]) $this->pc5a892eb = $v539082ff30["external_vars"]; if($v539082ff30["file"]) $v30857f7eca = $this->getSettingsFromFile($v539082ff30["file"]); if(is_array($v539082ff30["settings"])) $v30857f7eca = empty($v30857f7eca) ? $v539082ff30["settings"] : array_merge($v30857f7eca, $v539082ff30["settings"]); $this->pa89cbc14 = array(); $this->v1e9dc98c41 = $this->getBeansFromSettings($v30857f7eca, $this->pa89cbc14); } public function initObjects() { $pc37695cb = $this->pa89cbc14 ? count($this->pa89cbc14) : 0; for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { if ($this->pa89cbc14[$v43dd7d0051]["type"] == "bean") $this->initObject($this->pa89cbc14[$v43dd7d0051]["name"]); else if ($this->pa89cbc14[$v43dd7d0051]["type"] == "function") $this->initFunction($this->pa89cbc14[$v43dd7d0051]); } } public function initObject($v8ffce2a791, $v775d5d09e2 = true) { $pdec569fb = $this->v1e9dc98c41[$v8ffce2a791]; if($pdec569fb) { $v9b5402807d = md5(serialize($pdec569fb)); if (!isset($this->v399583365c[$v9b5402807d])) { $this->v399583365c[$v9b5402807d] = true; if($this->v52b4591032[$v8ffce2a791]) return $this->v52b4591032[$v8ffce2a791]; if($this->v9956857107[$v8ffce2a791]) { launch_exception(new BeanFactoryException(3, $v8ffce2a791)); return false; } else $this->v9956857107[$v8ffce2a791] = true; if($pdec569fb->path) { $objs = $this->v52b4591032; $vars = $this->v52b4591032["vars"]; foreach($this->pc5a892eb as $v1cfba8c105 => $pa6209df1) ${$v1cfba8c105} = $pa6209df1; include_once($pdec569fb->path); } $pf3b79f6d = $this->f6a336053a6($pdec569fb->constructor_args); eval("\$v972f1a5c2b = new " . $pdec569fb->class_name . "(" . $pf3b79f6d . ");"); $this->v52b4591032[$v8ffce2a791] = $v972f1a5c2b; foreach($pdec569fb->properties as $v5e813b295b => $v9acf40c110) { $v67db1bd535 = $this->f46c99bf678($v9acf40c110); eval("\$v972f1a5c2b->set" . ucfirst($v5e813b295b) . "(" . $v67db1bd535 . ");"); } $pc37695cb = $pdec569fb->functions ? count($pdec569fb->functions) : 0; for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v1b08a89324 = $pdec569fb->functions[$v43dd7d0051]; $pf3b79f6d = $this->f6a336053a6($v1b08a89324->parameters); eval("\$v972f1a5c2b->" . $v1b08a89324->name . "(" . $pf3b79f6d . ");"); } } } else if($v775d5d09e2) launch_exception(new BeanFactoryException(2, $v8ffce2a791)); } public function initFunction($v2f4e66e00a, $v775d5d09e2 = true) { $v1b08a89324 = $v2f4e66e00a["function"]; $pf3b79f6d = $this->f6a336053a6($v1b08a89324->parameters); $v972f1a5c2b = $this->v52b4591032[$v1b08a89324->parent_object_reference]; if (isset($v972f1a5c2b) && $v972f1a5c2b) $v067674f4e4 = "\$v972f1a5c2b->" . $v1b08a89324->name . "(" . $pf3b79f6d . ");"; else $v067674f4e4 = $v1b08a89324->getFunctionNSName() . "(" . $pf3b79f6d . ");"; eval($v067674f4e4); } private function f46c99bf678($v8d23b2381d) { $v67db1bd535 = ""; if($v8d23b2381d->reference) { if(!isset($this->v52b4591032[$v8d23b2381d->reference])) $this->initObject($v8d23b2381d->reference); $v67db1bd535 = "\$this->v52b4591032['" . $v8d23b2381d->reference . "']"; } else { $v67db1bd535 = $v8d23b2381d->value; if (is_array($v67db1bd535)) $v67db1bd535 = var_export($v67db1bd535, true); else $v67db1bd535 = is_numeric($v67db1bd535) && !is_string($v67db1bd535) ? $v67db1bd535 : '"' . addcslashes($v67db1bd535, '\\"') . '"'; } return $v67db1bd535; } private function f6a336053a6($v86066462c3) { $pf3b79f6d = ""; $v898c9246f0 = 0; $pf44d5842 = array_keys($v86066462c3); $pc37695cb = count($pf44d5842); for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v8a4df75785 = $pf44d5842[$v43dd7d0051]; $pbde5fb24 = $v86066462c3[$v8a4df75785]; $pf3b79f6d .= strlen($pf3b79f6d) > 0 ? ", " : ""; $v3d24b0af9b = $v8a4df75785 - ($v898c9246f0 + 1); if($v3d24b0af9b > 0) for($v9d27441e80 = 0; $v9d27441e80 < $v3d24b0af9b; $v9d27441e80++) $pf3b79f6d .= "false, "; $pf3b79f6d .= $this->f46c99bf678($pbde5fb24); $v898c9246f0 = $v8a4df75785; } return $pf3b79f6d; } public function reset() { $this->v52b4591032 = array(); $this->v1e9dc98c41 = array(); $this->pa89cbc14 = array(); } public function addObjects($v52b4591032) { $this->v52b4591032 = empty($this->v52b4591032) ? $v52b4591032 : array_merge($this->v52b4591032, $v52b4591032); } public function getBeans() {return $this->v1e9dc98c41;} public function getBean($v8ffce2a791) {return $this->v1e9dc98c41[$v8ffce2a791];} public function getObjects() {return $this->v52b4591032;} public function getObject($v55c0c0e582) {return $this->v52b4591032[$v55c0c0e582];} public function setCacheRootPath($v17be587282) { $this->v19ed750c63->setCacheRootPath($v17be587282); } } ?>
