<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once $EVC->getUtilPath("AdminMenuHandler"); class LayoutTypeProjectHandler { private $pdf77ee66; private $v0cd49d5a59; private $v0d51bbbc63; private $pa0462a8e; private $v8ffce2a791; private $v46a9c3505c = array(); private $v8139553e50 = array(); public function __construct($pdf77ee66, $v0cd49d5a59, $v0d51bbbc63, $pa0462a8e = null, $v8ffce2a791 = null) { $this->pdf77ee66 = $pdf77ee66; $this->v0cd49d5a59 = $v0cd49d5a59; $this->v0d51bbbc63 = $v0d51bbbc63; $this->pa0462a8e = $pa0462a8e; $this->v8ffce2a791 = $v8ffce2a791; } public function createPresentationLayerSetupDefaultProjectLayouts($v24bae6e8d7, $v830c8335f6 = true) { $v5c1c342594 = true; $pb512d021 = new WorkFlowBeansFileHandler($this->v0d51bbbc63 . $this->pa0462a8e, $this->v0cd49d5a59); $pd3623f40 = $pb512d021->getBeanObject($this->v8ffce2a791); $pa2bba2ac = $pd3623f40->getLayerPathSetting(); $pa47fac06 = $pd3623f40->getCommonProjectName(); if ($pa47fac06) { $v7e136b813a = $pa2bba2ac . $pa47fac06; if (!$this->createNewLayoutFromProjectPath($v7e136b813a, $v830c8335f6)) $v5c1c342594 = false; } if ($v24bae6e8d7) { $v7e136b813a = $pa2bba2ac . $v24bae6e8d7; if (!$this->createNewLayoutFromProjectPath($v7e136b813a, $v830c8335f6)) $v5c1c342594 = false; } return $v5c1c342594; } public function filterPresentationLayersProjectsByUserAndLayoutPermissions(&$v6cbcbc949c, $pb154d332 = null, $v75b595c772 = null, $v5d3813882f = null) { if ($v6cbcbc949c) { if ($pb154d332) { if (!$v75b595c772) $v75b595c772 = array(UserAuthenticationHandler::$PERMISSION_BELONG_NAME, UserAuthenticationHandler::$PERMISSION_REFERENCED_NAME); $this->pdf77ee66->loadLayoutPermissions($pb154d332, UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID); $pe8fdf8da = $v5d3813882f && $v5d3813882f["do_not_filter_by_layout"] ? $v5d3813882f["do_not_filter_by_layout"] : null; } foreach ($v6cbcbc949c as $v8ffce2a791 => $v9073377656) { $pa0462a8e = $v9073377656["bean_file_name"]; $pc38bce14 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $pa0462a8e, $v8ffce2a791, $this->v0cd49d5a59); $pd5679809 = LAYER_PATH . $pc38bce14; $v0495519e7c = $pe8fdf8da && $pe8fdf8da["bean_name"] == $v8ffce2a791 && $pe8fdf8da["bean_file_name"] == $pa0462a8e; if (!$this->pdf77ee66->isInnerFilePermissionAllowed($pd5679809, "layer", "access")) unset($v6cbcbc949c[$v8ffce2a791]); else if ($pb154d332 && !$v0495519e7c && !$this->pdf77ee66->isLayoutInnerFilePermissionAllowed($pd5679809, $pb154d332, "layer", $v75b595c772)) unset($v6cbcbc949c[$v8ffce2a791]); else { $v1eb9193558 = new LayoutTypeProjectHandler($this->pdf77ee66, $this->v0cd49d5a59, $this->v0d51bbbc63, $pa0462a8e, $v8ffce2a791); $v1eb9193558->filterPresentationLayerProjectsByUserAndLayoutPermissions($v6cbcbc949c[$v8ffce2a791]["projects"], $pb154d332, $v75b595c772, $v5d3813882f); } } } } public function filterPresentationLayerProjectsByUserAndLayoutPermissions(&$v90b50cf52d, $pb154d332 = null, $v75b595c772 = null, $v5d3813882f = null) { $this->f1bb72db551(); if ($v90b50cf52d) { $pc38bce14 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $this->pa0462a8e, $this->v8ffce2a791, $this->v0cd49d5a59); $pd5679809 = LAYER_PATH . $pc38bce14; if ($pb154d332) { if (!$v75b595c772) $v75b595c772 = array(UserAuthenticationHandler::$PERMISSION_BELONG_NAME, UserAuthenticationHandler::$PERMISSION_REFERENCED_NAME); $this->pdf77ee66->loadLayoutPermissions($pb154d332, UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID); $pe8fdf8da = $v5d3813882f && $v5d3813882f["do_not_filter_by_layout"] ? $v5d3813882f["do_not_filter_by_layout"] : null; $v0495519e7c = $pe8fdf8da && $pe8fdf8da["bean_name"] == $this->v8ffce2a791 && $pe8fdf8da["bean_file_name"] == $this->pa0462a8e; } foreach ($v90b50cf52d as $v29e5d6d712 => $v20dfc6306e) { $v465835b53a = "$pd5679809/$v29e5d6d712"; $v2709fc3a41 = $v0495519e7c && $v29e5d6d712 == $pe8fdf8da["project"]; if (!$this->pdf77ee66->isInnerFilePermissionAllowed($v465835b53a, "layer", "access")) unset($v90b50cf52d[$v29e5d6d712]); else if ($pb154d332 && !$v2709fc3a41 && !$this->pdf77ee66->isLayoutInnerFilePermissionAllowed($v465835b53a, $pb154d332, "layer", $v75b595c772)) unset($v90b50cf52d[$v29e5d6d712]); } } } public function filterLayerBrokersDBDriversPropsBasedInUrl(&$v9b98e0e818, $v6f3a2700dd) { if ($v9b98e0e818 && $v6f3a2700dd && strpos($v6f3a2700dd, "?") !== false) { $pc2defd39 = substr($v6f3a2700dd, strpos($v6f3a2700dd, "?") + 1); parse_str($pc2defd39, $pfb662071); $pb154d332 = $pfb662071["filter_by_layout"]; if ($pb154d332) $this->filterLayerBrokersDBDriversPropsFromLayoutName($v9b98e0e818, $pb154d332, $pfb662071["filter_by_layout_permission"]); } } public function filterLayerBrokersDBDriversNamesFromLayoutName($v847a7225e0, &$v9b98e0e818, $pb154d332, $v75b595c772 = null) { if ($v9b98e0e818 && $pb154d332) { if (!$this->layer_db_drivers_props) $this->layer_db_drivers_props = WorkFlowBeansFileHandler::getLayerDBDrivers($this->v0cd49d5a59, $this->v0d51bbbc63, $v847a7225e0, true); if ($this->layer_db_drivers_props) { $pe8c6ec14 = array_flip($v9b98e0e818); $v8a4ea5d473 = array_intersect_key($this->layer_db_drivers_props, $pe8c6ec14); $this->filterLayerBrokersDBDriversPropsFromLayoutName($v8a4ea5d473, $pb154d332, $v75b595c772); $v9b98e0e818 = array_keys($v8a4ea5d473); } } } public function filterLayerBrokersDBDriversPropsFromLayoutName(&$v9b98e0e818, $pb154d332, $v75b595c772 = null) { if ($v9b98e0e818 && $pb154d332) { if (!$this->layer_objs) $this->layer_objs = WorkFlowBeansFileHandler::getAllLayersBeanObjs($this->v0cd49d5a59, $this->v0d51bbbc63); $v8b7aee3f9c = array(); foreach ($this->layer_objs as $v8ffce2a791 => $v5ce4bd29b6) if (is_a($v5ce4bd29b6, "DBLayer")) $v8b7aee3f9c[] = $v5ce4bd29b6->getLayerPathSetting(); if ($v8b7aee3f9c) { $this->pdf77ee66->loadLayoutPermissions($pb154d332, UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID); $v75b595c772 = $v75b595c772 ? $v75b595c772 : UserAuthenticationHandler::$PERMISSION_BELONG_NAME; foreach ($v9b98e0e818 as $pe5c5e2fe => $pa9b2090f) if ($pa9b2090f) foreach ($v8b7aee3f9c as $v96fffa7342) { $v0aa6cb69f8 = $v96fffa7342 . "/" . $pa9b2090f[2]; $v9d5638b722 = $this->md5afbe6fdc19($v0aa6cb69f8); if (!$this->pdf77ee66->isLayoutInnerFilePermissionAllowed($v9d5638b722, $pb154d332, "layer", $v75b595c772)) unset($v9b98e0e818[$pe5c5e2fe]); } } } } public function isPathAPresentationProjectPath($v7e136b813a) { $this->f1bb72db551(); if (is_dir($v7e136b813a)) { $pb512d021 = new WorkFlowBeansFileHandler($this->v0d51bbbc63 . $this->pa0462a8e, $this->v0cd49d5a59); $pd3623f40 = $pb512d021->getBeanObject($this->v8ffce2a791); if ($pd3623f40) { $pf8271f9d = $pd3623f40->settings["presentation_webroot_path"]; $pe9717439 = $v7e136b813a ? is_dir("$v7e136b813a/$pf8271f9d") : false; return $pe9717439; } } return false; } public function isPathAPresentationProjectFolderPath($v7e136b813a) { $this->f1bb72db551(); if (is_dir($v7e136b813a)) { $pb512d021 = new WorkFlowBeansFileHandler($this->v0d51bbbc63 . $this->pa0462a8e, $this->v0cd49d5a59); $pd3623f40 = $pb512d021->getBeanObject($this->v8ffce2a791); if ($pd3623f40) { $pa2bba2ac = $pd3623f40->getLayerPathSetting(); if (strpos($v7e136b813a, $pa2bba2ac) === 0 && strpos($v7e136b813a, "/src/") === false && strpos($v7e136b813a, "/webroot/") === false) return true; } } return false; } public function existsLayoutFromProjectPath($v7e136b813a) { $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); if ($v00e8ae73a2) { $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); return $pe7e28c8a && $pe7e28c8a["layout_type_id"]; } return false; } public function getLayoutFromProjectPath($v7e136b813a) { $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); if ($v00e8ae73a2) return $this->f17c784e328($v00e8ae73a2); return false; } public function createNewLayoutFromProjectPath($v7e136b813a, $v830c8335f6 = true) { $this->f1bb72db551(); $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); if ($v00e8ae73a2) { $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if (!$v1a222c94d4) $v1a222c94d4 = $this->pdf77ee66->insertLayoutType(array( "type_id" => UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID, "name" => $v00e8ae73a2, )); return $v1a222c94d4 && $this->f5aa6684f7d($v1a222c94d4, $v830c8335f6); } } public function createNewLayoutFromProjectFolderPath($v7e136b813a, $v830c8335f6 = true) { $this->f1bb72db551(); $v5c1c342594 = false; if ($v7e136b813a && is_dir($v7e136b813a)) { $v5c1c342594 = true; $v2cd5d67337 = array_diff(scandir($v7e136b813a), array('..', '.')); foreach ($v2cd5d67337 as $v3a3060fe4b) { $v396d7de99e = "$v7e136b813a/$v3a3060fe4b"; if ($this->isPathAPresentationProjectPath($v396d7de99e) && !$this->createNewLayoutFromProjectPath($v396d7de99e, $v830c8335f6)) $v5c1c342594 = false; else if ($this->isPathAPresentationProjectFolderPath($v396d7de99e) && !$this->createNewLayoutFromProjectFolderPath($v396d7de99e, $v830c8335f6)) $v5c1c342594 = false; } } return $v5c1c342594; } public function renameLayoutFromProjectPath($v50f35562b7, $v8abf5728a8) { $pac8b5980 = $this->f7c8bfdf331($v50f35562b7); $v404d1208d7 = $this->f7c8bfdf331($v8abf5728a8); if ($pac8b5980 && $v404d1208d7) { $pe7e28c8a = $this->f17c784e328($pac8b5980); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if ($v1a222c94d4) { $pe7e28c8a["name"] = $v404d1208d7; if ($this->pdf77ee66->updateLayoutType($pe7e28c8a)) { $v7953a8daf6 = $this->pdf77ee66->getAvailableObjectTypes(); $v24d63e0b1f = $v7953a8daf6["layer"]; $pef34936b = $this->pdf77ee66->getAvailablePermissions(); $pf5478be6 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_BELONG_NAME ]; $v188faededb = $this->md5afbe6fdc19(LAYER_PATH . $pac8b5980); $pc1da042e = $this->md5afbe6fdc19(LAYER_PATH . $v404d1208d7); if (!$this->f48c96703a6($v1a222c94d4, $v24d63e0b1f, $v188faededb, $pc1da042e)) return false; else $this->mc32603311706($pac8b5980, $v404d1208d7); return true; } } } return false; } public function renameLayoutFromProjectFolderPath($v50f35562b7, $v8abf5728a8) { $v5c1c342594 = false; if ($v8abf5728a8 && is_dir($v8abf5728a8)) { $v2cd5d67337 = array_diff(scandir($v8abf5728a8), array('..', '.')); foreach ($v2cd5d67337 as $pd69fb7d0 => $v3a3060fe4b) { $pd7df304d = "$v8abf5728a8/$v3a3060fe4b"; if (!$this->isPathAPresentationProjectPath($pd7df304d) && !$this->isPathAPresentationProjectFolderPath($pd7df304d)) unset($v2cd5d67337[$pd69fb7d0]); } $pac8b5980 = $this->f7c8bfdf331($v50f35562b7); $v404d1208d7 = $this->f7c8bfdf331($v8abf5728a8); $v5c1c342594 = $this->mc32603311706($pac8b5980, $v404d1208d7, $v2cd5d67337); } return $v5c1c342594; } public function removeLayoutFromProjectPath($v7e136b813a) { $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); if ($v00e8ae73a2) { $this->f195421101c($v00e8ae73a2); $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if ($v1a222c94d4) return $this->pdf77ee66->deleteLayoutTypePermissionsByConditions(array("layout_type_id" => $v1a222c94d4)) && $this->pdf77ee66->deleteLayoutType($v1a222c94d4); } return false; } public function removeLayoutFromProjectFolderPath($v7e136b813a) { $v5c1c342594 = false; if ($v7e136b813a && is_dir($v7e136b813a)) { $v5c1c342594 = true; $v2cd5d67337 = array_diff(scandir($v7e136b813a), array('..', '.')); foreach ($v2cd5d67337 as $v3a3060fe4b) { $v396d7de99e = "$v7e136b813a/$v3a3060fe4b"; if ($this->isPathAPresentationProjectPath($v396d7de99e) && !$this->removeLayoutFromProjectPath($v396d7de99e)) $v5c1c342594 = false; else if ($this->isPathAPresentationProjectFolderPath($v396d7de99e) && !$this->removeLayoutFromProjectFolderPath($v396d7de99e)) $v5c1c342594 = false; } $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); $this->f195421101c($v00e8ae73a2); } return $v5c1c342594; } public function createLayoutTypePermissionsForModuleInLayersFromProjectPath($v7e136b813a, $pb4927ce4, $pcd8c70bc) { $this->f1bb72db551(); $v5c1c342594 = true; if ($pb4927ce4) { $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); if ($v00e8ae73a2) { $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if (!$v1a222c94d4) { $v1a222c94d4 = $this->pdf77ee66->insertLayoutType(array( "type_id" => UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID, "name" => $v00e8ae73a2, )); if ($v1a222c94d4 && !$this->f5aa6684f7d($v1a222c94d4, false)) $v5c1c342594 = false; } if ($v1a222c94d4) { $v7953a8daf6 = $this->pdf77ee66->getAvailableObjectTypes(); $v24d63e0b1f = $v7953a8daf6["layer"]; $pef34936b = $this->pdf77ee66->getAvailablePermissions(); $pf5478be6 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_BELONG_NAME ]; $v37778494c0 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_REFERENCED_NAME ]; $pb512d021 = new WorkFlowBeansFileHandler($this->v0d51bbbc63 . $this->pa0462a8e, $this->v0cd49d5a59); $pd3623f40 = $pb512d021->getBeanObject($this->v8ffce2a791); $pa47fac06 = $pd3623f40->getCommonProjectName(); if ($pa47fac06) { $v7dc9f8567d = $pd3623f40->getLayerPathSetting(); $v3fab52f440 = $this->md5afbe6fdc19($v7dc9f8567d . $pa47fac06 . "/src/module/$pcd8c70bc"); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $v37778494c0)) $v5c1c342594 = false; } foreach ($pb4927ce4 as $v8ffce2a791 => $v5ce4bd29b6) if (is_a($v5ce4bd29b6, "BusinessLogicLayer") || is_a($v5ce4bd29b6, "DataAccessLayer")) { $pc38bce14 = WorkFlowBeansFileHandler::getLayerObjFolderName($v5ce4bd29b6); $peefc795d = LAYER_PATH . "$pc38bce14/module/$pcd8c70bc"; if (file_exists($peefc795d)) { $v3fab52f440 = $this->md5afbe6fdc19($peefc795d); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } } } else $v5c1c342594 = false; } else $v5c1c342594 = false; } else $v5c1c342594 = false; return $v5c1c342594; } public function createLayoutTypePermissionsForProgramInLayersFromProjectPath($v90b50cf52d, $pb4927ce4, $v4ebf62adfb) { $this->f1bb72db551(); $v5c1c342594 = true; if ($pb4927ce4 && $v90b50cf52d) { $v7953a8daf6 = $this->pdf77ee66->getAvailableObjectTypes(); $v24d63e0b1f = $v7953a8daf6["layer"]; $pef34936b = $this->pdf77ee66->getAvailablePermissions(); $pf5478be6 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_BELONG_NAME ]; foreach ($pb4927ce4 as $v2b2cf4c0eb => $v5ce4bd29b6) if (is_a($v5ce4bd29b6, "PresentationLayer")) { $v9e6067792a = $v90b50cf52d[$v2b2cf4c0eb]; if ($v9e6067792a) { $pa2bba2ac = $v5ce4bd29b6->getLayerPathSetting(); foreach ($v9e6067792a as $v29e5d6d712) { $v7e136b813a = $pa2bba2ac . $v29e5d6d712; $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); if ($v00e8ae73a2) { $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if (!$v1a222c94d4) { $v1a222c94d4 = $this->pdf77ee66->insertLayoutType(array( "type_id" => UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID, "name" => $v00e8ae73a2, )); if ($v1a222c94d4 && !$this->f5aa6684f7d($v1a222c94d4, false)) $v5c1c342594 = false; } if ($v1a222c94d4) { foreach ($pb4927ce4 as $v8ffce2a791 => $v5ce4bd29b6) if (is_a($v5ce4bd29b6, "BusinessLogicLayer") || is_a($v5ce4bd29b6, "DataAccessLayer")) { $pc38bce14 = WorkFlowBeansFileHandler::getLayerObjFolderName($v5ce4bd29b6); $peefc795d = LAYER_PATH . "$pc38bce14/program/$v4ebf62adfb"; if (file_exists($peefc795d)) { $v3fab52f440 = $this->md5afbe6fdc19($peefc795d); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } } } else $v5c1c342594 = false; } else $v5c1c342594 = false; } } } } else $v5c1c342594 = false; return $v5c1c342594; } public function createLayoutTypePermissionsForDBDriverFromProjectPath($v7e136b813a, $v5ba36af525) { if (!$v7e136b813a || !$v5ba36af525) return false; $this->f1bb72db551(); $v00e8ae73a2 = $this->f7c8bfdf331($v7e136b813a); return $this->createLayoutTypePermissionsForDBDriverAndLayoutTypeName($v00e8ae73a2, $v5ba36af525); } public function createLayoutTypePermissionsForFilePathAndLayoutTypeName($v00e8ae73a2, $pf3dc0762, $v29dbc88c12 = true) { if (!$v00e8ae73a2 || !$pf3dc0762) return false; $this->f1bb72db551(); $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if (!$v1a222c94d4) return false; if ($v29dbc88c12) { $this->pdf77ee66->loadLayoutPermissions($v00e8ae73a2, UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID); if ($this->pdf77ee66->isLayoutInnerFilePermissionAllowed($pf3dc0762, $v00e8ae73a2, "layer", UserAuthenticationHandler::$PERMISSION_BELONG_NAME)) return true; } $v7953a8daf6 = $this->pdf77ee66->getAvailableObjectTypes(); $v24d63e0b1f = $v7953a8daf6["layer"]; $pef34936b = $this->pdf77ee66->getAvailablePermissions(); $pf5478be6 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_BELONG_NAME ]; $v3fab52f440 = $this->md5afbe6fdc19($pf3dc0762); return $this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6); } public function renameLayoutTypePermissionsForFilePath($v3b2ed6908a, $v3f7a88fc27) { if (!$v3b2ed6908a || !$v3f7a88fc27) return false; $this->f1bb72db551(); $v188faededb = $this->md5afbe6fdc19($v3b2ed6908a); $pc1da042e = $this->md5afbe6fdc19($v3f7a88fc27); $pff25d6bd = $this->pdf77ee66->searchLayoutTypePermissions(array("object_id" => $v188faededb)); $v6be2309ce7 = array(); $v5c1c342594 = true; if (is_array($pff25d6bd)) foreach ($pff25d6bd as $pb8889c54) if (!$v6be2309ce7[ $pb8889c54["layout_type_id"] ][ $pb8889c54["object_type_id"] ]) { $v6be2309ce7[ $pb8889c54["layout_type_id"] ][ $pb8889c54["object_type_id"] ] = 1; if (!$this->f48c96703a6($pb8889c54["layout_type_id"], $pb8889c54["object_type_id"], $v188faededb, $pc1da042e)) $v5c1c342594 = false; } return $v5c1c342594; } public function removeLayoutTypePermissionsForFilePath($pf3dc0762) { if (!$pf3dc0762) return false; $v3fab52f440 = $this->md5afbe6fdc19($pf3dc0762); return $this->pdf77ee66->deleteLayoutTypePermissionsByConditions(array("object_id" => $v3fab52f440)); } public function createLayoutTypePermissionsForDBDriverAndLayoutTypeName($v00e8ae73a2, $v5ba36af525) { if (!$v00e8ae73a2 || !$v5ba36af525) return false; $this->f1bb72db551(); $pe7e28c8a = $this->f17c784e328($v00e8ae73a2); $v1a222c94d4 = $pe7e28c8a ? $pe7e28c8a["layout_type_id"] : null; if (!$v1a222c94d4) return false; $v2635bad135 = AdminMenuHandler::getLayersFiles($this->v0cd49d5a59); $v5c1c342594 = false; if ($v2635bad135) { $v5cc54bf9f5 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $this->pa0462a8e, $this->v8ffce2a791, $this->v0cd49d5a59) . "/"; $pd93efc3e = substr($v00e8ae73a2, 0, strlen($v5cc54bf9f5)) == $v5cc54bf9f5 ? substr($v00e8ae73a2, strlen($v5cc54bf9f5)) : null; $v7953a8daf6 = $this->pdf77ee66->getAvailableObjectTypes(); $v24d63e0b1f = $v7953a8daf6["layer"]; $pef34936b = $this->pdf77ee66->getAvailablePermissions(); $pf5478be6 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_BELONG_NAME ]; $v6c90c0548c = $v2635bad135["db_layers"]; $v7959970a41 = false; $v5c1c342594 = true; foreach ($v6c90c0548c as $v0a5deb92d8 => $v4a24304713) { foreach ($v4a24304713 as $v0d708df77c => $v05a87ff131) { $pcfc8a76b = WorkFlowBeansConverter::getBrokerNameFromRawLabel($v0d708df77c); if ($pcfc8a76b == $v5ba36af525) { $v7959970a41 = true; $pc38bce14 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $v4a24304713["properties"]["bean_file_name"], $v4a24304713["properties"]["bean_name"], $this->v0cd49d5a59); $pd5679809 = LAYER_PATH . "$pc38bce14/"; $v3fab52f440 = $this->md5afbe6fdc19($pd5679809 . $v0d708df77c); if ($this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) { $v3fab52f440 = $this->md5afbe6fdc19($pd5679809); if (!$this->pdf77ee66->deleteLayoutTypePermission($v1a222c94d4, $pf5478be6, $v24d63e0b1f, $v3fab52f440)) $v5c1c342594 = false; } else $v5c1c342594 = false; } } } if (!$v7959970a41) $v5c1c342594 = false; } return $v5c1c342594; } private function f5aa6684f7d($v1a222c94d4, $v830c8335f6 = true) { if ($v1a222c94d4) { $pe7e28c8a = $this->pdf77ee66->getLayoutType($v1a222c94d4); $v00e8ae73a2 = $pe7e28c8a ? $pe7e28c8a["name"] : null; if ($v00e8ae73a2) { $v2635bad135 = AdminMenuHandler::getLayersFiles($this->v0cd49d5a59); $v5c1c342594 = true; if ($v2635bad135) { $v5cc54bf9f5 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $this->pa0462a8e, $this->v8ffce2a791, $this->v0cd49d5a59) . "/"; $pd93efc3e = substr($v00e8ae73a2, 0, strlen($v5cc54bf9f5)) == $v5cc54bf9f5 ? substr($v00e8ae73a2, strlen($v5cc54bf9f5)) : null; $v7953a8daf6 = $this->pdf77ee66->getAvailableObjectTypes(); $v24d63e0b1f = $v7953a8daf6["layer"]; $pef34936b = $this->pdf77ee66->getAvailablePermissions(); $pf5478be6 = $pef34936b[ UserAuthenticationHandler::$PERMISSION_BELONG_NAME ]; $v3fab52f440 = $this->md5afbe6fdc19(LAYER_PATH . $v00e8ae73a2); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; $pb512d021 = new WorkFlowBeansFileHandler($this->v0d51bbbc63 . $this->pa0462a8e, $this->v0cd49d5a59); $pd3623f40 = $pb512d021->getBeanObject($this->v8ffce2a791); $pa47fac06 = $pd3623f40->getCommonProjectName(); if ($pa47fac06 && $pa47fac06 != $pd93efc3e) { $v7dc9f8567d = $pd3623f40->getLayerPathSetting(); $v3fab52f440 = $this->md5afbe6fdc19($v7dc9f8567d . $pa47fac06); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } foreach ($v2635bad135 as $v43974ff697 => $pfd248cca) if (in_array($v43974ff697, array("business_logic_layers", "data_access_layers", "db_layers"))) foreach ($pfd248cca as $v0a5deb92d8 => $v4a24304713) { $pc38bce14 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $v4a24304713["properties"]["bean_file_name"], $v4a24304713["properties"]["bean_name"], $this->v0cd49d5a59); if ($v43974ff697 == "db_layers") { $v3fab52f440 = $this->md5afbe6fdc19(LAYER_PATH . $pc38bce14); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } else { if ($pd93efc3e) { $pd5679809 = LAYER_PATH . "$pc38bce14/$pd93efc3e"; $v3fab52f440 = $this->md5afbe6fdc19($pd5679809); if ($v830c8335f6 && !file_exists($pd5679809)) mkdir($pd5679809, 0755, true); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } if ($pa47fac06 && $pa47fac06 != $pd93efc3e) { $v3fab52f440 = $this->md5afbe6fdc19(LAYER_PATH . "$pc38bce14/$pa47fac06"); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } $v3fab52f440 = $this->md5afbe6fdc19(LAYER_PATH . "$pc38bce14/module"); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; $v3fab52f440 = $this->md5afbe6fdc19(LAYER_PATH . "$pc38bce14/program"); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; $v3fab52f440 = $this->md5afbe6fdc19(LAYER_PATH . "$pc38bce14/resource"); if (!$this->f9607fe737e($v1a222c94d4, $v24d63e0b1f, $v3fab52f440, $pf5478be6)) $v5c1c342594 = false; } } } return $v5c1c342594; } } return false; } private function mc32603311706($pac8b5980, $v404d1208d7, $paca7d263 = null) { if ($pac8b5980 && $v404d1208d7 && $pac8b5980 != $v404d1208d7) { $v5cc54bf9f5 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $this->pa0462a8e, $this->v8ffce2a791, $this->v0cd49d5a59) . "/"; $v56451e6fbf = substr($pac8b5980, 0, strlen($v5cc54bf9f5)) == $v5cc54bf9f5 ? substr($pac8b5980, strlen($v5cc54bf9f5)) : null; $pb8081b08 = substr($v404d1208d7, 0, strlen($v5cc54bf9f5)) == $v5cc54bf9f5 ? substr($v404d1208d7, strlen($v5cc54bf9f5)) : null; $v5c1c342594 = true; if ($v56451e6fbf && $v404d1208d7) { $v2635bad135 = AdminMenuHandler::getLayersFiles($this->v0cd49d5a59); if ($v2635bad135) { foreach ($v2635bad135 as $v43974ff697 => $pfd248cca) if (in_array($v43974ff697, array("business_logic_layers", "data_access_layers"))) foreach ($pfd248cca as $v0a5deb92d8 => $v4a24304713) { $pc38bce14 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $v4a24304713["properties"]["bean_file_name"], $v4a24304713["properties"]["bean_name"], $this->v0cd49d5a59); $pc49ff70b = LAYER_PATH . "$pc38bce14/$v56451e6fbf"; $v29408ca6f9 = LAYER_PATH . "$pc38bce14/$pb8081b08"; if (is_dir($pc49ff70b) && !file_exists($v29408ca6f9)) { $v2cd5d67337 = array_diff(scandir($pc49ff70b), array('..', '.')); if (is_array($paca7d263)) $v2cd5d67337 = array_diff($v2cd5d67337, $paca7d263); if (count($v2cd5d67337) == 0 && !rename($pc49ff70b, $v29408ca6f9)) $v5c1c342594 = false; } } } } return $v5c1c342594; } return false; } private function f195421101c($v00e8ae73a2) { if ($v00e8ae73a2) { $v5cc54bf9f5 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $this->pa0462a8e, $this->v8ffce2a791, $this->v0cd49d5a59) . "/"; $pd93efc3e = substr($v00e8ae73a2, 0, strlen($v5cc54bf9f5)) == $v5cc54bf9f5 ? substr($v00e8ae73a2, strlen($v5cc54bf9f5)) : null; $v5c1c342594 = true; if ($pd93efc3e) { $v2635bad135 = AdminMenuHandler::getLayersFiles($this->v0cd49d5a59); if ($v2635bad135) { foreach ($v2635bad135 as $v43974ff697 => $pfd248cca) if (in_array($v43974ff697, array("business_logic_layers", "data_access_layers"))) foreach ($pfd248cca as $v0a5deb92d8 => $v4a24304713) { $pc38bce14 = WorkFlowBeansFileHandler::getLayerBeanFolderName($this->v0d51bbbc63 . $v4a24304713["properties"]["bean_file_name"], $v4a24304713["properties"]["bean_name"], $this->v0cd49d5a59); $pd5679809 = LAYER_PATH . "$pc38bce14/$pd93efc3e"; if (is_dir($pd5679809)) { $v2cd5d67337 = array_diff(scandir($pd5679809), array('..', '.')); if (count($v2cd5d67337) == 0 && !CMSModuleUtil::deleteFolder($pd5679809)) $v5c1c342594 = false; } } } } return $v5c1c342594; } return false; } private function f9607fe737e($v1a222c94d4, $v0a035c60aa, $v3fab52f440, $pb76ee81a) { if ($v1a222c94d4 && $v0a035c60aa && $v3fab52f440 && $pb76ee81a) { $v80e52685d5 = $this->f97ce0c693a($v1a222c94d4); if ($v80e52685d5 && $this->md21cb7e9cc46($v1a222c94d4, $v0a035c60aa, $v3fab52f440, $pb76ee81a)) return true; $v5c1c342594 = $this->pdf77ee66->insertLayoutTypePermission(array( "layout_type_id" => $v1a222c94d4, "object_type_id" => $v0a035c60aa, "object_id" => $v3fab52f440, "permission_id" => $pb76ee81a, )); if ($v5c1c342594) $this->f97ce0c693a($v1a222c94d4, true); return $v5c1c342594; } return false; } private function f48c96703a6($v1a222c94d4, $v0a035c60aa, $v188faededb, $pc1da042e, $v2c82d915c4 = true) { if ($v1a222c94d4 && $v0a035c60aa && $v188faededb && $pc1da042e) { $v80e52685d5 = $this->f97ce0c693a($v1a222c94d4); if ($v80e52685d5 && $this->md21cb7e9cc46($v1a222c94d4, $v0a035c60aa, $v188faededb)) { $this->v8139553e50[$v1a222c94d4][$v0a035c60aa][$pc1da042e] = $this->v8139553e50[$v1a222c94d4][$v0a035c60aa][$v188faededb]; unset($this->v8139553e50[$v1a222c94d4][$v0a035c60aa][$v188faededb]); return $this->pdf77ee66->updateLayoutTypesByObjectsPermissions($v1a222c94d4, $this->v8139553e50[$v1a222c94d4]); } } return $v2c82d915c4; } private function f17c784e328($v00e8ae73a2) { if ($this->v46a9c3505c[$v00e8ae73a2]) return $this->v46a9c3505c[$v00e8ae73a2]; $v1bfcb73f58 = $this->pdf77ee66->searchLayoutTypes(array( "type_id" => UserAuthenticationHandler::$LAYOUTS_TYPE_FROM_PROJECT_ID, "name" => $v00e8ae73a2 )); if ($v1bfcb73f58 && $v1bfcb73f58[0]) { $this->v46a9c3505c[$v00e8ae73a2] = $v1bfcb73f58[0]; return $v1bfcb73f58[0]; } return null; } private function f97ce0c693a($v1a222c94d4, $v543a4abeae = false) { if ($v1a222c94d4 && ($v543a4abeae || !$this->v8139553e50[$v1a222c94d4])) { $pff25d6bd = $this->pdf77ee66->searchLayoutTypePermissions(array("layout_type_id" => $v1a222c94d4)); if (is_array($pff25d6bd)) { foreach ($pff25d6bd as $pb8889c54) $this->v8139553e50[$v1a222c94d4][ $pb8889c54["object_type_id"] ][ $pb8889c54["object_id"] ][] = $pb8889c54["permission_id"]; } } return $v1a222c94d4 ? $this->v8139553e50[$v1a222c94d4] : null; } private function md21cb7e9cc46($v1a222c94d4, $v0a035c60aa, $v3fab52f440, $pb76ee81a = null) { if ($v1a222c94d4 && $v0a035c60aa && $v3fab52f440 && !empty($this->v8139553e50[$v1a222c94d4][$v0a035c60aa][$v3fab52f440]) && is_array($this->v8139553e50[$v1a222c94d4][$v0a035c60aa][$v3fab52f440]) ) { return !$pb76ee81a || in_array($pb76ee81a, $this->v8139553e50[$v1a222c94d4][$v0a035c60aa][$v3fab52f440]); } return false; } private function f7c8bfdf331($v7e136b813a) { if (substr($v7e136b813a, 0, strlen(LAYER_PATH)) == LAYER_PATH) $v00e8ae73a2 = substr($v7e136b813a, strlen(LAYER_PATH)); else $v00e8ae73a2 = $v7e136b813a; $v00e8ae73a2 = preg_replace("/\/+$/", "", $v00e8ae73a2); $v00e8ae73a2 = preg_replace("/^\/+/", "", $v00e8ae73a2); $v00e8ae73a2 = preg_replace("/\/+/", "/", $v00e8ae73a2); return $v00e8ae73a2; } private function md5afbe6fdc19($v7e136b813a) { if (substr($v7e136b813a, 0, strlen(APP_PATH)) == APP_PATH) $v3fab52f440 = substr($v7e136b813a, strlen(APP_PATH)); else $v3fab52f440 = $v7e136b813a; $v3fab52f440 = preg_replace("/\/+$/", "", $v3fab52f440); $v3fab52f440 = preg_replace("/^\/+/", "", $v3fab52f440); $v3fab52f440 = preg_replace("/\/+/", "/", $v3fab52f440); return $v3fab52f440; } private function f1bb72db551() { if (!$this->v8ffce2a791 || !$this->pa0462a8e) launch_exception(new Exception("Bean name or bean file name in LayoutTypeProjectHandler constructor cannot be empty!")); } } ?>
