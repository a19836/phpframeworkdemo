<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sql_mapping>
	<insert id="insert_attachment">
		insert into mat_attachment (name, type, size, path, created_date, modified_date) values ('#name#', '#type#', #size#, '#path#', '#created_date#', '#modified_date#')
	</insert>
	
	<update id="update_attachment">
		update mat_attachment set name='#name#', type='#type#', size=#size#, path='#path#', modified_date='#modified_date#' where attachment_id=#attachment_id#
	</update>
	
	<update id="update_attachment_name">
		update mat_attachment set name='#name#', modified_date='#modified_date#' where attachment_id=#attachment_id#
	</update>
	
	<delete id="delete_attachment">
		delete from mat_attachment where attachment_id=#attachment_id#
	</delete>
	
	<select id="get_attachment">
		select * from mat_attachment where attachment_id=#attachment_id#
	</select>
	
	<select id="get_all_attachments">
		select * from mat_attachment
	</select>
	
	<select id="count_all_attachments">
		select count(attachment_id) total from mat_attachment
	</select>
	
	<select id="get_attachments_by_ids">
		select * from mat_attachment where attachment_id in (#attachment_ids#)
	</select>
	
	<select id="get_attachments_by_conditions">
		select * from mat_attachment where #conditions#
	</select>
	
	<select id="count_attachments_by_conditions">
		select count(attachment_id) total from mat_attachment where #conditions#
	</select>
	
	<select id="get_attachments_by_object">
		select a.*, oa.`group` `group`, oa.`order` `order`
		from mat_attachment a 
		inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id=#object_id#
	</select>
	
	<select id="get_attachments_by_objects">
		select a.*, oa.object_type_id, oa.object_id, oa.`group` `group`, oa.`order` `order`
		from mat_attachment a 
		inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id in (#object_ids#)
	</select>
	
	<select id="get_attachments_by_object_group">
		select a.*, oa.`group` `group`, oa.`order` `order`
		from mat_attachment a 
		inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id=#object_id# and oa.`group`=#group#
	</select>
	
	<select id="get_attachments_by_objects_group">
		select a.*, oa.object_type_id, oa.object_id, oa.`group` `group`, oa.`order` `order`
		from mat_attachment a 
		inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id in (#object_ids#) and oa.`group` in (#groups#)
	</select>
</sql_mapping>
