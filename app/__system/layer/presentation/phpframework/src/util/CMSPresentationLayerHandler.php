<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
include_once get_lib("org.phpframework.util.MyArray"); include_once get_lib("org.phpframework.layer.presentation.cms.CMSFileHandler"); include_once get_lib("org.phpframework.layer.presentation.cms.CMSExternalTemplateLayer"); include_once get_lib("org.phpframework.workflow.WorkFlowTask"); include_once get_lib("org.phpframework.cms.wordpress.WordPressUrlsParser"); include_once get_lib("org.phpframework.phpscript.PHPUICodeExpressionHandler"); include_once $EVC->getUtilPath("AdminMenuHandler"); include_once $EVC->getUtilPath("WorkFlowBeansFileHandler"); include_once $EVC->getUtilPath("CMSPresentationLayerJoinPointsUIHandler"); class CMSPresentationLayerHandler { public static function configureUniqueFileId(&$pbee67690, $pdcf670f6 = "", $v77cb07b555 = "") { $pbee67690 = trim($pbee67690); while (substr($pbee67690, -1) == "/") $pbee67690 = substr($pbee67690, 0, -1); if (strlen($pbee67690)) { $v250a1176c9 = $pbee67690; $v3727108dfe = ""; $pac5c0f6d = strrpos($pbee67690, "/"); if ($pac5c0f6d !== false) { $v3727108dfe = substr($pbee67690, 0, $pac5c0f6d + 1); $v250a1176c9 = substr($pbee67690, $pac5c0f6d + 1); } $v5442ff2fbd = pathinfo($v250a1176c9); $v6bfcc44e7b = $v5442ff2fbd["extension"] ? "." . $v5442ff2fbd["extension"] : ""; $pe3b24b6a = $v5442ff2fbd["filename"]; $pbd1bc7b0 = strrpos($pe3b24b6a, "_"); $v250a1176c9 = $pbd1bc7b0 !== false && is_numeric(substr($pe3b24b6a, $pbd1bc7b0 + 1)) ? substr($pe3b24b6a, 0, $pbd1bc7b0) : $pe3b24b6a; $v15f3268002 = 0; while(file_exists("$pdcf670f6$pbee67690$v77cb07b555")) { $v15f3268002++; $pbee67690 = $v3727108dfe . $v250a1176c9 . "_" . $v15f3268002 . $v6bfcc44e7b; } } } public static function getFilePathId($v188b4f5fa6, $pf3dc0762) { $pa2bba2ac = $v188b4f5fa6->getPresentationLayer()->getLayerPathSetting(); $v9a84a79e2e = str_replace($pa2bba2ac, "", $pf3dc0762); $v9a84a79e2e = substr($v9a84a79e2e, 0, -4); $pbee67690 = "file_" . HashCode::getHashCodePositive($v9a84a79e2e); return $pbee67690; } public static function isEntityFileHardCoded($v08d9602741, $pe77f177a, $v29c163a46f, $pf3dc0762, $pfca440c2 = false, $pdb9e96e6 = null, $v8ffce2a791 = null) { if (file_exists($pf3dc0762)) { $v067674f4e4 = file_get_contents($pf3dc0762); $pb0277fa1 = self::getCachedEntitySaveActionTime($pe77f177a, $v29c163a46f, $pf3dc0762); $v47b0b0b0d8 = filemtime($pf3dc0762); $v86a2fe4410 = $v067674f4e4 && (!$pb0277fa1 || $pb0277fa1 != $v47b0b0b0d8); if ($v86a2fe4410 && $pfca440c2 && $pdb9e96e6 && $v8ffce2a791) { $v9ab35f1f0d = $v08d9602741->getPresentationLayer(); $pa2bba2ac = $v9ab35f1f0d->getLayerPathSetting(); $v6bfcc44e7b = $v9ab35f1f0d->getPresentationFileExtension(); $v6c7faf569b = str_replace($pa2bba2ac, "", dirname($pf3dc0762)); $v6c7faf569b .= substr($v6c7faf569b, -1) == "/" ? "" : "/"; $v250a1176c9 = pathinfo($pf3dc0762, PATHINFO_FILENAME); $pb4201a4b = WorkFlowTasksFileHandler::getTaskFilePathByPath($pdb9e96e6, "presentation_ui", "_{$v8ffce2a791}_" . md5($v6c7faf569b)); $v8cd3e3837d = new WorkFlowTasksFileHandler($pb4201a4b); $v8cd3e3837d->init(); $v1d696dbd12 = $v8cd3e3837d->getWorkflowData(); if ($v1d696dbd12 && $v1d696dbd12["tasks"]) foreach ($v1d696dbd12["tasks"] as $v7f5911d32d) if ($v7f5911d32d["properties"]["file_name"] == $v250a1176c9) { $pbee67690 = self::getFilePathId($v08d9602741, $pf3dc0762); if ($v7f5911d32d["properties"]["created_files"][$pbee67690] == $v47b0b0b0d8) $v86a2fe4410 = false; break; } } return $v86a2fe4410; } return false; } public static function cacheEntitySaveActionTime($v08d9602741, $pe77f177a, $v29c163a46f, $pf3dc0762, $v8ee58f54f1 = false, $pdb9e96e6 = null, $v8ffce2a791 = null) { $pe77f177a->config(false, false); $v47b0b0b0d8 = filemtime($pf3dc0762); $pcc09eb12 = md5($v29c163a46f . str_replace(APP_PATH, "", $pf3dc0762)); $pe77f177a->write($pcc09eb12, $v47b0b0b0d8); if ($v8ee58f54f1 && $pdb9e96e6 && $v8ffce2a791) { $v9ab35f1f0d = $v08d9602741->getPresentationLayer(); $pa2bba2ac = $v9ab35f1f0d->getLayerPathSetting(); $v6bfcc44e7b = $v9ab35f1f0d->getPresentationFileExtension(); $v6c7faf569b = str_replace($pa2bba2ac, "", dirname($pf3dc0762)); $v6c7faf569b .= substr($v6c7faf569b, -1) == "/" ? "" : "/"; $v250a1176c9 = pathinfo($pf3dc0762, PATHINFO_FILENAME); $pb4201a4b = WorkFlowTasksFileHandler::getTaskFilePathByPath($pdb9e96e6, "presentation_ui", "_{$v8ffce2a791}_" . md5($v6c7faf569b)); $v8cd3e3837d = new WorkFlowTasksFileHandler($pb4201a4b); $v8cd3e3837d->init(); $v1d696dbd12 = $v8cd3e3837d->getWorkflowData(); $v7959970a41 = false; if ($v1d696dbd12 && $v1d696dbd12["tasks"]) foreach ($v1d696dbd12["tasks"] as $v8282c7dd58 => $v7f5911d32d) if ($v7f5911d32d["properties"]["file_name"] == $v250a1176c9) { $v7959970a41 = true; $pbee67690 = self::getFilePathId($v08d9602741, $pf3dc0762); if (!$v7f5911d32d["properties"]["created_files"]) $v1d696dbd12["tasks"][$v8282c7dd58]["properties"]["created_files"] = array(); $v1d696dbd12["tasks"][$v8282c7dd58]["properties"]["created_files"][$pbee67690] = $v47b0b0b0d8; break; } if ($v7959970a41) WorkFlowTasksFileHandler::createTasksFile($pb4201a4b, $v1d696dbd12); } } public static function getCachedEntitySaveActionTime($pe77f177a, $v29c163a46f, $pf3dc0762) { $pe77f177a->config(false, false); $pcc09eb12 = md5($v29c163a46f . str_replace(APP_PATH, "", $pf3dc0762)); return $pe77f177a->read($pcc09eb12); } public static function getPresentationLayerProjectUrl($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v2508589a4c) { $v6f3a2700dd = null; $pb512d021 = new WorkFlowBeansFileHandler($v5039a77f9d . $pa0462a8e, $v3d55458bcd); $v188b4f5fa6 = $pb512d021->getEVCBeanObject($v8ffce2a791, $v2508589a4c); $pa1a69218 = $GLOBALS["presentation_id"]; $GLOBALS["presentation_id"] = $v2508589a4c; $v188b4f5fa6->getPresentationLayer()->setSelectedPresentationId($v2508589a4c); $EVC = $v188b4f5fa6; @include $EVC->getConfigPath("config", $v2508589a4c); if ($project_url_prefix) { $v6f3a2700dd = $project_url_prefix; } $GLOBALS["presentation_id"] = $pa1a69218; return $v6f3a2700dd; } public static function getPresentationLayerProjectLogo($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v2508589a4c) { $pd321faee = null; $paff6ce6f = null; $pb512d021 = new WorkFlowBeansFileHandler($v5039a77f9d . $pa0462a8e, $v3d55458bcd); $v188b4f5fa6 = $pb512d021->getEVCBeanObject($v8ffce2a791, $v2508589a4c); $pa1a69218 = $GLOBALS["presentation_id"]; $GLOBALS["presentation_id"] = $v2508589a4c; $v188b4f5fa6->getPresentationLayer()->setSelectedPresentationId($v2508589a4c); $EVC = $v188b4f5fa6; @include $EVC->getConfigPath("config", $v2508589a4c); if ($project_url_prefix) { $v5c398c2c28 = $v188b4f5fa6->getWebrootPath(); $v943d04e731 = array( $v5c398c2c28 => "", $v5c398c2c28 . "img/" => "img/" ); $v1846d48ea9 = array("favicon", "icon", "logo"); $v2e8d892c7e = array("ico", "gif", "png", "jpg", "jpeg", "tif", "tiff", "bmp", "webp", "svg", "psd", "raw", "heif", "bat"); foreach ($v943d04e731 as $pdd397f0a => $v69e970e17e) if ($pdd397f0a && is_dir($pdd397f0a)) { $v6ee393d9fb = array_diff(scandir($pdd397f0a), array('..', '.')); foreach ($v6ee393d9fb as $v7dffdb5a5b) { $v5e813b295b = strtolower(pathinfo($v7dffdb5a5b, PATHINFO_FILENAME)); $v6bfcc44e7b = strtolower(pathinfo($v7dffdb5a5b, PATHINFO_EXTENSION)); if (in_array($v5e813b295b, $v1846d48ea9) && in_array($v6bfcc44e7b, $v2e8d892c7e)) { $pd321faee = "$project_url_prefix$v69e970e17e$v7dffdb5a5b"; $paff6ce6f = "$pdd397f0a$v7dffdb5a5b"; break 2; } } if ($v1c32b0c991) break 1; } } $GLOBALS["presentation_id"] = $pa1a69218; return array($pd321faee, $paff6ce6f); } public static function getPresentationLayerProjectDescription($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v2508589a4c) { $pd2c744e8 = ""; $pb512d021 = new WorkFlowBeansFileHandler($v5039a77f9d . $pa0462a8e, $v3d55458bcd); $v188b4f5fa6 = $pb512d021->getEVCBeanObject($v8ffce2a791, $v2508589a4c); $v5c398c2c28 = $v188b4f5fa6->getWebrootPath(); $pf3dc0762 = $v5c398c2c28 . "humans.txt"; if ($v5c398c2c28 && is_dir($v5c398c2c28) && file_exists($pf3dc0762)) $pd2c744e8 = file_get_contents($pf3dc0762); return $pd2c744e8; } public static function getPresentationLayersProjectsFiles($v3d55458bcd, $v5039a77f9d, $v3fb9f41470 = false, $pc437c891 = false, $pb1924b99 = -1, $v22bccb82c7 = false, $v5d74214952 = null, $v367039a361 = false) { $v2635bad135 = AdminMenuHandler::getLayers($v3d55458bcd); $v58053186ba = $v2635bad135["presentation_layers"]; if (is_array($v58053186ba)) { $v6ee393d9fb = array(); if ($v5d74214952) { $v5d74214952 .= "/"; $v5d74214952 = preg_replace("/\/+/", "/", $v5d74214952); $v5d74214952 = preg_replace("/^\/+/", "/", $v5d74214952); } foreach ($v58053186ba as $v8ffce2a791 => $pa0462a8e) { $pb512d021 = new WorkFlowBeansFileHandler($v5039a77f9d . $pa0462a8e, $v3d55458bcd); $v972f1a5c2b = $pb512d021->getBeanObject($v8ffce2a791); $v4e418a3dfa = WorkFlowBeansFileHandler::getLayerNameFromBeanObject($v8ffce2a791, $v972f1a5c2b); $v90b50cf52d = self::getPresentationLayerProjectsFiles($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v3fb9f41470, $pc437c891, $pb1924b99, $v22bccb82c7, $v367039a361); if ($v90b50cf52d && $v5d74214952) foreach ($v90b50cf52d as $v29e5d6d712 => $v20dfc6306e) if (substr($v29e5d6d712, 0, strlen($v5d74214952)) != $v5d74214952) unset($v90b50cf52d[$v29e5d6d712]); $v6ee393d9fb[$v8ffce2a791] = array( "bean_file_name" => $pa0462a8e, "item_label" => $v4e418a3dfa, "projects" => $v90b50cf52d, ); } } return $v6ee393d9fb; } public static function getPresentationLayerProjectsFiles($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v3fb9f41470 = false, $pc437c891 = false, $pb1924b99 = -1, $v22bccb82c7 = false, $v367039a361 = false) { $v6ee393d9fb = array(); $pb512d021 = new WorkFlowBeansFileHandler($v5039a77f9d . $pa0462a8e, $v3d55458bcd); $v972f1a5c2b = $pb512d021->getEVCBeanObject($v8ffce2a791); if ($v972f1a5c2b) { $v9ab35f1f0d = $v972f1a5c2b->getPresentationLayer(); $pa2bba2ac = $v9ab35f1f0d->getLayerPathSetting(); $pa47fac06 = $v9ab35f1f0d->getCommonProjectName(); $v9643d970d1 = self::getPresentationLayerPrefixPath($v9ab35f1f0d, $v3fb9f41470); if (is_dir($pa2bba2ac)) { $pf9b48cd3 = array(); $v90b50cf52d = $v972f1a5c2b->getProjectsId("", $pf9b48cd3); asort($v90b50cf52d); $v9643d970d1 .= $v9643d970d1 && substr($v9643d970d1, strlen($v9643d970d1) - 1) != "/" ? "/" : ""; if ($v22bccb82c7 && $pf9b48cd3) { asort($pf9b48cd3); foreach ($pf9b48cd3 as $v29e5d6d712) { $v7e136b813a = $pa2bba2ac . $v29e5d6d712; $v6ee393d9fb[$v29e5d6d712] = array( "path" => $v7e136b813a, "element_type_path" => $v29e5d6d712 . "/" . $v9643d970d1, "item_type" => "project_folder", ); } } foreach ($v90b50cf52d as $v29e5d6d712) $v6ee393d9fb[$v29e5d6d712] = self::getPresentationLayerProjectFiles($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $pa2bba2ac, $v29e5d6d712, $v9643d970d1, $pc437c891, $pb1924b99, $v367039a361); } } return $v6ee393d9fb; } public static function getPresentationLayerProjectFiles($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $pa2bba2ac, $v29e5d6d712, $v9643d970d1 = false, $pc437c891 = false, $pb1924b99 = -1, $v367039a361 = false) { $v7e136b813a = $pa2bba2ac . $v29e5d6d712; $v93756c94b3 = array( "path" => $v7e136b813a, "element_type_path" => $v29e5d6d712 . "/" . $v9643d970d1, "files" => $v9643d970d1 ? self::getFolderFilesTree($pa2bba2ac, $v7e136b813a . "/" . $v9643d970d1, $pc437c891, $pb1924b99) : null, "item_type" => $pa47fac06 != $v29e5d6d712 ? "project" : "project_common", ); if ($v367039a361) { $v6f3a2700dd = self::getPresentationLayerProjectUrl($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v29e5d6d712); $pa5b85276 = self::getPresentationLayerProjectLogo($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v29e5d6d712); $pd2c744e8 = self::getPresentationLayerProjectDescription($v3d55458bcd, $v5039a77f9d, $pa0462a8e, $v8ffce2a791, $v29e5d6d712); $v93756c94b3["url"] = $v6f3a2700dd; $v93756c94b3["logo_url"] = $pa5b85276[0]; $v93756c94b3["logo_path"] = $pa5b85276[1]; $v93756c94b3["description"] = $pd2c744e8; } return $v93756c94b3; } public static function getPresentationLayerPrefixPath($v847a7225e0, $v3fb9f41470) { switch ($v3fb9f41470) { case "entity": return $v847a7225e0->settings["presentation_entities_path"]; case "view": return $v847a7225e0->settings["presentation_views_path"]; case "template": return $v847a7225e0->settings["presentation_templates_path"]; case "util": return $v847a7225e0->settings["presentation_utils_path"]; case "block": return $v847a7225e0->settings["presentation_blocks_path"]; case "webroot": return $v847a7225e0->settings["presentation_webroot_path"]; case "config": return $v847a7225e0->settings["presentation_configs_path"]; } return ""; } public static function getFolderFilesTree($pe6d4823f, $pdd397f0a, $pc437c891 = false, $pb1924b99 = -1) { $v6ee393d9fb = array(); $v802bcfdfc9 = $pb1924b99 > 0 ? $pb1924b99 - 1 : $pb1924b99; if (is_dir($pdd397f0a) && ($v89d33f4133 = opendir($pdd397f0a)) ) { while( ($v7dffdb5a5b = readdir($v89d33f4133)) !== false) { if (substr($v7dffdb5a5b, 0, 1) != ".") { $v9a84a79e2e = $pdd397f0a . $v7dffdb5a5b; $pa32be502 = str_replace($pe6d4823f, "", $v9a84a79e2e); if (is_dir($v9a84a79e2e)) { $v2cd5d67337 = null; if ($pb1924b99 > 0 || $pb1924b99 == -1) $v2cd5d67337 = self::getFolderFilesTree($pe6d4823f, $v9a84a79e2e . "/", $pc437c891, $v802bcfdfc9); $v6ee393d9fb[$v7dffdb5a5b] = array( "name" => $v7dffdb5a5b, "type" => "folder", "sub_files" => $v2cd5d67337, "path" => $pa32be502, ); } else if (!$pc437c891) { $v5442ff2fbd = pathinfo($v7dffdb5a5b); if ($v5442ff2fbd["extension"] == "php") $v982d6fe381 = "php_file"; else if ($v5442ff2fbd["extension"] == "css") $v982d6fe381 = "css_file"; else if ($v5442ff2fbd["extension"] == "js") $v982d6fe381 = "js_file"; else if ($v5442ff2fbd["extension"] == "zip") $v982d6fe381 = "zip_file"; else if (exif_imagetype($v9a84a79e2e)) $v982d6fe381 = "img_file"; else $v982d6fe381 = "undefined_file"; $v6ee393d9fb[$v7dffdb5a5b] = array( "name" => $v5442ff2fbd["filename"], "type" => $v982d6fe381, "path" => $pa32be502, ); } } } closedir($v89d33f4133); } ksort($v6ee393d9fb); return $v6ee393d9fb; } public static function getFolderFilesList($pe6d4823f, $pdd397f0a, $pc437c891 = false) { $v6ee393d9fb = array(); if (is_dir($pdd397f0a) && ($v89d33f4133 = opendir($pdd397f0a)) ) { while( ($v7dffdb5a5b = readdir($v89d33f4133)) !== false) { if (substr($v7dffdb5a5b, 0, 1) != ".") { $v9a84a79e2e = $pdd397f0a . $v7dffdb5a5b; $pa32be502 = str_replace($pe6d4823f, "", $v9a84a79e2e); if (is_dir($v9a84a79e2e)) { $v6ee393d9fb[$pa32be502] = array( "type" => "folder", "name" => $v7dffdb5a5b, ); $v2cd5d67337 = self::getFolderFilesList($pe6d4823f, $v9a84a79e2e . "/", $pc437c891); $v6ee393d9fb = array_merge($v6ee393d9fb, $v2cd5d67337); } else if (!$pc437c891) { $v5442ff2fbd = pathinfo($v7dffdb5a5b); $v6ee393d9fb[$pa32be502] = array( "type" => "file", "name" => $v5442ff2fbd["filename"], ); } } } closedir($v89d33f4133); } return $v6ee393d9fb; } public static function getAvailableTemplatesList($v188b4f5fa6, $pee3fb492) { $v7f83e5a900 = $v188b4f5fa6->getTemplatesPath(); $v1fcdf76e5d = array("php", "html", "htm"); $v6ee393d9fb = self::getFolderFilesList($v7f83e5a900, $v7f83e5a900); ksort($v6ee393d9fb); $pf006418d = array(); $pee540c28 = array(); foreach ($v6ee393d9fb as $pf3dc0762 => $v7dffdb5a5b) { if ($v7dffdb5a5b["type"] == "folder" && file_exists($v7f83e5a900 . $pf3dc0762 . "/template.xml")) { $pfb662071 = XMLFileParser::parseXMLFileToArray($v7f83e5a900 . $pf3dc0762 . "/template.xml"); $pfb662071 = MyXML::complexArrayToBasicArray($pfb662071, array("lower_case_keys" => true, "trim" => true)); $pa5aa1779 = isset($pfb662071["template"]) ? $pfb662071["template"] : null; if ($pa5aa1779 && !empty($pa5aa1779["layouts"]["layout"])) { $pdd397f0a = $pf3dc0762 . "/"; $v1bfcb73f58 = is_array($pa5aa1779["layouts"]["layout"]) ? $pa5aa1779["layouts"]["layout"] : array($pa5aa1779["layouts"]["layout"]); $v2d69029767 = array(); foreach ($v1bfcb73f58 as $pd69fb7d0 => $v67eb76783f) { if (array_key_exists($pdd397f0a . $v67eb76783f, $v6ee393d9fb)) $v2d69029767[] = $pdd397f0a . $v67eb76783f; else if (array_key_exists($pdd397f0a . $v67eb76783f . $pee3fb492, $v6ee393d9fb)) $v2d69029767[] = $pdd397f0a . $v67eb76783f . $pee3fb492; } $pf006418d[$pdd397f0a] = $v2d69029767; } } else { $v14af37edde = true; foreach ($pf006418d as $pdd397f0a => $v2d69029767) if (substr($pf3dc0762, 0, strlen($pdd397f0a)) == $pdd397f0a) { $v14af37edde = false; if (in_array($pf3dc0762, $v2d69029767) && !isset($pee540c28[$pf3dc0762])) foreach ($v2d69029767 as $pddb21b57) $pee540c28[$pddb21b57] = $v6ee393d9fb[$pddb21b57]; break 1; } if ($v14af37edde && !isset($pee540c28[$pf3dc0762])) $pee540c28[$pf3dc0762] = $v7dffdb5a5b; } } $v6ee393d9fb = $pee540c28; $v94d48fb72f = array(); foreach ($v6ee393d9fb as $pf3dc0762 => $v7dffdb5a5b) { if ($v7dffdb5a5b["type"] != "folder") { $pf4addcfc = !in_array(pathinfo($pf3dc0762, PATHINFO_EXTENSION), $v1fcdf76e5d); if (strpos($pf3dc0762, "/region/") !== false || strpos($pf3dc0762, "/module/") !== false) { $pb1e3197f = strpos($pf3dc0762, "/"); $pc61c14a0 = substr($pf3dc0762, $pb1e3197f + 1, strpos($pf3dc0762, "/", $pb1e3197f + 1) - $pb1e3197f - 1); if ($pc61c14a0 == "region" || $pc61c14a0 == "module") $pf4addcfc = true; } if (!$pf4addcfc) { $v9a84a79e2e = substr($pf3dc0762, strlen($pf3dc0762) - strlen($pee3fb492)) == $pee3fb492 ? substr($pf3dc0762, 0, strlen($pf3dc0762) - strlen($pee3fb492)) : $pf3dc0762; $v7dffdb5a5b["path"] = $pf3dc0762; $v94d48fb72f[$v9a84a79e2e] = $v7dffdb5a5b; } } } $v5c8db1b6d8 = array("empty", "ajax", "blank"); $pacd2d0f6 = array(); for ($v43dd7d0051 = 0; $v43dd7d0051 < count($v5c8db1b6d8); $v43dd7d0051++) { $v9a84a79e2e = $v5c8db1b6d8[$v43dd7d0051]; if ($v94d48fb72f[$v9a84a79e2e]) { $pacd2d0f6[$v9a84a79e2e] = $v94d48fb72f[$v9a84a79e2e]; unset($v94d48fb72f[$v9a84a79e2e]); } } $v94d48fb72f = array_merge($pacd2d0f6, $v94d48fb72f); return $v94d48fb72f; } public static function getAvailableTemplatesProps($v188b4f5fa6, $v2508589a4c, $paf93610a) { $v94d48fb72f = array(); $EVC = $v188b4f5fa6; @include $EVC->getConfigPath("config", $v2508589a4c); $pfa121d4e = preg_replace("/\/+$/", "", $project_url_prefix); $v5c398c2c28 = $v188b4f5fa6->getWebrootPath() . "/template/"; $v3a658f5133 = array("php", "html", "htm"); $v2e8d892c7e = array("gif", "png", "jpg", "jpeg", "tif", "tiff", "bmp", "webp", "svg", "psd", "raw", "heif", "bat"); for ($v43dd7d0051 = 0; $v43dd7d0051 < count($paf93610a); $v43dd7d0051++) { $v9a84a79e2e = $paf93610a[$v43dd7d0051]; $v250a1176c9 = pathInfo($v9a84a79e2e, PATHINFO_FILENAME); $v94d48fb72f[$v9a84a79e2e] = array( "label" => ucwords(strtolower(str_replace(array("-", "_"), " ", $v250a1176c9))), "file" => $v9a84a79e2e . ".php", "logo" => null, "demo" => null, ); for ($v9d27441e80 = 0; $v9d27441e80 < count($v3a658f5133); $v9d27441e80++) { $pa32be502 = $v5c398c2c28 . $v9a84a79e2e . "." . $v3a658f5133[$v9d27441e80]; if (file_exists($pa32be502)) { $v94d48fb72f[$v9a84a79e2e]["demo"] = $pfa121d4e . "/template/" . $v9a84a79e2e . "." . $v3a658f5133[$v9d27441e80]; break; } } for ($v9d27441e80 = 0; $v9d27441e80 < count($v2e8d892c7e); $v9d27441e80++) { $pa32be502 = $v5c398c2c28 . $v9a84a79e2e . "." . $v2e8d892c7e[$v9d27441e80]; if (file_exists($pa32be502)) { $v94d48fb72f[$v9a84a79e2e]["logo"] = $pfa121d4e . "/template/" . $v9a84a79e2e . "." . $v2e8d892c7e[$v9d27441e80]; break; } } } return $v94d48fb72f; } public static function initBlocksListThroughRegionBlocks($v188b4f5fa6, $v2b1e634696, $v2508589a4c) { $v0f198000b9 = array(); if ($v2b1e634696) foreach ($v2b1e634696 as $pd06bdde3) { $v3fb9f41470 = $pd06bdde3[3]; $v90a480265d = $v3fb9f41470 == 2 || $v3fb9f41470 == 3; if ($v90a480265d) { $v9b9b8653bc = $pd06bdde3[0]; $peebaaf55 = $pd06bdde3[1]; $pd6ec966e = $pd06bdde3[2]; $v9b9b8653bc = substr($v9b9b8653bc, 0, 1) == '"' ? str_replace('"', '', $v9b9b8653bc) : $v9b9b8653bc; $peebaaf55 = substr($peebaaf55, 0, 1) == '"' ? str_replace('"', '', $peebaaf55) : $peebaaf55; $pd6ec966e = substr($pd6ec966e, 0, 1) == '"' ? str_replace('"', '', $pd6ec966e) : $pd6ec966e; $pd6ec966e = $pd6ec966e ? $pd6ec966e : $v2508589a4c; if ($pd6ec966e) $v0f198000b9[$pd6ec966e][] = $peebaaf55; } } return $v0f198000b9; } public static function getAvailableBlocksList($v188b4f5fa6, $pcda5797d) { $v5aaf0d3496 = array(); $v9ab35f1f0d = $v188b4f5fa6->getPresentationLayer(); $pa2bba2ac = $v9ab35f1f0d->getLayerPathSetting(); $pee3fb492 = "." . $v9ab35f1f0d->getPresentationFileExtension(); $pa47fac06 = $v9ab35f1f0d->getCommonProjectName(); $v90b50cf52d = $v188b4f5fa6->getProjectsId(); if ($v90b50cf52d[0] != $pcda5797d || $v90b50cf52d[1] != $pa47fac06) { $v90b50cf52d = array_flip($v90b50cf52d); unset($v90b50cf52d[$pcda5797d]); unset($v90b50cf52d[$pa47fac06]); $v90b50cf52d = array_merge(array($pcda5797d, $pa47fac06), array_flip($v90b50cf52d)); } $pc37695cb = count($v90b50cf52d); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v29e5d6d712 = $v90b50cf52d[$v43dd7d0051]; $v7e136b813a = $pa2bba2ac . $v29e5d6d712; $v4876e08d4b = $v7e136b813a . "/" . $v9ab35f1f0d->settings["presentation_blocks_path"]; $pb0a3359e = self::getFolderFilesList($v4876e08d4b, $v4876e08d4b); ksort($pb0a3359e); foreach ($pb0a3359e as $v9a84a79e2e => $v7dffdb5a5b) if ($v7dffdb5a5b["type"] != "folder") $v5aaf0d3496[$v29e5d6d712][] = substr($v9a84a79e2e, strlen($v9a84a79e2e) - strlen($pee3fb492)) == $pee3fb492 ? substr($v9a84a79e2e, 0, strlen($v9a84a79e2e) - strlen($pee3fb492)) : $v9a84a79e2e; } return $v5aaf0d3496; } public static function getAvailableBlockParams($v188b4f5fa6, $pf2e4821f, $v5aaf0d3496) { $v435a5d5967 = array(); $v9ab35f1f0d = $v188b4f5fa6->getPresentationLayer(); $pa2bba2ac = $v9ab35f1f0d->getLayerPathSetting(); $pee3fb492 = "." . $v9ab35f1f0d->getPresentationFileExtension(); $v2508589a4c = $v9ab35f1f0d->getSelectedPresentationId(); if ($pf2e4821f) { $pc37695cb = count($pf2e4821f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pd06bdde3 = $pf2e4821f[$v43dd7d0051]; $v3fb9f41470 = $pd06bdde3["type"]; $v90a480265d = $v3fb9f41470 == 2 || $v3fb9f41470 == 3; if ($v90a480265d && $pd06bdde3["block_type"] == "string") { $v29fec2ceaa = $pd06bdde3["block"]; $v93756c94b3 = $pd06bdde3["block_project"]; $v93756c94b3 = $v93756c94b3 ? $v93756c94b3 : $v2508589a4c; if (!$v5aaf0d3496[$v93756c94b3] || !in_array($v29fec2ceaa, $v5aaf0d3496[$v93756c94b3])) { $v93756c94b3 = self::getBlockProject($v29fec2ceaa, $v5aaf0d3496); $v93756c94b3 = $v93756c94b3 ? $v93756c94b3 : $v2508589a4c; } $v303bc2287d = $pa2bba2ac . "$v93756c94b3/" . $v9ab35f1f0d->settings["presentation_blocks_path"] . "$v29fec2ceaa$pee3fb492"; if (file_exists($v303bc2287d)) { $v9b9b8653bc = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["region"], $pd06bdde3["region_type"]); $peebaaf55 = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pd06bdde3["block_type"]); $v435a5d5967[ $v9b9b8653bc ][ $peebaaf55 ] = CMSFileHandler::getFileBlockParams($v303bc2287d); } } } } return $v435a5d5967; } public static function getBlockProject($v29fec2ceaa, $v5aaf0d3496) { if ($v5aaf0d3496) foreach ($v5aaf0d3496 as $v29e5d6d712 => $v9158f5ed68) if (in_array($v29fec2ceaa, $v9158f5ed68)) return $v29e5d6d712; return null; } public static function getAvailableBlockParamsList($v435a5d5967) { $v5e5b435544 = array(); foreach ($v435a5d5967 as $v9b9b8653bc => $pb88f7dfc) foreach ($pb88f7dfc as $peebaaf55 => $v9b391a5b1f) if ($v9b391a5b1f) { $pc37695cb = count($v9b391a5b1f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9acf40c110 = $v9b391a5b1f[$v43dd7d0051]; $v5e5b435544[$v9b9b8653bc][$peebaaf55][] = PHPUICodeExpressionHandler::getArgumentCode($v9acf40c110["param"], $v9acf40c110["param_type"]); } } return $v5e5b435544; } public static function getBlockParamsValuesList($v36aefa195e) { $peb496cef = array(); if ($v36aefa195e) { $pc37695cb = count($v36aefa195e); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v8936ce16b2 = $v36aefa195e[$v43dd7d0051]; $v9b9b8653bc = PHPUICodeExpressionHandler::getArgumentCode($v8936ce16b2["region"], $v8936ce16b2["region_type"]); $peebaaf55 = PHPUICodeExpressionHandler::getArgumentCode($v8936ce16b2["block"], $v8936ce16b2["block_type"]); $v58b61e02bc = PHPUICodeExpressionHandler::getArgumentCode($v8936ce16b2["param"], $v8936ce16b2["param_type"]); $v8a4df75785 = is_numeric($v8936ce16b2["region_block_index"]) ? $v8936ce16b2["region_block_index"] : 0; $peb496cef[$v9b9b8653bc][$peebaaf55][$v8a4df75785][$v58b61e02bc] = PHPUICodeExpressionHandler::getArgumentCode($v8936ce16b2["value"], $v8936ce16b2["value_type"]); } } return $peb496cef; } public static function getBlockParamsList($v188b4f5fa6, $pf2e4821f, $v067674f4e4, $v5aaf0d3496) { $v435a5d5967 = self::getAvailableBlockParams($v188b4f5fa6, $pf2e4821f, $v5aaf0d3496); $v5e5b435544 = self::getAvailableBlockParamsList($v435a5d5967); $v36aefa195e = CMSFileHandler::getRegionBlockParamsValues($v067674f4e4); $peb496cef = self::getBlockParamsValuesList($v36aefa195e); return array($v5e5b435544, $peb496cef); } public static function getAvailableRegionsList($v8ea5ee2b30, $v2508589a4c, $v3af75f12c5 = false) { $v067674f4e4 = CMSFileHandler::getFileContents($v8ea5ee2b30); return self::getAvailableRegionsListFromCode($v067674f4e4, $v2508589a4c, $v3af75f12c5); } public static function getAvailableRegionsListFromCode($v067674f4e4, $v2508589a4c, $v3af75f12c5 = false) { $v3f8f1acfdb = array(); $pc8bdb5e6 = CMSFileHandler::getRegionsBlocks($v067674f4e4); $pe031d4d8 = self::getRegionsBlocksList($pc8bdb5e6, $v2508589a4c); $v651d63364b = CMSFileHandler::getRegions($v067674f4e4); $v76da6d1e76 = array(); foreach ($pe031d4d8 as $v1758c645b6) { $v76da6d1e76[ $v1758c645b6[0] ] = true; } $pc37695cb = count($v651d63364b); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v327f72fb62 = $v651d63364b[$v43dd7d0051]; $v9b9b8653bc = PHPUICodeExpressionHandler::getArgumentCode($v327f72fb62["region"], $v327f72fb62["region_type"]); if (!$v3af75f12c5 || !isset($v76da6d1e76[$v9b9b8653bc])) $v3f8f1acfdb[] = $v9b9b8653bc; } return array_values( array_unique($v3f8f1acfdb) ); } public static function getRegionsBlocksList($pf2e4821f, $v2508589a4c) { $v2b1e634696 = array(); if ($pf2e4821f) { $pc37695cb = count($pf2e4821f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pd06bdde3 = $pf2e4821f[$v43dd7d0051]; $v3fb9f41470 = $pd06bdde3["type"]; $v7a1b9c07b3 = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["region"], $pd06bdde3["region_type"]); $v7aeaf992f5 = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pd06bdde3["block_type"]); $pedcd39ad = $pd06bdde3["block_project"] ? PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block_project"], $pd06bdde3["block_project_type"]) : '"' . $v2508589a4c . '"'; $v2b1e634696[] = array($v7a1b9c07b3, $v7aeaf992f5, $pedcd39ad, $v3fb9f41470); } } return $v2b1e634696; } public static function getAvailableTemplateParamsList($pf3dc0762, $v11ed7b345c = false) { $v067674f4e4 = CMSFileHandler::getFileContents($pf3dc0762); return self::getAvailableTemplateParamsListFromCode($v067674f4e4, $v11ed7b345c); } public static function getAvailableTemplateParamsListFromCode($v067674f4e4, $v11ed7b345c = false) { $v3fd37663c7 = array(); $pbbf03f8a = self::getAvailableTemplateParamsValuesList($v067674f4e4); $v9b391a5b1f = CMSFileHandler::getParams($v067674f4e4); $pc37695cb = count($v9b391a5b1f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9acf40c110 = $v9b391a5b1f[$v43dd7d0051]; $v5e813b295b = PHPUICodeExpressionHandler::getArgumentCode($v9acf40c110["param"], $v9acf40c110["param_type"]); if (!$v11ed7b345c || !isset($pbbf03f8a[$v5e813b295b])) $v3fd37663c7[] = $v5e813b295b; } return array( array_values( array_unique($v3fd37663c7) ), $pbbf03f8a); } public static function getAvailableTemplateParamsValuesList($v067674f4e4) { $pbbf03f8a = array(); $v9b391a5b1f = CMSFileHandler::getParamsValues($v067674f4e4); $pc37695cb = count($v9b391a5b1f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9acf40c110 = $v9b391a5b1f[$v43dd7d0051]; $v5e813b295b = PHPUICodeExpressionHandler::getArgumentCode($v9acf40c110["param"], $v9acf40c110["param_type"]); $v67db1bd535 = PHPUICodeExpressionHandler::getArgumentCode($v9acf40c110["value"], $v9acf40c110["value_type"]); $pbbf03f8a[$v5e813b295b] = $v67db1bd535; } return $pbbf03f8a; } public static function getWordPressInstallationsFoldersName($v08d9602741) { $pa47fac06 = $v08d9602741->getCommonProjectName(); $pfaca025b = $v08d9602741->getWebrootPath($pa47fac06) . WordPressUrlsParser::WORDPRESS_FOLDER_PREFIX . "/"; $v6ee393d9fb = file_exists($pfaca025b) ? array_diff(scandir($pfaca025b), array('..', '.')) : array(); if ($v6ee393d9fb) foreach ($v6ee393d9fb as $pd69fb7d0 => $v7dffdb5a5b) if (!is_dir($pfaca025b . $v7dffdb5a5b)) unset($v6ee393d9fb[$pd69fb7d0]); return array_values($v6ee393d9fb); } public static function getFileCodeSetTemplate($v067674f4e4) { $v94d48fb72f = CMSFileHandler::getTemplates($v067674f4e4); if ($v94d48fb72f[0]) { $v01c84b1653 = $v94d48fb72f[0]["template"]; $v9e3513bc0e = $v94d48fb72f[0]["template_params"]; if ($v94d48fb72f[0]["template_params_type"] == "array" && is_array($v9e3513bc0e)) $v9e3513bc0e = CMSPresentationLayerJoinPointsUIHandler::convertBlockSettingsArrayToObj($v9e3513bc0e); return array( "template_code" => $v01c84b1653, "template_params" => $v9e3513bc0e, ); } } public static function isSetTemplateParamsValid($v08d9602741, $pb46d1829) { if (!$pb46d1829) return false; $v7b2ad4afbf = $pb46d1829["template_code"]; $pcb2931a9 = $pb46d1829["template_params"]; if (is_array($pcb2931a9)) { $pb9273491 = $pcb2931a9["type"]; $v9ce4ec6a3b = $pcb2931a9["project_id"]; } if (isset($pcb2931a9) && ( ($v7b2ad4afbf && $v7b2ad4afbf != "parse_php_code") || ($pb9273491 && $pb9273491["value"] && $pb9273491["value_type"] != 'string') || ($pb9273491 && $pb9273491["value"] && ( !$v9ce4ec6a3b || !$v9ce4ec6a3b["value"] || ($v9ce4ec6a3b["value_type"] == "string" && $v9ce4ec6a3b["value"] != $v08d9602741->getCommonProjectName()) || ($v9ce4ec6a3b["value_type"] != "string" && preg_replace("/\s+/", "", $v9ce4ec6a3b["value"]) != '$EVC->getCommonProjectName()') )) ) ) return false; return true; } public static function isSetTemplateExternalTemplate($v08d9602741, $pb46d1829) { $v7b2ad4afbf = $pb46d1829["template_code"]; $v65a4acbc39 = $pb46d1829["template_params"]; $v4ff2642e3e = is_array($v65a4acbc39) ? $v65a4acbc39["project_id"] : null; return $v7b2ad4afbf == "parse_php_code" && $v4ff2642e3e && ( ($v4ff2642e3e["value_type"] == "string" && $v4ff2642e3e["value"] == $v08d9602741->getCommonProjectName()) || ($v4ff2642e3e["value_type"] != "string" && preg_replace("/\s+/", "", $v4ff2642e3e["value"]) == '$EVC->getCommonProjectName()') ); } public static function getSetTemplateCode($EVC, $v0febf893c5, $pe7333513, $v65a4acbc39, $v66a6023e1e) { if ($v0febf893c5) { $pc0e3086a = get_defined_vars(); include $EVC->getConfigPath("config"); $pfced817d = get_defined_vars(); $pc5a892eb = array_diff_key($pfced817d, $pc0e3086a); $pc5a892eb["EVC"] = $EVC; unset($pc5a892eb["before_defined_vars"]); $pedc73c42 = '<?php return ' . WorkFlowTask::getArrayString($v65a4acbc39) . '; ?>'; PHPScriptHandler::parseContent($pedc73c42, $pc5a892eb, $v368e4322b2); $v9e3513bc0e = $v368e4322b2[0]; include_once $EVC->getUtilPath("include_text_translator_handler", $EVC->getCommonProjectName()); if ($v66a6023e1e) foreach ($v66a6023e1e as $pc24afc88) if ($pc24afc88["path"]) eval("include" . ($pc24afc88["once"] ? "_once" : "") . " " . $pc24afc88["path"] . ";"); if ($v9e3513bc0e && $v9e3513bc0e["type"] == "project") $v9e3513bc0e["add_template_xml_regions_and_params"] = true; $v067674f4e4 = CMSExternalTemplateLayer::getTemplateCode($EVC, $v9e3513bc0e, $pc5a892eb); } else if ($pe7333513) { $v8ea5ee2b30 = $EVC->getTemplatePath($pe7333513); $v067674f4e4 = CMSFileHandler::getFileContents($v8ea5ee2b30); } return $v067674f4e4; } public static function getFileAddBlockJoinPointsListByBlock($v303bc2287d) { $v0fa547ce72 = CMSFileHandler::getFileAddBlockJoinPoints($v303bc2287d); return self::getAddBlockJoinPointsListByBlock($v0fa547ce72); } public static function getAddBlockJoinPointsListByBlock($v0fa547ce72) { $pf615c15a = array(); if (is_array($v0fa547ce72)) { foreach ($v0fa547ce72 as $pc5f2e454) { $peebaaf55 = PHPUICodeExpressionHandler::getArgumentCode($pc5f2e454["block"], $pc5f2e454["block_type"]); $pf615c15a[$peebaaf55][] = $pc5f2e454; } } return $pf615c15a; } public static function getFileAddRegionBlockJoinPointsListByBlock($v303bc2287d) { $v0fa547ce72 = CMSFileHandler::getFileAddRegionBlockJoinPoints($v303bc2287d); return self::getAddRegionBlockJoinPointsListByBlock($v0fa547ce72); } public static function getAddRegionBlockJoinPointsListByBlock($v0fa547ce72) { $pf615c15a = array(); if (is_array($v0fa547ce72)) foreach ($v0fa547ce72 as $pc5f2e454) { $v9b9b8653bc = PHPUICodeExpressionHandler::getArgumentCode($pc5f2e454["region"], $pc5f2e454["region_type"]); $peebaaf55 = PHPUICodeExpressionHandler::getArgumentCode($pc5f2e454["block"], $pc5f2e454["block_type"]); $v8a4df75785 = is_numeric($pc5f2e454["region_block_index"]) ? $pc5f2e454["region_block_index"] : 0; $pf615c15a[$v9b9b8653bc][$peebaaf55][$v8a4df75785][] = $pc5f2e454; } return $pf615c15a; } public static function getFileBlockLocalJoinPointsListByBlock($v303bc2287d) { $pf615c15a = array(); $v0fa547ce72 = CMSFileHandler::getFileBlockLocalJoinPoints($v303bc2287d); if (is_array($v0fa547ce72)) foreach ($v0fa547ce72 as $pc5f2e454) { $peebaaf55 = PHPUICodeExpressionHandler::getArgumentCode($pc5f2e454["block"], $pc5f2e454["block_type"]); $pf615c15a[$peebaaf55][] = $pc5f2e454; } return $pf615c15a; } public static function getFilePageProperties($v93dda00907) { $v9073377656 = array(); $v305588d5f0 = CMSFileHandler::getFilePageProperties($v93dda00907); if (is_array($v305588d5f0)) foreach ($v305588d5f0 as $v7a224bb80d) { $v5e813b295b = $v7a224bb80d["prop_name"]; if ($v7a224bb80d["prop_value"] === null && $v7a224bb80d["prop_value_type"] === null) $v67db1bd535 = PHPUICodeExpressionHandler::getArgumentCode($v7a224bb80d["prop_default_value"], $v7a224bb80d["prop_default_value_type"]); else $v67db1bd535 = PHPUICodeExpressionHandler::getArgumentCode($v7a224bb80d["prop_value"], $v7a224bb80d["prop_value_type"]); $v956913c90f = $v67db1bd535 !== null ? strtolower($v67db1bd535) : ""; $v9073377656[$v5e813b295b] = !strlen($v956913c90f) || $v956913c90f == "null" ? null : ($v956913c90f == "false" || $v956913c90f == "0" || $v956913c90f == '"0"' || $v956913c90f == '""' || $v956913c90f == "''" ? false : (is_numeric($v956913c90f) ? $v956913c90f : true)); } return $v9073377656; } public static function createCMSLayerCodeForIncludes($pc06f1034) { $v067674f4e4 = ""; if ($pc06f1034) { $pc37695cb = count($pc06f1034); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pc24afc88 = $pc06f1034[$v43dd7d0051]; if ($pc24afc88["path"]) { $v067674f4e4 .= 'include' . ($pc24afc88["once"] ? '_once' : '') . ' ' . PHPUICodeExpressionHandler::getArgumentCode($pc24afc88["path"], $pc24afc88["path_type"]) . ';' . "\n"; } } $v067674f4e4 = $v067674f4e4 ? "//Includes\n$v067674f4e4" : ""; } return $v067674f4e4; } public static function createCMSLayerCodeForRegionsBLocks($v2508589a4c, $pee3fb492, $pf2e4821f, $pf1c1fb25 = false, $v63208850d1 = false) { $v067674f4e4 = ""; if ($pf2e4821f) { $pc37695cb = count($pf2e4821f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pd06bdde3 = $pf2e4821f[$v43dd7d0051]; if ($pd06bdde3["region"] && $pd06bdde3["block"]) { $v3fb9f41470 = $pd06bdde3["type"]; $v9f2c84d2ad = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["region"], $pd06bdde3["region_type"]); $v067674f4e4 .= "\n"; if ($v3fb9f41470 == 1) { $pa7fd620a = PHPUICodeExpressionHandler::getValueType($pd06bdde3["block"], array("empty_string_type" => "string", "non_set_type" => "string")); $pf8ed4912 = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pa7fd620a); $v067674f4e4 .= '$EVC->getCMSLayer()->getCMSTemplateLayer()->addRegionHtml(' . $v9f2c84d2ad . ', ' . $pf8ed4912 . ');' . "\n"; } else if ($v3fb9f41470 == 2 || $v3fb9f41470 == 3) { $v29fec2ceaa = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pd06bdde3["block_type"]); $v76425220d5 = PHPUICodeExpressionHandler::getValueType($pd06bdde3["block_project"], array("empty_string_type" => "string", "non_set_type" => "string")); $v175e16d850 = $v76425220d5 == "" ? str_replace('"', '', $pd06bdde3["block_project"]) : $pd06bdde3["block_project"]; $pedcd39ad = !$v175e16d850 || $v175e16d850 == $v2508589a4c ? "" : ", \"$v175e16d850\""; $v7959970a41 = false; if ($pf1c1fb25[$v43dd7d0051]) { $pd28479e5 = count($pf1c1fb25[$v43dd7d0051]); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) { $pdfec2e36 = $pf1c1fb25[$v43dd7d0051][$v9d27441e80]; if (PHPUICodeExpressionHandler::getArgumentCode($pdfec2e36["region"], $pdfec2e36["region_type"]) == $v9f2c84d2ad && PHPUICodeExpressionHandler::getArgumentCode($pdfec2e36["block"], $pdfec2e36["block_type"]) == $v29fec2ceaa && $pdfec2e36["name"] && strlen($pdfec2e36["value"])) { $v067674f4e4 .= '$region_block_local_variables[' . $v9f2c84d2ad . '][' . $v29fec2ceaa . '][' . PHPUICodeExpressionHandler::getArgumentCode($pdfec2e36["name"], $pdfec2e36["name_type"]) . '] = ' . PHPUICodeExpressionHandler::getArgumentCode($pdfec2e36["value"], $pdfec2e36["value_type"]) . ';' . "\n"; $v7959970a41 = true; } } } if ($v7959970a41) $v067674f4e4 .= '$block_local_variables = $region_block_local_variables[' . $v9f2c84d2ad . '][' . $v29fec2ceaa . '];' . "\n"; else $v067674f4e4 .= '$block_local_variables = array();' . "\n"; $v067674f4e4 .= self::f6e68f6b61f($v9f2c84d2ad, $v29fec2ceaa, $v63208850d1[$v43dd7d0051]); $v067674f4e4 .= '$EVC->getCMSLayer()->getCMSTemplateLayer()->addRegionBlock(' . $v9f2c84d2ad . ', ' . $v29fec2ceaa . $pedcd39ad . ');' . "\n"; $v067674f4e4 .= 'include $EVC->getBlockPath(' . $v29fec2ceaa . $pedcd39ad . ');' . "\n"; } else if ($v3fb9f41470 == 4 || $v3fb9f41470 == 5) { $v29fec2ceaa = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pd06bdde3["block_type"]); $v76425220d5 = PHPUICodeExpressionHandler::getValueType($pd06bdde3["block_project"], array("empty_string_type" => "string", "non_set_type" => "string")); $v175e16d850 = $v76425220d5 == "" ? str_replace('"', '', $pd06bdde3["block_project"]) : $pd06bdde3["block_project"]; $pedcd39ad = !$v175e16d850 || $v175e16d850 == $v2508589a4c ? "" : ", \"$v175e16d850\""; $v067674f4e4 .= 'include $EVC->getCMSLayer()->getCMSTemplateLayer()->includeRegionViewPathOutput(' . $v9f2c84d2ad . ', ' . $v29fec2ceaa . $pedcd39ad . ');' . "\n"; } } } $v067674f4e4 = $v067674f4e4 ? "//Regions-Blocks:$v067674f4e4" : ""; } return $v067674f4e4; } private static function f6e68f6b61f($v9f2c84d2ad, $v29fec2ceaa, $v63208850d1) { $v067674f4e4 = '$EVC->getCMSLayer()->getCMSJoinPointLayer()->resetRegionBlockJoinPoints(' . $v9f2c84d2ad . ', ' . $v29fec2ceaa . ');
'; if (is_array($v63208850d1)) { foreach ($v63208850d1 as $v4d109e7412) { $v68ed13a98c = PHPUICodeExpressionHandler::getArgumentCode($v4d109e7412["region"], $v4d109e7412["region_type"]); $pebf81758 = PHPUICodeExpressionHandler::getArgumentCode($v4d109e7412["block"], $v4d109e7412["block_type"]); if ($v68ed13a98c == $v9f2c84d2ad && $pebf81758 == $v29fec2ceaa && $v4d109e7412["join_points"]) foreach ($v4d109e7412["join_points"] as $v34bca6a112 => $v5d2ebe3c1a) { foreach ($v5d2ebe3c1a as $pd69fb7d0 => $v342a134247) { if (is_numeric($pd69fb7d0)) { $v067674f4e4 .= '$block_join_point_properties = ' . self::getJoinPointPropertiesCode($v342a134247) . ';
$EVC->getCMSLayer()->getCMSJoinPointLayer()->addRegionBlockJoinPoint(' . $v9f2c84d2ad . ', ' . $v29fec2ceaa . ', "' . $v34bca6a112 . '", $block_join_point_properties);
'; } } } break; } } return $v067674f4e4; } public static function createCMSLayerCodeForTemplateParams($v9e3513bc0e) { $v067674f4e4 = ""; if ($v9e3513bc0e) { $pc37695cb = count($v9e3513bc0e); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9acf40c110 = $v9e3513bc0e[$v43dd7d0051]; if ($v9acf40c110["param"] && strlen($v9acf40c110["value"])) { $v58b61e02bc = PHPUICodeExpressionHandler::getArgumentCode($v9acf40c110["param"], $v9acf40c110["param_type"]); $v67db1bd535 = PHPUICodeExpressionHandler::getArgumentCode($v9acf40c110["value"], $v9acf40c110["value_type"]); $v067674f4e4 .= '$EVC->getCMSLayer()->getCMSTemplateLayer()->setParam(' . $v58b61e02bc . ', ' . $v67db1bd535 . ');' . "\n"; } } $v067674f4e4 = $v067674f4e4 ? "//Template params:\n$v067674f4e4" : ""; } return $v067674f4e4; } public static function createCMSLayerCodeForTemplates($v94d48fb72f) { $v067674f4e4 = ""; if ($v94d48fb72f) { $pc37695cb = count($v94d48fb72f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pe7333513 = $v94d48fb72f[$v43dd7d0051]; if ($pe7333513["template"]) { $v9ef371982d = self::mea4f4b25e019($pe7333513["template_args"]); $v9ef371982d = $v9ef371982d ? ", $v9ef371982d" : ""; $v067674f4e4 .= '$EVC->setTemplate(' . PHPUICodeExpressionHandler::getArgumentCode($pe7333513["template"], $pe7333513["template_type"]) . $v9ef371982d . ');' . "\n"; } } $v067674f4e4 = $v067674f4e4 ? "//Templates:\n$v067674f4e4" : ""; } return $v067674f4e4; } public static function createCMSLayerCodeForPagePropertiesCode($v8933804989) { $v067674f4e4 = ""; if ($v8933804989) { $v3ae55a9a2e = new ReflectionClass("CMSPagePropertyLayer"); $pb2bb35e9 = $v3ae55a9a2e->getMethods(); $v6a0696ed5d = array(); foreach ($pb2bb35e9 as $v4dab304881) { $v603bd47baf = $v4dab304881->getName(); if (substr($v603bd47baf, 0, 3) == "set") { $v9b391a5b1f = $v4dab304881->getParameters(); $v943c52a786 = $v9b391a5b1f[0]; $v6a0696ed5d[ $v943c52a786->getName() ] = $v603bd47baf; } } foreach ($v8933804989 as $pe5c5e2fe => $v956913c90f) { if ($pe5c5e2fe == "parse_html" && $v956913c90f) { if ($v956913c90f === 1 || $v956913c90f === "1") $v067674f4e4 .= "\$EVC->getCMSLayer()->getCMSPagePropertyLayer()->setParseFullHtml(true);\n"; else if ($v956913c90f === 2 || $v956913c90f === "2") $v067674f4e4 .= "\$EVC->getCMSLayer()->getCMSPagePropertyLayer()->setParseRegionsHtml(true);\n"; } else if ($v6a0696ed5d[$pe5c5e2fe] && $v956913c90f !== "") { $v603bd47baf = $v6a0696ed5d[$pe5c5e2fe]; $v956913c90f = $v956913c90f === 0 || $v956913c90f === "0" ? "false" : ($v956913c90f === 1 || $v956913c90f === "1" ? "true" : $v956913c90f); $v067674f4e4 .= "\$EVC->getCMSLayer()->getCMSPagePropertyLayer()->$v603bd47baf($v956913c90f);\n"; } } if ($v067674f4e4) $v067674f4e4 = "//PAGE PROPERTIES:\n" . $v067674f4e4; } return $v067674f4e4; } public static function createCMSLayerCodeForSequentialLogicalActivitySettingsCode($v79cfe2159a) { $v067674f4e4 = ""; if ($v79cfe2159a) { $v067674f4e4 = "//SLA ACTIONS SETTINGS:\n"; $v067674f4e4 .= "\$EVC->getCMSLayer()->getCMSSequentialLogicalActivityLayer()->addSequentialLogicalActivities($v79cfe2159a);\n"; } return $v067674f4e4; } public static function checkIfEntityCodeContainsSimpleUISettings($v067674f4e4, $v7b2ad4afbf, $pc06f1034, $pf2e4821f) { if ($v067674f4e4) { if ($v7b2ad4afbf) { $v94d48fb72f = CMSFileHandler::getTemplates($v067674f4e4); $pc2a23947 = '$EVC->setTemplate(' . PHPUICodeExpressionHandler::getArgumentCode($v94d48fb72f[0]["template"], $v94d48fb72f[0]["template_type"]); if (strpos($v067674f4e4, $pc2a23947) === false) return false; } if ($pc06f1034) { $pc2a23947 = ""; $pc37695cb = count($pc06f1034); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pc24afc88 = $pc06f1034[$v43dd7d0051]; if ($pc24afc88["path"]) { $pc2a23947 .= 'include' . ($pc24afc88["once"] ? '_once' : '') . ' ' . PHPUICodeExpressionHandler::getArgumentCode($pc24afc88["path"], $pc24afc88["path_type"]) . ';' . "\n"; } } if ($pc2a23947 && strpos($v067674f4e4, $pc2a23947) === false) return false; } if ($pf2e4821f) { $pc37695cb = count($pf2e4821f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pd06bdde3 = $pf2e4821f[$v43dd7d0051]; if ($pd06bdde3["region"] && $pd06bdde3["block"]) { $v3fb9f41470 = $pd06bdde3["type"]; $v9f2c84d2ad = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["region"], $pd06bdde3["region_type"]); if ($v3fb9f41470 == 1) { $pa7fd620a = PHPUICodeExpressionHandler::getValueType($pd06bdde3["block"], array("empty_string_type" => "string", "non_set_type" => "string")); $pf8ed4912 = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pa7fd620a); $pc2a23947 = '$EVC->getCMSLayer()->getCMSTemplateLayer()->addRegionHtml(' . $v9f2c84d2ad . ', ' . $pf8ed4912 . ');' . "\n"; } else if ($v3fb9f41470 == 2 || $v3fb9f41470 == 3) { $v29fec2ceaa = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pd06bdde3["block_type"]); $v175e16d850 = $pd06bdde3["block_project"]; $pedcd39ad = !$v175e16d850 || $v175e16d850 == $v2508589a4c ? "" : ", \"$v175e16d850\""; $pc2a23947 = '$EVC->getCMSLayer()->getCMSTemplateLayer()->addRegionBlock(' . $v9f2c84d2ad . ', ' . $v29fec2ceaa . $pedcd39ad . ');' . "\n"; $pc2a23947 .= 'include $EVC->getBlockPath(' . $v29fec2ceaa . $pedcd39ad . ');' . "\n"; } else if ($v3fb9f41470 == 4 || $v3fb9f41470 == 5) { $v29fec2ceaa = PHPUICodeExpressionHandler::getArgumentCode($pd06bdde3["block"], $pd06bdde3["block_type"]); $v175e16d850 = $pd06bdde3["block_project"]; $pedcd39ad = !$v175e16d850 || $v175e16d850 == $v2508589a4c ? "" : ", \"$v175e16d850\""; $pc2a23947 = 'include $EVC->getCMSLayer()->getCMSTemplateLayer()->includeRegionViewPathOutput(' . $v9f2c84d2ad . ', ' . $v29fec2ceaa . $pedcd39ad . ');' . "\n"; } if (strpos($v067674f4e4, $pc2a23947) === false) return false; } } } } return true; } public static function createEntityCode($v4948cc5869, $v2508589a4c, $pee3fb492) { $v63208850d1 = $v4948cc5869["regions_blocks_join_points"]; MyArray::arrKeysToLowerCase($v4948cc5869, true); $v94d48fb72f = $v4948cc5869["templates"]; $pf2e4821f = $v4948cc5869["regions_blocks"]; $pf8ee75c7 = $v4948cc5869["other_regions_blocks"]; $pf1c1fb25 = $v4948cc5869["regions_blocks_params"]; $pc06f1034 = $v4948cc5869["includes"]; $v9e3513bc0e = $v4948cc5869["template_params"]; $pa771573b = $v4948cc5869["other_template_params"]; $v4859640498 = $v4948cc5869["advanced_settings"]; $v79cfe2159a = $v4948cc5869["sla_settings_code"]; $pd1e576d9 = self::createCMSLayerCodeForIncludes($pc06f1034); $v2655545b46 = self::createCMSLayerCodeForPagePropertiesCode($v4859640498); $v01f4d49925 = self::createCMSLayerCodeForSequentialLogicalActivitySettingsCode($v79cfe2159a); $v6e16c1f086 = self::createCMSLayerCodeForTemplates($v94d48fb72f); $pdc3a0007 = self::createCMSLayerCodeForTemplateParams($v9e3513bc0e); $pf7ec0de0 = str_replace("//Template params:", "//Other Template params:", self::createCMSLayerCodeForTemplateParams($pa771573b)); $v71ed39ebcc = self::createCMSLayerCodeForRegionsBLocks($v2508589a4c, $pee3fb492, $pf2e4821f, $pf1c1fb25, $v63208850d1); $v16c00e1d89 = str_replace("//Regions-Blocks:", "//Other Regions-Blocks:", self::createCMSLayerCodeForRegionsBLocks($v2508589a4c, $pee3fb492, $pf8ee75c7, $pf1c1fb25, $v63208850d1)); $v8a88c91d44 = $pd1e576d9; $v8a88c91d44 .= trim($v2655545b46) ? "\n" . $v2655545b46 : ""; $v8a88c91d44 .= trim($v01f4d49925) ? "\n" . $v01f4d49925 : ""; $v8a88c91d44 .= trim($v6e16c1f086) ? "\n" . $v6e16c1f086 : ""; $v8a88c91d44 .= trim($pdc3a0007) ? "\n" . $pdc3a0007 : ""; $v8a88c91d44 .= trim($pf7ec0de0) ? "\n" . $pf7ec0de0 : ""; $v8a88c91d44 .= trim($v71ed39ebcc) ? "\n" . $v71ed39ebcc : ""; $v8a88c91d44 .= trim($v16c00e1d89) ? "\n" . $v16c00e1d89 : ""; return trim($v8a88c91d44) ? "<?php \n$v8a88c91d44?>" : ""; } public static function checkIfBlockCodeContainsSimpleUISettings($v067674f4e4, $pcd8c70bc) { if ($v067674f4e4) { $pc2a23947 = '$block_id = $EVC->getCMSLayer()->getCMSBlockLayer()->getBlockIdFromFilePath(__FILE__);'; if (strpos($v067674f4e4, $pc2a23947) === false) return false; $pc2a23947 = '$block_settings[$block_id] = '; if (strpos($v067674f4e4, $pc2a23947) === false) return false; $pc2a23947 = '$EVC->getCMSLayer()->getCMSBlockLayer()->createBlock("' . $pcd8c70bc . '", $block_id, $block_settings[$block_id]);'; if (strpos($v067674f4e4, $pc2a23947) === false) return false; } return true; } public static function createBlockCode($v972f1a5c2b) { $v067674f4e4 = isset($v972f1a5c2b["settings"]) ? self::mea4f4b25e019($v972f1a5c2b["settings"], "") : (isset($v972f1a5c2b["code"]) ? $v972f1a5c2b["code"] : ""); $v067674f4e4 = trim($v067674f4e4); $pf4c3dc70 = self::f5bed2234bf($v972f1a5c2b["join_points"]); return '<?php
$block_id = $EVC->getCMSLayer()->getCMSBlockLayer()->getBlockIdFromFilePath(__FILE__);//must be the same than this file name.

$block_settings[$block_id] = ' . ($v067674f4e4 ? $v067674f4e4 : "null") . ';
' . $pf4c3dc70 . '
$EVC->getCMSLayer()->getCMSBlockLayer()->createBlock("' . $v972f1a5c2b["module_id"] . '", $block_id, $block_settings[$block_id]);
?>'; } private static function f5bed2234bf($pf4c3dc70) { $v067674f4e4 = ''; if (is_array($pf4c3dc70)) { foreach ($pf4c3dc70 as $v34bca6a112 => $v5d2ebe3c1a) { if ($v5d2ebe3c1a["active"]) { if ($v5d2ebe3c1a["active"] == 2) $v067674f4e4 .= '
$block_local_join_points[$block_id]["' . $v34bca6a112 . '"] = 1;
'; foreach ($v5d2ebe3c1a as $pd69fb7d0 => $v342a134247) { if (is_numeric($pd69fb7d0)) { $v067674f4e4 .= '
$block_join_point_properties = ' . self::getJoinPointPropertiesCode($v342a134247) . ';
$EVC->getCMSLayer()->getCMSJoinPointLayer()->addBlockJoinPoint($block_id, "' . $v34bca6a112 . '", $block_join_point_properties);
'; } } } } } return $v067674f4e4; } public static function getJoinPointPropertiesCode($v342a134247) { if ($v342a134247["method_args"]) { foreach ($v342a134247["method_args"] as $v43dd7d0051 => $v29b0ab3445) { $pb19b5cb6 = substr($v29b0ab3445["value"], 0, 1) == '$' && substr($v29b0ab3445["value"], 0, 6) != '$input'; if (!$pb19b5cb6 && (substr($v29b0ab3445["value"], 0, 1) != '"' || substr($v29b0ab3445["value"], -1, 1) != '"')) { $v29b0ab3445["value"] = '"' . addcslashes($v29b0ab3445["value"], '"') . '"'; } $v342a134247["method_args"][$v43dd7d0051]["value"] = preg_replace_callback('/(.*)(\$[\w]+)(.*)/u', function($pbae7526c) { if ($pbae7526c[2] == '$input' && substr($pbae7526c[1], -1, 1) != '\\') $pbae7526c[2] = '\\' . $pbae7526c[2]; return $pbae7526c[1] . $pbae7526c[2] . $pbae7526c[3]; }, $v29b0ab3445["value"]); } } return self::mea4f4b25e019($v342a134247, ""); } private static function mea4f4b25e019($pfb662071, $pdcf670f6 = "") { $v067674f4e4 = ''; if (is_array($pfb662071)) { $v067674f4e4 = "array(\n"; $v22095cfe4c = true; $v43dd7d0051 = 0; foreach ($pfb662071 as $pbfa01ed1 => $v2b3a130180) { if (!is_numeric($pbfa01ed1) || $pbfa01ed1 != $v43dd7d0051) { $v22095cfe4c = false; break; } $v43dd7d0051++; } foreach ($pfb662071 as $pbfa01ed1 => $v2b3a130180) { $v067674f4e4 .= $pdcf670f6 . "\t"; if (!$v22095cfe4c) { $pbfa01ed1 = substr($pbfa01ed1, 0, 1) == '$' || strpos($pbfa01ed1, '"') !== false || strpos($pbfa01ed1, "'") !== false ? $pbfa01ed1 : '"' . $pbfa01ed1 . '"'; $v067674f4e4 .= $pbfa01ed1 . " => "; } if (is_array($v2b3a130180)) $v067674f4e4 .= self::mea4f4b25e019($v2b3a130180, $pdcf670f6 . "\t"); else { $v3fb9f41470 = PHPUICodeExpressionHandler::getValueType($v2b3a130180, array("empty_string_type" => "string")); $v067674f4e4 .= PHPUICodeExpressionHandler::getArgumentCode($v2b3a130180, $v3fb9f41470); } $v067674f4e4 .= ",\n"; } $v067674f4e4 .= $pdcf670f6 . ")"; } return $v067674f4e4; } } ?>
