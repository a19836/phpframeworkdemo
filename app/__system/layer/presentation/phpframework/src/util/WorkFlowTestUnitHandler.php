<?php
/*
 * Copyright (c) 2024 Bloxtor - http://bloxtor.com
 * 
 * Please note that this code belongs to the Bloxtor framework and must comply with the Bloxtor license.
 * If you do not accept these provisions, or if the Bloxtor License is not present or cannot be found, you are not entitled to use this code and must stop and delete it immediately.
 */
include_once get_lib("org.phpframework.phpscript.PHPCodePrintingHandler"); include_once get_lib("org.phpframework.phpscript.docblock.DocBlockParser"); include_once $EVC->getUtilPath("WorkFlowBeansFileHandler"); class WorkFlowTestUnitHandler { private $v0cd49d5a59; private $v0d51bbbc63; private $pd8dc8ad3; public function __construct($v0cd49d5a59, $v0d51bbbc63) { $this->v0cd49d5a59 = $v0cd49d5a59; $this->v0d51bbbc63 = $v0d51bbbc63; } public function setBeanObjects($pd8dc8ad3) { $this->pd8dc8ad3 = $pd8dc8ad3; } public function getBeanObjects($pd8dc8ad3) { return $this->pd8dc8ad3; } public function initBeanObjects() { $this->pd8dc8ad3 = WorkFlowBeansFileHandler::getAllBeanObjects($this->v0cd49d5a59, $this->v0d51bbbc63); } public static function getAllLayersBrokersSettings($v0cd49d5a59, $v0d51bbbc63) { $pb6be299d = array(); $v1a387233cc = array(); $v5483bfa973 = array(); $v78844cd25d = array(); $v9fda9fad47 = array(); $pdeced6cd = array(); $pf864769c = array(); $v6a3a9f9182 = array(); $paf75a67c = array(); $pbf7e8fcb = array(); $v6e9af47944 = array(); $v5421227efb = array(); $pb0e92e25 = array(); $v89e7b130c6 = array(); $pfe34aedf = array(); $v6307981cb5 = array(); $v434bd8c1c7 = array(); $v95b17da7d4 = array(); $v74b5cabc4f = array(); $pfaf08f23 = new PHPVariablesFileHandler($v0cd49d5a59); $pfaf08f23->startUserGlobalVariables(); if (is_dir($v0d51bbbc63) && ($v89d33f4133 = opendir($v0d51bbbc63)) ) { while( ($v7dffdb5a5b = readdir($v89d33f4133)) !== false) { if (substr($v7dffdb5a5b, strlen($v7dffdb5a5b) - 4) == ".xml" && $v7dffdb5a5b != "app.xml" && !strstr($v7dffdb5a5b, "_bll_common_services.xml", true)) { $pddfc29cd = new BeanFactory(); $pddfc29cd->init(array("file" => $v0d51bbbc63 . $v7dffdb5a5b)); $v1e9dc98c41 = $pddfc29cd->getBeans(); $pddfc29cd->initObjects(); foreach ($v1e9dc98c41 as $v8ffce2a791 => $pdec569fb) { $v972f1a5c2b = $pddfc29cd->getObject($v8ffce2a791); if (is_a($v972f1a5c2b, "ILayer")) { $v0a5deb92d8 = WorkFlowBeansFileHandler::getLayerNameFromBeanObject($v8ffce2a791, $v972f1a5c2b); $v2b2cf4c0eb = WorkFlowBeansConverter::getBrokerNameFromRawLabel($v0a5deb92d8); $v9073377656 = array( $v2b2cf4c0eb, $v7dffdb5a5b, $v8ffce2a791, ); if (is_a($v972f1a5c2b, "DBLayer")) { $v5483bfa973[] = $v9073377656; $v78844cd25d[$v2b2cf4c0eb] = '$this->getDBLayer("' . $v2b2cf4c0eb . '")'; } else if (is_a($v972f1a5c2b, "DataAccessLayer")) { $v9fda9fad47[] = $v9073377656; $pdeced6cd[$v2b2cf4c0eb] = '$this->getDataAcessLayer("' . $v2b2cf4c0eb . '")'; if (is_a($v972f1a5c2b, "HibernateDataAccessLayer")) { $paf75a67c[] = $v9073377656; $pbf7e8fcb[$v2b2cf4c0eb] = '$this->getHibernateLayer("' . $v2b2cf4c0eb . '")'; } else { $pf864769c[] = $v9073377656; $v6a3a9f9182[$v2b2cf4c0eb] = '$this->getIbatisLayer("' . $v2b2cf4c0eb . '")'; } } else if (is_a($v972f1a5c2b, "BusinessLogicLayer")) { $v6e9af47944[] = $v9073377656; $v5421227efb[$v2b2cf4c0eb] = '$this->getBusinessLogicLayer("' . $v2b2cf4c0eb . '")'; } else if (is_a($v972f1a5c2b, "PresentationLayer")) { $pb0e92e25[] = $v9073377656; $v89e7b130c6[$v2b2cf4c0eb] = '$this->getPresentationLayer("' . $v2b2cf4c0eb . '")'; } } else if (is_a($v972f1a5c2b, "EVC")) { $pbf61d117 = null; if ($pdec569fb->properties) foreach ($pdec569fb->properties as $v1654ac0a73) if ($v1654ac0a73->name == "presentationLayer") { $pbf61d117 = $v1654ac0a73->reference; break; } if ($pbf61d117) { $v0a5deb92d8 = WorkFlowBeansFileHandler::getLayerNameFromBeanObject($pbf61d117, $v972f1a5c2b->getPresentationLayer()); $v2b2cf4c0eb = WorkFlowBeansConverter::getBrokerNameFromRawLabel($v0a5deb92d8); $pfe34aedf[] = array( $v2b2cf4c0eb, $v7dffdb5a5b, $pbf61d117, ); $v6307981cb5[$v2b2cf4c0eb] = '$this->getPresentationLayerEVC("' . $v2b2cf4c0eb . '")'; $v434bd8c1c7[] = $pfe34aedf[ count($pfe34aedf) - 1 ]; $v95b17da7d4[$v2b2cf4c0eb] = '$this->getPresentationLayerEVC("' . $v2b2cf4c0eb . '")->getCMSLayer()->getCMSTemplateLayer()'; $v74b5cabc4f = array_merge($v74b5cabc4f, $v972f1a5c2b->getProjectsId()); } } else if (is_a($v972f1a5c2b, "DB")) { $v2b2cf4c0eb = WorkFlowBeansConverter::getBrokerNameFromRawLabel($v8ffce2a791); $v9073377656 = array( $v2b2cf4c0eb, $v7dffdb5a5b, $v8ffce2a791, ); $pb6be299d[] = $v9073377656; $v1a387233cc[$v2b2cf4c0eb] = '$this->getDBDriver("' . $v2b2cf4c0eb . '")'; } } } } closedir($v89d33f4133); } $pfaf08f23->endUserGlobalVariables(); return array( "db_driver_brokers" => $pb6be299d, "db_driver_brokers_obj" => $v1a387233cc, "db_brokers" => $v5483bfa973, "db_brokers_obj" => $v78844cd25d, "data_access_brokers" => $v9fda9fad47, "data_access_brokers_obj" => $pdeced6cd, "ibatis_brokers" => $pf864769c, "ibatis_brokers_obj" => $v6a3a9f9182, "hibernate_brokers" => $paf75a67c, "hibernate_brokers_obj" => $pbf7e8fcb, "business_logic_brokers" => $v6e9af47944, "business_logic_brokers_obj" => $v5421227efb, "presentation_brokers" => $pb0e92e25, "presentation_brokers_obj" => $v89e7b130c6, "presentation_evc_brokers" => $pfe34aedf, "presentation_evc_brokers_obj" => $v6307981cb5, "presentation_evc_template_brokers" => $v434bd8c1c7, "presentation_evc_template_brokers_obj" => $v95b17da7d4, "available_projects" => $v74b5cabc4f, ); } public function executeTest($v5ec153d061, &$peb8f865e, $v1335217393 = null) { if (is_array($peb8f865e[$v5ec153d061])) return $peb8f865e[$v5ec153d061]["status"]; $v7bd5d88a74 = array(); $pf3dc0762 = TEST_UNIT_PATH . $v5ec153d061; if (!file_exists($pf3dc0762)) $v7bd5d88a74["error"] = "File not found! Path: $v5ec153d061"; else { if (is_dir($pf3dc0762)) { $v6ee393d9fb = scandir($pf3dc0762); $v922f7ad86a = array(); if ($v6ee393d9fb) foreach ($v6ee393d9fb as $v7dffdb5a5b) if ($v7dffdb5a5b != "." && $v7dffdb5a5b != ".." && (strtolower(pathinfo($v7dffdb5a5b, PATHINFO_EXTENSION)) == "php" || is_dir("$pf3dc0762/$v7dffdb5a5b"))) $v922f7ad86a[] = $v7dffdb5a5b; if ($v922f7ad86a) { $v5c1c342594 = true; $v01644b5abd = $v5ec153d061 . ($v5ec153d061 && substr($v5ec153d061, -1) != "/" ? "/" : ""); foreach ($v922f7ad86a as $v7dffdb5a5b) { $v4f91f72b36 = $v01644b5abd . $v7dffdb5a5b . (is_dir("$pf3dc0762/$v7dffdb5a5b") ? "/" : ""); if (!$this->executeTest($v4f91f72b36, $peb8f865e, $v1335217393)) $v5c1c342594 = false; } $v7bd5d88a74["status"] = $v5c1c342594; if (!$v5c1c342594) $v7bd5d88a74["error"] = "There was a sub test inside of this folder that didn't executed successfuly!"; } else { unset($peb8f865e[$v5ec153d061]); return true; } } else { $v1335217393 = $v1335217393 ? $v1335217393 : pathinfo($v5ec153d061, PATHINFO_FILENAME); $pd4e0b815 = PHPCodePrintingHandler::getFunctionFromFile($pf3dc0762, "execute", $v1335217393); $pcc2fe66c = $pd4e0b815["doc_comments"] ? implode("\n", $pd4e0b815["doc_comments"]) : ""; $v6da2e4df28 = new DocBlockParser(); $v6da2e4df28->ofComment($pcc2fe66c); $v023c8cca9f = $v6da2e4df28->getObjects(); $v156861204e = !empty($v023c8cca9f["enabled"]); if (!$v156861204e) $v7bd5d88a74["error"] = "Test is disabled"; else { include_once $pf3dc0762; if ($v1335217393 && is_subclass_of($v1335217393, "TestUnit")) { $v6aa656dc2c = array(); $v0b8758d59b = $v023c8cca9f["global_variables_files_path"]; if (is_array($v0b8758d59b)) foreach ($v0b8758d59b as $v0cd49d5a59) $v6aa656dc2c[] = trim($v0cd49d5a59->getArgs()); $v972f1a5c2b = new $v1335217393(); if ($v6aa656dc2c) { $v6aa656dc2c = is_array($v6aa656dc2c) ? $v6aa656dc2c : array($v6aa656dc2c); if (is_array($this->v0cd49d5a59)) $v6aa656dc2c = array_merge($this->v0cd49d5a59, $v6aa656dc2c); else array_unshift($v6aa656dc2c, $this->v0cd49d5a59); $pbe872b25 = WorkFlowBeansFileHandler::getAllBeanObjects($v6aa656dc2c, $this->v0d51bbbc63); $v972f1a5c2b->setBeanObjects($pbe872b25); } else $v972f1a5c2b->setBeanObjects($this->pd8dc8ad3); $v28c1cd997a = true; $v112c146385 = $v023c8cca9f["depends"]; if (is_array($v112c146385)) foreach ($v112c146385 as $v727f2826b3) { $v86066462c3 = $v727f2826b3->getArgs(); $pb4227d84 = trim($v86066462c3["path"]); if ($pb4227d84) { $v0c32fb1a0a = pathinfo($pb4227d84, PATHINFO_EXTENSION); $pb4227d84 .= ($v0c32fb1a0a ? "" : ".php"); $pc820c444 = $this->executeTest($pb4227d84, $peb8f865e); if (!$pc820c444) { $v28c1cd997a = false; $v7bd5d88a74["error"] = "The following dependencie didn't executed correctly: $pb4227d84!" . ($pc820c444["error"] ? "\n" . $pc820c444["error"] : ""); break; } } } if ($v28c1cd997a) { $v7bd5d88a74["status"] = $v972f1a5c2b->execute(); $v8a29987473 = $v972f1a5c2b->getErrors(); if (!$v7bd5d88a74["status"]) $v7bd5d88a74["error"] = "$v1335217393 didn't execute correctly!"; if ($v8a29987473) $v7bd5d88a74["error"] .= ($v7bd5d88a74["error"] ? "\n" : "") . implode("\n", $v8a29987473); } } else $v7bd5d88a74["error"] = "$v1335217393 class must implement the TestUnit class!"; } } } $peb8f865e[$v5ec153d061] = $v7bd5d88a74; return $v7bd5d88a74["status"]; } public static function getGlobalVariablesFilePathHTML($pa32be502 = false) { $pf8ed4912 = '
		<tr class="global_variables_file_path">
			<td class="path">
				<input type="text" value="' . str_replace('"', "&quot;", $pa32be502) . '" />
			</td>
			<td class="icon_cell table_header"><span class="icon delete" onClick="$(this).parent().parent().remove();" title="Remove">Remove</span></td>
		</tr>'; return $pf8ed4912; } public static function getAnnotationHTML($ped0a6251 = false, $v18f86e4308 = false) { $pa32be502 = $pd2c744e8 = $pe9715da5 = ""; if (is_array($ped0a6251)) { $pa32be502 = $ped0a6251["path"]; $pd2c744e8 = str_replace('\\"', '"', $ped0a6251["desc"]); foreach ($ped0a6251 as $pe5c5e2fe => $v956913c90f) if ($pe5c5e2fe != "path" && $pe5c5e2fe != "desc") $pe9715da5 .= ($pe9715da5 ? ", " : "") . "$pe5c5e2fe=$v956913c90f"; } $pf8ed4912 = '
		<tr class="annotation">
			<td class="annotation_type">
				<select>
					<option value="depends"' . ($v18f86e4308 == "depends" ? ' selected' : '') . '>Depends</option>
				</select>
			</td>
			<td class="path">
				<input type="text" value="' . str_replace('"', "&quot;", $pa32be502) . '" />
			</td>
			<td class="description">
				<input type="text" value="' . str_replace('"', "&quot;", $pd2c744e8) . '" />
			</td>
			<td class="others">
				<input type="text" value="' . str_replace('"', "&quot;", $pe9715da5) . '" />
			</td>
			<td class="icon_cell table_header"><span class="icon delete" onClick="$(this).parent().parent().remove();" title="Remove">Remove</span></td>
		</tr>'; return $pf8ed4912; } public static function saveTestFile($pf3dc0762, $v4948cc5869, $v1335217393) { if ($pf3dc0762 && is_file($pf3dc0762) && $v1335217393) { self::f9ce1e84bbc($v4948cc5869); $v4948cc5869 = $v4948cc5869 ? $v4948cc5869 : array(); $v4948cc5869["name"] = "execute"; $v4948cc5869["type"] = "public"; if (PHPCodePrintingHandler::getFunctionFromFile($pf3dc0762, $v4948cc5869["name"], $v1335217393)) { PHPCodePrintingHandler::editFunctionCommentsFromFile($pf3dc0762, $v4948cc5869["name"], "", $v1335217393); $v5c1c342594 = PHPCodePrintingHandler::editFunctionFromFile($pf3dc0762, array("name" => $v4948cc5869["name"]), $v4948cc5869, $v1335217393); } else $v5c1c342594 = PHPCodePrintingHandler::addFunctionToFile($pf3dc0762, $v4948cc5869, $v1335217393); } return $v5c1c342594; } private static function f9ce1e84bbc(&$v4948cc5869) { $pcc2fe66c = isset($v4948cc5869["comments"]) && trim($v4948cc5869["comments"]) ? " * " . str_replace("\n", "\n * ", trim($v4948cc5869["comments"])) . "\n" : ""; if (isset($v4948cc5869["enabled"]) && $v4948cc5869["enabled"]) { $pcc2fe66c .= $pcc2fe66c ? " * \n" : ""; $pcc2fe66c .= " * @enabled\n"; } if (isset($v4948cc5869["global_variables_files_path"]) && is_array($v4948cc5869["global_variables_files_path"])) { $pcc2fe66c .= $pcc2fe66c ? " * \n" : ""; foreach ($v4948cc5869["global_variables_files_path"] as $v0cd49d5a59) { $pa32be502 = trim($v0cd49d5a59["path"]); if ($pa32be502) $pcc2fe66c .= " * @global_variables_files_path " . $pa32be502 . "\n"; } } if (isset($v4948cc5869["annotations"]) && is_array($v4948cc5869["annotations"])) { $pcc2fe66c .= $pcc2fe66c ? " * \n" : ""; foreach ($v4948cc5869["annotations"] as $v18f86e4308 => $pf81e7d81) { $pe9daf1fc = strtolower($v18f86e4308); $pc37695cb = $pf81e7d81 ? count($pf81e7d81) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v1ebe15b151 = $pf81e7d81[$v43dd7d0051]; $pa32be502 = trim($v1ebe15b151["path"]); $v86066462c3 = ""; $v86066462c3 .= $pa32be502 ? ($v86066462c3 ? ", " : "") . "path=" . $pa32be502 : ""; $v86066462c3 .= trim($v1ebe15b151["others"]) ? ($v86066462c3 ? ", " : "") . $v1ebe15b151["others"] : ""; if ($v86066462c3 || trim($v1ebe15b151["desc"])) $pcc2fe66c .= " * @$pe9daf1fc ($v86066462c3) " . addcslashes($v1ebe15b151["desc"], '"') . "\n"; } } } $v4948cc5869["comments"] = $pcc2fe66c ? "/**\n$pcc2fe66c */" : ""; } } ?>
