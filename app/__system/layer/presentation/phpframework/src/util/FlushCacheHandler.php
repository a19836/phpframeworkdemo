<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
include_once get_lib("org.phpframework.workflow.WorkFlowTaskHandler"); include_once $EVC->getUtilPath("CMSPresentationLayerHandler"); class FlushCacheHandler { public static function flushCache($v08d9602741, $v4bf8d90f04, $pfce4d1b3, $pdb9e96e6, $v3d55458bcd, $v5039a77f9d, $v0bd21d963b, $v28d8163063, $v40e3c77a4e) { $pecad7cca = new WorkFlowTaskHandler($v4bf8d90f04, $pfce4d1b3); $pecad7cca->setCacheRootPath(LAYER_CACHE_PATH); $v5c1c342594 = $pecad7cca->flushCache(); try { CacheHandlerUtil::deleteFolder( $v08d9602741->getWebrootPath("test") . "__system/cache/" ); } catch (Exception $paec2c009) { } CacheHandlerUtil::deleteFolder($v0bd21d963b); CacheHandlerUtil::deleteFolder($v4bf8d90f04, false); CacheHandlerUtil::deleteFolder( dirname($pdb9e96e6["business_logic_workflow_tmp"]) ); CacheHandlerUtil::deleteFolder( dirname($pdb9e96e6["presentation_workflow_tmp"]) ); CacheHandlerUtil::deleteFolder( dirname($pdb9e96e6["presentation_block_workflow_tmp"]) ); CacheHandlerUtil::deleteFolder( dirname($pdb9e96e6["presentation_block_form_tmp"]) ); CacheHandlerUtil::deleteFolder(CACHE_PATH, false); $pbac4feec = substr(CACHE_PATH, strlen(TMP_PATH)); $pab996f83 = self::f3546f6da0a($v3d55458bcd); if ($pab996f83) CacheHandlerUtil::deleteFolder("$pab996f83/$pbac4feec"); $v6ee393d9fb = CMSPresentationLayerHandler::getPresentationLayersProjectsFiles($v3d55458bcd, $v5039a77f9d); if (is_array($v6ee393d9fb)) foreach ($v6ee393d9fb as $v0a5deb92d8 => $v54307eb686) if (is_array($v54307eb686["projects"])) { $pa0462a8e = $v54307eb686["bean_file_name"]; $pb512d021 = new WorkFlowBeansFileHandler($v5039a77f9d . $pa0462a8e, $v3d55458bcd); $v188b4f5fa6 = $pb512d021->getEVCBeanObject($v0a5deb92d8); foreach ($v54307eb686["projects"] as $v29e5d6d712 => $v20dfc6306e) { $pab996f83 = self::f3546f6da0a(array($v3d55458bcd, $v188b4f5fa6->getConfigPath("pre_init_config", $v29e5d6d712))); if ($pab996f83) CacheHandlerUtil::deleteFolder("$pab996f83/$pbac4feec"); } } if (is_dir($v28d8163063)) { $v6ee393d9fb = array_diff(scandir($v28d8163063), array('..', '.')); foreach ($v6ee393d9fb as $v7dffdb5a5b) { $v9a84a79e2e = $v28d8163063 . $v7dffdb5a5b; if (filemtime($v9a84a79e2e) < time() - (60 * 60 * 24 * 3)) { if (is_dir($v9a84a79e2e)) CacheHandlerUtil::deleteFolder($v9a84a79e2e); else unlink($v9a84a79e2e); } } } if (is_dir($v40e3c77a4e)) { $v6ee393d9fb = array_diff(scandir($v40e3c77a4e), array('..', '.')); foreach ($v6ee393d9fb as $v7dffdb5a5b) { $v9a84a79e2e = $v40e3c77a4e . $v7dffdb5a5b; if (filemtime($v9a84a79e2e) < time() - (60 * 60 * 24)) { if (is_dir($v9a84a79e2e)) CacheHandlerUtil::deleteFolder($v9a84a79e2e); else unlink($v9a84a79e2e); } } } return $v5c1c342594; } private static function f3546f6da0a($v3d55458bcd) { $pfaf08f23 = new PHPVariablesFileHandler($v3d55458bcd); $pfaf08f23->startUserGlobalVariables(); $pab996f83 = $GLOBALS["tmp_path"]; $pfaf08f23->endUserGlobalVariables(); return $pab996f83; } } ?>
