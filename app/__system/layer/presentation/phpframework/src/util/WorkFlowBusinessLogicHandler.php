<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
include_once get_lib("org.phpframework.object.ObjTypeHandler"); class WorkFlowBusinessLogicHandler { public static function renameServiceObjectFile($pf3dc0762, $pe5762321) { $v02d749dd61 = false; if (file_exists($pf3dc0762)) { $pa1c3a9c4 = PHPCodePrintingHandler::getPHPClassesFromFile($pf3dc0762); unset($pa1c3a9c4[0]); $v02a69d4e0f = PHPCodePrintingHandler::decoupleClassNameWithNameSpace($pe5762321); $v1335217393 = $v02a69d4e0f["name"]; if (count($pa1c3a9c4) == 1 && $pa1c3a9c4[$pe5762321] && $v1335217393 == pathinfo($pf3dc0762, PATHINFO_FILENAME)) $v02d749dd61 = true; } return $v02d749dd61; } public static function prepareServiceObjectForsaving(&$v4948cc5869, $v5d3813882f = null) { $ped1096bd = $v5d3813882f && $v5d3813882f["default_include"] ? $v5d3813882f["default_include"] : ""; $v8fa7bffaba = $v5d3813882f && $v5d3813882f["default_extend"] ? $v5d3813882f["default_extend"] : ""; $v4948cc5869["includes"] = empty($v4948cc5869["includes"]) ? array() : $v4948cc5869["includes"]; $v4948cc5869["includes"] = is_array($v4948cc5869["includes"]) ? $v4948cc5869["includes"] : array($v4948cc5869["includes"]); $v0822e6cbe6 = false; $pc37695cb = count($v4948cc5869["includes"]); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pc24afc88 = $v4948cc5869["includes"][$v43dd7d0051]; $v67db1bd535 = $pc24afc88["path"]; if ($ped1096bd && str_replace("'", '"', $v67db1bd535) == $ped1096bd) $v0822e6cbe6 = true; else if ($pc24afc88["var_type"] == "string") { $pc24afc88["path"] = '$vars["business_logic_path"] . "/' . $v67db1bd535 . '"'; $pc24afc88["var_type"] = ""; $v4948cc5869["includes"][$v43dd7d0051] = $pc24afc88; } } if ($ped1096bd && !$v0822e6cbe6) $v4948cc5869["includes"][] = array( "path" => $ped1096bd, "var_type" => "", "once" => true ); if ($v8fa7bffaba && empty($v4948cc5869["extends"])) $v4948cc5869["extends"] = ($v4948cc5869["namespace"] && substr($v8fa7bffaba, 0, 1) != '\\' ? '\\' : '') . $v8fa7bffaba; } public static function isBusinessLogicService($v4948cc5869) { return strtolower($v4948cc5869["type"]) == "public" && !$v4948cc5869["abstract"] && !$v4948cc5869["static"] && is_array($v4948cc5869["arguments"]) && count($v4948cc5869["arguments"]) == 1 && ( array_key_exists('data', $v4948cc5869["arguments"]) || array_key_exists('$data', $v4948cc5869["arguments"]) ); } public static function prepareObjectIfIsBusinessLogicService(&$v4948cc5869) { if ($v4948cc5869["is_business_logic_service"]) { $v4948cc5869["type"] = "public"; $v4948cc5869["abstract"] = 0; $v4948cc5869["static"] = 0; $v4948cc5869["arguments"] = array(array( "name" => "data", "value" => null, "var_type" => "", )); if (isset($v4948cc5869["annotations"]) && is_array($v4948cc5869["annotations"])) foreach ($v4948cc5869["annotations"] as $v18f86e4308 => $pf81e7d81) { $pc37695cb = $pf81e7d81 ? count($pf81e7d81) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v1ebe15b151 = $pf81e7d81[$v43dd7d0051]; $v5e813b295b = trim($v1ebe15b151["name"]); $v5e813b295b = str_replace(array('"', "'"), "", $v5e813b295b); preg_match_all("/([^\[\]]+)/u", $v5e813b295b, $pbae7526c, PREG_PATTERN_ORDER); $v5e813b295b = "data[" . implode('][', $pbae7526c[1]) . "]"; $v4948cc5869["annotations"][$v18f86e4308][$v43dd7d0051]["name"] = $v5e813b295b; } } } } public static function getAnnotationsFromParameters($v9367d5be85, $v887e85c917 = false, $pa17baa76 = false, $v418bc820b7 = false, $v5a58bb7119 = false, $pace67119 = false, $v5eecea4d15 = false, $v6bebdf0e99 = false, $pdcf670f6 = "\t") { $pf81e7d81 = ""; if (is_array($v9367d5be85)) { $v3438e44e7a = null; foreach ($v9367d5be85 as $v5e813b295b => $pc5faab2f) { $pc5faab2f["name"] = $pc5faab2f["name"] ? $pc5faab2f["name"] : $v5e813b295b; $pf81e7d81 .= self::getAnnotationsFromParameter($pc5faab2f, $v887e85c917, $pa17baa76, $v418bc820b7, $v5a58bb7119, $pace67119, $v5eecea4d15, $v6bebdf0e99, $pdcf670f6, $v3438e44e7a); } if ($v3438e44e7a) $pf81e7d81 .= $v3438e44e7a; } return $pf81e7d81 ? "$pdcf670f6/**\n$pf81e7d81$pdcf670f6 */" : ""; } public static function getAnnotationsFromParameter($pc5faab2f, $v887e85c917 = false, $pa17baa76 = false, $v418bc820b7 = false, $v5a58bb7119 = false, $pace67119 = false, $v5eecea4d15 = false, $v6bebdf0e99 = false, $pdcf670f6 = "\t", &$v3438e44e7a = null) { $pf81e7d81 = ""; if ( ($pc5faab2f["primary_key"] && $v887e85c917) || (!$pc5faab2f["primary_key"] && $pa17baa76) ) { $v5e813b295b = $pc5faab2f["name"]; if ($v5e813b295b) { if ($v5eecea4d15 && !$pc5faab2f["primary_key"] && (ObjTypeHandler::isDBAttributeNameACreatedDate($v5e813b295b) || ObjTypeHandler::isDBAttributeNameACreatedUserId($v5e813b295b))) return ""; $pdf6a7143 = ObjTypeHandler::isPHPTypeNumeric($pc5faab2f["type"]); $pf17ebc72 = (ObjTypeHandler::isDBAttributeNameACreatedUserId($v5e813b295b) || ObjTypeHandler::isDBAttributeNameAModifiedUserId($v5e813b295b)) && $pdf6a7143; $v5a3bcff685 = $v6bebdf0e99 ? "[conditions]" : ""; $pf81e7d81 .= "$pdcf670f6 * @param (name=data{$v5a3bcff685}[" . $v5e813b295b . "], type=" . ($v6bebdf0e99 ? 'array|' : '') . $pc5faab2f["type"]; if (!$pc5faab2f["primary_key"] || $v887e85c917 !== 2) { $v9abfb1e31c = !isset($pc5faab2f["null"]) || $pc5faab2f["null"]; $pf81e7d81 .= $v418bc820b7 && !isset($pc5faab2f["mandatory"]) && !$v9abfb1e31c ? ", not_null=1" : ""; $pf81e7d81 .= $v418bc820b7 && $pc5faab2f["mandatory"] && ($pc5faab2f["primary_key"] || (!strlen($pc5faab2f["default"]) && !$v9abfb1e31c)) ? ", not_null=1" : ""; } if (trim(strtolower($pc5faab2f["default"])) == "null") $pc5faab2f["default"] = "@null"; else if (ObjTypeHandler::isDBAttributeValueACurrentTimestamp( trim($pc5faab2f["default"]) )) $pc5faab2f["default"] = "@date('Y-m-d H:i:s')"; else if ((empty($pc5faab2f["default"]) || trim($pc5faab2f["default"]) == "0000-00-00 00:00:00" || ObjTypeHandler::isDBAttributeValueACurrentTimestamp( trim($pc5faab2f["default"]) )) && (ObjTypeHandler::isDBAttributeNameACreatedDate($v5e813b295b) || ObjTypeHandler::isDBAttributeNameAModifiedDate($v5e813b295b))) $pc5faab2f["default"] = "@date('Y-m-d H:i:s')"; $v77a0f400bf = $pc5faab2f["primary_key"] && !$pdf6a7143; $v3c0209fac0 = substr($pc5faab2f["default"], 0, 1) == "@"; $pf81e7d81 .= $v5a58bb7119 && (!$pdf6a7143 || is_numeric($pc5faab2f["default"])) ? ", default=" . ($v3c0209fac0 || is_numeric($pc5faab2f["default"]) ? '' : '"') . $pc5faab2f["default"] . ($v3c0209fac0 || is_numeric($pc5faab2f["default"]) ? '' : '"') : ""; $pf81e7d81 .= $v77a0f400bf ? ", min_length=1" : ""; $pf81e7d81 .= $pace67119 && is_numeric($pc5faab2f["length"]) && $pc5faab2f["length"] ? ", " . ($v77a0f400bf ? "max_" : "") . "length=" . $pc5faab2f["length"] : ""; $v64a24c63c3 = !isset($pc5faab2f["add_sql_slashes"]) || $pc5faab2f["add_sql_slashes"] ? true : false; $pf81e7d81 .= $v64a24c63c3 && ObjTypeHandler::convertCompositeTypeIntoSimpleType($pc5faab2f["type"]) != "no_string" && !ObjTypeHandler::isPHPTypeNumeric($pc5faab2f["type"]) ? ", add_sql_slashes=1" : ""; $v665cc68459 = !isset($pc5faab2f["sanitize_html"]) || $pc5faab2f["sanitize_html"] ? true : false; $pf81e7d81 .= $v665cc68459 && ObjTypeHandler::isDBTypeText($pc5faab2f["type"]) ? ", sanitize_html=1" : ""; $pf81e7d81 .= ") " . $pc5faab2f["comment"] . " \n"; if ($pf17ebc72 && !$v6bebdf0e99) $v3438e44e7a = "$pdcf670f6 * @param (name=data[logged_user_id], type=" . $pc5faab2f["type"] . ($pace67119 && is_numeric($pc5faab2f["length"]) && $pc5faab2f["length"] ? ", " . ($v77a0f400bf ? "max_" : "") . "length=" . $pc5faab2f["length"] : "") . ") \n"; } } return $pf81e7d81; } public static function prepareAddcslashesCode($v9367d5be85) { if ($v9367d5be85) { $v067674f4e4 = ""; foreach ($v9367d5be85 as $v5e45ec9bb9 => $v1b0cfa478b) { $v5e813b295b = $v1b0cfa478b["name"] ? $v1b0cfa478b["name"] : $v5e45ec9bb9; $v3fb9f41470 = $v1b0cfa478b["type"]; if (ObjTypeHandler::convertCompositeTypeIntoSimpleType($v3fb9f41470) != "no_string" && !ObjTypeHandler::isPHPTypeNumeric($v3fb9f41470)) { $v067674f4e4 .= '
			if (isset($data["' . $v5e813b295b . '"])'; $v067674f4e4 .= ') $data["' . $v5e813b295b . '"] = addcslashes($data["' . $v5e813b295b . '"], "\\\\\'");'; } } return $v067674f4e4; } return ""; } public static function prepareAttributesDefaultValueCode($v9367d5be85, $v071665b860, $v5eecea4d15 = false) { $v067674f4e4 = ''; if (is_array($v9367d5be85)) foreach ($v9367d5be85 as $v5e813b295b => $pc5faab2f) if (!$pc5faab2f["primary_key"]) { $v3fb9f41470 = $pc5faab2f["type"]; $v9abfb1e31c = !isset($pc5faab2f["null"]) || $pc5faab2f["null"]; $pdf6a7143 = ObjTypeHandler::isDBTypeNumeric($v3fb9f41470); if ($v9abfb1e31c && ($pc5faab2f["mandatory"] || ObjTypeHandler::isDBTypeDate($v3fb9f41470) || $pdf6a7143)) { if ($v5eecea4d15 && (ObjTypeHandler::isDBAttributeNameACreatedDate($v5e813b295b) || ObjTypeHandler::isDBAttributeNameACreatedUserId($v5e813b295b))) continue; $pf17ebc72 = (ObjTypeHandler::isDBAttributeNameACreatedUserId($v5e813b295b) || ObjTypeHandler::isDBAttributeNameAModifiedUserId($v5e813b295b)) && $pdf6a7143; $v4bfe0500a2 = $pc5faab2f["default"]; if (ObjTypeHandler::isDBAttributeValueACurrentTimestamp($v4bfe0500a2)) $v4bfe0500a2 = 'date("Y-m-d H:i:s")'; else if (strlen($v4bfe0500a2)) $v4bfe0500a2 = is_numeric($v4bfe0500a2) ? $v4bfe0500a2 : '"' .$v4bfe0500a2 . '"'; $v067674f4e4 .= 'if (!isset($data["' . $v5e813b295b . '"]) || (is_string($data["' . $v5e813b295b . '"]) && !strlen(trim($data["' . $v5e813b295b . '"])))) $data["' . $v5e813b295b . '"] = '; if ((ObjTypeHandler::isDBAttributeNameACreatedDate($v5e813b295b) || ObjTypeHandler::isDBAttributeNameAModifiedDate($v5e813b295b)) && ObjTypeHandler::isDBTypeDate($v3fb9f41470)) $v067674f4e4 .= $v3fb9f41470 == "date" ? 'date("Y-m-d")' : 'date("Y-m-d H:i:s")'; else { if ($v071665b860) $v4bfe0500a2 = strlen($v4bfe0500a2) ? $v4bfe0500a2 : '"null"'; else $v4bfe0500a2 = strlen($v4bfe0500a2) ? $v4bfe0500a2 : 'null'; if ($pf17ebc72) $v4bfe0500a2 = '$data["logged_user_id"] ? $data["logged_user_id"] : ' . $v4bfe0500a2; $v067674f4e4 .= $v4bfe0500a2; } $v067674f4e4 .= ';
			'; } } return $v067674f4e4; } public static function prepareNumericAttributesStringValueCode($v9367d5be85) { $v067674f4e4 = ''; if (is_array($v9367d5be85)) foreach ($v9367d5be85 as $v5e813b295b => $pc5faab2f) { $v3fb9f41470 = $pc5faab2f["type"]; $pdf6a7143 = ObjTypeHandler::isDBTypeNumeric($v3fb9f41470); if ($pdf6a7143) { $v067674f4e4 .= 'if (isset($data["' . $v5e813b295b . '"]) && is_string($data["' . $v5e813b295b . '"]) && is_numeric($data["' . $v5e813b295b . '"])) $data["' . $v5e813b295b . '"] += 0;
			'; } } return $v067674f4e4; } } ?>
