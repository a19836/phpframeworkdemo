<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once get_lib("org.phpframework.util.xml.MyXML"); include_once get_lib("org.phpframework.util.xml.MyXMLArray"); include_once get_lib("org.phpframework.xmlfile.XMLFileParser"); include_once get_lib("org.phpframework.object.ObjTypeHandler"); include_once get_lib("org.phpframework.db.DB"); include_once $EVC->getUtilPath("WorkFlowDBHandler"); include_once $EVC->getUtilPath("AdminMenuHandler"); class WorkFlowDataAccessHandler { private $v1d696dbd12; private $pba9184cd; private $v0a1dac07d9 = array( "One To One" => "1-1", "One To Many" => "1-*", "Many To One" => "*-1", "Many To Many" => "*-*", ); public function setTasksFilePath($v5e053dece2) { $v8cd3e3837d = new WorkFlowTasksFileHandler($v5e053dece2); $v8cd3e3837d->init(); $v1d696dbd12 = $v8cd3e3837d->getTasks(); $v1d696dbd12 = WorkFlowTasksFileHandler::getWorkflowDataByTasks($v1d696dbd12); $this->v1d696dbd12 = array("containers" => $v1d696dbd12["containers"]); foreach ($v1d696dbd12["tasks"] as $v8282c7dd58 => $v7f5911d32d) $this->v1d696dbd12["tasks"][ $v7f5911d32d["label"] ] = $v7f5911d32d; $this->pba9184cd = $this->me8479d1c3331(); } public function setTasks($v1d696dbd12) { $this->v1d696dbd12 = $v1d696dbd12; $v1d696dbd12 = array(); foreach ($this->v1d696dbd12["tasks"] as $v8282c7dd58 => $v7f5911d32d) { $v1d696dbd12[ $v7f5911d32d["label"] ] = $v7f5911d32d; } $this->v1d696dbd12["tasks"] = $v1d696dbd12; $this->pba9184cd = $this->me8479d1c3331(); } public function getTasks() { return $this->v1d696dbd12; } public function getForeignKeys() { return $this->pba9184cd; } public function getTasksAsTables() { $v1d696dbd12 = $this->v1d696dbd12 && $this->v1d696dbd12["tasks"] ? $this->v1d696dbd12["tasks"] : array(); $pac4bc40a = array(); foreach ($v1d696dbd12 as $v8c5df8072b => $v7f5911d32d) { $pef349725 = $v7f5911d32d["properties"]; $pc9dfdb06 = $pef349725["table_attr_primary_keys"]; $v141a1052c0 = $pef349725["table_attr_names"]; $v64603d66e4 = $pef349725["table_attr_types"]; $pc338736d = $pef349725["table_attr_lengths"]; $pf950db1c = $pef349725["table_attr_nulls"]; $v6f7ca5e45f = $pef349725["table_attr_unsigneds"]; $pe23543a0 = $pef349725["table_attr_uniques"]; $v0277df0f74 = $pef349725["table_attr_auto_increments"]; $pa3301f67 = $pef349725["table_attr_has_defaults"]; $v559ea8b5aa = $pef349725["table_attr_defaults"]; $v342ece8a62 = $pef349725["table_attr_extras"]; $pc1c13991 = $pef349725["table_attr_charsets"]; $v4389940cae = $pef349725["table_attr_comments"]; if ($v141a1052c0) { if (is_array($v141a1052c0)) { $pc37695cb = count($v141a1052c0); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pb65331d8 = strtolower($pc9dfdb06[$v43dd7d0051]) == "true" || $pc9dfdb06[$v43dd7d0051] == "1"; $v5e45ec9bb9 = $v141a1052c0[$v43dd7d0051]; $v670a5790dd = strtolower($v64603d66e4[$v43dd7d0051]); $v2526c465bc = $pc338736d[$v43dd7d0051]; $pd8c9353b = strtolower($pf950db1c[$v43dd7d0051]) == "true" || $pf950db1c[$v43dd7d0051] == "1"; $v3c261bfc96 = strtolower($v6f7ca5e45f[$v43dd7d0051]) == "true" || $v6f7ca5e45f[$v43dd7d0051] == "1"; $v9707fb73e0 = strtolower($pe23543a0[$v43dd7d0051]) == "true" || $pe23543a0[$v43dd7d0051] == "1"; $pefe8fef4 = strtolower($v0277df0f74[$v43dd7d0051]) == "true" || $v0277df0f74[$v43dd7d0051] == "1"; $v24d6d98703 = strtolower($pa3301f67[$v43dd7d0051]) == "true" || $pa3301f67[$v43dd7d0051] == "1"; $v487af869a3 = $v559ea8b5aa[$v43dd7d0051]; $v86d8b50e05 = $v342ece8a62[$v43dd7d0051]; $v91b2b11f81 = $pc1c13991[$v43dd7d0051]; $pc3c16071 = $v4389940cae[$v43dd7d0051]; $pac4bc40a[$v8c5df8072b][$v5e45ec9bb9] = array( "name" => $v5e45ec9bb9, "type" => $v670a5790dd, "length" => $v2526c465bc, "null" => $pd8c9353b, "primary_key" => $pb65331d8, "unsigned" => $v3c261bfc96, "unique" => $v9707fb73e0, "auto_increment" => $pefe8fef4, "default" => $v24d6d98703 ? $v487af869a3 : null, "extra" => $v86d8b50e05, "charset" => $v91b2b11f81, "comment" => $pc3c16071, ); } } else { $pb65331d8 = strtolower($pc9dfdb06) == "true" || $pc9dfdb06 == "1"; $v5e45ec9bb9 = $v141a1052c0; $v670a5790dd = strtolower($v64603d66e4); $v2526c465bc = $pc338736d; $pd8c9353b = strtolower($pf950db1c) == "true" || $pf950db1c == "1"; $v3c261bfc96 = strtolower($v6f7ca5e45f) == "true" || $v6f7ca5e45f == "1"; $v9707fb73e0 = strtolower($pe23543a0) == "true" || $pe23543a0 == "1"; $pefe8fef4 = strtolower($v0277df0f74) == "true" || $v0277df0f74 == "1"; $v24d6d98703 = strtolower($pa3301f67) == "true" || $pa3301f67 == "1"; $v487af869a3 = $v559ea8b5aa; $v86d8b50e05 = $v342ece8a62; $v91b2b11f81 = $pc1c13991; $pc3c16071 = $v4389940cae; $pac4bc40a[$v8c5df8072b][$v5e45ec9bb9] = array( "name" => $v5e45ec9bb9, "type" => $v670a5790dd, "length" => $v2526c465bc, "null" => $pd8c9353b, "primary_key" => $pb65331d8, "unsigned" => $v3c261bfc96, "unique" => $v9707fb73e0, "auto_increment" => $pefe8fef4, "default" => $v24d6d98703 ? $v487af869a3 : null, "extra" => $v86d8b50e05, "charset" => $v91b2b11f81, "comment" => $pc3c16071, ); } } $pba9184cd = self::getTableFromTables($this->pba9184cd, $v8c5df8072b); if ($pba9184cd) { $pd28479e5 = count($pba9184cd); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) { $pa7c14731 = $pba9184cd[$v9d27441e80]; $v3fb9f41470 = $pa7c14731["type"]; $v9994512d98 = $pa7c14731["keys"]; $paf3a3908 = $v9994512d98 ? count($v9994512d98) : 0; switch($v3fb9f41470) { case "1-1": case "*-*": for ($pc5166886 = 0; $pc5166886 < $paf3a3908; $pc5166886++) { $pbfa01ed1 = $v9994512d98[$pc5166886]; $v5e45ec9bb9 = $pa7c14731["child_table"] == $v8c5df8072b ? $pbfa01ed1["child"] : $pbfa01ed1["parent"]; $v39cc6cbe9a = array( "table" => $pa7c14731["child_table"] == $v8c5df8072b ? $pa7c14731["parent_table"] : $pa7c14731["child_table"], "attribute" => $pa7c14731["child_table"] == $v8c5df8072b ? $pbfa01ed1["parent"] : $pbfa01ed1["child"], ); if ($pa7c14731["source"]) $v39cc6cbe9a["source"] = $pa7c14731["source"]; if ($pa7c14731["target"]) $v39cc6cbe9a["target"] = $pa7c14731["target"]; $pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"][] = $v39cc6cbe9a; } break; case "*-1": if ($pa7c14731["child_table"] == $v8c5df8072b) for ($pc5166886 = 0; $pc5166886 < $paf3a3908; $pc5166886++) { $pbfa01ed1 = $v9994512d98[$pc5166886]; $v5e45ec9bb9 = $pbfa01ed1["child"]; $v39cc6cbe9a = array( "table" => $pa7c14731["parent_table"], "attribute" => $pbfa01ed1["parent"], ); if ($pa7c14731["parent_table"] == $v8c5df8072b) { $v7959970a41 = false; if ($pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"]) foreach ($pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"] as $v39cc6cbe9a) if ($v39cc6cbe9a["table"] == $v8c5df8072b && $v39cc6cbe9a["attribute"] == $pbfa01ed1["parent"]) { $v7959970a41 = true; break; } if (!$v7959970a41) $pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"][] = $v39cc6cbe9a; } else $pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"][] = $v39cc6cbe9a; } break; case "1-*": if ($pa7c14731["child_table"] == $v8c5df8072b && $pa7c14731["parent_table"] == $v8c5df8072b) for ($pc5166886 = 0; $pc5166886 < $paf3a3908; $pc5166886++) { $pbfa01ed1 = $v9994512d98[$pc5166886]; $v5e45ec9bb9 = $pbfa01ed1["child"]; $v7959970a41 = false; if ($pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"]) foreach ($pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"] as $v39cc6cbe9a) if ($v39cc6cbe9a["table"] == $v8c5df8072b && $v39cc6cbe9a["attribute"] == $pbfa01ed1["parent"]) { $v7959970a41 = true; break; } if (!$v7959970a41) $pac4bc40a[$v8c5df8072b][$v5e45ec9bb9]["fk"][] = array( "table" => $v8c5df8072b, "attribute" => $pbfa01ed1["parent"], ); } break; } } } } return $pac4bc40a; } private static function f75118bf403($v3c76382d93) { $v9073377656 = array(); preg_match_all("/([\"']?)(\#)([\w \-\+\.\>\<]*)(\#)([\"']?)/u", $v3c76382d93, $v62bf8bcb37); $v62bf8bcb37 = $v62bf8bcb37[0]; $pc37695cb = count($v62bf8bcb37); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5fa7432164 = $v62bf8bcb37[$v43dd7d0051]; $v5e813b295b = str_replace(array("'", '"', "#"), "", $v5fa7432164); $v3fb9f41470 = strpos($v5fa7432164, "'") !== false || strpos($v5fa7432164, '"') !== false ? "string" : ""; $v9073377656[$v5e813b295b] = isset($v9073377656[$v5e813b295b]) && empty($v9073377656[$v5e813b295b]) ? $v9073377656[$v5e813b295b] : $v3fb9f41470; } return $v9073377656; } public static function getXmlHibernateImportsData($v45952cf45c) { $v09421cf63e = file_exists($v45952cf45c) ? file_get_contents($v45952cf45c) : ""; if (!empty($v09421cf63e)) { $pfb662071 = self::f944de41f66($v09421cf63e); return $pfb662071["sql_mapping"][0]["childs"]["import"]; } return false; } public static function getXmlHibernateObjData($v45952cf45c, $v9ff79a4a24) { $v09421cf63e = file_exists($v45952cf45c) ? file_get_contents($v45952cf45c) : ""; if (!empty($v09421cf63e)) { $pfb662071 = self::f944de41f66($v09421cf63e); $pa1c3a9c4 = $pfb662071["sql_mapping"][0]["childs"]["class"]; if ($pa1c3a9c4) { $pc37695cb = count($pa1c3a9c4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) if ($pa1c3a9c4[$v43dd7d0051]["@"]["name"] == $v9ff79a4a24) { $pf232dd5a = $pa1c3a9c4[$v43dd7d0051]; $pf232dd5a["childs"]["relationships"] = XMLFileParser::combineMultipleNodesInASingleNode($pf232dd5a["childs"]["relationships"]); $pf232dd5a["childs"]["queries"] = XMLFileParser::combineMultipleNodesInASingleNode($pf232dd5a["childs"]["queries"]); return $pf232dd5a; } } } return false; } public static function getXmlHibernateObjQueryOrMapData($v45952cf45c, $v9ff79a4a24, $v41dd9f9ba8, $pc28d161b, $v05e3431fe2 = false) { $v09421cf63e = file_exists($v45952cf45c) ? file_get_contents($v45952cf45c) : ""; if (!empty($v09421cf63e)) { $v05e3431fe2 = $v05e3431fe2 ? $v05e3431fe2 : "queries"; $pfb662071 = self::f944de41f66($v09421cf63e); $pa1c3a9c4 = $pfb662071["sql_mapping"][0]["childs"]["class"]; if ($pa1c3a9c4) { $pc37695cb = count($pa1c3a9c4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) if ($pa1c3a9c4[$v43dd7d0051]["@"]["name"] == $v9ff79a4a24) { $pf232dd5a = $pa1c3a9c4[$v43dd7d0051]; $v50d32a6fc4 = XMLFileParser::combineMultipleNodesInASingleNode($pf232dd5a["childs"][$v05e3431fe2]); $v9d5bd46e17 = $v50d32a6fc4[0]["childs"]; $pc28d161b = $pc28d161b ? $pc28d161b : array("insert", "update", "delete", "select", "procedure", "parameter_map", "result_map", "one_to_one", "one_to_many", "many_to_one", "many_to_many"); return self::mfd9472e1cadf($v9d5bd46e17, $v41dd9f9ba8, $pc28d161b); } } } return false; } public static function getXmlQueryOrMapData($v45952cf45c, $v41dd9f9ba8, $pc28d161b) { $v09421cf63e = file_exists($v45952cf45c) ? file_get_contents($v45952cf45c) : ""; if (!empty($v09421cf63e)) { $pfb662071 = self::f944de41f66($v09421cf63e); $v9994512d98 = array_keys($pfb662071); $v201d5661d1 = $v9994512d98[0]; $v9d5bd46e17 = $pfb662071[$v201d5661d1][0]["childs"]; $pc28d161b = $pc28d161b ? $pc28d161b : array("insert", "update", "delete", "select", "procedure", "parameter_map", "result_map", "one_to_one", "one_to_many", "many_to_one", "many_to_many"); return self::mfd9472e1cadf($v9d5bd46e17, $v41dd9f9ba8, $pc28d161b); } return false; } private static function mfd9472e1cadf($v9d5bd46e17, $v9ff79a4a24, $pc28d161b = array()) { if (is_array($v9d5bd46e17)) { foreach ($v9d5bd46e17 as $v3fb9f41470 => $pf72c1d58) { if ($pf72c1d58 && (empty($pc28d161b) || in_array($v3fb9f41470, $pc28d161b))) { $pc37695cb = count($pf72c1d58); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v1cbfbb49c5 = $pf72c1d58[$v9d27441e80]["@"]["id"] ? $pf72c1d58[$v9d27441e80]["@"]["id"] : $pf72c1d58[$v9d27441e80]["@"]["name"]; if ($v1cbfbb49c5 == $v9ff79a4a24) { return $pf72c1d58[$v9d27441e80]; } } } } } return null; } public static function getDAOObjectsLibPath($v3fb9f41470) { $pa5f3c638 = AdminMenuHandler::getDaoObjs(); return self::f430f313224($pa5f3c638, $v3fb9f41470); } private static function f430f313224($v50d32a6fc4, $v3fb9f41470) { $pa5f3c638 = array(); if ($v50d32a6fc4) { foreach ($v50d32a6fc4 as $pff56eb51 => $v6694236c2c) { if ($pff56eb51 != "properties") { if ($v6694236c2c["properties"]["item_type"] == $v3fb9f41470) { $v14b888c9ab = pathinfo($v6694236c2c["properties"]["path"]); $pa5f3c638[] = "vendor.dao." . str_replace("/", ".", $v14b888c9ab["dirname"] . "/" . $v14b888c9ab["filename"]); } else { $pa5f3c638 = array_merge($pa5f3c638, self::f430f313224($v6694236c2c, $v3fb9f41470)); } } } } return $pa5f3c638; } public static function getMapDBTypes() { return ObjTypeHandler::getDBTypesPaths(); } public static function getMapPHPTypes() { return ObjTypeHandler::getPHPTypesPaths(); } public static function getNodeValue($v6694236c2c, $v5e45ec9bb9, $v670a5790dd = "value") { $v67db1bd535 = XMLFileParser::getAttribute($v6694236c2c, $v5e45ec9bb9); if (!isset($v67db1bd535) && isset($v6694236c2c["childs"]) && isset($v6694236c2c["childs"][$v5e45ec9bb9])) { $v67db1bd535 = XMLFileParser::getAttribute($v6694236c2c["childs"][$v5e45ec9bb9][0], $v670a5790dd); } if ($v5e45ec9bb9 == "value" && $v6694236c2c["value"]) { return $v6694236c2c["value"]; } return $v67db1bd535; } public static function createIncludesFromObjectData($pf3dc0762, $v539082ff30, $pfd248cca) { $v5c1c342594 = false; if ($pf3dc0762 && file_exists($pf3dc0762)) { $v09421cf63e = file_get_contents($pf3dc0762); $pfb662071 = self::f944de41f66($v09421cf63e); $v9994512d98 = array_keys($pfb662071); $v201d5661d1 = $v9994512d98[0]; $v280898d986 = $v539082ff30["queries"][0]["childs"]["import"]; if ($v280898d986) { $pfb662071[$v201d5661d1][0]["childs"]["import"] = $v280898d986; } else { unset($pfb662071[$v201d5661d1][0]["childs"]["import"]); } $v7b5a53c9d7 = $pfd248cca == "hibernate" ? '<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">' : '<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">'; $v6da2ec01d0 = self::mb12381933b4e($pfb662071, "\n$v7b5a53c9d7\n"); $v5c1c342594 = self::f55ce0f1965($pf3dc0762, $v6da2ec01d0); } return $v5c1c342594 ? true : false; } public function createHibernateObjectFromObjectData($pf3dc0762, $v539082ff30, $pc4aa460d = false, $pa9694aaa = false) { $v5c1c342594 = false; if ($pf3dc0762) { $v9ff79a4a24 = $pa9694aaa ? $pa9694aaa : $v539082ff30["class"][0]["@"]["name"]; $pd4b5eb28 = self::getXmlHibernateObjData($pf3dc0762, $v9ff79a4a24); $v9ff79a4a24 = $pd4b5eb28 && !$pc4aa460d ? $v9ff79a4a24 . "_" . rand(0, 1000) : $v9ff79a4a24; if (is_dir($pf3dc0762)) $pf3dc0762 .= "/$v9ff79a4a24.xml"; if ($pd4b5eb28 && $pc4aa460d) { $v09421cf63e = file_get_contents($pf3dc0762); $pfb662071 = self::f944de41f66($v09421cf63e); $pa1c3a9c4 = $pfb662071["sql_mapping"][0]["childs"]["class"]; $v391bca0441 = array(); if ($pa1c3a9c4) { $pc37695cb = count($pa1c3a9c4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { if ($pa1c3a9c4[$v43dd7d0051]["@"]["name"] == $v9ff79a4a24) { $v9d24c33f35 = $v539082ff30["class"][0]; if ($v9d24c33f35) { $v391bca0441[] = $v9d24c33f35; } } else { $v391bca0441[] = $pa1c3a9c4[$v43dd7d0051]; } } } $pfb662071["sql_mapping"][0]["childs"]["class"] = $v391bca0441; $v6da2ec01d0 = self::mb12381933b4e($pfb662071, "\n" . '<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">' . "\n"); $v5c1c342594 = self::f55ce0f1965($pf3dc0762, $v6da2ec01d0); } else { $v539082ff30 = $v539082ff30 ? array("sql_mapping" => array(0 => array("childs" => $v539082ff30))) : array(); $pa694ba99 = new MyXMLArray($v539082ff30); $v241205aec6 = $v539082ff30 ? $pa694ba99->toXML(array("lower_case_keys" => true, "to_decimal" => true)) : ""; if (file_exists($pf3dc0762)) { $pae77d38c = file_get_contents($pf3dc0762); if (strpos($pae77d38c, "<sql_mapping>") !== false) { $v241205aec6 = trim(str_replace("<sql_mapping>", "", $v241205aec6, $v9a8b7dc209 = 1)); $pae77d38c = str_replace("</sql_mapping>", "\n$v241205aec6", $pae77d38c); } else $pae77d38c = '<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
' . $v241205aec6; } else { $pae77d38c = '<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
' . $v241205aec6; } $v5c1c342594 = self::f55ce0f1965($pf3dc0762, $pae77d38c); } } return $v5c1c342594 ? true : false; } public function createHibernateObjectFromDBTaskFlow($v8c5df8072b, $pf3dc0762, $pc4aa460d = false, $pa9694aaa = false, $v1d20487968 = false) { if ($pf3dc0762 && $v8c5df8072b) { $v7f5911d32d = self::getTableFromTables($this->v1d696dbd12["tasks"], $v8c5df8072b); if ($v7f5911d32d) { $v9ff79a4a24 = empty($pa9694aaa) ? self::f337ea47e85($v7f5911d32d["alias"] ? $v7f5911d32d["alias"] : $v8c5df8072b) : $pa9694aaa; $v241205aec6 = $this->f1ab98bd5e1($v7f5911d32d, $v9ff79a4a24, $v1d20487968); $v539082ff30 = self::f944de41f66($v241205aec6); return $this->createHibernateObjectFromObjectData($pf3dc0762, $v539082ff30, $pc4aa460d, $v9ff79a4a24); } } return false; } public function createHibernateQueriesFromObjectData($pf3dc0762, $pa9694aaa, $v539082ff30, $pfb6c6f83 = false, $v05e3431fe2 = false) { $v5c1c342594 = false; if ($pf3dc0762 && file_exists($pf3dc0762) && $pa9694aaa) { $v05e3431fe2 = $v05e3431fe2 ? $v05e3431fe2 : "queries"; $v376655d624 = $v539082ff30["queries"][0]["childs"] ? $v539082ff30["queries"][0]["childs"] : array(); if (!$pfb6c6f83) { $pfb6c6f83 = array(); foreach ($v376655d624 as $v9c4bf49720 => $v50d32a6fc4) if ($v50d32a6fc4) { $pc37695cb = count($v50d32a6fc4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pff56eb51 = $v50d32a6fc4[$v43dd7d0051]["@"]["id"] ? $v50d32a6fc4[$v43dd7d0051]["@"]["id"] : $v50d32a6fc4[$v43dd7d0051]["@"]["name"]; $pfb6c6f83[$v9c4bf49720][$pff56eb51] = $v43dd7d0051; } } } if ($pfb6c6f83) { $v09421cf63e = file_get_contents($pf3dc0762); $pfb662071 = self::f944de41f66($v09421cf63e); $pa1c3a9c4 = $pfb662071["sql_mapping"][0]["childs"]["class"]; if ($pa1c3a9c4) { $pc37695cb = count($pa1c3a9c4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { if ($pa1c3a9c4[$v43dd7d0051]["@"]["name"] == $pa9694aaa) { $pf85aa381 = $pfb662071["sql_mapping"][0]["childs"]["class"][$v43dd7d0051]; $v1b0642ff06 = $pf85aa381["childs"][$v05e3431fe2][0]["childs"]; if ($v1b0642ff06) { foreach ($v1b0642ff06 as $v9c4bf49720 => $v50d32a6fc4) { $pd29b0c43 = array(); if ($v50d32a6fc4) { $pd28479e5 = count($v50d32a6fc4); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) { $v6694236c2c = $v50d32a6fc4[$v9d27441e80]; $pff56eb51 = $v6694236c2c["@"]["id"] ? $v6694236c2c["@"]["id"] : $v6694236c2c["@"]["name"]; if ($pff56eb51 && isset($pfb6c6f83[$v9c4bf49720][$pff56eb51])) { $pd69fb7d0 = $pfb6c6f83[$v9c4bf49720][$pff56eb51]; $v948cbcb5c1 = $v376655d624[$v9c4bf49720][$pd69fb7d0]; if ($v948cbcb5c1) $pd29b0c43[] = $v948cbcb5c1; unset($pfb6c6f83[$v9c4bf49720][$pff56eb51]); } else $pd29b0c43[] = $v6694236c2c; } } $v1b0642ff06[$v9c4bf49720] = $pd29b0c43; } } foreach ($pfb6c6f83 as $v9c4bf49720 => $pd61417ac) foreach ($pd61417ac as $pff56eb51 => $pd69fb7d0) { $v948cbcb5c1 = $v376655d624[$v9c4bf49720][$pd69fb7d0]; if ($v948cbcb5c1) $v1b0642ff06[$v9c4bf49720][] = $v948cbcb5c1; } $pf85aa381["childs"][$v05e3431fe2][0]["childs"] = $v1b0642ff06; $pfb662071["sql_mapping"][0]["childs"]["class"][$v43dd7d0051] = $pf85aa381; break; } } } $v6da2ec01d0 = self::mb12381933b4e($pfb662071, "\n" . '<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">'. "\n"); $v5c1c342594 = self::f55ce0f1965($pf3dc0762, $v6da2ec01d0); } } return $v5c1c342594 ? true : false; } public function createTableQueriesFromObjectData($pf3dc0762, $v539082ff30, $pc4aa460d = false, $pfb6c6f83 = false, $pce2c28ae = false) { $v5c1c342594 = false; if ($pf3dc0762) { $v376655d624 = $v539082ff30["queries"][0]["childs"] ? $v539082ff30["queries"][0]["childs"] : array(); $v201d5661d1 = $pce2c28ae ? "import" : "sql_mapping"; if ($pc4aa460d && file_exists($pf3dc0762)) { if (!$pfb6c6f83) { $pfb6c6f83 = array(); foreach ($v376655d624 as $v9c4bf49720 => $v50d32a6fc4) if ($v50d32a6fc4) { $pc37695cb = count($v50d32a6fc4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pff56eb51 = $v50d32a6fc4[$v43dd7d0051]["@"]["id"] ? $v50d32a6fc4[$v43dd7d0051]["@"]["id"] : $v50d32a6fc4[$v43dd7d0051]["@"]["name"]; $pfb6c6f83[$v9c4bf49720][$pff56eb51] = $v43dd7d0051; } } } if ($pfb6c6f83) { $v09421cf63e = file_get_contents($pf3dc0762); $pfb662071 = self::f944de41f66($v09421cf63e); if ($pfb662071[$v201d5661d1][0]["childs"]) foreach ($pfb662071[$v201d5661d1][0]["childs"] as $v9c4bf49720 => $v50d32a6fc4) { $pd29b0c43 = array(); if ($v50d32a6fc4) { $pc37695cb = count($v50d32a6fc4); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v6694236c2c = $v50d32a6fc4[$v43dd7d0051]; $pff56eb51 = $v6694236c2c["@"]["id"] ? $v6694236c2c["@"]["id"] : $v6694236c2c["@"]["name"]; if ($pff56eb51 && isset($pfb6c6f83[$v9c4bf49720][$pff56eb51])) { $pd69fb7d0 = $pfb6c6f83[$v9c4bf49720][$pff56eb51]; $v948cbcb5c1 = $v376655d624[$v9c4bf49720][$pd69fb7d0]; if ($v948cbcb5c1) $pd29b0c43[] = $v948cbcb5c1; unset($pfb6c6f83[$v9c4bf49720][$pff56eb51]); } else $pd29b0c43[] = $v6694236c2c; } } $pfb662071[$v201d5661d1][0]["childs"][$v9c4bf49720] = $pd29b0c43; } foreach ($pfb6c6f83 as $v9c4bf49720 => $pd61417ac) foreach ($pd61417ac as $pff56eb51 => $pd69fb7d0) { $v948cbcb5c1 = $v376655d624[$v9c4bf49720][$pd69fb7d0]; if ($v948cbcb5c1) $pfb662071[$v201d5661d1][0]["childs"][$v9c4bf49720][] = $v948cbcb5c1; } $v6da2ec01d0 = self::mb12381933b4e($pfb662071, "\n" . '<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">'. "\n"); $v5c1c342594 = self::f55ce0f1965($pf3dc0762, $v6da2ec01d0); } } else { $v201d5661d1 = strtolower($v201d5661d1); $v376655d624 = $v376655d624 ? array($v201d5661d1 => array(0 => array("childs" => $v376655d624))) : array(); $pa694ba99 = new MyXMLArray($v376655d624); $v241205aec6 = $v376655d624 ? $pa694ba99->toXML(array("lower_case_keys" => true, "to_decimal" => true)) : ""; if (file_exists($pf3dc0762)) { $v241205aec6 = trim(str_replace("<$v201d5661d1>", "", $v241205aec6, $v9a8b7dc209 = 1)); $pae77d38c = file_get_contents($pf3dc0762); $pae77d38c = str_replace("</$v201d5661d1>", "\n$v241205aec6", $pae77d38c); } else $pae77d38c = '<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
' . $v241205aec6; $v5c1c342594 = self::f55ce0f1965($pf3dc0762, $pae77d38c); } } return $v5c1c342594 ? true : false; } public function createTableQueriesFromDBTaskFlow($v8c5df8072b, $pf3dc0762, $pc4aa460d = false, $v1d20487968 = false) { if ($pf3dc0762) { $v7f5911d32d = self::getTableFromTables($this->v1d696dbd12["tasks"], $v8c5df8072b); $v241205aec6 = $this->f46b38c48e7($v7f5911d32d, $v1d20487968); $v539082ff30 = self::f944de41f66("<queries>$v241205aec6</queries>"); return $this->createTableQueriesFromObjectData($pf3dc0762, $v539082ff30, $pc4aa460d); } return false; } public function getHibernateObjectArrayFromDBTaskFlow($v8c5df8072b, $v9ff79a4a24 = false, $v1d20487968 = false) { $v7f5911d32d = self::getTableFromTables($this->v1d696dbd12["tasks"], $v8c5df8072b); if ($v7f5911d32d) { $v9ff79a4a24 = empty($v9ff79a4a24) ? self::f337ea47e85($v8c5df8072b) : $v9ff79a4a24; $v241205aec6 = $this->f1ab98bd5e1($v7f5911d32d, $v9ff79a4a24, $v1d20487968); $pfb662071 = self::f944de41f66($v241205aec6); return $pfb662071; } return null; } public function getQueryObjectsArrayFromDBTaskFlow($v8c5df8072b, $v1d20487968 = false) { $v7f5911d32d = self::getTableFromTables($this->v1d696dbd12["tasks"], $v8c5df8072b); if ($v7f5911d32d) { $v241205aec6 = $this->f46b38c48e7($v7f5911d32d, $v1d20487968, "\t"); $pfb662071 = self::f944de41f66("<queries>$v241205aec6</queries>"); return $pfb662071; } return null; } private function f1ab98bd5e1($v7f5911d32d, $v9ff79a4a24, $v1d20487968) { $v241205aec6 = ''; if (!empty($v7f5911d32d)) { if (strtolower($v7f5911d32d["tag"] == "table")) { $pef349725 = $v7f5911d32d["properties"]; $v8c5df8072b = $v7f5911d32d["label"]; $pc9dfdb06 = $pef349725["table_attr_primary_keys"]; $v141a1052c0 = $pef349725["table_attr_names"]; $v64603d66e4 = $pef349725["table_attr_types"]; $pc338736d = $pef349725["table_attr_lengths"]; $pf950db1c = $pef349725["table_attr_nulls"]; $v6f7ca5e45f = $pef349725["table_attr_unsigneds"]; $pe23543a0 = $pef349725["table_attr_uniques"]; $v0277df0f74 = $pef349725["table_attr_auto_increments"]; $pa3301f67 = $pef349725["table_attr_has_defaults"]; $v559ea8b5aa = $pef349725["table_attr_defaults"]; $v342ece8a62 = $pef349725["table_attr_extras"]; $pc1c13991 = $pef349725["table_attr_charsets"]; $v4389940cae = $pef349725["table_attr_comments"]; $pba9184cd = self::getTableFromTables($this->pba9184cd, $v8c5df8072b); $v241205aec6 .= '
	<class name="' . $v9ff79a4a24 . '" table="' . $v8c5df8072b . '">'; if ($v141a1052c0) { $pc37695cb = count($v141a1052c0); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5e45ec9bb9 = $v141a1052c0[$v43dd7d0051]; $v670a5790dd = strtolower($v64603d66e4[$v43dd7d0051]); $pb65331d8 = strtolower($pc9dfdb06[$v43dd7d0051]) == "true" || $pc9dfdb06[$v43dd7d0051] == "1"; if ($pb65331d8) { $pefe8fef4 = self::isAutoIncrementedAttribute(array("type" => $v670a5790dd, "extra" => $v342ece8a62[$v43dd7d0051], "auto_increment" => $v0277df0f74[$v43dd7d0051])); if ($pefe8fef4) $v241205aec6 .= '
			<id column="' . $v5e45ec9bb9 . '" />
			'; else $v241205aec6 .= '
			<id column="' . $v5e45ec9bb9 . '">
				<generator type="increment" />
			</id>
			'; } } } if ($v1d20487968) { $v241205aec6 .= self::getTableParameterMap($v141a1052c0, $v64603d66e4, self::f337ea47e85($v8c5df8072b) . "ParameterMap", "\t"); $v241205aec6 .= self::getTableResultMap($v141a1052c0, $v64603d66e4, self::f337ea47e85($v8c5df8072b) . "ResultMap", "\t"); } if (!empty($pba9184cd)) { $v241205aec6 .= '
		<relationships>'; $v4159504aa3 = array_flip($this->v0a1dac07d9); if ($v1d20487968) { $pa03d305e = array(); $pc37695cb = count($pba9184cd); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v615f2b77c3 = $pba9184cd[$v9d27441e80]; $pa03d305e[] = $v615f2b77c3["child_table"] == $v8c5df8072b ? $v615f2b77c3["parent_table"] : $v615f2b77c3["child_table"]; } $pa03d305e = array_unique($pa03d305e); $pc37695cb = count($pa03d305e); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v78108fb2bd = $pa03d305e[$v9d27441e80]; $v5903f00766 = self::f337ea47e85($v78108fb2bd) . "ResultMap"; $v3357bc7a47 = $this->v1d696dbd12["tasks"][$v78108fb2bd]; $v241205aec6 .= self::getTableResultMap($v3357bc7a47["properties"]["table_attr_names"], $v3357bc7a47["properties"]["table_attr_types"], $v5903f00766, "\t\t"); } } $pc37695cb = count($pba9184cd); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v615f2b77c3 = $pba9184cd[$v9d27441e80]; $v3fb9f41470 = $v615f2b77c3["type"]; $v77af13d404 = $v4159504aa3[$v3fb9f41470]; if ($v77af13d404) { $v77af13d404 = str_replace(" ", "_", strtolower($v77af13d404)); $v78108fb2bd = $v615f2b77c3["child_table"] == $v8c5df8072b ? $v615f2b77c3["parent_table"] : $v615f2b77c3["child_table"]; $v5903f00766 = $v1d20487968 ? self::f337ea47e85($v78108fb2bd) . "ResultMap" : null; $v566db8f5a9 = $v7f5911d32d["alias"]; $pea4553dc = $this->v1d696dbd12["tasks"][$v78108fb2bd]["alias"]; $v5e813b295b = self::getForeignTableQueryName($v566db8f5a9 ? $v566db8f5a9 : $v8c5df8072b, $pea4553dc ? $pea4553dc : $v78108fb2bd, $v3fb9f41470); $v5e813b295b = $v5e813b295b ? substr($v5e813b295b, strlen("get_")) : $v5e813b295b; $pb1915dc7 = ''; if ($v615f2b77c3["keys"]) { $pd28479e5 = count($v615f2b77c3["keys"]); for ($pc5166886 = 0; $pc5166886 < $pd28479e5; $pc5166886++) { $v7a1b9c07b3 = $v615f2b77c3["keys"][$pc5166886]; $v294f67133d = $v78108fb2bd; if ($v615f2b77c3["child_table"] == $v8c5df8072b) { $pa3c827a4 = $v7a1b9c07b3["child"]; $v8903e4e7c4 = $v7a1b9c07b3["parent"]; } else { $pa3c827a4 = $v7a1b9c07b3["parent"]; $v8903e4e7c4 = $v7a1b9c07b3["child"]; } $pb1915dc7 .= '
					<key pcolumn="' . $pa3c827a4 . '" fcolumn="' . $v8903e4e7c4 . '" ftable="' . $v294f67133d . '" />'; } } $ped0a6251 = $this->f25bd954d39($v78108fb2bd); $v5447ed1982 = ''; if ($ped0a6251) { $pd28479e5 = count($ped0a6251); for ($pc5166886 = 0; $pc5166886 < $pd28479e5; $pc5166886++) $v5447ed1982 .= '
					<attribute column="' . $ped0a6251[$pc5166886] . '" table="' . $v78108fb2bd . '" />'; } $v11abf661e9 = $v5903f00766 ? " result_map=\"" . $v5903f00766 . "\"" : ""; $v241205aec6 .= "
			<$v77af13d404 name=\"$v5e813b295b\"$v11abf661e9>$pb1915dc7\n$v5447ed1982
			</$v77af13d404>\n"; } } $v241205aec6 .= '
		</relationships>
		'; } $v241205aec6 .= "
		<queries>
			<!-- You can insert here new sql queries... -->
		" . "
		</queries>"; $v241205aec6 .= '
	</class>'; } } return $v241205aec6; } private function f46b38c48e7($v7f5911d32d, $v1d20487968, $v54bb17785b = false) { $v241205aec6 = ''; if (!empty($v7f5911d32d)) { if (strtolower($v7f5911d32d["tag"] == "table")) { $pef349725 = $v7f5911d32d["properties"]; $v8c5df8072b = $v7f5911d32d["label"]; $v566db8f5a9 = $v7f5911d32d["alias"]; $v71571534b0 = str_replace(array(" ", "."), "_", strtolower($v566db8f5a9 ? $v566db8f5a9 : $v8c5df8072b)); $v141a1052c0 = $pef349725["table_attr_names"]; if ($v141a1052c0) { $pbbcdea40 = ObjTypeHandler::getDBNumericTypes(); $pc9dfdb06 = $pef349725["table_attr_primary_keys"]; $v64603d66e4 = $pef349725["table_attr_types"]; $v0277df0f74 = $pef349725["table_attr_auto_increments"]; $v342ece8a62 = $pef349725["table_attr_extras"]; $pae040e02 = $pf16e0a65 = $v5dcbbc1437 = $v2097e6d88d = $v81cfea8707 = $paf1bc6f6 = $v223002cb02 = array(); $pc37695cb = count($v141a1052c0); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5e45ec9bb9 = $v141a1052c0[$v43dd7d0051]; $pb65331d8 = $pc9dfdb06[$v43dd7d0051]; $pb65331d8 = $pb65331d8 == "1" || strtolower($pb65331d8) == "true"; $v223002cb02[$v5e45ec9bb9] = $v5e45ec9bb9; $pf16e0a65[$v5e45ec9bb9] = "#$v5e45ec9bb9#"; if (!$pb65331d8 || !self::isAutoIncrementedAttribute(array("type" => $v64603d66e4[$v43dd7d0051], "extra" => $v342ece8a62[$v43dd7d0051], "auto_increment" => $v0277df0f74[$v43dd7d0051]))) $pae040e02[$v5e45ec9bb9] = "#$v5e45ec9bb9#"; if ($pb65331d8) { $paf1bc6f6[$v5e45ec9bb9] = "#$v5e45ec9bb9#"; $v2097e6d88d[$v5e45ec9bb9] = "#new_$v5e45ec9bb9#"; $v81cfea8707[$v5e45ec9bb9] = "#old_$v5e45ec9bb9#"; } else if (!ObjTypeHandler::isDBAttributeNameACreatedDate($v5e45ec9bb9)) { $v5dcbbc1437[$v5e45ec9bb9] = "#$v5e45ec9bb9#"; } } $v2f5a2aa950 = DB::buildDefaultTableInsertSQL($v8c5df8072b, $pae040e02); $pc2a89af2 = DB::buildDefaultTableInsertSQL($v8c5df8072b, $pf16e0a65); $v5b56a70669 = DB::buildDefaultTableUpdateSQL($v8c5df8072b, $v5dcbbc1437, $paf1bc6f6); $pa3d47349 = DB::buildDefaultTableUpdateSQL($v8c5df8072b, $v5dcbbc1437, null, array("all" => true)); $v57ea021647 = DB::buildDefaultTableUpdateSQL($v8c5df8072b, $v2097e6d88d, $v81cfea8707); $v942d144222 = DB::buildDefaultTableDeleteSQL($v8c5df8072b, $paf1bc6f6); $paa827116 = DB::buildDefaultTableDeleteSQL($v8c5df8072b, null, array("all" => true)); $v9e529d8324 = DB::buildDefaultTableFindSQL($v8c5df8072b, $v223002cb02, $paf1bc6f6); $v52c867ceb3 = DB::buildDefaultTableFindSQL($v8c5df8072b, $v223002cb02); $pfee276c6 = DB::buildDefaultTableCountSQL($v8c5df8072b); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5e45ec9bb9 = $v141a1052c0[$v43dd7d0051]; $v670a5790dd = $v64603d66e4[$v43dd7d0051]; if (in_array($v670a5790dd, $pbbcdea40)) { $v2f5a2aa950 = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $v2f5a2aa950); $pc2a89af2 = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $pc2a89af2); $v5b56a70669 = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $v5b56a70669); $pa3d47349 = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $pa3d47349); $v942d144222 = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $v942d144222); $v9e529d8324 = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $v9e529d8324); $pb65331d8 = $pc9dfdb06[$v43dd7d0051]; $pb65331d8 = $pb65331d8 == "1" || strtolower($pb65331d8) == "true"; if ($pb65331d8) { $v57ea021647 = str_replace("'#new_$v5e45ec9bb9#'", "#new_$v5e45ec9bb9#", $v57ea021647); $v57ea021647 = str_replace("'#old_$v5e45ec9bb9#'", "#old_$v5e45ec9bb9#", $v57ea021647); } } } if ($v1d20487968) { $v22db9a54ff = self::f337ea47e85($v8c5df8072b) . "ParameterMap"; $pab5ae921 = self::f337ea47e85($v8c5df8072b) . "PksParameterMap"; $v5903f00766 = self::f337ea47e85($v8c5df8072b) . "ResultMap"; $v1e1db68c67 = $v928474762b = array(); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pb65331d8 = $pc9dfdb06[$v43dd7d0051]; $pb65331d8 = $pb65331d8 == "1" || strtolower($pb65331d8) == "true"; if ($pb65331d8) { $v1e1db68c67[] = $v141a1052c0[$v43dd7d0051]; $v928474762b[] = $v64603d66e4[$v43dd7d0051]; } } $v241205aec6 .= self::getTableParameterMap($v141a1052c0, $v64603d66e4, $v22db9a54ff, $v54bb17785b); $v241205aec6 .= self::getTableParameterMap($v1e1db68c67, $v928474762b, $pab5ae921, $v54bb17785b); $v241205aec6 .= self::getTableResultMap($v141a1052c0, $v64603d66e4, $v5903f00766, $v54bb17785b); } $v0e658cc4ed = $v22db9a54ff ? " parameter_map=\"" . $v22db9a54ff . "\"" : ""; $v3b470b744e = $pab5ae921 ? " parameter_map=\"" . $pab5ae921 . "\"" : ""; $v11abf661e9 = $v5903f00766 ? " result_map=\"" . $v5903f00766 . "\"" : ""; $v241205aec6 .= "
	$v54bb17785b<insert id=\"insert_" . $v71571534b0 . "\">
	$v54bb17785b	$v2f5a2aa950
	$v54bb17785b</insert>
	$v54bb17785b
	$v54bb17785b<insert id=\"insert_" . $v71571534b0 . "_with_ai_pk\" hard_coded_ai_pk=\"1\">
	$v54bb17785b	$pc2a89af2
	$v54bb17785b</insert>
	$v54bb17785b"; if ($v5b56a70669) { $v241205aec6 .= "
	$v54bb17785b<update id=\"update_" . $v71571534b0 . "\">
	$v54bb17785b	$v5b56a70669
	$v54bb17785b</update>
	
	$v54bb17785b<update id=\"update_" . $v71571534b0 . "_primary_keys\">
	$v54bb17785b	$v57ea021647
	$v54bb17785b</update>
	$v54bb17785b"; } $v241205aec6 .= "
	$v54bb17785b<update id=\"update_all_" . $v71571534b0 . "_items\">
	$v54bb17785b	$pa3d47349 WHERE 1=1 #searching_condition#
	$v54bb17785b</update>
	$v54bb17785b"; if ($v942d144222) { $v241205aec6 .= "
	$v54bb17785b<delete id=\"delete_" . $v71571534b0 . "\">
	$v54bb17785b	$v942d144222
	$v54bb17785b</delete>
	$v54bb17785b"; } $v241205aec6 .= "
	$v54bb17785b<delete id=\"delete_all_" . $v71571534b0 . "_items\">
	$v54bb17785b	$paa827116 WHERE 1=1 #searching_condition#
	$v54bb17785b</delete>
	$v54bb17785b"; if ($v9e529d8324) { $v241205aec6 .= "
	$v54bb17785b<select id=\"get_" . $v71571534b0 . "\"$v3b470b744e$v11abf661e9>
	$v54bb17785b	$v9e529d8324
	$v54bb17785b</select>
	$v54bb17785b"; } $v241205aec6 .= "
	$v54bb17785b<select id=\"get_" . $v71571534b0 . "_items\"$v0e658cc4ed$v11abf661e9>
	$v54bb17785b	$v52c867ceb3 WHERE 1=1 #searching_condition#
	$v54bb17785b</select>
	$v54bb17785b"; $v241205aec6 .= "
	$v54bb17785b<select id=\"count_" . $v71571534b0 . "_items\">
	$v54bb17785b	$pfee276c6 WHERE 1=1 #searching_condition#
	$v54bb17785b</select>
	$v54bb17785b"; $v241205aec6 .= $this->ma6cf8ed272c1($v7f5911d32d, $v1d20487968, $v54bb17785b); } } } return $v241205aec6; } private function f409bb2324d($v8c5df8072b, $v5e45ec9bb9) { $pba9184cd = self::getTableFromTables($this->pba9184cd, $v8c5df8072b); if ($pba9184cd) { $pc37695cb = count($pba9184cd); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pa7c14731 = $pba9184cd[$v43dd7d0051]; if ($pa7c14731["keys"]) { $pbfa01ed1 = $pa7c14731["child_table"] == $v8c5df8072b ? "child" : "parent"; $pd28479e5 = count($pa7c14731["keys"]); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) if ($pa7c14731["keys"][$v9d27441e80][$pbfa01ed1] == $v5e45ec9bb9) return true; } } } return false; } private function ma6cf8ed272c1($v7f5911d32d, $v1d20487968 = false, $v54bb17785b = false) { $v241205aec6 = ""; if (!empty($v7f5911d32d)) { if (strtolower($v7f5911d32d["tag"] == "table")) { $pef349725 = $v7f5911d32d["properties"]; $v8c5df8072b = $v7f5911d32d["label"]; $v141a1052c0 = $pef349725["table_attr_names"]; if ($v141a1052c0) { $pbbcdea40 = ObjTypeHandler::getDBNumericTypes(); $pc9dfdb06 = $pef349725["table_attr_primary_keys"]; $v64603d66e4 = $pef349725["table_attr_types"]; $pba9184cd = self::getTableFromTables($this->pba9184cd, $v8c5df8072b); $v4ec0135323 = array(); $pfd110c6e = array(); $pc37695cb = count($v141a1052c0); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v5e45ec9bb9 = $v141a1052c0[$v9d27441e80]; $v670a5790dd = $v64603d66e4[$v9d27441e80]; $pb65331d8 = $pc9dfdb06[$v9d27441e80]; if ($pb65331d8 == "1" || strtolower($pb65331d8) == "true") { $v4ec0135323[$v5e45ec9bb9] = "#$v5e45ec9bb9#"; if (in_array($v670a5790dd, $pbbcdea40)) $pfd110c6e[] = $v5e45ec9bb9; } } if (count($v4ec0135323) && !empty($pba9184cd)) { if ($v1d20487968) { $pa03d305e = array(); $pc37695cb = count($pba9184cd); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v615f2b77c3 = $pba9184cd[$v9d27441e80]; $pa03d305e[] = $v615f2b77c3["child_table"] == $v8c5df8072b ? $v615f2b77c3["parent_table"] : $v615f2b77c3["child_table"]; } $pa03d305e = array_unique($pa03d305e); $pc37695cb = count($pa03d305e); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v78108fb2bd = $pa03d305e[$v9d27441e80]; $v22db9a54ff = self::f337ea47e85($v78108fb2bd) . "ParameterMap"; $v5903f00766 = self::f337ea47e85($v78108fb2bd) . "ResultMap"; $v3357bc7a47 = $this->v1d696dbd12["tasks"][$v78108fb2bd]; $v241205aec6 .= self::getTableParameterMap($v3357bc7a47["properties"]["table_attr_names"], $v3357bc7a47["properties"]["table_attr_types"], $v22db9a54ff, $v54bb17785b); $v241205aec6 .= self::getTableResultMap($v3357bc7a47["properties"]["table_attr_names"], $v3357bc7a47["properties"]["table_attr_types"], $v5903f00766, $v54bb17785b); } } $pc37695cb = count($pba9184cd); for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v615f2b77c3 = $pba9184cd[$v9d27441e80]; $v3fb9f41470 = $v615f2b77c3["type"]; $v78108fb2bd = $v615f2b77c3["child_table"] == $v8c5df8072b ? $v615f2b77c3["parent_table"] : $v615f2b77c3["child_table"]; $v22db9a54ff = $v1d20487968 ? self::f337ea47e85($v78108fb2bd) . "ParameterMap" : null; $v5903f00766 = $v1d20487968 ? self::f337ea47e85($v78108fb2bd) . "ResultMap" : null; $v566db8f5a9 = $v7f5911d32d["alias"]; $pea4553dc = $this->v1d696dbd12["tasks"][$v78108fb2bd]["alias"]; $v5e813b295b = self::getForeignTableQueryName($v566db8f5a9 ? $v566db8f5a9 : $v8c5df8072b, $pea4553dc ? $pea4553dc : $v78108fb2bd, $v3fb9f41470); $ped0a6251 = $this->f25bd954d39($v78108fb2bd); if ($ped0a6251) { $ped0a6251 = is_array($ped0a6251) ? $ped0a6251 : array($ped0a6251); $pfdbbc383 = $v9994512d98 = array(); $pd28479e5 = count($ped0a6251); for ($pc5166886 = 0; $pc5166886 < $pd28479e5; $pc5166886++) { $pfdbbc383[] = array( "table" => $v78108fb2bd, "column" => $ped0a6251[$pc5166886], ); } if ($v615f2b77c3["keys"]) { $pd28479e5 = count($v615f2b77c3["keys"]); for ($pc5166886 = 0; $pc5166886 < $pd28479e5; $pc5166886++) { $v7a1b9c07b3 = $v615f2b77c3["keys"][$pc5166886]; if ($v615f2b77c3["child_table"] == $v8c5df8072b) { $pa3c827a4 = $v7a1b9c07b3["child"]; $v8903e4e7c4 = $v7a1b9c07b3["parent"]; } else { $pa3c827a4 = $v7a1b9c07b3["parent"]; $v8903e4e7c4 = $v7a1b9c07b3["child"]; } $v9994512d98[] = array( "ptable" => $v8c5df8072b, "pcolumn" => $pa3c827a4, "ftable" => $v78108fb2bd, "fcolumn" => $v8903e4e7c4, ); } } $pf6e84d2b = DB::buildDefaultTableFindRelationshipSQL($v8c5df8072b, array( "keys" => $v9994512d98, "attributes" => $pfdbbc383, ), $v4ec0135323); $v10f2eb455b = DB::buildDefaultTableCountRelationshipSQL($v8c5df8072b, array( "keys" => $v9994512d98, ), $v4ec0135323); foreach ($pfd110c6e as $v5e45ec9bb9) { $pf6e84d2b = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $pf6e84d2b); $v10f2eb455b = str_replace("'#$v5e45ec9bb9#'", "#$v5e45ec9bb9#", $v10f2eb455b); } $v0e658cc4ed = $v22db9a54ff ? " parameter_map=\"" . $v22db9a54ff . "\"" : ""; $v11abf661e9 = $v5903f00766 ? " result_map=\"" . $v5903f00766 . "\"" : ""; $v241205aec6 .= "
	$v54bb17785b<select id=\"$v5e813b295b\"$v0e658cc4ed$v11abf661e9>
	$v54bb17785b	$pf6e84d2b #searching_condition#
	$v54bb17785b</select>
	$v54bb17785b
	$v54bb17785b<select id=\"" . self::getForeignTableQueryCountName($v566db8f5a9 ? $v566db8f5a9 : $v8c5df8072b, $pea4553dc ? $pea4553dc : $v78108fb2bd, $v3fb9f41470) . "\"$v0e658cc4ed>
	$v54bb17785b	$v10f2eb455b #searching_condition#
	$v54bb17785b</select>
	$v54bb17785b"; } } } } } } return $v241205aec6; } public static function getTableParameterMap($v141a1052c0, $v64603d66e4, $v3df2d026a1 = false, $v54bb17785b = false) { if ($v141a1052c0) { $v2967293505 = '
	' . $v54bb17785b . '<!--parameter_class' . ($v3df2d026a1 ? ' id="' . $v3df2d026a1 . '"' : '') . '>org.phpframework.object.php.HashMap</parameter_class-->
	' . $v54bb17785b . '<parameter_map' . ($v3df2d026a1 ? ' id="' . $v3df2d026a1 . '"' : '') . '>'; $pc37695cb = count($v141a1052c0); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5e45ec9bb9 = $v141a1052c0[$v43dd7d0051]; $v670a5790dd = strtolower($v64603d66e4[$v43dd7d0051]); $v2967293505 .= '
		' . $v54bb17785b . '<parameter input_name="' . $v5e45ec9bb9 . '" output_name="' . $v5e45ec9bb9 . '" input_type="org.phpframework.object.php.Primitive(' . ObjTypeHandler::convertDBToPHPType($v670a5790dd) . ')" output_type="org.phpframework.object.db.DBPrimitive(' . $v670a5790dd . ')" mandatory="0" />'; } $v2967293505 .= '
	' . $v54bb17785b . '</parameter_map>
			'; return $v2967293505; } return ""; } public static function getTableResultMap($v141a1052c0, $v64603d66e4, $v3df2d026a1 = false, $v54bb17785b = false) { if ($v141a1052c0) { $pce128343 = '
	' . $v54bb17785b . '<!--result_class' . ($v3df2d026a1 ? ' id="' . $v3df2d026a1 . '"' : '') . '>org.phpframework.object.php.HashMap</result_class-->
	' . $v54bb17785b . '<result_map' . ($v3df2d026a1 ? ' id="' . $v3df2d026a1 . '"' : '') . '>'; $pc37695cb = count($v141a1052c0); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5e45ec9bb9 = $v141a1052c0[$v43dd7d0051]; $v670a5790dd = strtolower($v64603d66e4[$v43dd7d0051]); $pce128343 .= '
		' . $v54bb17785b . '<result output_name="' . $v5e45ec9bb9 . '" input_name="' . $v5e45ec9bb9 . '" output_type="org.phpframework.object.php.Primitive(' . ObjTypeHandler::convertDBToPHPType($v670a5790dd) . ')" input_type="org.phpframework.object.db.DBPrimitive(' . $v670a5790dd . ')" mandatory="0" />'; } $pce128343 .= '
	' . $v54bb17785b . '</result_map>
			'; return $pce128343; } return ""; } public static function getForeignTableQueryName($v8c5df8072b, $v78108fb2bd, $v3fb9f41470) { $v2ee72186a7 = str_replace(".", "_", strtolower($v8c5df8072b)); $v7d1891d6f3 = str_replace(".", "_", strtolower($v78108fb2bd)); if ($v3fb9f41470 == "1-*") $v5e813b295b = "get_" . $v2ee72186a7 . "_" . $v7d1891d6f3 . "_childs"; else if ($v3fb9f41470 == "*-1") $v5e813b295b = "get_" . $v2ee72186a7 . "_" . $v7d1891d6f3 . "_parent"; else if ($v3fb9f41470 == "1-1") $v5e813b295b = "get_" . $v2ee72186a7 . "_" . $v7d1891d6f3 . "_brother"; else if ($v3fb9f41470 == "*-*") $v5e813b295b = "get_" . $v2ee72186a7 . "_" . $v7d1891d6f3 . "_relatives"; return $v5e813b295b; } public static function getForeignTableQueryCountName($v8c5df8072b, $v78108fb2bd, $v3fb9f41470) { $v5e813b295b = self::getForeignTableQueryName($v8c5df8072b, $v78108fb2bd, $v3fb9f41470); return $v5e813b295b ? "count_" . substr($v5e813b295b, 4) : ""; } private function me8479d1c3331() { $pba9184cd = array(); if (is_array($this->v1d696dbd12["tasks"])) { foreach ($this->v1d696dbd12["tasks"] as $v8c5df8072b => $pc661dc6b) { $v6939304e91 = $pc661dc6b["exits"]["layer_exit"]; $pef349725 = $this->ma6cf47514905($v8c5df8072b, $v6939304e91, $pba9184cd); $pc37695cb = count($pef349725); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9073377656 = $pef349725[$v43dd7d0051]; $pba9184cd[$v8c5df8072b][] = $v9073377656; $v78108fb2bd = $v9073377656["child_table"] == $v8c5df8072b ? $v9073377656["parent_table"] : $v9073377656["child_table"]; if ($v78108fb2bd) { if ($v78108fb2bd != $v8c5df8072b || $v9073377656["type"] == "1-*") { $v9073377656["type"] = $v9073377656["type"] == "*-1" ? "1-*" : ($v9073377656["type"] == "1-*" ? "*-1" : $v9073377656["type"]); $v9073377656["target"] = true; unset($v9073377656["source"]); $pba9184cd[$v78108fb2bd][] = $v9073377656; } } } } } return $pba9184cd; } private function ma6cf47514905($v8c5df8072b, $v6939304e91, &$pba9184cd) { $pb88d9a1d = array(); if ($v6939304e91) { $v6939304e91 = isset($v6939304e91["task_id"]) ? array($v6939304e91) : $v6939304e91; $pc37695cb = count($v6939304e91); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pdcbd5e39 = $v6939304e91[$v43dd7d0051]; $pef349725 = $pdcbd5e39["properties"]; $v3fb9f41470 = $this->v0a1dac07d9[ $pdcbd5e39["overlay"] ]; $v3fb9f41470 = $v3fb9f41470 ? $v3fb9f41470 : "1-1"; $v78108fb2bd = $this->ma994ee0975fa($pdcbd5e39["task_id"]); if ($v78108fb2bd) { $v9994512d98 = array(); if (!$pef349725 || !$pef349725["source_columns"]) { $pef349725 = array(); $pc3502754 = $this->f25bd954d39($v8c5df8072b); $pe8584f8a = $this->f25bd954d39($v78108fb2bd); $v58b4c471a1 = $this->mbe185c8d6d1d($v8c5df8072b); $v506430ad75 = $this->mbe185c8d6d1d($v78108fb2bd); $pf9145084 = array_intersect($pc3502754, $v506430ad75); $pe3023dac = array_intersect($pe8584f8a, $v58b4c471a1); if ($v3fb9f41470 == "*-*" || $v3fb9f41470 == "1-1") $v571a648e93 = array_merge($pf9145084, $pe3023dac); else if ($v3fb9f41470 == "*-1") $v571a648e93 = $pe3023dac; else if ($v3fb9f41470 == "1-*") $v571a648e93 = $pf9145084; if ($v571a648e93) { $pd28479e5 = count($v571a648e93); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) $v9994512d98[] = array("child" => $v571a648e93[$v9d27441e80], "parent" => $v571a648e93[$v9d27441e80]); } else if ($v3fb9f41470 == "*-1") { $pd28479e5 = count($v58b4c471a1); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) if ($v506430ad75[$v9d27441e80]) $v9994512d98[] = array("child" => $v58b4c471a1[$v9d27441e80], "parent" => $v506430ad75[$v9d27441e80]); } else { $pd28479e5 = count($v58b4c471a1); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) if ($v506430ad75[$v9d27441e80]) $v9994512d98[] = array("child" => $v506430ad75[$v9d27441e80], "parent" => $v58b4c471a1[$v9d27441e80]); } } else { $pd9cb6fd1 = $pef349725["source_columns"]; $v7884a11c4c = $pef349725["target_columns"]; if ($pd9cb6fd1) { if (!is_array($pd9cb6fd1)) { $pd9cb6fd1 = array($pd9cb6fd1); $v7884a11c4c = array($v7884a11c4c); } if ($v3fb9f41470 == "*-1") { $pd28479e5 = count($pd9cb6fd1); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) $v9994512d98[] = array("child" => $pd9cb6fd1[$v9d27441e80], "parent" => $v7884a11c4c[$v9d27441e80]); } else { $pd28479e5 = count($pd9cb6fd1); for ($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) $v9994512d98[] = array("child" => $v7884a11c4c[$v9d27441e80], "parent" => $pd9cb6fd1[$v9d27441e80]); } } } if ($v9994512d98) { if ($v3fb9f41470 == "1-*") $pb88d9a1d[] = array( "type" => $v3fb9f41470, "child_table" => $v78108fb2bd, "parent_table" => $v8c5df8072b, "keys" => $v9994512d98, "source" => true, ); else $pb88d9a1d[] = array( "type" => $v3fb9f41470, "child_table" => $v8c5df8072b, "parent_table" => $v78108fb2bd, "keys" => $v9994512d98, "source" => true, ); } } } } return $pb88d9a1d; } private function ma994ee0975fa($v8282c7dd58) { foreach ($this->v1d696dbd12["tasks"] as $v8c5df8072b => $v7f5911d32d) { if ($v8282c7dd58 == $v8c5df8072b) return $v8c5df8072b; else if ($v7f5911d32d["id"] == $v8282c7dd58) return $v7f5911d32d["label"]; } return null; } private function mbe185c8d6d1d($v8c5df8072b) { $pc661dc6b = self::getTableFromTables($this->v1d696dbd12["tasks"], $v8c5df8072b); $pc9dfdb06 = $pc661dc6b["properties"]["table_attr_primary_keys"]; $pe2f18119 = array(); if ($pc9dfdb06) { $pc37695cb = count($pc9dfdb06); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pb65331d8 = $pc9dfdb06[$v43dd7d0051]; if ($pb65331d8 == "1" || strtolower($pb65331d8) == "true") $pe2f18119[] = $pc661dc6b["properties"]["table_attr_names"][$v43dd7d0051]; } } return $pe2f18119; } private function f25bd954d39($v8c5df8072b) { $pc661dc6b = self::getTableFromTables($this->v1d696dbd12["tasks"], $v8c5df8072b); return $pc661dc6b["properties"]["table_attr_names"]; } private static function f337ea47e85($v1cfba8c105) { return str_replace(" ", "", ucwords(strtolower(trim(str_replace(array("_", "-", "."), " ", $v1cfba8c105))))); } private static function f944de41f66($v09421cf63e) { if ($v09421cf63e) { $v09421cf63e = str_replace("&", "&amp;", $v09421cf63e); $v09421cf63e = str_replace("<?php", "&lt;?php", $v09421cf63e); $v09421cf63e = str_replace('&lt;?xml', '<?xml', $v09421cf63e); $v6dcd71ad57 = new MyXML($v09421cf63e); $pfb662071 = $v6dcd71ad57->toArray(array("lower_case_keys" => true, "from_decimal" => true)); return $pfb662071; } } private static function mb12381933b4e($pfb662071, $v69c38a9e13 = "") { if ($pfb662071) { $pa694ba99 = new MyXMLArray($pfb662071); $v6da2ec01d0 = $pa694ba99->toXML(array("lower_case_keys" => true, "to_decimal" => true)); $v6da2ec01d0 = str_replace("&lt;?php", "<?php", $v6da2ec01d0); $v6da2ec01d0 = str_replace("&amp;", "&", $v6da2ec01d0); $v6da2ec01d0 = '<?xml version="1.0" encoding="UTF-8"?>' . $v69c38a9e13 . $v6da2ec01d0; return $v6da2ec01d0; } } private static function f55ce0f1965($pf3dc0762, $v241205aec6) { return MyXML::isXMLContentValid($v241205aec6) && file_put_contents($pf3dc0762, $v241205aec6) !== false; } public static function getClassName($v5e813b295b) { return str_replace(" ", "", ucwords(strtolower( (str_replace(array("_", "-", "."), " ", $v5e813b295b) )) )); } public static function getHbnObjParameters($v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, $pf232dd5a) { $v9367d5be85 = array(); if ($pf232dd5a["childs"]["parameter_map"][0]["parameter"]) { $pc37695cb = count($pf232dd5a["childs"]["parameter_map"][0]["parameter"]); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9acf40c110 = $pf232dd5a["childs"]["parameter_map"][0]["parameter"][$v43dd7d0051]; $v9367d5be85[ $v9acf40c110["output_name"] ] = array( "name" => $v9acf40c110["input_name"], "type" => $v9acf40c110["input_type"] ); } } $v8c5df8072b = trim($pf232dd5a["@"]["table"]); if ($v8c5df8072b) { self::mbb2cae723703($v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, $v0674ea4a10, array($v8c5df8072b)); $v8c5df8072b = strpos($v8c5df8072b, " ") !== false ? strstr($v8c5df8072b, " ", true) : $v8c5df8072b; $pd98df87c = strtolower($v8c5df8072b); $ped0a6251 = $v0674ea4a10[$pd98df87c]; foreach ($ped0a6251 as $v5e45ec9bb9 => $v1b0cfa478b) { $v9367d5be85[$v5e45ec9bb9] = isset($v9367d5be85[$v5e45ec9bb9]) ? array_merge($v1b0cfa478b, $v9367d5be85[$v5e45ec9bb9]) : $v1b0cfa478b; if ($v9367d5be85[$v5e45ec9bb9]["type"]) $v9367d5be85[$v5e45ec9bb9]["type"] = "org.phpframework.object.db.DBPrimitive(" . $v9367d5be85[$v5e45ec9bb9]["type"] . ")"; } } $v217e7cf3c0 = XMLFileParser::getAttribute($pf232dd5a, "parameter_class"); self::prepareParametersFromClass($v217e7cf3c0, $v9367d5be85); return $v9367d5be85; } public static function prepareParametersFromClass($v217e7cf3c0, &$v9367d5be85) { if ($v217e7cf3c0) { $pf3dc0762 = get_lib($v217e7cf3c0); if (file_exists($pf3dc0762)) { include_once $pf3dc0762; $v3ae55a9a2e = explode(".", $v217e7cf3c0); $v3ae55a9a2e = $v3ae55a9a2e[ count($v3ae55a9a2e) - 1 ]; eval ("\$v972f1a5c2b = new $v3ae55a9a2e();"); if ($v972f1a5c2b && method_exists($v972f1a5c2b, "getData")) { $v539082ff30 = $v972f1a5c2b->getData(); $v9994512d98 = is_array($v539082ff30) ? array_keys($v539082ff30) : array(); $v9b391a5b1f = array(); $pc37695cb = count($v9994512d98); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pe5c5e2fe = $v9994512d98[$v43dd7d0051]; $v9b391a5b1f[$pe5c5e2fe] = array( "name" => $pe5c5e2fe, ); if ($v9367d5be85[$pe5c5e2fe]) $v9b391a5b1f[$pe5c5e2fe] = array_merge($v9367d5be85[$pe5c5e2fe], $v9b391a5b1f[$pe5c5e2fe]); } $v9367d5be85 = $v9b391a5b1f; } } } } public static function addPrimaryKeysToParameters($pcaaa70b9, &$v9367d5be85) { foreach ($pcaaa70b9 as $v5e813b295b => $v58b61e02bc) { if ($v58b61e02bc["primary_key"] && !isset($v9367d5be85[$v5e813b295b])) { $v9367d5be85[$v5e813b295b] = $v58b61e02bc; } } } public static function removePrimaryKeysFromParameters($pcaaa70b9, &$v9367d5be85) { foreach ($pcaaa70b9 as $v5e813b295b => $v58b61e02bc) { if ($v58b61e02bc["primary_key"] && isset($v9367d5be85[$v5e813b295b])) { unset($v9367d5be85[$v5e813b295b]); } } } public static function getPrimaryKeysFromParameters($pcaaa70b9, $v9367d5be85) { $pe2f18119 = array(); foreach ($pcaaa70b9 as $v5e813b295b => $v58b61e02bc) { if ($v58b61e02bc["primary_key"] && isset($v9367d5be85[$v5e813b295b])) { $pe2f18119[$v5e813b295b] = $v9367d5be85[$v5e813b295b]; } } return $pe2f18119; } public static function prepareRelationshipParameters(&$v50819961ef, $v987a981e39, $v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, &$v0674ea4a10, $v1eda8d978f, &$v9367d5be85) { $v9367d5be85 = array(); $pac4bc40a = array(); $v8c5df8072b = $v1eda8d978f["@"]["table"]; if ($v8c5df8072b) $pac4bc40a[$v8c5df8072b] = true; self::f153c83667e($v50819961ef["attribute"], $pac4bc40a, $v9367d5be85, "table", "column"); self::f153c83667e($v50819961ef["key"], $pac4bc40a, $v9367d5be85, "ptable", "pcolumn", "value"); self::f153c83667e($v50819961ef["key"], $pac4bc40a, $v9367d5be85, "ftable", "fcolumn", "value"); self::f153c83667e($v50819961ef["condition"], $pac4bc40a, $v9367d5be85, "table", "column", "value"); self::f153c83667e($v50819961ef["group_by"], $pac4bc40a, $v9367d5be85, "table", "column"); self::f153c83667e($v50819961ef["sort"], $pac4bc40a, $v9367d5be85, "table", "column"); $v50819961ef["@"]["parameter_map"] = $v1eda8d978f["childs"]["parameter_map"][0]["attrib"]["id"]; self::f476e34bf68($v50819961ef, $v987a981e39, $v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, $v0674ea4a10, $pac4bc40a, $v9367d5be85, $v8c5df8072b); $v552b831ecd = $v50819961ef["limit"]; if (strpos($v552b831ecd, "#") !== false) { $v5e813b295b = str_replace("#", "", $v552b831ecd); $v9367d5be85[$v5e813b295b] = array( "type" => "org.phpframework.object.php.Primitive(int)", "mandatory" => false ); } $v7e4b517c18 = $v50819961ef["start"]; if (strpos($v7e4b517c18, "#") !== false) { $v5e813b295b = str_replace("#", "", $v7e4b517c18); $v9367d5be85[$v5e813b295b] = array( "type" => "org.phpframework.object.php.Primitive(int)", "mandatory" => false ); } $v50819961ef["@"]["parameter_class"] = XMLFileParser::getAttribute($v1eda8d978f, "parameter_class"); self::prepareParametersFromClass($v50819961ef["@"]["parameter_class"], $v9367d5be85); } public static function getSQLStatementTable($pa919c09b, $v51d1745dbd, $pab752e34, $v872f5b4dbb) { $v3c76382d93 = $pa919c09b["value"]; if ($v3c76382d93) { $v539082ff30 = $v51d1745dbd ? $v51d1745dbd->getBroker($pab752e34)->getFunction("convertSQLToObject", $v3c76382d93, array("db_driver" => $v872f5b4dbb)) : DB::convertDefaultSQLToObject($v3c76382d93); $pab9d8506 = $v539082ff30["type"]; if ($pab9d8506 == "insert" || $pab9d8506 == "update" || $pab9d8506 == "delete") return strpos($v539082ff30["table"], "#") === false ? $v539082ff30["table"] : null; else if ($pab9d8506 == "select") return $v539082ff30["attributes"][0]["table"] ? $v539082ff30["attributes"][0]["table"] : $v539082ff30["table"]; } } public static function prepareSQLStatementParameters($pa919c09b, $v987a981e39, $v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, &$v0674ea4a10, $pa3585c80, &$v9367d5be85) { $v9367d5be85 = array(); $v3c76382d93 = $pa919c09b["value"]; if ($v3c76382d93) { if (is_array($pa3585c80)) foreach ($pa3585c80 as $pf7da0c38) $v3c76382d93 = str_replace("#$pf7da0c38#", "", $v3c76382d93); $v539082ff30 = $v51d1745dbd ? $v51d1745dbd->getBroker($pab752e34)->getFunction("convertSQLToObject", $v3c76382d93, array("db_driver" => $v872f5b4dbb)) : DB::convertDefaultSQLToObject($v3c76382d93); $pab9d8506 = $v539082ff30["type"]; $v9367d5be85 = self::f75118bf403($v3c76382d93); foreach ($v9367d5be85 as $v5e813b295b => $v3fb9f41470) { $v3fb9f41470 = $v3fb9f41470 ? $v3fb9f41470 : "no_string"; $v9367d5be85[$v5e813b295b] = array( "type" => "org.phpframework.object.php.Primitive($v3fb9f41470)", "mandatory" => $v3fb9f41470 == "no_string" ? true : null ); } $pac4bc40a = array(); $v8c5df8072b = ""; if ($pab9d8506 == "insert" || $pab9d8506 == "update" || $pab9d8506 == "delete") { $v8c5df8072b = $v539082ff30["table"]; if (strpos($v8c5df8072b, "#") !== false) { $v8c5df8072b = str_replace("#", "", $v8c5df8072b); $v9367d5be85[$v8c5df8072b] = array( "type" => "org.phpframework.object.php.Primitive(name)", "mandatory" => true, ); } else $pac4bc40a[$v8c5df8072b] = true; self::f153c83667e($v539082ff30["attributes"], $pac4bc40a, $v9367d5be85, "table", "column", "value"); self::f153c83667e($v539082ff30["conditions"], $pac4bc40a, $v9367d5be85, "table", "column", "value"); } else if ($pab9d8506 == "select") { $v8c5df8072b = $v539082ff30["attributes"][0]["table"] ? $v539082ff30["attributes"][0]["table"] : $v539082ff30["table"]; $pac4bc40a[$v8c5df8072b] = true; self::f153c83667e($v539082ff30["attributes"], $pac4bc40a, $v9367d5be85, "table", "column"); self::f153c83667e($v539082ff30["keys"], $pac4bc40a, $v9367d5be85, "ptable", "pcolumn", "value"); self::f153c83667e($v539082ff30["keys"], $pac4bc40a, $v9367d5be85, "ftable", "fcolumn", "value"); self::f153c83667e($v539082ff30["conditions"], $pac4bc40a, $v9367d5be85, "table", "column", "value"); self::f153c83667e($v539082ff30["groups_by"], $pac4bc40a, $v9367d5be85, "table", "column"); self::f153c83667e($v539082ff30["sorts"], $pac4bc40a, $v9367d5be85, "table", "column"); } self::f476e34bf68($pa919c09b, $v987a981e39, $v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, $v0674ea4a10, $pac4bc40a, $v9367d5be85, $v8c5df8072b); self::prepareParametersFromClass($pa919c09b["@"]["parameter_class"], $v9367d5be85); } } private static function mbb2cae723703($v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, &$v0674ea4a10, $pac4bc40a) { if ($pac4bc40a) { foreach ($pac4bc40a as $v8c5df8072b) if ($v8c5df8072b) { $v8c5df8072b = strpos($v8c5df8072b, " ") !== false ? strstr($v8c5df8072b, " ", true) : $v8c5df8072b; $pd98df87c = strtolower($v8c5df8072b); if (!$v0674ea4a10[$pd98df87c]) $v0674ea4a10[$pd98df87c] = $v51d1745dbd->getFunction("listTableFields", $v8c5df8072b, array("db_broker" => $pab752e34, "db_driver" => $v872f5b4dbb)); } if ($v5e053dece2) { $v094d1a2778 = new WorkFlowDataAccessHandler(); $v094d1a2778->setTasksFilePath($v5e053dece2); $v5ff7954bf3 = $v094d1a2778->getTasksAsTables(); if ($v5ff7954bf3) foreach ($v5ff7954bf3 as $v8c5df8072b => $ped0a6251) { $pd98df87c = strtolower($v8c5df8072b); if (!$v0674ea4a10[$pd98df87c]) $v0674ea4a10[$pd98df87c] = $ped0a6251; else foreach ($ped0a6251 as $v5e45ec9bb9 => $v1b0cfa478b) if (!$v0674ea4a10[$pd98df87c][$v5e45ec9bb9]) $v0674ea4a10[$pd98df87c][$v5e45ec9bb9] = $v1b0cfa478b; else if ($v1b0cfa478b) foreach ($v1b0cfa478b as $pe5c5e2fe => $v956913c90f) $v0674ea4a10[$pd98df87c][$v5e45ec9bb9][$pe5c5e2fe] = $v956913c90f; } } } } private static function f476e34bf68($pa919c09b, $v987a981e39, $v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, &$v0674ea4a10, $pac4bc40a, &$v9367d5be85, $v9f3311212d = "") { self::mbb2cae723703($v51d1745dbd, $pab752e34, $v872f5b4dbb, $v5e053dece2, $v0674ea4a10, array_keys($pac4bc40a)); $pbbcdea40 = ObjTypeHandler::getDBNumericTypes(); $v9f3311212d = strpos($v9f3311212d, " ") !== false ? strstr($v9f3311212d, " ", true) : $v9f3311212d; $v2da72894c4 = strtolower($v9f3311212d); foreach ($v9367d5be85 as $v5e813b295b => $v58b61e02bc) { if ($v58b61e02bc["parameter_type"] == "table_column") { $pd98df87c = strtolower($v58b61e02bc["parameter_table"]); $pe04f136f = strtolower($v58b61e02bc["parameter_column"]); $pa51479fc = null; if ($v0674ea4a10[$pd98df87c][$pe04f136f]) $pa51479fc = $v0674ea4a10[$pd98df87c][$pe04f136f]; else if ($v2da72894c4 && $v0674ea4a10[$v2da72894c4][$pe04f136f]) $pa51479fc = $v0674ea4a10[$v2da72894c4][$pe04f136f]; else foreach ($v0674ea4a10 as $v8c5df8072b => $v86e5d83e26) { foreach ($v86e5d83e26 as $v5e45ec9bb9 => $v1b0cfa478b) { if (strtolower($v5e45ec9bb9) == $pe04f136f) { $pa51479fc = $v1b0cfa478b; break; } } if ($pa51479fc) break; } if ($pa51479fc) { $v6cc00e79ac = $pa51479fc["type"]; $pa51479fc["name"] = $v5e813b295b; $pa51479fc["type"] = $v58b61e02bc["type"]; $pa51479fc["mandatory"] = $v58b61e02bc["mandatory"]; if (strpos($v58b61e02bc["type"], "(no_string)") !== false && in_array($v6cc00e79ac, $pbbcdea40)) $pa51479fc["type"] = "org.phpframework.object.db.DBPrimitive($v6cc00e79ac)"; else if (strpos($v58b61e02bc["type"], "(no_string)") === false) $pa51479fc["type"] = "org.phpframework.object.db.DBPrimitive($v6cc00e79ac)"; $v9367d5be85[$v5e813b295b] = $pa51479fc; } } unset($v9367d5be85[$v5e813b295b]["parameter_type"]); unset($v9367d5be85[$v5e813b295b]["parameter_column"]); unset($v9367d5be85[$v5e813b295b]["parameter_table"]); } $v2967293505 = $pa919c09b["@"]["parameter_map"]; $v7d1068ab72 = $v2967293505 ? $v987a981e39["parameter_map"][$v2967293505]["parameter"] : null; if ($v7d1068ab72) { $pc37695cb = count($v7d1068ab72); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pdca845fa = $v7d1068ab72[$v43dd7d0051]; $v49bdd49c66 = $pdca845fa["output_name"]; $v9367d5be85[$v49bdd49c66]["name"] = $pdca845fa["input_name"]; if (isset($pdca845fa["input_type"])) $v9367d5be85[$v49bdd49c66]["type"] = $pdca845fa["input_type"]; if (isset($pdca845fa["mandatory"])) $v9367d5be85[$v49bdd49c66]["mandatory"] = $pdca845fa["mandatory"]; } } } private static function f153c83667e($pf72c1d58, &$pac4bc40a, &$v9367d5be85, $v10d0c57ca9, $pe032b229, $v4598208b14 = "") { if (is_array($pf72c1d58)) { $pc37695cb = count($pf72c1d58); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v1b0cfa478b = $pf72c1d58[$v43dd7d0051]; if ($v10d0c57ca9 && isset($v1b0cfa478b[$v10d0c57ca9])) { $pc661dc6b = $v1b0cfa478b[$v10d0c57ca9]; if (strpos($pc661dc6b, "#") !== false) { $pc661dc6b = str_replace("#", "", $pc661dc6b); $v9367d5be85[$pc661dc6b] = array( "type" => "org.phpframework.object.php.Primitive(name)", "mandatory" => true ); } else { $pac4bc40a[$pc661dc6b] = true; } } if ($pe032b229 && isset($v1b0cfa478b[$pe032b229]) && strpos($v1b0cfa478b[$pe032b229], "#") !== false) { $v7e8fc026cb = strtolower($v1b0cfa478b["operator"]); $v3fb9f41470 = $v7e8fc026cb == "in" ? "array_str" : "name"; $v9ea12a829c = str_replace("#", "", $v1b0cfa478b[$pe032b229]); $pc661dc6b = $v1b0cfa478b[$v10d0c57ca9]; $v9367d5be85[$v9ea12a829c] = array( "type" =>"org.phpframework.object.php.Primitive($v3fb9f41470)", "mandatory" => true ); if ($v7e8fc026cb != "in") { $v9367d5be85[$v9ea12a829c]["parameter_type"] = "table_column"; $v9367d5be85[$v9ea12a829c]["parameter_column"] = $v9ea12a829c; $v9367d5be85[$v9ea12a829c]["parameter_table"] = $pc661dc6b; } } if ($v4598208b14 && isset($v1b0cfa478b[$v4598208b14]) && strpos($v1b0cfa478b[$v4598208b14], "#") !== false) { $v7e8fc026cb = strtolower($v1b0cfa478b["operator"]); $v67db1bd535 = $v1b0cfa478b[$v4598208b14]; $v67db1bd535 = str_replace(array("'", '"', "#"), "", $v67db1bd535); $pc3e857ed = $v7e8fc026cb == "in" ? "org.phpframework.object.php.Primitive(array_str)" : $v9367d5be85[$v67db1bd535]["type"]; $v9ea12a829c = $v9367d5be85[$v67db1bd535]["parameter_column"] ? $v9367d5be85[$v67db1bd535]["parameter_column"] : $v1b0cfa478b[$pe032b229]; $pc661dc6b = $v9367d5be85[$v67db1bd535]["parameter_column"] ? $v9367d5be85[$v67db1bd535]["parameter_table"] : $v1b0cfa478b[$v10d0c57ca9]; $v9367d5be85[$v67db1bd535] = array( "type" => $pc3e857ed, "mandatory" => strpos($pc3e857ed, "(no_string)") !== false || strpos($pc3e857ed, "(array_str)") !== false ? true : null, ); if ($v7e8fc026cb != "in") { $v9367d5be85[$v67db1bd535]["parameter_type"] = "table_column"; $v9367d5be85[$v67db1bd535]["parameter_column"] = $v9ea12a829c; $v9367d5be85[$v67db1bd535]["parameter_table"] = $pc661dc6b; } } } } } public static function isAutoIncrementedAttribute($pf932fb91) { return $pf932fb91["auto_increment"] || stripos($pf932fb91["extra"], "auto_increment") !== false || stripos($pf932fb91["extra"], "nextval") !== false || in_array($pf932fb91["type"], DB::getAllColumnAutoIncrementTypes()); } public static function getTableFromTables($pac4bc40a, $v8c5df8072b) { $v9a1fa54047 = WorkFlowDBHandler::getTableTaskRealNameFromTasks($pac4bc40a, $v8c5df8072b); return $pac4bc40a[$v9a1fa54047]; } } ?>
