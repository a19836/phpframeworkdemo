<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
include_once get_lib("org.phpframework.phpscript.PHPCodePrintingHandler"); class PHPVariablesFileHandler { private $v19baa1242a; private $v01690001bb; private $pde3667a2; public function __construct($v19baa1242a) { $this->v19baa1242a = is_array($v19baa1242a) ? $v19baa1242a : array($v19baa1242a); } private function f0acd802fe6() { $v84bde98cb9 = array(); $pf3dc0762 = dirname(__DIR__) . "/config/pre_init_config.php"; if (file_exists($pf3dc0762)) { if (self::isSimpleVarsFile($pf3dc0762)) $v761f4d757f = self::getVarsFromFileContent($pf3dc0762); else $v761f4d757f = self::getVarsFromFileCode($pf3dc0762); $v84bde98cb9 = $v761f4d757f ? array_keys($v761f4d757f) : array(); } return $v84bde98cb9; } public function startUserGlobalVariables() { $this->v01690001bb = array(); $this->pde3667a2 = array_keys($GLOBALS); $v84bde98cb9 = array_flip($this->f0acd802fe6()); if ($this->v19baa1242a) { foreach ($this->v19baa1242a as $v0cd49d5a59) { if (self::isSimpleVarsFile($v0cd49d5a59)) $pb408669c = self::getVarsFromFileContent($v0cd49d5a59); else $pb408669c = self::getVarsFromFileCode($v0cd49d5a59); if ($pb408669c) foreach ($pb408669c as $v1cfba8c105 => $pa6209df1) { $v134ff07483 = strpos($v1cfba8c105, "->"); if (!isset($this->v01690001bb[$v1cfba8c105])) { if (strpos($v1cfba8c105, "::") !== false || $v134ff07483 !== false) { if ($v134ff07483 !== false) eval("global " . substr($v1cfba8c105, 0, $v134ff07483) . ";"); eval("\$this->v01690001bb[\$v1cfba8c105] = isset($v1cfba8c105) ? $v1cfba8c105 : null;"); } else $this->v01690001bb[$v1cfba8c105] = $GLOBALS[$v1cfba8c105]; } if (is_string($pa6209df1)) { if (strpos($pa6209df1, "::") !== false || strpos($pa6209df1, "->") !== false) { $pbd1bc7b0 = strpos($pa6209df1, "->"); if ($pbd1bc7b0 !== false) eval("global " . substr($pa6209df1, 0, $pbd1bc7b0) . ";"); eval("\$pa6209df1 = isset($pa6209df1) ? $pa6209df1 : null;"); } else if (substr(trim($pa6209df1), 0, 1) == '$') $pa6209df1 = $GLOBALS[substr(trim($pa6209df1), 1)]; } if (strpos($v1cfba8c105, "::") !== false || $v134ff07483 !== false) { if ($v134ff07483 !== false) eval("global " . substr($v1cfba8c105, 0, $v134ff07483) . ";"); eval("$v1cfba8c105 = \$pa6209df1;"); } else $GLOBALS[$v1cfba8c105] = $pa6209df1; unset($v84bde98cb9[$v1cfba8c105]); } } } if ($v84bde98cb9) foreach ($v84bde98cb9 as $v1cfba8c105 => $v02a69d4e0f) { $v134ff07483 = strpos($v1cfba8c105, "->"); if (!isset($this->v01690001bb[$v1cfba8c105])) { if (strpos($v1cfba8c105, "::") !== false || $v134ff07483 !== false) { if ($v134ff07483 !== false) eval("global " . substr($v1cfba8c105, 0, $v134ff07483) . ";"); eval("\$this->v01690001bb[\$v1cfba8c105] = isset($v1cfba8c105) ? $v1cfba8c105 : null;"); } else $this->v01690001bb[$v1cfba8c105] = $GLOBALS[$v1cfba8c105]; } unset($GLOBALS[$v1cfba8c105]); } } public function endUserGlobalVariables() { foreach ($this->v01690001bb as $v1cfba8c105 => $pa6209df1) { if (strpos($v1cfba8c105, "::") !== false || strpos($v1cfba8c105, "->") !== false) { $pbd1bc7b0 = strpos($v1cfba8c105, "->"); if ($pbd1bc7b0 !== false) eval("global " . substr($v1cfba8c105, 0, $pbd1bc7b0) . ";"); eval("$v1cfba8c105 = \$pa6209df1;"); } else $GLOBALS[$v1cfba8c105] = $pa6209df1; } if ($this->pde3667a2) { $pe5492542 = array_keys($GLOBALS); $paa706222 = array_diff($pe5492542, $this->pde3667a2); foreach ($paa706222 as $v1cfba8c105) unset($GLOBALS[$v1cfba8c105]); } } public static function isSimpleVarsFile($pf3dc0762) { $pae77d38c = file_exists($pf3dc0762) ? file_get_contents($pf3dc0762) : ""; return self::isSimpleVarsContent($pae77d38c); } public static function isSimpleVarsContent($pae77d38c) { $v761f4d757f = self::getVarsFromContent($pae77d38c); $v9de8312d8b = PHPCodePrintingHandler::getCodeWithoutComments($pae77d38c); $v9de8312d8b = trim(preg_replace("/(^[\r\n]*|[\r\n]+)[\s\t]*[\r\n]+/", "\n", $v9de8312d8b)); $v9de8312d8b = preg_replace("/\s*=\s*'/", ' = "', $v9de8312d8b); $v9de8312d8b = preg_replace("/'\s*;/", '";', $v9de8312d8b); $v9de8312d8b = preg_replace("/\s/", "", $v9de8312d8b); $v8eefcd570c = self::getVarsCode($v761f4d757f); $v8eefcd570c = preg_replace("/\s/", "", $v8eefcd570c); return $v8eefcd570c == $v9de8312d8b; } public static function saveVarsToFile($pf3dc0762, $v761f4d757f, $v939ff77da6 = false) { return file_put_contents($pf3dc0762, self::getVarsCode($v761f4d757f, $v939ff77da6)) !== false; } public static function getVarsCode($v761f4d757f, $v939ff77da6 = false) { $pae77d38c = "<?php\n"; if ($v761f4d757f) foreach ($v761f4d757f as $pbfa01ed1 => $v67db1bd535) { $pbfa01ed1 = (strpos($pbfa01ed1, "::") !== false || strpos($pbfa01ed1, "->") !== false ? "" : "\$") . $pbfa01ed1; if (is_bool($v67db1bd535)) $v67db1bd535 = $v67db1bd535 ? "true" : "false"; else if (is_numeric($v67db1bd535) || substr(trim($v67db1bd535), 0, 1) == '$' || strpos($v67db1bd535, "::") !== false || strpos($v67db1bd535, "->") !== false) $v67db1bd535 = $v67db1bd535; else if (isset($v67db1bd535)) $v67db1bd535 = '"' . addcslashes($v67db1bd535, '"') . '"'; else $v67db1bd535 = "null"; $pae77d38c .= $pbfa01ed1 . " = " . ($v939ff77da6 ? "isset(" . $pbfa01ed1 . ") ? " . $pbfa01ed1 . " : $v67db1bd535" : $v67db1bd535) . ";\n"; } $pae77d38c .= "?>"; return $pae77d38c; } public static function getVarsFromFileCode($file_path) { if (file_exists($file_path)) { $old_defined_vars = get_defined_vars(); if (function_exists('opcache_invalidate') && strlen(ini_get("opcache.restrict_api")) < 1) opcache_invalidate($file_path); ob_start(null, 0); include $file_path; ob_end_clean(); $pc4b92931 = get_defined_vars(); unset($pc4b92931["old_defined_vars"]); unset($pc4b92931["file_path"]); $v02a69d4e0f = new PHPVariablesFileHandler(null); $pae20c115 = array_diff_key($pc4b92931, $old_defined_vars); $pcf893696 = array_udiff($pc4b92931, $old_defined_vars, array('PHPVariablesFileHandler', 'customCompare')); $v761f4d757f = array_merge($pae20c115, $pcf893696); return $v761f4d757f; } } public static function customCompare($v2315f59719, $v16bd06603e) { return $v2315f59719 === $v16bd06603e ? 0 : 1; } public static function getVarsFromFileContent($pf3dc0762) { $pae77d38c = file_exists($pf3dc0762) ? file_get_contents($pf3dc0762) : ""; return self::getVarsFromContent($pae77d38c); } public static function getVarsFromContent($pae77d38c) { $v761f4d757f = array(); if ($pae77d38c) { preg_match_all('/([\w\$:\-\>]+)([ ]*)=([ ]*)([^;]+);/u', $pae77d38c, $pbae7526c, PREG_SET_ORDER); $pc37695cb = count($pbae7526c); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5e813b295b = $pbae7526c[$v43dd7d0051][1]; $v67db1bd535 = trim($pbae7526c[$v43dd7d0051][4]); $pc288256e = substr($v67db1bd535, 0, 1); if (substr($v5e813b295b, 0, 1) == '$' || strpos($v5e813b295b, "::") !== false) { $v5e813b295b = substr($v5e813b295b, 0, 1) == "\$" && strpos($v5e813b295b, "::") === false && strpos($v5e813b295b, "->") === false ? substr($v5e813b295b, 1) : $v5e813b295b; if ($pc288256e == '"' || $pc288256e == "'") { $v67db1bd535 = str_replace("\\" . $pc288256e, $pc288256e, substr($v67db1bd535, 1, -1)); } else { preg_match_all('/isset([ ]*)\(([ ]*)([\w\$:\-\>]+)([ ]*)\)([ ]*)\?([ ]*)([\w\$:\-\>]+)([ ]*)\:([ ]*)([^;]+);/iu', "$v67db1bd535;", $v6107abf109, PREG_SET_ORDER); $v665fa73259 = strtolower($v67db1bd535); if(isset($v6107abf109[0][10])) { $v67db1bd535 = $v6107abf109[0][10]; $pc288256e = substr($v67db1bd535, 0, 1); $v67db1bd535 = $pc288256e == '"' || $pc288256e == "'" ? str_replace("\\" . $pc288256e, $pc288256e, substr($v67db1bd535, 1, -1)) : (strtolower($v67db1bd535) == "null" ? null : $v67db1bd535); } else if ($v665fa73259 == "true") $v67db1bd535 = true; else if ($v665fa73259 == "false") $v67db1bd535 = false; else if ($v665fa73259 == "null") $v67db1bd535 = null; } $v761f4d757f[$v5e813b295b] = $v67db1bd535; } } } return $v761f4d757f; } public function getGlobalVariablesFilePaths() { return $this->v19baa1242a; } } ?>
