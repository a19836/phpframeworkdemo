<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once $EVC->getUtilPath("WorkFlowBeansFileHandler"); class CodeResultGuesser { private $v847a7225e0; private $pdf77ee66; private $v3d55458bcd; private $v5039a77f9d; private $peb014cfd; private $v872f5b4dbb; private $v7a0994a134; private $v87e4fe1181; public function __construct($v847a7225e0, $pdf77ee66, $v3d55458bcd, $v5039a77f9d, $peb014cfd, $v872f5b4dbb) { $this->v847a7225e0 = $v847a7225e0; $this->pdf77ee66 = $pdf77ee66; $this->v3d55458bcd = $v3d55458bcd; $this->v5039a77f9d = $v5039a77f9d; $this->peb014cfd = $peb014cfd; $this->v872f5b4dbb = $v872f5b4dbb; $this->v7a0994a134 = WorkFlowBeansFileHandler::getLayerBrokersSettings($v3d55458bcd, $v5039a77f9d, $v847a7225e0->getBrokers(), ''); $pa9b2090f = WorkFlowBeansFileHandler::getLayerDBDriverProps($v3d55458bcd, $v5039a77f9d, $v847a7225e0, $v872f5b4dbb); if ($pa9b2090f) { $v7207333d3c = new WorkFlowBeansFileHandler($v5039a77f9d . $pa9b2090f[1], $v3d55458bcd); $this->v87e4fe1181 = $v7207333d3c->getBeanObject($pa9b2090f[2]); } } public function getCodeResultAttributes($v067674f4e4) { $v4ee0f690b1 = $this->peb014cfd . "phpframework/dataaccess/get_query_result_properties?bean_name=#bean_name#&bean_file_name=#bean_file_name#&db_driver=" . $this->v872f5b4dbb . "&module_id=#module_id#&query_type=#query_type#&query=#query#&rel_name=#rel_name#&obj=#obj#&relationship_type=#relationship_type#"; $v06d0841ec2 = $this->peb014cfd . "phpframework/businesslogic/get_business_logic_result_properties?bean_name=#bean_name#&bean_file_name=#bean_file_name#&module_id=#module_id#&service=#service#&db_driver=" . $this->v872f5b4dbb; $v28b9855350 = array("callBusinessLogic", "callSelect", "getQuery", "getData", "getSQL", "findObjects", "findRelationshipObjects", "findById", "find", "findRelationships", "findRelationship"); $pf07e7d8a = "<?php\n$v067674f4e4\n?>"; $pedde3449 = CMSFileHandler::getContentsMethodParams($pf07e7d8a, $v28b9855350); if ($pedde3449) foreach ($pedde3449 as $v6cd9d4006f) { if (!$v6cd9d4006f["static"]) { $v603bd47baf = $v6cd9d4006f["method"]; switch($v603bd47baf) { case "callBusinessLogic": $pcd8c70bc = null; $v20b8676a9f = null; if ($v6cd9d4006f["params"][0]["type"] == "variable" && $v6cd9d4006f["params"][0]["referenced_type"] == "string") $pcd8c70bc = $v6cd9d4006f["params"][0]["referenced_value"]; else if ($v6cd9d4006f["params"][0]["type"] == "string") $pcd8c70bc = $v6cd9d4006f["params"][0]["value"]; if ($v6cd9d4006f["params"][1]["type"] == "variable" && $v6cd9d4006f["params"][1]["referenced_type"] == "string") $v20b8676a9f = $v6cd9d4006f["params"][1]["referenced_value"]; else if ($v6cd9d4006f["params"][1]["type"] == "string") $v20b8676a9f = $v6cd9d4006f["params"][1]["value"]; if ($pcd8c70bc && $v20b8676a9f) { $v1e79db4422 = $this->md626b79d8079($v6cd9d4006f["class_obj"]); if (!$v1e79db4422 && $this->v7a0994a134["business_logic_brokers"]) $v1e79db4422 = $this->v7a0994a134["business_logic_brokers"][0]; if ($v1e79db4422) { $v6f3a2700dd = $v06d0841ec2; $v6f3a2700dd = str_replace("#bean_name#", $v1e79db4422[2], $v6f3a2700dd); $v6f3a2700dd = str_replace("#bean_file_name#", $v1e79db4422[1], $v6f3a2700dd); $v6f3a2700dd = str_replace("#module_id#", $pcd8c70bc, $v6f3a2700dd); $v6f3a2700dd = str_replace("#service#", $v20b8676a9f, $v6f3a2700dd); $v9073377656 = $this->pdf77ee66->getURLContent($v6f3a2700dd); $v9073377656 = $v9073377656 ? json_decode($v9073377656, true) : null; } } break; case "callSelect": $pcd8c70bc = null; $v93353f70b3 = null; if ($v6cd9d4006f["params"][0]["type"] == "variable" && $v6cd9d4006f["params"][0]["referenced_type"] == "string") $pcd8c70bc = $v6cd9d4006f["params"][0]["referenced_value"]; else if ($v6cd9d4006f["params"][0]["type"] == "string") $pcd8c70bc = $v6cd9d4006f["params"][0]["value"]; if ($v6cd9d4006f["params"][1]["type"] == "variable" && $v6cd9d4006f["params"][1]["referenced_type"] == "string") $v93353f70b3 = $v6cd9d4006f["params"][1]["referenced_value"]; else if ($v6cd9d4006f["params"][1]["type"] == "string") $v93353f70b3 = $v6cd9d4006f["params"][1]["value"]; $v40cd224025 = $this->f5d08b9dd46($pf07e7d8a, $v6cd9d4006f["class_obj"]); if ($pcd8c70bc && ($v93353f70b3 || $v40cd224025)) { $v1e79db4422 = $this->md626b79d8079($v6cd9d4006f["class_obj"]); if (!$v1e79db4422 && $this->v7a0994a134["data_access_brokers"]) $v1e79db4422 = $this->v7a0994a134["data_access_brokers"][0]; if ($v1e79db4422) { $v6f3a2700dd = $v4ee0f690b1; $v6f3a2700dd = str_replace("#bean_name#", $v1e79db4422[2], $v6f3a2700dd); $v6f3a2700dd = str_replace("#bean_file_name#", $v1e79db4422[1], $v6f3a2700dd); $v6f3a2700dd = str_replace("#query_type#", "select", $v6f3a2700dd); $v6f3a2700dd = str_replace("#rel_name#", "", $v6f3a2700dd); $v6f3a2700dd = str_replace("#relationship_type#", "queries", $v6f3a2700dd); if ($v40cd224025) { $ped932a1f = $v6f3a2700dd; $ped932a1f = str_replace("#module_id#", $v40cd224025["module_id"], $ped932a1f); $ped932a1f = str_replace("#query#", $pcd8c70bc, $ped932a1f); $ped932a1f = str_replace("#obj#", $v40cd224025["obj_id"], $ped932a1f); $v9073377656 = $this->pdf77ee66->getURLContent($ped932a1f); $v9073377656 = $v9073377656 ? json_decode($v9073377656, true) : null; } if (!$v9073377656 && $v93353f70b3) { $v6f3a2700dd = str_replace("#module_id#", $pcd8c70bc, $v6f3a2700dd); $v6f3a2700dd = str_replace("#query#", $v93353f70b3, $v6f3a2700dd); $v6f3a2700dd = str_replace("#obj#", "", $v6f3a2700dd); $v9073377656 = $this->pdf77ee66->getURLContent($v6f3a2700dd); $v9073377656 = $v9073377656 ? json_decode($v9073377656, true) : null; } } } break; case "getData": case "getSQL": $v3c76382d93 = null; if ($v6cd9d4006f["params"][0]["type"] == "variable" && $v6cd9d4006f["params"][0]["referenced_type"] == "string") $v3c76382d93 = $v6cd9d4006f["params"][0]["referenced_value"]; else if ($v6cd9d4006f["params"][0]["type"] == "string") $v3c76382d93 = $v6cd9d4006f["params"][0]["value"]; if ($v3c76382d93) { $pa8db77e3 = DB::convertDefaultSQLToObject($v3c76382d93); if ($pa8db77e3["type"] == "select" && $pa8db77e3["table"]) { $pfdbbc383 = array(); if (!$pa8db77e3["attributes"] || count($pa8db77e3["attributes"]) == 0 || $pa8db77e3["attributes"][0]["column"] == "*") { if ($this->v87e4fe1181) { $v2054e8846a = $this->v87e4fe1181->listTableFields($pa8db77e3["table"]); if ($v2054e8846a) foreach ($v2054e8846a as $v5e45ec9bb9 => $v1b0cfa478b) $pfdbbc383[] = array( "column" => $v5e45ec9bb9 ); } } else { foreach ($pa8db77e3["attributes"] as $v1b0cfa478b) { if ($v1b0cfa478b["name"]) $pfdbbc383[] = array( "column" => $v1b0cfa478b["name"] ); else if ($v1b0cfa478b["column"]) $pfdbbc383[] = array( "column" => $v1b0cfa478b["column"] ); } } $v7e4b517c18 = is_numeric($pa8db77e3["start"]) ? $pa8db77e3["start"] : 0; $pbf2a75a9 = !$pa8db77e3["limit"] || $pa8db77e3["limit"] - $v7e4b517c18 > 1; $v9073377656 = array( "attributes" => $pfdbbc383, "is_multiple" => $pbf2a75a9, ); } } break; case "findObjects": $v8c5df8072b = null; if ($v6cd9d4006f["params"][0]["type"] == "variable" && $v6cd9d4006f["params"][0]["referenced_type"] == "string") $v8c5df8072b = $v6cd9d4006f["params"][0]["referenced_value"]; else if ($v6cd9d4006f["params"][0]["type"] == "string") $v8c5df8072b = $v6cd9d4006f["params"][0]["value"]; if ($v8c5df8072b && $this->v87e4fe1181) { $v2054e8846a = $this->v87e4fe1181->listTableFields($v8c5df8072b); $pfdbbc383 = array(); if ($v2054e8846a) foreach ($v2054e8846a as $v5e45ec9bb9 => $v1b0cfa478b) $pfdbbc383[] = array( "column" => $v5e45ec9bb9 ); $v9073377656 = array( "attributes" => $pfdbbc383, "is_multiple" => true, ); } break; case "findRelationshipObjects": break; case "findById": case "find": case "findRelationships": case "findRelationship": $v40cd224025 = $this->f5d08b9dd46($pf07e7d8a, $v6cd9d4006f["class_obj"]); if ($v40cd224025) { $v1e79db4422 = $this->md626b79d8079($v40cd224025["class_obj"]); if (!$v1e79db4422 && $this->v7a0994a134["hibernate_brokers"]) $v1e79db4422 = $this->v7a0994a134["hibernate_brokers"][0]; if ($v1e79db4422) { $v016220e8f0 = ""; if ($v603bd47baf == "findRelationship") { if ($v6cd9d4006f["params"][0]["type"] == "variable" && $v6cd9d4006f["params"][0]["referenced_type"] == "string") $v016220e8f0 = $v6cd9d4006f["params"][0]["referenced_value"]; else if ($v6cd9d4006f["params"][0]["type"] == "string") $v016220e8f0 = $v6cd9d4006f["params"][0]["value"]; } $v6f3a2700dd = $v4ee0f690b1; $v6f3a2700dd = str_replace("#bean_name#", $v1e79db4422[2], $v6f3a2700dd); $v6f3a2700dd = str_replace("#bean_file_name#", $v1e79db4422[1], $v6f3a2700dd); $v6f3a2700dd = str_replace("#module_id#", $v40cd224025["module_id"], $v6f3a2700dd); $v6f3a2700dd = str_replace("#query_type#", "", $v6f3a2700dd); $v6f3a2700dd = str_replace("#query#", $v603bd47baf, $v6f3a2700dd); $v6f3a2700dd = str_replace("#rel_name#", $v016220e8f0, $v6f3a2700dd); $v6f3a2700dd = str_replace("#obj#", $v40cd224025["obj_id"], $v6f3a2700dd); $v6f3a2700dd = str_replace("#relationship_type#", "native", $v6f3a2700dd); $v9073377656 = $this->pdf77ee66->getURLContent($v6f3a2700dd); $v9073377656 = $v9073377656 ? json_decode($v9073377656, true) : null; } } break; } if ($v9073377656) return $v9073377656; } } return null; } private function f5d08b9dd46($pf07e7d8a, $v838ff99a4d) { $pedde3449 = CMSFileHandler::getContentsMethodParams($pf07e7d8a, "callObject"); $v9073377656 = null; if ($pedde3449) foreach ($pedde3449 as $v6cd9d4006f) { if (!$v6cd9d4006f["static"]) { $pcd8c70bc = null; $v9ff79a4a24 = null; if ($v6cd9d4006f["params"][0]["type"] == "variable" && $v6cd9d4006f["params"][0]["referenced_type"] == "string") $pcd8c70bc = $v6cd9d4006f["params"][0]["referenced_value"]; else if ($v6cd9d4006f["params"][0]["type"] == "string") $pcd8c70bc = $v6cd9d4006f["params"][0]["value"]; if ($v6cd9d4006f["params"][1]["type"] == "variable" && $v6cd9d4006f["params"][1]["referenced_type"] == "string") $v9ff79a4a24 = $v6cd9d4006f["params"][1]["referenced_value"]; else if ($v6cd9d4006f["params"][1]["type"] == "string") $v9ff79a4a24 = $v6cd9d4006f["params"][1]["value"]; if ($pcd8c70bc && $v9ff79a4a24) { $v9073377656 = array( "class_obj" => $v6cd9d4006f["class_obj"], "module_id" => $pcd8c70bc, "obj_id" => $v9ff79a4a24 ); if (preg_match("/" . preg_quote($v838ff99a4d, "/") . "\s*=\s*" . preg_quote($v6cd9d4006f["match"], "/") . "/", $pf07e7d8a)) break; } } } return $v9073377656; } private function md626b79d8079($v0b196f001b) { if ($this->v7a0994a134) { preg_match('/\s*\->\s*getBroker\s*\(\s*"([^"]+)"\s*\)/', $v0b196f001b, $pbae7526c, PREG_OFFSET_CAPTURE); if (!$pbae7526c) preg_match("/\s*\->\s*getBroker\s*\(\s*'([^']+)'\s*\)/", $v0b196f001b, $pbae7526c, PREG_OFFSET_CAPTURE); $v2b2cf4c0eb = $pbae7526c && $pbae7526c[1] ? $pbae7526c[1][0] : null; if ($v2b2cf4c0eb) { $v9994512d98 = array("business_logic_brokers", "data_access_brokers", "db_brokers"); foreach ($v9994512d98 as $pbfa01ed1) { $pc4223ce1 = $this->v7a0994a134[$pbfa01ed1]; if ($pc4223ce1) foreach ($pc4223ce1 as $v1e79db4422) if ($v1e79db4422[0] == $v2b2cf4c0eb) return $v1e79db4422; } } } return null; } } ?>
