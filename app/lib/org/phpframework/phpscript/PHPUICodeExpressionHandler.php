<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once get_lib("org.phpframework.util.text.TextSanitizer"); class PHPUICodeExpressionHandler { public static function getArgumentCode($pea70e132, $v9439b47442) { if ((!isset($pea70e132) && $v9439b47442 != "string") || $v9439b47442 == "null") return "null"; if (!$v9439b47442 && is_string($pea70e132)) return mb_strlen($pea70e132) ? $pea70e132 : "null"; if ($v9439b47442 == "boolean") return $pea70e132 ? "true" : "false"; if ($v9439b47442 == "variable") return (substr($pea70e132, 0, 1) != '$' ? "$" : "") . $pea70e132; if ($v9439b47442 == "string") { $pea70e132 = '"' . TextSanitizer::addCSlashes($pea70e132, '"', true) . '"'; $pea70e132 = TextSanitizer::replaceIfNotEscaped('\n', '\\\n', $pea70e132); return $pea70e132; } return $pea70e132; } public static function getValueType($v67db1bd535, $v5d3813882f = null) { $v5c32a4aa93 = is_array($v5d3813882f) && !empty($v5d3813882f["non_set_type"]) ? $v5d3813882f["non_set_type"] : "null"; $v4e44851c76 = is_array($v5d3813882f) && !empty($v5d3813882f["empty_string_type"]) ? $v5d3813882f["empty_string_type"] : "null"; if (!isset($v67db1bd535)) return $v5c32a4aa93; $v3fb9f41470 = strtolower(gettype($v67db1bd535)); if ($v3fb9f41470 == "string") { if (mb_strlen($v67db1bd535) == 0) return $v4e44851c76; if (is_numeric($v67db1bd535) || self::f09e2f0efe1($v67db1bd535)) return ""; return "string"; } return $v3fb9f41470; } private static function f09e2f0efe1($v67db1bd535) { if (!mb_strlen(trim($v67db1bd535))) return false; if (is_numeric($v67db1bd535) || strtolower($v67db1bd535) == "true" || strtolower($v67db1bd535) == "false") return true; if (strpos($v67db1bd535, '"') !== false || strpos($v67db1bd535, "'") !== false || strpos($v67db1bd535, '$') !== false || strpos($v67db1bd535, '<?') !== false) { $pd5c67a44 = self::mee3db549cf70($v67db1bd535); $pc37695cb = count($pd5c67a44); $v04170c0816 = array(); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) if (trim($pd5c67a44[$v43dd7d0051][0]) || $pd5c67a44[$v43dd7d0051][1]) $v04170c0816[] = $pd5c67a44[$v43dd7d0051]; $pc37695cb = count($v04170c0816); if ($pc37695cb) { if ($pc37695cb == 1 && ($v04170c0816[0][1] == "php" || $v04170c0816[0][1] == "variable" || $v04170c0816[0][1] == "quotes")) return true; $v16c1bf3c03 = false; $v27f231a7af = 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9e9acf7b8a = $v04170c0816[$v43dd7d0051][1]; $v6b90d589f1 = $v43dd7d0051 + 1 < $pc37695cb ? $v04170c0816[$v43dd7d0051 + 1][1] : null; if ($v9e9acf7b8a == "variable" || $v9e9acf7b8a == "quotes") { if ($v43dd7d0051 >= 0 && $v43dd7d0051 + 2 < $pc37695cb) { if ($v6b90d589f1 != "operator") return false; else if ($v04170c0816[$v43dd7d0051 + 1][0] == ".") $v16c1bf3c03 = true; } else if ($v43dd7d0051 + 1 <= $pc37695cb && $v43dd7d0051 - 1 > 0) { if ($v04170c0816[$v43dd7d0051 - 1][1] != "operator") return false; else if ($v04170c0816[$v43dd7d0051 - 1][0] == ".") $v16c1bf3c03 = true; } } else if ($v9e9acf7b8a == "operator") { if ($v43dd7d0051 == 0 || $v43dd7d0051 + 1 == $pc37695cb) return false; else if ($v6b90d589f1 == "operator") return false; } } return $v16c1bf3c03; } } return false; } public static function isSimpleVariable($v67db1bd535) { $v67db1bd535 = trim($v67db1bd535); if (substr($v67db1bd535, 0, 1) == '$') { $pd5c67a44 = self::mee3db549cf70($v67db1bd535); $pc37695cb = count($pd5c67a44); $v04170c0816 = array(); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) if (trim($pd5c67a44[$v43dd7d0051][0]) || $pd5c67a44[$v43dd7d0051][1]) $v04170c0816[] = $pd5c67a44[$v43dd7d0051]; $pc37695cb = count($v04170c0816); if ($pc37695cb == 1 && $v04170c0816[0][1] == "variable") return true; } return false; } private static function mee3db549cf70($v39e1347c93) { $pd5c67a44 = array(); $v79b7cb19d1 = $v66327139f0 = false; $pac65f06f = 0; $pff850098 = ""; $pa75e95f5 = array( "." => ".", "+" => "+", "-" => "-", "/" => "/", "*" => "*", "%" => "%", ">" => array(">==", ">=", ">"), "<" => array("<==", "<=", "<"), "=" => array("===", "=="), "&" => "&", "|" => "|", "!" => "!", "?" => "?", ":" => ":", ); $v0efa4124a1 = TextSanitizer::mbStrSplit($v39e1347c93); $pe2ae3be9 = count($v0efa4124a1); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pc288256e = $v0efa4124a1[$v43dd7d0051]; if (!TextSanitizer::isMBCharEscaped($v39e1347c93, $v43dd7d0051, $v0efa4124a1)) { if ($pc288256e == '"' && !$v66327139f0) { $v79b7cb19d1 = !$v79b7cb19d1; $v327f72fb62 = implode("", array_slice($v0efa4124a1, $pac65f06f, $v43dd7d0051 - $pac65f06f + (!$v79b7cb19d1 ? 1 : 0))); if ($v327f72fb62) $pd5c67a44[] = array($v327f72fb62, !$v79b7cb19d1 ? "quotes" : $pff850098); $pff850098 = !$v79b7cb19d1 ? "" : "quotes"; $pac65f06f = !$v79b7cb19d1 ? $v43dd7d0051 + 1 : $v43dd7d0051; } else if ($pc288256e == "'" && !$v79b7cb19d1) { $v66327139f0 = !$v66327139f0; $v327f72fb62 = implode("", array_slice($v0efa4124a1, $pac65f06f, $v43dd7d0051 - $pac65f06f + (!$v66327139f0 ? 1 : 0))); if ($v327f72fb62) $pd5c67a44[] = array($v327f72fb62, !$v66327139f0 ? "quotes" : $pff850098); $pff850098 = !$v66327139f0 ? "" : "quotes"; $pac65f06f = !$v66327139f0 ? $v43dd7d0051 + 1 : $v43dd7d0051; } else if ($pc288256e == "$" && !$v66327139f0 && !$v79b7cb19d1) { $v327f72fb62 = implode("", array_slice($v0efa4124a1, $v43dd7d0051)); preg_match('/^\$[\w]+/u', $v327f72fb62, $v87ae7286da); $v87ae7286da = $v87ae7286da[0]; if ($v87ae7286da) { $v5d69d70611 = 0; $v3beaa307d1 = 0; $v853662c1db = TextSanitizer::mbStrSplit($v87ae7286da); for ($v9d27441e80 = $v43dd7d0051 + count($v853662c1db); $v9d27441e80 < $pe2ae3be9; $v9d27441e80++) { $pc288256e = $v0efa4124a1[$v9d27441e80]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isMBCharEscaped($v39e1347c93, $v9d27441e80, $v0efa4124a1)) $v79b7cb19d1 = !$v79b7cb19d1; else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isMBCharEscaped($v39e1347c93, $v9d27441e80, $v0efa4124a1)) $v66327139f0 = !$v66327139f0; else if ($pc288256e == "[" && !$v66327139f0 && !$v79b7cb19d1) ++$v5d69d70611; else if ($pc288256e == "]" && !$v66327139f0 && !$v79b7cb19d1) --$v5d69d70611; else if ($pc288256e == "(" && !$v66327139f0 && !$v79b7cb19d1) ++$v3beaa307d1; else if ($pc288256e == ")" && !$v66327139f0 && !$v79b7cb19d1) --$v3beaa307d1; else if ($pc288256e == "-" && $v9d27441e80 + 1 < $pe2ae3be9 && $v0efa4124a1[$v9d27441e80 + 1] == ">" && !$v66327139f0 && !$v79b7cb19d1) { $v327f72fb62 = implode("", array_slice($v0efa4124a1, $v9d27441e80 + 2)); preg_match('/^[\w]+/u', $v327f72fb62, $v48b10a467d); $v48b10a467d = isset($v48b10a467d[0]) ? $v48b10a467d[0] : null; if ($v48b10a467d) { $v0511d9da06 = TextSanitizer::mbStrSplit($v48b10a467d); $v9d27441e80 += 1 + count($v0511d9da06); } else break; } else if (!$v66327139f0 && !$v79b7cb19d1 && $v5d69d70611 <= 0 && $v3beaa307d1 <= 0) break; } $v327f72fb62 = implode("", array_slice($v0efa4124a1, $pac65f06f, $v43dd7d0051 - $pac65f06f)); if ($v327f72fb62) $pd5c67a44[] = array($v327f72fb62, $pff850098); $v327f72fb62 = implode("", array_slice($v0efa4124a1, $v43dd7d0051, $v9d27441e80 - $v43dd7d0051)); $pd5c67a44[] = array($v327f72fb62, "variable"); $pff850098 = ""; $v43dd7d0051 = $v9d27441e80 - 1; $pac65f06f = $v9d27441e80; } } else if ($pc288256e == "<" && $v43dd7d0051 + 1 < $pe2ae3be9 && $v0efa4124a1[$v43dd7d0051 + 1] == "?" && !$v66327139f0 && !$v79b7cb19d1) { for ($v9d27441e80 = $v43dd7d0051 + 2; $v9d27441e80 < $pe2ae3be9; $v9d27441e80++) { $pc288256e = $v0efa4124a1[$v9d27441e80]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isMBCharEscaped($v39e1347c93, $v9d27441e80, $v0efa4124a1)) $v79b7cb19d1 = !$v79b7cb19d1; else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isMBCharEscaped($v39e1347c93, $v9d27441e80, $v0efa4124a1)) $v66327139f0 = !$v66327139f0; else if ($pc288256e == "?" && $v9d27441e80 + 1 < $pe2ae3be9 && $v0efa4124a1[$v9d27441e80 + 1] == ">" && !$v66327139f0 && !$v79b7cb19d1) break; } $v327f72fb62 = implode("", array_slice($v0efa4124a1, $pac65f06f, $v43dd7d0051 - $pac65f06f)); if ($v327f72fb62) $pd5c67a44[] = array($v327f72fb62, $pff850098); $v327f72fb62 = implode("", array_slice($v0efa4124a1, $v43dd7d0051, $v9d27441e80 - $v43dd7d0051 + 2)); $pd5c67a44[] = array($v327f72fb62, "php"); $pff850098 = ""; $v43dd7d0051 = $v9d27441e80 + 1; $pac65f06f = $v9d27441e80 + 2; } else if ($pc288256e == "(" && !$v66327139f0 && !$v79b7cb19d1) { $v3beaa307d1 = 1; for ($v9d27441e80 = $v43dd7d0051 + 1; $v9d27441e80 < $pe2ae3be9; $v9d27441e80++) { $pc288256e = $v0efa4124a1[$v9d27441e80]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isMBCharEscaped($v39e1347c93, $v9d27441e80, $v0efa4124a1)) $v79b7cb19d1 = !$v79b7cb19d1; else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isMBCharEscaped($v39e1347c93, $v9d27441e80, $v0efa4124a1)) $v66327139f0 = !$v66327139f0; else if ($pc288256e == "(" && !$v66327139f0 && !$v79b7cb19d1) ++$v3beaa307d1; else if ($pc288256e == ")" && !$v66327139f0 && !$v79b7cb19d1) { --$v3beaa307d1; if (!$v66327139f0 && !$v79b7cb19d1 && $v3beaa307d1 <= 0) break; } } $v43dd7d0051 = $v9d27441e80; } else if (!empty($pa75e95f5[$pc288256e]) && !$v66327139f0 && !$v79b7cb19d1) { $v6d7b298f40 = $pa75e95f5[$pc288256e]; $v6d7b298f40 = !is_array($v6d7b298f40) ? array($v6d7b298f40) : $v6d7b298f40; foreach ($v6d7b298f40 as $v7e8fc026cb) { $v327f72fb62 = implode("", array_slice($v0efa4124a1, $v43dd7d0051, strlen($v7e8fc026cb))); if ($v327f72fb62 == $v7e8fc026cb) { $v327f72fb62 = implode("", array_slice($v0efa4124a1, $pac65f06f, $v43dd7d0051 - $pac65f06f)); if ($v327f72fb62) $pd5c67a44[] = array($v327f72fb62, $pff850098); $pd5c67a44[] = array($v7e8fc026cb, "operator"); $pff850098 = ""; $v43dd7d0051 += strlen($v7e8fc026cb) - 1; $pac65f06f = $v43dd7d0051 + 1; break; } } } } } $v327f72fb62 = implode("", array_slice($v0efa4124a1, $pac65f06f)); if ($v327f72fb62) $pd5c67a44[] = array($v327f72fb62, $pff850098); return $pd5c67a44; } } ?>
