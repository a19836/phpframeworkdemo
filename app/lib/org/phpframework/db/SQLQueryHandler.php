<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once get_lib("lib.vendor.sqlparser.src.PHPSQLParser"); include_once get_lib("lib.vendor.sqlparser.src.PHPSQLCreator"); include_once get_lib("org.phpframework.util.text.TextSanitizer"); class SQLQueryHandler { public static $exception = null; public static $reserved_conditions = array("#searching_condition#"); public static function parse($v3c76382d93) { $v539082ff30 = null; self::$exception = null; try { if ($v3c76382d93) { $v78599b62fe = new PHPSQLParser(); $v7bb8636f3b = $v78599b62fe->parse($v3c76382d93); if (isset($v7bb8636f3b["INSERT"])) { $v539082ff30 = self::parseInsert($v7bb8636f3b); $v539082ff30["type"] = "insert"; } else if (isset($v7bb8636f3b["UPDATE"])) { $v539082ff30 = self::parseUpdate($v7bb8636f3b); $v539082ff30["type"] = "update"; } else if (isset($v7bb8636f3b["DELETE"])) { $v539082ff30 = self::parseDelete($v7bb8636f3b); $v539082ff30["type"] = "delete"; } else { $v539082ff30 = self::parseSelect($v7bb8636f3b); $v539082ff30["type"] = "select"; } } } catch(Exception $paec2c009) { self::$exception = $paec2c009; } return $v539082ff30; } public static function parseInsert($v7bb8636f3b) { $v539082ff30 = array( "table" => self::ma2780d5f62c1($v7bb8636f3b["INSERT"][0]["table"]), "attributes" => array(), ); $v223002cb02 = $v7bb8636f3b["INSERT"][0]["columns"]; $v76b0aa2076 = $v7bb8636f3b["VALUES"][0]["data"]; $v16ac35fd79 = $v223002cb02 ? count($v223002cb02) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v539082ff30["attributes"][] = array( "table" => self::ma2780d5f62c1($v539082ff30["table"]), "column" => self::ma2780d5f62c1($v223002cb02[$v43dd7d0051]["base_expr"]), "operator" => "=", "value" => self::f2e64b9e35e($v76b0aa2076[$v43dd7d0051]), ); } return $v539082ff30; } public static function parseUpdate($v7bb8636f3b) { $v539082ff30 = array( "table" => self::ma2780d5f62c1($v7bb8636f3b["UPDATE"][0]["table"]), "attributes" => array(), "conditions" => array(), ); $paf1bc6f6 = self::parseConditions($v7bb8636f3b, $v539082ff30["table"], null); $v539082ff30["conditions"] = array_merge($paf1bc6f6["keys"], $paf1bc6f6["conditions"]); $v16ac35fd79 = $v7bb8636f3b["SET"] ? count($v7bb8636f3b["SET"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v7bb8636f3b["SET"][$v43dd7d0051]; $v539082ff30["attributes"][] = array( "table" => self::ma2780d5f62c1($v539082ff30["table"]), "column" => self::ma2780d5f62c1($v342a134247["sub_tree"][0]["base_expr"]), "operator" => $v342a134247["sub_tree"][1]["base_expr"], "value" => self::f2e64b9e35e($v342a134247["sub_tree"][2]), ); } return $v539082ff30; } public static function parseDelete($v7bb8636f3b) { $v539082ff30 = array( "table" => self::ma2780d5f62c1($v7bb8636f3b["DELETE"]["TABLES"][0]), "conditions" => array(), ); $paf1bc6f6 = self::parseConditions($v7bb8636f3b, $v539082ff30["table"], null); $v539082ff30["conditions"] = array_merge($paf1bc6f6["keys"], $paf1bc6f6["conditions"]); return $v539082ff30; } public static function parseSelect($v7bb8636f3b) { $v539082ff30 = array( "table" => "", "attributes" => array(), "keys" => array(), "conditions" => array(), "groups_by" => array(), "sorts" => array(), "start" => $v7bb8636f3b["LIMIT"]["offset"], "limit" => $v7bb8636f3b["LIMIT"]["rowcount"], ); $v70210c15fa = array(); $v5582324c2f = null; $v16ac35fd79 = $v7bb8636f3b["FROM"] ? count($v7bb8636f3b["FROM"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v7bb8636f3b["FROM"][$v43dd7d0051]; if ($v342a134247["expr_type"] == "table") { $pc661dc6b = self::ma2780d5f62c1($v342a134247["table"]); $v7c3c74d27f = self::ma2780d5f62c1($v342a134247["alias"]["name"]); $v70210c15fa[ ($v7c3c74d27f ? $v7c3c74d27f : $pc661dc6b) ] = $pc661dc6b . ($v7c3c74d27f ? " $v7c3c74d27f" : ""); if (!$v5582324c2f) { $v539082ff30["table"] = $pc661dc6b; $v5582324c2f = $pc661dc6b . ($v7c3c74d27f ? " " . $v7c3c74d27f : ""); } } } $v3380b67c5f = new SelectBuilder(); $v16ac35fd79 = $v7bb8636f3b["SELECT"] ? count($v7bb8636f3b["SELECT"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v7bb8636f3b["SELECT"][$v43dd7d0051]; $pc661dc6b = $v9ea12a829c = $v5e813b295b = ""; if ($v342a134247["expr_type"] == "colref") { $pda09cefc = $v342a134247["base_expr"]; $pda09cefc = self::f2dc9a9f54d($pda09cefc, $v5582324c2f, $v70210c15fa); $v9cd205cadb = explode(" ", $pda09cefc[1]); $pc661dc6b = $pda09cefc[0]; $v9ea12a829c = $v9cd205cadb[0]; $v5e813b295b = $v9cd205cadb[1]; } else { $pb7272577 = $v342a134247; $pb7272577["alias"] = null; $v9ea12a829c = $v3380b67c5f->build(array($pb7272577)); $v9ea12a829c = substr($v9ea12a829c, 7); $v5e813b295b = $v342a134247["alias"]["name"]; } $v539082ff30["attributes"][] = array( "table" => $pc661dc6b, "column" => $v9ea12a829c, "name" => $v5e813b295b, ); } $v16ac35fd79 = $v7bb8636f3b["FROM"] ? count($v7bb8636f3b["FROM"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v7bb8636f3b["FROM"][$v43dd7d0051]; if ($v342a134247["expr_type"] == "table") { $pc661dc6b = self::ma2780d5f62c1($v342a134247["table"]); $v7c3c74d27f = self::ma2780d5f62c1($v342a134247["alias"]["name"]); $v566db8f5a9 = $pc661dc6b . ($v7c3c74d27f ? " $v7c3c74d27f" : ""); if ($v5582324c2f != $v566db8f5a9) { $v9df16de072 = $v342a134247["join_type"]; $paf1bc6f6 = $v342a134247["ref_clause"]; $pc37695cb = $paf1bc6f6 ? count($paf1bc6f6) : 0; for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v32dd06ab9b = $paf1bc6f6[$v9d27441e80]; if ($v32dd06ab9b["expr_type"] == "colref" || $v32dd06ab9b["expr_type"] == "const") { $v3b625ac0a5 = $pa3c827a4 = $v294f67133d = $v8903e4e7c4 = $v67db1bd535 = $v19a7745bc6 = null; if ($v32dd06ab9b["expr_type"] == "colref") { $pda09cefc = self::f2dc9a9f54d($v32dd06ab9b["base_expr"], $v5582324c2f, $v70210c15fa); $v3b625ac0a5 = $pda09cefc[0]; $pa3c827a4 = $pda09cefc[1]; $v19a7745bc6 = $paf1bc6f6[$v9d27441e80 + 1]["expr_type"] == "operator" ? $paf1bc6f6[$v9d27441e80 + 1]["base_expr"] : null; if ($v19a7745bc6) { if ($paf1bc6f6[$v9d27441e80 + 2]["expr_type"] == "colref" && !self::f533d7fe077($paf1bc6f6[$v9d27441e80 + 2]["base_expr"])) { $pda09cefc = self::f2dc9a9f54d($paf1bc6f6[$v9d27441e80 + 2]["base_expr"], $v5582324c2f, $v70210c15fa); $v294f67133d = $pda09cefc[0]; $v8903e4e7c4 = $pda09cefc[1]; } else { $v67db1bd535 = self::f2e64b9e35e($paf1bc6f6[$v9d27441e80 + 2]); } } else { $v3b625ac0a5 = null; $v67db1bd535 = $pa3c827a4; } } else if ($v32dd06ab9b["expr_type"] == "const") { $v67db1bd535 = self::f2e64b9e35e($v32dd06ab9b); $v19a7745bc6 = $paf1bc6f6[$v9d27441e80 + 1]["expr_type"] == "operator" ? $paf1bc6f6[$v9d27441e80 + 1]["base_expr"] : null; if ($v19a7745bc6) { if ($paf1bc6f6[$v9d27441e80 + 2]["expr_type"] == "colref" && !self::f533d7fe077($paf1bc6f6[$v9d27441e80 + 2]["base_expr"])) { $pda09cefc = self::f2dc9a9f54d($paf1bc6f6[$v9d27441e80 + 2]["base_expr"], $v5582324c2f, $v70210c15fa); $v3b625ac0a5 = $pda09cefc[0]; $pa3c827a4 = $pda09cefc[1]; } else { $v67db1bd535 = "$v67db1bd535 $v19a7745bc6 " . self::f2e64b9e35e($v32dd06ab9b[$v9d27441e80 + 2]); } } } if ($v19a7745bc6 && ($pa3c827a4 || $v8903e4e7c4)) { if (strtolower($v19a7745bc6) == "in") { $v67db1bd535 = trim($v67db1bd535); $v67db1bd535 = substr($v67db1bd535, 0, 1) == "(" && substr($v67db1bd535, strlen($v67db1bd535) - 1) == ")" ? substr($v67db1bd535, 1, strlen($v67db1bd535) - 2) : $v67db1bd535; } $v539082ff30["keys"][] = array( "ptable" => $v3b625ac0a5, "pcolumn" => $pa3c827a4, "ftable" => $v294f67133d, "fcolumn" => $v8903e4e7c4, "value" => $v67db1bd535, "join" => $v9df16de072 == "JOIN" ? "INNER" : $v9df16de072, "operator" => $v19a7745bc6, ); } else if ($v67db1bd535) { $v539082ff30["keys"][] = array( "value" => $v67db1bd535, ); } $v9d27441e80 = $v9d27441e80 + ($v19a7745bc6 ? 2 : 0); $v3b625ac0a5 = $pa3c827a4 = $v294f67133d = $v8903e4e7c4 = $v67db1bd535 = $v19a7745bc6 = null; } } } } } $paf1bc6f6 = self::parseConditions($v7bb8636f3b, $v5582324c2f, $v70210c15fa); $v539082ff30["keys"] = array_merge($v539082ff30["keys"], $paf1bc6f6["keys"]); $v539082ff30["conditions"] = $paf1bc6f6["conditions"]; $v16ac35fd79 = $v7bb8636f3b["GROUP"] ? count($v7bb8636f3b["GROUP"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v7bb8636f3b["GROUP"][$v43dd7d0051]; if ($v342a134247["expr_type"] == "colref") { $pda09cefc = self::f2dc9a9f54d($v342a134247["base_expr"], $v5582324c2f, $v70210c15fa); $pc661dc6b = $pda09cefc[0]; $v9ea12a829c = $pda09cefc[1]; if ($v9ea12a829c) { $v539082ff30["groups_by"][] = array( "table" => $pc661dc6b, "column" => $v9ea12a829c, ); } } } $v16ac35fd79 = $v7bb8636f3b["ORDER"] ? count($v7bb8636f3b["ORDER"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v7bb8636f3b["ORDER"][$v43dd7d0051]; if ($v342a134247["expr_type"] == "colref") { $pda09cefc = self::f2dc9a9f54d($v342a134247["base_expr"], $v5582324c2f, $v70210c15fa); $pc661dc6b = $pda09cefc[0]; $v9ea12a829c = $pda09cefc[1]; if ($v9ea12a829c) { $v539082ff30["sorts"][] = array( "table" => $pc661dc6b, "column" => $v9ea12a829c, "order" => $v342a134247["direction"], ); } } } return $v539082ff30; } public static function parseConditions($v7bb8636f3b, $v5582324c2f, $v70210c15fa) { $v539082ff30 = array( "keys" => array(), "conditions" => array(), ); $pf72c1d58 = $v7bb8636f3b["WHERE"]; $v16ac35fd79 = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $pf72c1d58[$v43dd7d0051]; if ($v342a134247["expr_type"] == "colref" || $v342a134247["expr_type"] == "const") { $pc661dc6b = $v9ea12a829c = $v67db1bd535 = $v19a7745bc6 = null; if ($v342a134247["expr_type"] == "colref") { $pda09cefc = self::f2dc9a9f54d($v342a134247["base_expr"], $v5582324c2f, $v70210c15fa); $pc661dc6b = $pda09cefc[0]; $v9ea12a829c = $pda09cefc[1]; $v19a7745bc6 = $pf72c1d58[$v43dd7d0051 + 1]["expr_type"] == "operator" ? $pf72c1d58[$v43dd7d0051 + 1]["base_expr"] : null; if ($v19a7745bc6) { if ($pf72c1d58[$v43dd7d0051 + 2]["expr_type"] == "colref" && !self::f533d7fe077($pf72c1d58[$v43dd7d0051 + 2]["base_expr"])) { $pda09cefc = self::f2dc9a9f54d($pf72c1d58[$v43dd7d0051 + 2]["base_expr"], $v5582324c2f, $v70210c15fa); $v294f67133d = $pda09cefc[0]; $v8903e4e7c4 = $pda09cefc[1]; $pff5830e4 = trim($v8903e4e7c4); if ($v9ea12a829c && $v8903e4e7c4) { $v539082ff30["keys"][] = array( "ptable" => $pc661dc6b, "pcolumn" => $v9ea12a829c, "ftable" => $v294f67133d, "fcolumn" => $v8903e4e7c4, "value" => "", "join" => "INNER", "operator" => $v19a7745bc6, ); $pc661dc6b = $v9ea12a829c = $v67db1bd535 = $v19a7745bc6 = null; } else { $v67db1bd535 = ""; } } else { $v67db1bd535 = self::f2e64b9e35e($pf72c1d58[$v43dd7d0051 + 2]); } } else { $pc661dc6b = null; $v67db1bd535 = $v9ea12a829c; } } else if ($v342a134247["expr_type"] == "const") { $v67db1bd535 = self::f2e64b9e35e($v342a134247); $v19a7745bc6 = $pf72c1d58[$v43dd7d0051 + 1]["expr_type"] == "operator" ? $pf72c1d58[$v43dd7d0051 + 1]["base_expr"] : null; if ($v19a7745bc6) { if ($pf72c1d58[$v43dd7d0051 + 2]["expr_type"] == "colref" && !self::f533d7fe077($pf72c1d58[$v43dd7d0051 + 2]["base_expr"])) { $pda09cefc = self::f2dc9a9f54d($pf72c1d58[$v43dd7d0051 + 2]["base_expr"], $v5582324c2f, $v70210c15fa); $pc661dc6b = $pda09cefc[0]; $v9ea12a829c = $pda09cefc[1]; } else { $v67db1bd535 = "$v67db1bd535 $v19a7745bc6 " . self::f2e64b9e35e($pf72c1d58[$v43dd7d0051 + 2]); } } } if ($v19a7745bc6 && $v9ea12a829c) { if (strtolower($v19a7745bc6) == "in") { $v67db1bd535 = trim($v67db1bd535); $v67db1bd535 = substr($v67db1bd535, 0, 1) == "(" && substr($v67db1bd535, -1) == ")" ? substr($v67db1bd535, 1, strlen($v67db1bd535) - 2) : $v67db1bd535; } $v539082ff30["conditions"][] = array( "table" => $pc661dc6b, "column" => $v9ea12a829c, "value" => $v67db1bd535, "operator" => $v19a7745bc6, ); } else if ($v67db1bd535) { $v539082ff30["conditions"][] = array( "value" => $v67db1bd535, ); } $v43dd7d0051 = $v43dd7d0051 + ($v19a7745bc6 ? 2 : 0); $pc661dc6b = $v9ea12a829c = $v67db1bd535 = $v19a7745bc6 = null; } } return $v539082ff30; } public static function create($v539082ff30) { if ($v539082ff30["type"] == "insert") return self::createInsert($v539082ff30); else if ($v539082ff30["type"] == "update") return self::createUpdate($v539082ff30); else if ($v539082ff30["type"] == "delete") return self::createDelete($v539082ff30); else return self::createSelect($v539082ff30); return null; } public static function createInsert($v539082ff30) { $v3c76382d93 = null; $v8c5df8072b = $v539082ff30["main_table"] ? $v539082ff30["main_table"] : $v539082ff30["table"]; $pfdbbc383 = $v539082ff30["attributes"]; if ($v8c5df8072b && !empty($pfdbbc383)) { $v223002cb02 = array(); $v76b0aa2076 = array(); $v16ac35fd79 = count($pfdbbc383); for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v9ea12a829c = $pfdbbc383[$v43dd7d0051]["column"]; $v67db1bd535 = $pfdbbc383[$v43dd7d0051]["value"]; if ($v9ea12a829c) { $v223002cb02[] = array( "expr_type" => "colref", "base_expr" => self::getParsedSqlColumnName($v9ea12a829c), ); $v76b0aa2076[] = array( "expr_type" => "const", "base_expr" => self::createBaseExprValue($v67db1bd535), ); } } $v808a08b1f9 = array( "INSERT" => array(), "VALUES" => array(), ); $v808a08b1f9["INSERT"][] = array( "table" => self::getParsedSqlTableName($v8c5df8072b), "columns" => $v223002cb02, ); $v808a08b1f9["VALUES"][] = array( "expr_type" => "record", "data" => $v76b0aa2076, ); if (!empty($v808a08b1f9["INSERT"][0]["columns"])) { try { $pb6bff6f3 = new PHPSQLCreator($v808a08b1f9); $v3c76382d93 = $pb6bff6f3->created; if ($v539082ff30["ignore"]) $v3c76382d93 = preg_replace("/^(INSERT)(\s+)/i", '$1 IGNORE $2', $v3c76382d93); } catch(Exception $paec2c009) { } } } return $v3c76382d93; } public static function createUpdate($v539082ff30) { $v3c76382d93 = null; $v8c5df8072b = $v539082ff30["main_table"] ? $v539082ff30["main_table"] : $v539082ff30["table"]; $pfdbbc383 = $v539082ff30["attributes"]; $paf1bc6f6 = $v539082ff30["conditions"]; if ($v8c5df8072b && !empty($pfdbbc383)) { $v808a08b1f9 = array( "UPDATE" => array(), "SET" => array(), ); $v808a08b1f9["UPDATE"][] = array( "expr_type" => "table", "table" => self::getParsedSqlTableName($v8c5df8072b), ); $v16ac35fd79 = count($pfdbbc383); for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v9ea12a829c = $pfdbbc383[$v43dd7d0051]["column"]; $v19a7745bc6 = "="; $v67db1bd535 = $pfdbbc383[$v43dd7d0051]["value"]; if ($v9ea12a829c) { $v808a08b1f9["SET"][] = array( "expr_type" => "expression", "sub_tree" => array( array( "expr_type" => "colref", "base_expr" => self::getParsedSqlColumnName($v9ea12a829c), ), array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ), array( "expr_type" => "const", "base_expr" => self::createBaseExprValue($v67db1bd535), ), ), ); } } $v8a19d204a8 = self::createConditions($paf1bc6f6, $v8c5df8072b); $v808a08b1f9["WHERE"] = $v8a19d204a8["WHERE"]; if (!empty($v808a08b1f9["SET"])) { try { $pb6bff6f3 = new PHPSQLCreator($v808a08b1f9); $v3c76382d93 = $pb6bff6f3->created; } catch(Exception $paec2c009) { } } } return $v3c76382d93; } public static function createDelete($v539082ff30) { $v3c76382d93 = null; $v8c5df8072b = $v539082ff30["main_table"] ? $v539082ff30["main_table"] : $v539082ff30["table"]; $paf1bc6f6 = $v539082ff30["conditions"]; if ($v8c5df8072b) { $v808a08b1f9 = array( "DELETE" => array( "TABLES" => array(), ), "FROM" => array(), ); $v808a08b1f9["DELETE"]["TABLES"][] = $v8c5df8072b; $v808a08b1f9["FROM"][] = array( "expr_type" => "table", "table" => self::getParsedSqlTableName($v8c5df8072b), ); $v8a19d204a8 = self::createConditions($paf1bc6f6, $v8c5df8072b); $v808a08b1f9["WHERE"] = $v8a19d204a8["WHERE"]; try { $pb6bff6f3 = new PHPSQLCreator($v808a08b1f9); $v3c76382d93 = $pb6bff6f3->created; } catch(Exception $paec2c009) { } } return $v3c76382d93; } public static function createSelect($v539082ff30) { $v3c76382d93 = null; $pfdbbc383 = $v539082ff30["attributes"]; $v9994512d98 = $v539082ff30["keys"]; $paf1bc6f6 = $v539082ff30["conditions"]; $pe4b1434e = $v539082ff30["groups_by"]; $v04003a4f53 = $v539082ff30["sorts"]; $v7e4b517c18 = $v539082ff30["start"]; $v552b831ecd = $v539082ff30["limit"]; $v5582324c2f = $v539082ff30["main_table"] ? $v539082ff30["main_table"] : ($v539082ff30["table"] ? $v539082ff30["table"] : self::f068a7c3eed($v539082ff30)); $v808a08b1f9 = array(); $v16ac35fd79 = $pfdbbc383 ? count($pfdbbc383) : 0; if ($v16ac35fd79) { $pac4bc40a = self::f7b3e31fd3b($v539082ff30, $v5582324c2f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $pfdbbc383[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $v5e813b295b = $v342a134247["name"]; $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); if ($v9ea12a829c) $v808a08b1f9["SELECT"][] = array( "expr_type" => "colref", "alias" => !$v5e813b295b ? null : array( "name" => $v5e813b295b, ), "base_expr" => "\n     " . self::f715724f8f1($v566db8f5a9, $v9ea12a829c), "delim" => $v43dd7d0051 + 1 < $v16ac35fd79 ? "," : "", ); } $v566db8f5a9 = self::f1119cb01ef($v5582324c2f); $v8c5df8072b = self::me1d69d4cf74b($v5582324c2f); if ($v8c5df8072b) { $v808a08b1f9["FROM"][] = array( "expr_type" => "table", "table" => self::getParsedSqlTableName($v8c5df8072b), "alias" => !$v566db8f5a9 || $v566db8f5a9 == $v8c5df8072b ? null : array( "name" => self::f4244af452e($v566db8f5a9), ), ); $pac4bc40a[$v5582324c2f] = true; } $v8ad572cc50 = self::mea09a02d4f3e($v9994512d98, $v5582324c2f); $v3cbbdf9379 = array(); foreach ($v8ad572cc50 as $v296f8e88e6) { $pcaa7d12a = self::f1119cb01ef($v296f8e88e6["source_table"]); $pcb2bf5a6 = self::f1119cb01ef($v296f8e88e6["target_table"]); $v087d4ea2cb = $pac4bc40a[ $v296f8e88e6["source_table"] ] && $v296f8e88e6["target_table"] != $v5582324c2f ? $v296f8e88e6["target_table"] : $v296f8e88e6["source_table"]; $v9df16de072 = $v296f8e88e6["tables_join"]; $v16ac35fd79 = $v296f8e88e6["source_columns"] ? count($v296f8e88e6["source_columns"]) : 0; if ($v16ac35fd79) { $v37367aac1a = $v3cbbdf9379[$v087d4ea2cb][$v9df16de072] ? $v3cbbdf9379[$v087d4ea2cb][$v9df16de072] : array(); for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v3338aaf1f5 = $v296f8e88e6["source_columns"][$v43dd7d0051]; $v85efd7d999 = $v296f8e88e6["target_columns"][$v43dd7d0051]; $v7d3883f907 = $v296f8e88e6["column_values"][$v43dd7d0051]; $v19a7745bc6 = $v296f8e88e6["operators"][$v43dd7d0051]; $v19a7745bc6 = $v19a7745bc6 ? $v19a7745bc6 : "="; $v3060512b8c = strtolower($v19a7745bc6); if ($v3060512b8c == "in") $pa39b917c = self::createBaseExprValueForOperatorIn($v7d3883f907); else if ($v3060512b8c == "is" || $v3060512b8c == "is not") $pa39b917c = self::createBaseExprValueForOperatorIs($v7d3883f907); else $pa39b917c = self::createBaseExprValue($v7d3883f907); if ($v3338aaf1f5 || $v85efd7d999) { if ($v43dd7d0051 > 0 || $v37367aac1a) { $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => "AND", ); } if ($v3338aaf1f5 && $v85efd7d999) { $v37367aac1a[] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($pcaa7d12a, $v3338aaf1f5), ); $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ); $v37367aac1a[] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($pcb2bf5a6, $v85efd7d999), ); if ($v7d3883f907 || $v7d3883f907 === 0) { $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => "AND", ); $v37367aac1a[] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($pcaa7d12a, $v3338aaf1f5), ); $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ); $v37367aac1a[] = array( "expr_type" => "const", "base_expr" => $pa39b917c, ); $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => "AND", ); $v37367aac1a[] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($pcb2bf5a6, $v85efd7d999), ); $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ); $v37367aac1a[] = array( "expr_type" => "const", "base_expr" => $pa39b917c, ); } } else if ($v3338aaf1f5) { $v37367aac1a[] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($pcaa7d12a, $v3338aaf1f5), ); $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ); $v37367aac1a[] = array( "expr_type" => "const", "base_expr" => $pa39b917c, ); } else if ($v85efd7d999) { $v37367aac1a[] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($pcb2bf5a6, $v85efd7d999), ); $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ); $v37367aac1a[] = array( "expr_type" => "const", "base_expr" => $pa39b917c, ); } } else if ($v7d3883f907) { if ($v43dd7d0051 > 0 || $v37367aac1a) $v37367aac1a[] = array( "expr_type" => "operator", "base_expr" => "AND", ); $v37367aac1a[] = array( "expr_type" => "const", "base_expr" => $v7d3883f907, ); } } $v3cbbdf9379[$v087d4ea2cb][$v9df16de072] = $v37367aac1a; } $pac4bc40a[$v087d4ea2cb] = true; } foreach ($v3cbbdf9379 as $v087d4ea2cb => $v342a134247) { $v566db8f5a9 = self::f1119cb01ef($v087d4ea2cb); $v8c5df8072b = self::me1d69d4cf74b($v087d4ea2cb); if ($v8c5df8072b) foreach ($v342a134247 as $v9df16de072 => $v37367aac1a) $v808a08b1f9["FROM"][] = array( "expr_type" => "table", "table" => self::getParsedSqlTableName($v8c5df8072b), "alias" => !$v566db8f5a9 || $v566db8f5a9 == $v8c5df8072b ? null : array( "name" => self::f4244af452e($v566db8f5a9), ), "join_type" => $v9df16de072 == "INNER" ? "JOIN" : $v9df16de072, "ref_type" => "ON", "ref_clause" => $v37367aac1a, ); } $v8a19d204a8 = self::createConditions($paf1bc6f6, $v5582324c2f); $v808a08b1f9["WHERE"] = $v8a19d204a8["WHERE"]; $v16ac35fd79 = $pe4b1434e ? count($pe4b1434e) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $pe4b1434e[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); if ($v9ea12a829c) { $v808a08b1f9["GROUP"][] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($v566db8f5a9, $v9ea12a829c), ); } } $v16ac35fd79 = $v04003a4f53 ? count($v04003a4f53) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v04003a4f53[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $pc06af91c = $v342a134247["order"]; $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); if ($v9ea12a829c) $v808a08b1f9["ORDER"][] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($v566db8f5a9, $v9ea12a829c), "direction" => $pc06af91c, ); } if ($v552b831ecd) $v808a08b1f9["LIMIT"] = array( "offset" => $v7e4b517c18, "rowcount" => $v552b831ecd, ); try { $pb6bff6f3 = new PHPSQLCreator($v808a08b1f9); $v3c76382d93 = $pb6bff6f3->created; $v3c76382d93 = str_replace(" FROM ", "\n FROM ", $v3c76382d93); $v3c76382d93 = str_replace(" INNER JOIN ", "\n   INNER JOIN ", $v3c76382d93); $v3c76382d93 = str_replace(" LEFT JOIN ", "\n   LEFT JOIN ", $v3c76382d93); $v3c76382d93 = str_replace(" RIGHT JOIN ", "\n   RIGHT JOIN ", $v3c76382d93); $v3c76382d93 = str_replace(" WHERE ", "\n WHERE ", $v3c76382d93); $v3c76382d93 = str_replace(" GROUP BY ", "\n GROUP BY ", $v3c76382d93); $v3c76382d93 = str_replace(" ORDER BY ", "\n ORDER BY ", $v3c76382d93); $v3c76382d93 = str_replace(" LIMIT ", "\n LIMIT ", $v3c76382d93); } catch(Exception $paec2c009) { } } return $v3c76382d93; } public static function createConditions($paf1bc6f6, $v5582324c2f) { $v808a08b1f9 = array(); $v16ac35fd79 = $paf1bc6f6 ? count($paf1bc6f6) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $paf1bc6f6[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $v19a7745bc6 = $v342a134247["operator"]; $v67db1bd535 = $v342a134247["value"]; if ($v9ea12a829c) { $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v19a7745bc6 = $v19a7745bc6 ? $v19a7745bc6 : "="; if (strtolower($v19a7745bc6) == "in") { $v67db1bd535 = self::createBaseExprValueForOperatorIn($v67db1bd535); } else { $v67db1bd535 = self::createBaseExprValue($v67db1bd535); } $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); if ($v43dd7d0051 > 0) { $v808a08b1f9["WHERE"][] = array( "expr_type" => "operator", "base_expr" => "AND", ); } $v808a08b1f9["WHERE"][] = array( "expr_type" => "colref", "base_expr" => self::f715724f8f1($v566db8f5a9, $v9ea12a829c), ); $v808a08b1f9["WHERE"][] = array( "expr_type" => "operator", "base_expr" => $v19a7745bc6, ); $v808a08b1f9["WHERE"][] = array( "expr_type" => "const", "base_expr" => $v67db1bd535, ); } else if ($v67db1bd535) { if ($v43dd7d0051 > 0 && !in_array($v67db1bd535, self::$reserved_conditions)) $v808a08b1f9["WHERE"][] = array( "expr_type" => "operator", "base_expr" => "AND", ); $v808a08b1f9["WHERE"][] = array( "expr_type" => "const", "base_expr" => $v67db1bd535, ); } } return $v808a08b1f9; } public static function create2($v539082ff30) { $pfdbbc383 = $v539082ff30["attributes"]; $v9994512d98 = $v539082ff30["keys"]; $paf1bc6f6 = $v539082ff30["conditions"]; $pe4b1434e = $v539082ff30["groups_by"]; $v04003a4f53 = $v539082ff30["sorts"]; $v7e4b517c18 = $v539082ff30["start"]; $v552b831ecd = $v539082ff30["limit"]; $v5582324c2f = $v539082ff30["main_table"] ? $v539082ff30["main_table"] : self::f068a7c3eed($v539082ff30); $v3c76382d93 = ""; $v16ac35fd79 = $pfdbbc383 ? count($pfdbbc383) : 0; if ($v16ac35fd79) { $pac4bc40a = array(); $v3c76382d93 = "SELECT \n\t"; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $pfdbbc383[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $v5e813b295b = $v342a134247["name"]; $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $pac4bc40a[$pc661dc6b] = false; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); $v3c76382d93 .= ($v43dd7d0051 > 0 ? ", \n\t" : "") . self::f715724f8f1($v566db8f5a9, $v9ea12a829c) . ($v5e813b295b ? " " . getAlias($v5e813b295b) : ""); } $v3c76382d93 .= "\n FROM " . self::getParsedSqlTableName($v5582324c2f); $pac4bc40a[$v5582324c2f] = true; $v8ad572cc50 = self::mea09a02d4f3e($v9994512d98, $v5582324c2f); $v3cbbdf9379 = array(); foreach ($v8ad572cc50 as $v296f8e88e6) { $pcaa7d12a = self::f1119cb01ef($v296f8e88e6["source_table"]); $pcb2bf5a6 = self::f1119cb01ef($v296f8e88e6["target_table"]); $v087d4ea2cb = $pac4bc40a[ $v296f8e88e6["source_table"] ] ? $v296f8e88e6["target_table"] : $v296f8e88e6["source_table"]; $v16ac35fd79 = $v296f8e88e6["source_columns"] ? count($v296f8e88e6["source_columns"]) : 0; if ($v16ac35fd79) { $v84c84d2427 = ""; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v3338aaf1f5 = $v296f8e88e6["source_columns"][$v43dd7d0051]; $v85efd7d999 = $v296f8e88e6["target_columns"][$v43dd7d0051]; $v7d3883f907 = $v296f8e88e6["column_values"][$v43dd7d0051]; $v19a7745bc6 = $v296f8e88e6["operators"][$v43dd7d0051]; $pa39b917c = is_numeric($v7d3883f907) ? $v7d3883f907 : "'" . addcslashes($v7d3883f907, "\\'") . "'"; $v19a7745bc6 = $v19a7745bc6 ? $v19a7745bc6 : "="; if ($v3338aaf1f5 && $v85efd7d999) { $v84c84d2427 .= ($v84c84d2427 ? " AND" : "") . " " . self::f715724f8f1($pcaa7d12a, $v3338aaf1f5) . " " . $v19a7745bc6 . " " . self::f715724f8f1($pcb2bf5a6, $v85efd7d999); if ($v7d3883f907 || $v7d3883f907 === 0) $v84c84d2427 .= " AND " . self::f715724f8f1($pcaa7d12a, $v3338aaf1f5) . " " . $v19a7745bc6 . " " . $pa39b917c . " AND " . self::f715724f8f1($pcb2bf5a6, $v85efd7d999) . " " . $v19a7745bc6 . " " . $pa39b917c; } else if ($v3338aaf1f5) $v84c84d2427 .= ($v84c84d2427 ? " AND" : "") . " " . self::f715724f8f1($pcaa7d12a, $v3338aaf1f5) . " " . $v19a7745bc6 . " " . $pa39b917c; else if ($v85efd7d999) $v84c84d2427 .= ($v84c84d2427 ? " AND" : "") . " " . self::f715724f8f1($pcb2bf5a6, $v85efd7d999) . " " . $v19a7745bc6 . " " . $pa39b917c; } $v3cbbdf9379[$v087d4ea2cb][ $v296f8e88e6["tables_join"] ][] = $v84c84d2427; } $pac4bc40a[$v087d4ea2cb] = true; } foreach ($v3cbbdf9379 as $v087d4ea2cb => $v342a134247) foreach ($v342a134247 as $v9df16de072 => $pbd9a0e9b) { $v84c84d2427 = ""; foreach ($pbd9a0e9b as $pe6084f95) $v84c84d2427 .= ($v84c84d2427 ? " AND" : "") . $pe6084f95; $v3c76382d93 .= "\n   " . $v9df16de072 . " JOIN " . self::getParsedSqlTableName($v087d4ea2cb) . ($v84c84d2427 ? " ON " . $v84c84d2427 : ""); } foreach ($pac4bc40a as $pc661dc6b => $v056b4d65a6) if (!$v056b4d65a6) $v3c76382d93 .= "\n   INNER JOIN " . self::getParsedSqlTableName($pc661dc6b); $v16ac35fd79 = $paf1bc6f6 ? count($paf1bc6f6) : 0; if ($v16ac35fd79) { $v3c76382d93 .= "\n WHERE \n\t"; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $paf1bc6f6[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $v19a7745bc6 = $v342a134247["operator"]; $v67db1bd535 = $v342a134247["value"]; if ($v9ea12a829c) { $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v19a7745bc6 = $v19a7745bc6 ? $v19a7745bc6 : "="; $v67db1bd535 = is_numeric($v67db1bd535) ? $v67db1bd535 : "'" . addcslashes($v67db1bd535, "\\'") . "'"; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); $v3c76382d93 .= ($v43dd7d0051 > 0 ? " AND \n\t" : "") . " " . self::f715724f8f1($v566db8f5a9, $v9ea12a829c) . " " . $v19a7745bc6 . " " . $v67db1bd535; } } } $v16ac35fd79 = $pe4b1434e ? count($pe4b1434e) : 0; if ($v16ac35fd79) { $v3c76382d93 .= "\n GROUP BY \n\t"; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $pe4b1434e[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); if ($v9ea12a829c) $v3c76382d93 .= ($v43dd7d0051 > 0 ? ", \n\t" : "") . self::f715724f8f1($v566db8f5a9, $v9ea12a829c); } } $v16ac35fd79 = $v04003a4f53 ? count($v04003a4f53) : 0; if ($v16ac35fd79) { $v3c76382d93 .= "\n ORDER BY \n\t"; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v04003a4f53[$v43dd7d0051]; $pc661dc6b = $v342a134247["table"]; $v9ea12a829c = $v342a134247["column"]; $pc06af91c = $v342a134247["order"]; $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $v566db8f5a9 = self::f1119cb01ef($pc661dc6b); if ($v9ea12a829c) $v3c76382d93 .= ($v43dd7d0051 > 0 ? ", \n\t" : "") . self::f715724f8f1($v566db8f5a9, $v9ea12a829c) . " " . $pc06af91c; } } if ($v552b831ecd) $v3c76382d93 .= "\n LIMIT " . ($v7e4b517c18 ? $v7e4b517c18 . ", " : "") . $v552b831ecd; } return $v3c76382d93; } private static function mea09a02d4f3e($v9994512d98, $v5582324c2f) { $v8ad572cc50 = array(); $v16ac35fd79 = $v9994512d98 ? count($v9994512d98) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $v16ac35fd79; $v43dd7d0051++) { $v342a134247 = $v9994512d98[$v43dd7d0051]; $v3b625ac0a5 = $v342a134247["ptable"]; $pa3c827a4 = $v342a134247["pcolumn"]; $v294f67133d = $v342a134247["ftable"]; $v8903e4e7c4 = $v342a134247["fcolumn"]; $v67db1bd535 = $v342a134247["value"]; $v3c581c912b = $v342a134247["join"]; $v19a7745bc6 = $v342a134247["operator"]; $v3b625ac0a5 = empty($v3b625ac0a5) ? $v5582324c2f : $v3b625ac0a5; $v294f67133d = empty($v294f67133d) ? $v5582324c2f : $v294f67133d; $v3c581c912b = empty($v3c581c912b) ? "INNER" : strtoupper($v3c581c912b); $v67db1bd535 = isset($v67db1bd535) ? $v67db1bd535 : ""; $v19a7745bc6 = empty($v19a7745bc6) ? "=" : $v19a7745bc6; if ($v3b625ac0a5 && $v294f67133d) { $v1e042327eb = $v3b625ac0a5 . "_" . $v294f67133d . "_" . $v49fda2c268; if (!isset($v8ad572cc50[$v1e042327eb])) { $v8ad572cc50[$v1e042327eb] = array( "source_table" => $v3b625ac0a5, "target_table" => $v294f67133d, "tables_join" => $v3c581c912b, "source_columns" => array(), "target_columns" => array(), "column_values" => array(), "operators" => array(), ); } $v8ad572cc50[$v1e042327eb]["source_columns"][] = $pa3c827a4; $v8ad572cc50[$v1e042327eb]["target_columns"][] = $v8903e4e7c4; $v8ad572cc50[$v1e042327eb]["column_values"][] = $v67db1bd535; $v8ad572cc50[$v1e042327eb]["operators"][] = $v19a7745bc6; } } return $v8ad572cc50; } private static function f1119cb01ef($pc661dc6b) { $v9cd205cadb = explode(" ", $pc661dc6b); return isset($v9cd205cadb[1]) ? $v9cd205cadb[1] : $v9cd205cadb[0]; } private static function me1d69d4cf74b($pc661dc6b) { $v9cd205cadb = explode(" ", $pc661dc6b); return $v9cd205cadb[0]; } private static function f2dc9a9f54d($pda09cefc, $v5582324c2f, &$v70210c15fa) { $v9cd205cadb = explode(".", $pda09cefc); if (count($v9cd205cadb) < 2) { $pc661dc6b = $v5582324c2f; $v1b0cfa478b = self::ma2780d5f62c1($v9cd205cadb[0]); } else { $v1b0cfa478b = array_pop($v9cd205cadb); $v1d2d80ed32 = self::ma2780d5f62c1(implode(".", $v9cd205cadb)); if (!$v70210c15fa[$v1d2d80ed32] && $v1d2d80ed32) $v70210c15fa[$v1d2d80ed32] = $v1d2d80ed32; $pc661dc6b = $v70210c15fa[$v1d2d80ed32]; $v1b0cfa478b = self::ma2780d5f62c1($v1b0cfa478b); } return array($pc661dc6b, $v1b0cfa478b); } private static function ma2780d5f62c1($v5e813b295b) { return str_replace("`", "", $v5e813b295b); } private static function f4244af452e($v7c3c74d27f) { return "`" . $v7c3c74d27f . "`"; } public static function getParsedSqlTableName($pc661dc6b) { $v3c76382d93 = ""; $v9cd205cadb = self::parseTableName($pc661dc6b); foreach ($v9cd205cadb as $v1d2d80ed32) if ($v1d2d80ed32) $v3c76382d93 .= ($v3c76382d93 ? "." : "") . "`" . $v1d2d80ed32 . "`"; return $v3c76382d93; } public static function getParsedSqlColumnName($v9ea12a829c) { return $v9ea12a829c == "*" ? "*" : "`" . self::removeInvalidCharsFromName($v9ea12a829c) . "`"; } public static function removeInvalidCharsFromName($v5e813b295b) { return trim(str_replace(array("'", '"', "`"), "", $v5e813b295b)); } private static function f715724f8f1($pc661dc6b, $v9ea12a829c) { $v2ad89ab96a = strpos($v9ea12a829c, "(") !== false; return $v2ad89ab96a ? $v9ea12a829c : self::getParsedSqlTableName($pc661dc6b) . "." . self::getParsedSqlColumnName($v9ea12a829c); } private static function f2e64b9e35e($v342a134247) { if ($v342a134247["expr_type"] != "const" && $v342a134247["expr_type"] != "colref" && $v342a134247["expr_type"] != "in-list") { $v342a134247["alias"] = null; $v3380b67c5f = new SelectBuilder(); $pda09cefc = $v3380b67c5f->build(array($v342a134247)); $pda09cefc = substr($pda09cefc, 7); } else { $pda09cefc = $v342a134247["base_expr"]; } $v02a69d4e0f = trim($pda09cefc); if ($v02a69d4e0f[0] == "'" && $v02a69d4e0f[ strlen($v02a69d4e0f) - 1 ] == "'") return substr($v02a69d4e0f, 1, strlen($v02a69d4e0f) - 2); else if ($v02a69d4e0f[0] == '"' && $v02a69d4e0f[ strlen($v02a69d4e0f) - 1 ] == '"') return substr($v02a69d4e0f, 1, strlen($v02a69d4e0f) - 2); return $pda09cefc; } public static function createBaseExprValue($v67db1bd535) { return $v67db1bd535 === null ? "null" : (is_numeric($v67db1bd535) && !is_string($v67db1bd535) ? $v67db1bd535 : "'" . addcslashes($v67db1bd535, "\\'") . "'"); } public static function createBaseExprValueForOperatorIn($v67db1bd535) { $v67db1bd535 = is_array($v67db1bd535) ? implode(", ", $v67db1bd535) : $v67db1bd535; $v76b0aa2076 = array(); $v956913c90f = ""; $v8f85090cce = false; $v365d20463c = false; $pc37695cb = strlen($v67db1bd535); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9a8b7dc209 = $v67db1bd535[$v43dd7d0051]; if ($v9a8b7dc209 == "," && !$v8f85090cce && !$v365d20463c) { $v76b0aa2076[] = is_numeric($v956913c90f) ? $v956913c90f : "'" . addcslashes($v956913c90f, "\\'") . "'"; $v956913c90f = ""; } else if ($v9a8b7dc209 == "'" && !$v365d20463c && !TextSanitizer::isCharEscaped($v67db1bd535, $v43dd7d0051)) $v8f85090cce = !$v8f85090cce; else if ($v9a8b7dc209 == '"' && !$v8f85090cce && !TextSanitizer::isCharEscaped($v67db1bd535, $v43dd7d0051)) $v365d20463c = !$v365d20463c; else if ($v8f85090cce || $v365d20463c) $v956913c90f .= $v9a8b7dc209; else if ($v956913c90f !== "" || $v9a8b7dc209 != " ") $v956913c90f .= $v9a8b7dc209; } if (strlen($v956913c90f) || !count($v76b0aa2076)) $v76b0aa2076[] = self::createBaseExprValue($v956913c90f); return "(" . implode($v76b0aa2076, ", ") . ")"; } public static function createBaseExprValueForOperatorIs($v67db1bd535) { $pf09bd9b7 = strtolower($v67db1bd535); if ($pf09bd9b7 == "null" || $pf09bd9b7 == "true" || $pf09bd9b7 == "false" || $pf09bd9b7 == "unknown") return $v67db1bd535; return self::createBaseExprValue($v67db1bd535); } private static function f5fa07a9288($v327f72fb62) { return str_replace(array("`", "'", '"'), "", $v327f72fb62); } private static function f068a7c3eed($v539082ff30) { $v4159504aa3 = array("attributes", "keys", "conditions", "groups_by", "sorts"); $pc37695cb = count($v4159504aa3); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pf72c1d58 = $v539082ff30[ $v4159504aa3[$v43dd7d0051] ]; $v16ac35fd79 = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v9d27441e80 = 0; $v9d27441e80 < $v16ac35fd79; $v9d27441e80++) { $v342a134247 = $pf72c1d58[$v9d27441e80]; if (!empty($v342a134247["table"])) return $v342a134247["table"]; else if (!empty($v342a134247["ptable"])) return $v342a134247["ptable"]; else if (!empty($v342a134247["ftable"])) return $v342a134247["ftable"]; } } return ""; } private static function f7b3e31fd3b($v539082ff30, $v5582324c2f) { $v4159504aa3 = array("attributes", "keys", "conditions", "groups_by", "sorts"); $pac4bc40a = array(); $pc37695cb = count($v4159504aa3); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pf72c1d58 = $v539082ff30[ $v4159504aa3[$v43dd7d0051] ]; $v16ac35fd79 = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v9d27441e80 = 0; $v9d27441e80 < $v16ac35fd79; $v9d27441e80++) { $v342a134247 = $pf72c1d58[$v9d27441e80]; $pc661dc6b = null; if (!empty($v342a134247["table"])) $pc661dc6b = $v342a134247["table"]; else if (!empty($v342a134247["ptable"])) $pc661dc6b = $v342a134247["ptable"]; else if (!empty($v342a134247["ftable"])) $pc661dc6b = $v342a134247["ftable"]; if (isset($pc661dc6b)) { $pc661dc6b = empty($pc661dc6b) ? $v5582324c2f : $pc661dc6b; $pac4bc40a[ $pc661dc6b ] = false; } } } return $pac4bc40a; } private static function f533d7fe077($pda09cefc) { $pda09cefc = trim($pda09cefc); return substr($pda09cefc, 0, 1) == '$' || (substr($pda09cefc, 0, 1) == "#" && substr($pda09cefc, -1, 1) == "#"); } public static function parseTableName($pc661dc6b, $v511e888558 = "`", $v5e80bc7115 = false) { if ($pc661dc6b) { if ($v511e888558) { if (!$v5e80bc7115) $v5e80bc7115 = $v511e888558; $v9cd205cadb = array(); $v86bd693a16 = strlen($pc661dc6b); $v7e4b517c18 = 0; do { $pbd1bc7b0 = strpos($pc661dc6b, ".", $v7e4b517c18); $v34b7b3a4f4 = strpos($pc661dc6b, $v511e888558, $v7e4b517c18); $v05067b509b = false; if ($v34b7b3a4f4 !== false && ($pbd1bc7b0 === false || $pbd1bc7b0 > $v34b7b3a4f4)) { $pbd1bc7b0 = $v34b7b3a4f4; $v05067b509b = true; } if ($pbd1bc7b0 === false) $pbd1bc7b0 = $v86bd693a16; $v327f72fb62 = trim( substr($pc661dc6b, $v7e4b517c18, $pbd1bc7b0 - $v7e4b517c18) ); $v7e4b517c18 = $pbd1bc7b0 + 1; if ($v327f72fb62) $v9cd205cadb[] = $v327f72fb62; if ($v05067b509b && $v7e4b517c18 < $v86bd693a16) { $pbd1bc7b0 = strpos($pc661dc6b, $v5e80bc7115, $v7e4b517c18); $pbd1bc7b0 = $pbd1bc7b0 !== false ? $pbd1bc7b0 : $v86bd693a16; $v327f72fb62 = substr($pc661dc6b, $v7e4b517c18, $pbd1bc7b0 - $v7e4b517c18); $v7e4b517c18 = $pbd1bc7b0 + 1; if ($v327f72fb62) $v9cd205cadb[] = $v327f72fb62; } } while ($v7e4b517c18 < $v86bd693a16); } else $v9cd205cadb = explode(".", $pc661dc6b); return $v9cd205cadb; } return array($pc661dc6b); } } ?>
