<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include get_lib("org.phpframework.util.xml.MyXMLArrayItem"); include get_lib("org.phpframework.util.xml.exception.MyXMLArrayException"); include_once get_lib("org.phpframework.util.xml.UnicodeUTF8"); class MyXMLArray { private $v539082ff30; public function __construct($v539082ff30) { $this->v539082ff30 = is_array($v539082ff30) ? $v539082ff30 : array(); } public function toXML($v5d3813882f = false) { $v54bb17785b = isset($v5d3813882f["prefix_tab"]) ? $v5d3813882f["prefix_tab"] : null; return self::f5fdedd4b81($this->v539082ff30, $v5d3813882f, $v54bb17785b); } private static function f5fdedd4b81($pfb662071, $v5d3813882f = false, $v54bb17785b = "") { $v241205aec6 = ""; $pea9218eb = isset($v5d3813882f["to_decimal"]) ? $v5d3813882f["to_decimal"] : null; foreach ($pfb662071 as $pbfa01ed1 => $pf72c1d58) { $pbfa01ed1 = !empty($v5d3813882f["lower_case_keys"]) ? strtolower($pbfa01ed1) : (!empty($v5d3813882f["upper_case_keys"]) ? strtoupper($pbfa01ed1) : $pbfa01ed1); $pc37695cb = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v342a134247 = $pf72c1d58[$v43dd7d0051]; $pc84e277d = ""; if (!empty($v342a134247["@"])) { foreach($v342a134247["@"] as $v5e45ec9bb9 => $pd6321fb0) { $v5e45ec9bb9 = !empty($v5d3813882f["lower_case_keys"]) ? strtolower($v5e45ec9bb9) : (!empty($v5d3813882f["upper_case_keys"]) ? strtoupper($v5e45ec9bb9) : $v5e45ec9bb9); $pd6321fb0 = htmlentities($pd6321fb0); if($pea9218eb) $pd6321fb0 = UnicodeUTF8::to_decimal(htmlentities(html_entity_decode($pd6321fb0))); else $pd6321fb0 = str_replace("&", "&amp;", str_replace("&amp;", "&", $pd6321fb0)); $pc84e277d .= " {$v5e45ec9bb9}=\"{$pd6321fb0}\""; } } $v2b29bbd149 = ""; if (isset($v342a134247["value"])) $v2b29bbd149 .= is_numeric($v342a134247["value"]) || is_bool($v342a134247["value"]) ? $v342a134247["value"] : (!empty($v342a134247["value"]) ? "<![CDATA[" . $v342a134247["value"] . "]]>" : $v342a134247["value"]); if (!empty($v342a134247["childs"])) $v2b29bbd149 .= self::f5fdedd4b81($v342a134247["childs"], $v5d3813882f, $v54bb17785b . "\t"); $v241205aec6 .= "\n$v54bb17785b<{$pbfa01ed1}" . $pc84e277d; $v241205aec6 .= empty($v2b29bbd149) && !is_numeric($v2b29bbd149) ? " />" : ">$v2b29bbd149" . (!empty($v342a134247["childs"]) ? "\n$v54bb17785b" : "") . "</{$pbfa01ed1}>"; } } return $v241205aec6; } private static function f21cff69b81($pfb662071, $v5d3813882f = false, $v54bb17785b = "") { $v241205aec6 = ""; $v50c59a1f5b = new SimpleXMLElement("<root/>"); self::f1221a24063($v50c59a1f5b, $pfb662071, $v5d3813882f); foreach ($v50c59a1f5b->children() as $v7c627adb6d) $v241205aec6 .= $v7c627adb6d->asXML(); return $v241205aec6; } private static function f1221a24063(&$v6694236c2c, $pfb662071, $v5d3813882f = false) { $pea9218eb = isset($v5d3813882f["to_decimal"]) ? $v5d3813882f["to_decimal"] : null; if ($pfb662071) foreach($pfb662071 as $pbfa01ed1 => $pf72c1d58) { $pbfa01ed1 = !empty($v5d3813882f["lower_case_keys"]) ? strtolower($pbfa01ed1) : (!empty($v5d3813882f["upper_case_keys"]) ? strtoupper($pbfa01ed1) : $pbfa01ed1); $pc37695cb = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v342a134247 = $pf72c1d58[$v43dd7d0051]; $v7c627adb6d = $v6694236c2c->addChild($pbfa01ed1, isset($v342a134247["value"]) ? $v342a134247["value"] : null); if (!empty($v342a134247["@"])) foreach($v342a134247["@"] as $v5e45ec9bb9 => $pd6321fb0) { $v5e45ec9bb9 = !empty($v5d3813882f["lower_case_keys"]) ? strtolower($v5e45ec9bb9) : (!empty($v5d3813882f["upper_case_keys"]) ? strtoupper($v5e45ec9bb9) : $v5e45ec9bb9); if($pea9218eb) $pd6321fb0 = UnicodeUTF8::to_decimal(htmlentities($pd6321fb0)); $v7c627adb6d->addAttribute($v5e45ec9bb9, $pd6321fb0); } self::f1221a24063($v7c627adb6d, isset($v342a134247["childs"]) ? $v342a134247["childs"] : null, $v5d3813882f); } } } public function getNodeValue($v7bb23e0d9e = "", $paf1bc6f6 = false, $v8a4df75785 = 0) { $v50d32a6fc4 = $this->getNodes($v7bb23e0d9e, $paf1bc6f6, true); $v342a134247 = isset($v50d32a6fc4[$v8a4df75785]) ? $v50d32a6fc4[$v8a4df75785] : null; return $v342a134247 ? $v342a134247->getValue() : ""; } public function getNodes($v7bb23e0d9e = "", $paf1bc6f6 = false, $pec2e10b1 = false) { $pf72c1d58 = $this->f681b55a862($v7bb23e0d9e, $this->v539082ff30); $v50d32a6fc4 = array(); $pc37695cb = count($pf72c1d58); for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v342a134247 = $this->md94733301fef($v43dd7d0051, $pf72c1d58); if($v342a134247 && $v342a134247->checkAttributes($paf1bc6f6)) { $v50d32a6fc4[] = $pec2e10b1 ? $v342a134247 : $pf72c1d58[$v43dd7d0051]; } } return $v50d32a6fc4; } private function f681b55a862($v7bb23e0d9e = false, $v539082ff30, $v605746901b = -1) { $v0af67f418a = ""; $pb0dc2e08 = false; $pa6afda51 = false; $pc38b4016 = false; $v57a9807e67 = explode("/", $v7bb23e0d9e); $pc37695cb = count($v57a9807e67); for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pbfa01ed1 = $v57a9807e67[$v43dd7d0051]; if($pbfa01ed1 && $v43dd7d0051 > $v605746901b) { $v605746901b = $v43dd7d0051; $v04fae7df44 = explode("[", $pbfa01ed1); $v0af67f418a = $v04fae7df44[0]; $pb4c3a5f1 = !empty($v04fae7df44[1]) ? explode("]", $v04fae7df44[1]) : false; $pb4c3a5f1 = $pb4c3a5f1 && trim($pb4c3a5f1[0]) ? trim($pb4c3a5f1[0]) : false; if(is_numeric($pb4c3a5f1)) { $pb0dc2e08 = $pb4c3a5f1 - 1; } elseif($pb4c3a5f1) { $pa6afda51 = $this->md408aa0e423f($pb4c3a5f1); } for($v9d27441e80 = $v43dd7d0051 + 1; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { if($v57a9807e67[$v9d27441e80]) { $pc38b4016 = true; break; } } break; } } if(!$v0af67f418a) { return $v539082ff30; } $v50d32a6fc4 = array(); if(!empty($v539082ff30[ $v0af67f418a ])) { $pf72c1d58 = $v539082ff30[ $v0af67f418a ]; $pc37695cb = count($pf72c1d58); for($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v342a134247 = is_numeric($pb0dc2e08) ? (isset($pf72c1d58[$pb0dc2e08]) ? $pf72c1d58[$pb0dc2e08] : null) : $pf72c1d58[$v43dd7d0051]; $v28c1cd997a = $pa6afda51 ? $this->mb81f4d883413($v342a134247, $pa6afda51) : true; if($v28c1cd997a) { if($pc38b4016) { $pc4222023 = isset($v342a134247["childs"]) ? $v342a134247["childs"] : null; if($pc4222023) { $v29680e12e6 = $this->f681b55a862($v7bb23e0d9e, $pc4222023, $v605746901b); $pd28479e5 = count($v29680e12e6); for($v9d27441e80 = 0; $v9d27441e80 < $pd28479e5; $v9d27441e80++) { $v50d32a6fc4[] = $v29680e12e6[$v9d27441e80]; } } } else { $v50d32a6fc4[] = $v342a134247; } } if(is_numeric($pb0dc2e08)) { break; } } } return $v50d32a6fc4; } private function md94733301fef($v8a4df75785 = 0, $v539082ff30 = false) { $v539082ff30 = $this->me515f5ef689e($v539082ff30); $v700315c4d3 = !empty($v539082ff30[$v8a4df75785]) ? $v539082ff30[$v8a4df75785] : false; if($v700315c4d3) { $v342a134247 = new MyXMLArrayItem($v700315c4d3); return $v342a134247; } return false; } private function me515f5ef689e($v539082ff30) { $v539082ff30 = $v539082ff30 ? $v539082ff30 : $this->v539082ff30; return is_array($v539082ff30) ? $v539082ff30 : array(); } private function mb81f4d883413($v6694236c2c, $pa6afda51) { $v6b311ec738 = ""; $pc37695cb = $pa6afda51 ? count($pa6afda51) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pb4c3a5f1 = $pa6afda51[$v43dd7d0051]; $pca686389 = isset($pb4c3a5f1["type"]) ? $pb4c3a5f1["type"] : null; $pd40b8cdb = isset($pb4c3a5f1["value"]) ? $pb4c3a5f1["value"] : null; if ($pca686389 == "node_or_attr") { $v43b58f382a = isset($pb4c3a5f1["name"]) ? $pb4c3a5f1["name"] : null; $v501c780e15 = isset($pb4c3a5f1["operator"]) ? $pb4c3a5f1["operator"] : null; $v6b311ec738 .= "\$v6694236c2c[\"@\"][\"".$v43b58f382a."\"] ".$v501c780e15." ".$pd40b8cdb; } else { $v6b311ec738 .= " ".$pd40b8cdb." "; } } if($v6b311ec738) { try { $v6b311ec738 = "\$v5c1c342594 = (".$v6b311ec738.") ? true : false;"; eval($v6b311ec738); return $v5c1c342594; } catch(Exception $paec2c009) { return false; } } return true; } private function md408aa0e423f($pb4c3a5f1) { $paf1bc6f6 = array(); $v3f34ce89e7 = '/(((@?)([\w\-\+]+)(\s*)(=|==|\\!=|<>|<=|>=|<|>)(\s*)([0-9]+))|((@?)([\w\-\+]+)(\s*)(=|==|\\!=|<>|<=|>=|<|>)(\s*)((?<!\\\\)\')(([^\']*)(((?<=\\\\)\')*)([^\']*))((?<!\\\\)\'))|((@?)([\w\-\+]+)(\s*)(=|==|\\!=|<>|<=|>=|<|>)(\s*)((?<!\\\\)")(([^"]*)(((?<=\\\\)")*)([^"]*))((?<!\\\\)"))|((\s*)(or|and|&&|\|\||\(|\))*(\s*)))/iu'; $v08ab3c4fb0 = '/(@?)([\w\-\+]+)(\s*)(=|==|\\!=|<>|<=|>=|<|>)(\s*)(.*)/u'; preg_match_all($v3f34ce89e7, $pb4c3a5f1, $pbae7526c); $pbae7526c = isset($pbae7526c[1]) ? $pbae7526c[1] : null; $pc37695cb = is_array($pbae7526c) ? count($pbae7526c) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v87ae7286da = $pbae7526c[$v43dd7d0051]; preg_match_all($v08ab3c4fb0, $v87ae7286da, $pcd395670); if (!empty($pcd395670[0])) { $pbad9fa7d = $pcd395670[1][0] == "@"; $pd6f1e780 = $pcd395670[2][0]; $v9d6f7f0674 = $pcd395670[4][0] == "=" ? "==" : $pcd395670[4][0]; $v84e76dfbbc = $pcd395670[6][0]; if(!$pbad9fa7d) { if(function_exists("launch_exception")) { launch_exception(new MyXMLArrayException(1, $pd6f1e780)); } else { throw new MyXMLArrayException(1, $pd6f1e780); } return false; } $paf1bc6f6[] = array("type" => "node_or_attr", "name" => $pd6f1e780, "operator" => $v9d6f7f0674, "value" => $v84e76dfbbc); } else { $v87ae7286da = strtolower(trim($v87ae7286da)); if(count($paf1bc6f6) && ($v87ae7286da == "and" || $v87ae7286da == "&&" || $v87ae7286da == "or" || $v87ae7286da == "||")) { $v87ae7286da = $v87ae7286da == "and" ? "&&" : ($v87ae7286da == "or" ? "||" : $v87ae7286da); $paf1bc6f6[] = array("type" => "gate", "value" => $v87ae7286da); } else if($v87ae7286da == "(" || $v87ae7286da == ")") { $paf1bc6f6[] = array("type" => "separator", "value" => $v87ae7286da); } else if($v87ae7286da) { if(function_exists("launch_exception")) { launch_exception(new MyXMLArrayException(2, $v87ae7286da)); } else { throw new MyXMLArrayException(2, $v87ae7286da); } return false; } } } return $paf1bc6f6; } } ?>
