<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once get_lib("org.phpframework.util.text.TextSanitizer"); class CssAndJSFilesOptimizer { const CURL_CONNECTION_TIMEOUT_SECS = 30; const CURL_MAX_HOST_CHUNK_REQUESTS = 10; private $v4bf8d90f04 = null; private $pfce4d1b3 = null; private $v30857f7eca = null; public function __construct($v4bf8d90f04, $pfce4d1b3, $v30857f7eca = null) { $this->v4bf8d90f04 = $v4bf8d90f04; $this->pfce4d1b3 = $pfce4d1b3; $this->v30857f7eca = $v30857f7eca ? $v30857f7eca : array(); if (!empty($this->v30857f7eca["urls_prefix"]) && !is_array($this->v30857f7eca["urls_prefix"])) $this->v30857f7eca["urls_prefix"] = array($this->v30857f7eca["urls_prefix"]); if (!empty($this->v30857f7eca["url_strings_to_avoid"]) && !is_array($this->v30857f7eca["url_strings_to_avoid"])) $this->v30857f7eca["url_strings_to_avoid"] = array($this->v30857f7eca["url_strings_to_avoid"]); } public function getCssAndJSFilesHtml($pa0ca8d24, $v7c2b1a70d1) { $v7c0a4872f9 = $v2012db502b = array(); if ($pa0ca8d24) foreach ($pa0ca8d24 as $pa32be502 => $v6f3a2700dd) { $pa32be502 = trim($pa32be502); if ($pa32be502 && file_exists($pa32be502)) { $pa32be502 = realpath($pa32be502); $v6f3a2700dd = self::ma3bdd2d49830($v6f3a2700dd); $v7c0a4872f9[$pa32be502] = $v6f3a2700dd; } } if ($v7c2b1a70d1) foreach ($v7c2b1a70d1 as $pa32be502 => $v6f3a2700dd) { $pa32be502 = trim($pa32be502); if ($pa32be502 && file_exists($pa32be502)) { $pa32be502 = realpath($pa32be502); $v6f3a2700dd = self::ma3bdd2d49830($v6f3a2700dd); $v2012db502b[$pa32be502] = $v6f3a2700dd; } } $pf8ed4912 = ""; if ($this->v4bf8d90f04 && $this->pfce4d1b3) { if ($v7c0a4872f9) { $v1a1ba767a8 = md5(json_encode($v7c0a4872f9)); $v04e9f7c90d = $this->v4bf8d90f04 . "/$v1a1ba767a8.css"; $v5c1c342594 = true; if (!file_exists($v04e9f7c90d)) { $v8c2ac697ee = ""; foreach ($v7c0a4872f9 as $pa32be502 => $v6f3a2700dd) { $v805e4dc79b = file_get_contents($pa32be502); $v805e4dc79b = self::f75ff63ea38($v805e4dc79b, $v6f3a2700dd); $v8c2ac697ee .= $v805e4dc79b . "\n"; } $v8c2ac697ee = trim($v8c2ac697ee); if ($v8c2ac697ee) { if (!is_dir($this->v4bf8d90f04)) mkdir($this->v4bf8d90f04, 0755, true); $v5c1c342594 = file_put_contents($v04e9f7c90d, $v8c2ac697ee) !== false; } } if (file_exists($v04e9f7c90d)) { $pf8ed4912 .= '<link rel="stylesheet" href="' . $this->pfce4d1b3 . "/$v1a1ba767a8.css" . '" type="text/css" />'; $v7c0a4872f9 = null; } } if ($v2012db502b) { $v1a1ba767a8 = md5(json_encode($v2012db502b)); $v04e9f7c90d = $this->v4bf8d90f04 . "/$v1a1ba767a8.js"; $v98e186aef2 = $this->v4bf8d90f04 . "/$v1a1ba767a8.urls"; $v5c1c342594 = true; if (!file_exists($v04e9f7c90d) || !file_exists($v98e186aef2)) { $v8c2ac697ee = ""; $pb2a3303e = array(); foreach ($v2012db502b as $pa32be502 => $v6f3a2700dd) { $v805e4dc79b = file_get_contents($pa32be502); if (self::f1ae16ed3a7($v805e4dc79b)) { $v805e4dc79b = self::f8c3996caff($v805e4dc79b, $v6f3a2700dd); $v8c2ac697ee .= $v805e4dc79b . "\n"; $pb2a3303e[] = $v6f3a2700dd; } } $v8c2ac697ee = trim($v8c2ac697ee); if ($v8c2ac697ee) { if (!is_dir($this->v4bf8d90f04)) mkdir($this->v4bf8d90f04, 0755, true); $v5c1c342594 = file_put_contents($v04e9f7c90d, $v8c2ac697ee) !== false; if ($v5c1c342594) $v5c1c342594 = file_put_contents($v98e186aef2, json_encode($pb2a3303e)) !== false; } } else $pb2a3303e = json_decode(file_get_contents($v98e186aef2), true); if (file_exists($v04e9f7c90d)) { $pf8ed4912 .= '<script language="javascript" type="text/javascript" src="' . $this->pfce4d1b3 . "/$v1a1ba767a8.js" . '"></script>'; $v2012db502b = array_diff($v2012db502b, $pb2a3303e); } } } if ($v7c0a4872f9) { $padd99f4f = array(""); $pd69fb7d0 = 0; $v9a8b7dc209 = 0; foreach ($v7c0a4872f9 as $v6f3a2700dd) if (trim($v6f3a2700dd)) { $padd99f4f[$pd69fb7d0] .= '@import url("' . $v6f3a2700dd . '");' . "\n"; if ($v9a8b7dc209 > 30) $pd69fb7d0++; $v9a8b7dc209++; } $pc37695cb = count($padd99f4f); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) if ($padd99f4f[$v43dd7d0051]) $pf8ed4912 .= '<style type="text/css">' . $padd99f4f[$v43dd7d0051] . '</style>' . "\n"; } if ($v2012db502b) foreach ($v2012db502b as $v6f3a2700dd) if (trim($v6f3a2700dd)) $pf8ed4912 .= '<script language="javascript" type="text/javascript" src="' . $v6f3a2700dd . '"></script>' . "\n"; return $pf8ed4912; } public function prepareHtmlWithOptimizedCssAndJSFiles($pf8ed4912, $pd3040ec3 = true) { if ($pf8ed4912) { if ($pd3040ec3 && $this->v4bf8d90f04) { $pbee67690 = md5($pf8ed4912); $pf3dc0762 = $this->v4bf8d90f04 . "/$pbee67690.html"; if (file_exists($pf3dc0762)) { $v3ff757a876 = file_get_contents($pf3dc0762); if (trim($v3ff757a876)) return $v3ff757a876; } $pf8ed4912 = $this->f5b160c4636($pf8ed4912); if (!is_dir($this->v4bf8d90f04)) mkdir($this->v4bf8d90f04, 0755, true); file_put_contents($pf3dc0762, $pf8ed4912); } else $pf8ed4912 = $this->f5b160c4636($pf8ed4912); } return $pf8ed4912; } private function f5b160c4636($pf8ed4912) { $pe2ae3be9 = strlen($pf8ed4912); $v79b7cb19d1 = $v66327139f0 = $pfe47f27e = $v6d755726a2 = $v43364fc17e = $pcac2c71c = $v5e9a24407a = false; $v5c57fb7f2a = $pa30ea55e = $pa611ba0b = $v5e3a4ea91f = $v859d647c1e = $v3ab2a0de12 = null; $v53b6dc805a = $v2ce6dc7e1f = $v0aa8b50da1 = array(); $v3ff757a876 = $pf8ed4912; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pc288256e = $pf8ed4912[$v43dd7d0051]; if ($pc288256e == '"' && !$v66327139f0 && $pfe47f27e && !TextSanitizer::isCharEscaped($pf8ed4912, $v43dd7d0051)) { $v79b7cb19d1 = !$v79b7cb19d1; if ($v79b7cb19d1) { $pbd1bc7b0 = strpos($pf8ed4912, '"', $v43dd7d0051 + 1); $v43dd7d0051 = $pbd1bc7b0 !== false ? $pbd1bc7b0 - 1 : $pe2ae3be9; } } else if ($pc288256e == "'" && !$v79b7cb19d1 && $pfe47f27e && !TextSanitizer::isCharEscaped($pf8ed4912, $v43dd7d0051)) { $v66327139f0 = !$v66327139f0; if ($v66327139f0) { $pbd1bc7b0 = strpos($pf8ed4912, "'", $v43dd7d0051 + 1); $v43dd7d0051 = $pbd1bc7b0 !== false ? $pbd1bc7b0 - 1 : $pe2ae3be9; } } else if ($pc288256e == "<" && !$v79b7cb19d1 && !$v66327139f0 && !$pfe47f27e) { if ($v43dd7d0051 + 1 < $pe2ae3be9 && preg_match("/[a-z]/i", $pf8ed4912[$v43dd7d0051 + 1])) $pfe47f27e = true; if ($v43dd7d0051 + 5 < $pe2ae3be9 && strtolower(substr($pf8ed4912, $v43dd7d0051, 5)) == "<link" && preg_match("/(\s|>)/", $pf8ed4912[$v43dd7d0051 + 5])) { $v5c57fb7f2a = $v43dd7d0051; $pa611ba0b = $v43dd7d0051 + 5; $v6d755726a2 = true; $v43dd7d0051 = $pa611ba0b - 1; } else if ($v43dd7d0051 + 6 < $pe2ae3be9 && strtolower(substr($pf8ed4912, $v43dd7d0051, 6)) == "<style" && preg_match("/(\s|>)/", $pf8ed4912[$v43dd7d0051 + 6])) { $v5c57fb7f2a = $v43dd7d0051; $pa611ba0b = $v43dd7d0051 + 6; $v43364fc17e = true; $v43dd7d0051 = $pa611ba0b - 1; } else if ($v43dd7d0051 + 7 < $pe2ae3be9 && strtolower(substr($pf8ed4912, $v43dd7d0051, 7)) == "<script" && preg_match("/(\s|>)/", $pf8ed4912[$v43dd7d0051 + 7])) { $v5c57fb7f2a = $v43dd7d0051; $pa611ba0b = $v43dd7d0051 + 7; $pcac2c71c = true; $v43dd7d0051 = $pa611ba0b - 1; } else if (substr($pf8ed4912, $v43dd7d0051, 4) == "<!--") { $pbd1bc7b0 = strpos($pf8ed4912, "\n", $v43dd7d0051); $pbd1bc7b0 = $pbd1bc7b0 !== false ? $pbd1bc7b0 : $pe2ae3be9; $v259d35fa15 = substr($pf8ed4912, $v43dd7d0051, $pbd1bc7b0 - $v43dd7d0051); if (preg_match("/<!--\s*\[\s*if/i", $v259d35fa15)) { $this->f2a3a2790d6($v3ff757a876, $v53b6dc805a, $v0aa8b50da1); $this->f2a3a2790d6($v3ff757a876, $v2ce6dc7e1f, $v0aa8b50da1); $pbd1bc7b0 = strpos($pf8ed4912, "-->", $v43dd7d0051); $v43dd7d0051 = $pbd1bc7b0 !== false ? $pbd1bc7b0 + 2 : $pe2ae3be9; } } } else if ($pc288256e == ">" && !$v79b7cb19d1 && !$v66327139f0 && !$pfe47f27e && $v5e9a24407a && ($v43364fc17e || $pcac2c71c)) { $v5e9a24407a = false; $v3ab2a0de12 = $v43dd7d0051; if ($pcac2c71c && !$v067674f4e4 && count($v2ce6dc7e1f)) { $v8830b9c3fd = count($v2ce6dc7e1f) - 1; $pa2afc843 = $v2ce6dc7e1f[$v8830b9c3fd]; $v2ce6dc7e1f[$v8830b9c3fd]["close_end_pos"] = $v3ab2a0de12; $v2ce6dc7e1f[$v8830b9c3fd]["html"] = substr($pf8ed4912, $pa2afc843["outter_start_pos"], ($v3ab2a0de12 + 1) - $pa2afc843["outter_start_pos"]); } $v43364fc17e = $pcac2c71c = false; } else if ($pc288256e == ">" && !$v79b7cb19d1 && !$v66327139f0 && $pfe47f27e) { $pfe47f27e = false; if ($v6d755726a2 || $v43364fc17e || $pcac2c71c) { $pa30ea55e = $v43dd7d0051; $v5e3a4ea91f = $v43dd7d0051 - 1; if (isset($pf8ed4912[$v5e3a4ea91f]) && $pf8ed4912[$v5e3a4ea91f] == "/") $v5e3a4ea91f--; $v658b8c0165 = substr($pf8ed4912, $pa611ba0b, ($v5e3a4ea91f + 1) - $pa611ba0b); if ($v6d755726a2) { $v6d755726a2 = false; $v6f3a2700dd = self::f5585f54914($v658b8c0165, "href"); $v446afd1219 = $this->f837d57d72d($v6f3a2700dd); if ($v446afd1219) { $v446afd1219 = preg_match("/\.css$/i", $v6f3a2700dd); if ($v446afd1219) { $v50af098176 = self::f5585f54914($v658b8c0165, "media"); $v16eb00c1d7 = self::f5585f54914($v658b8c0165, "rel"); $v3fb9f41470 = self::f5585f54914($v658b8c0165, "type"); $v446afd1219 = !trim($v50af098176) || preg_match("/(screen|all)/i", $v50af098176); $v446afd1219 = $v446afd1219 && (!trim($v16eb00c1d7) || strtolower($v16eb00c1d7) == "stylesheet"); $v446afd1219 = $v446afd1219 && (!trim($v3fb9f41470) || strtolower($v3fb9f41470) == "text/css"); if ($v446afd1219) { $pbebc8cef = self::f5585f54914($v658b8c0165, "charset"); $v446afd1219 = !trim($pbebc8cef) || preg_match("/utf8|utf-8/i", $pbebc8cef); } } } if ($v446afd1219) $v53b6dc805a[] = array( "type" => "link", "url" => $v6f3a2700dd, "outter_start_pos" => $v5c57fb7f2a, "outter_end_pos" => $pa30ea55e, "html" => substr($pf8ed4912, $v5c57fb7f2a, ($pa30ea55e + 1) - $v5c57fb7f2a), ); else $this->f2a3a2790d6($v3ff757a876, $v53b6dc805a, $v0aa8b50da1); } else if ($v43364fc17e) { $pbd1bc7b0 = stripos($pf8ed4912, "</style", $pa30ea55e + 1); $v859d647c1e = $pbd1bc7b0 ? $pbd1bc7b0 : $pe2ae3be9; $v43dd7d0051 = $pbd1bc7b0 ? $pbd1bc7b0 + 7 - 1 : $pe2ae3be9; $v5e9a24407a = true; $v067674f4e4 = trim(substr($pf8ed4912, $pa30ea55e + 1, $v859d647c1e - ($pa30ea55e + 1))); if ($v067674f4e4) $this->f2a3a2790d6($v3ff757a876, $v53b6dc805a, $v0aa8b50da1); } else if ($pcac2c71c) { $pbd1bc7b0 = stripos($pf8ed4912, "</script", $pa30ea55e + 1); $v859d647c1e = $pbd1bc7b0 ? $pbd1bc7b0 : $pe2ae3be9; $v43dd7d0051 = $pbd1bc7b0 ? $pbd1bc7b0 + 8 - 1 : $pe2ae3be9; $v5e9a24407a = true; $v067674f4e4 = trim(substr($pf8ed4912, $pa30ea55e + 1, $v859d647c1e - ($pa30ea55e + 1))); if ($v067674f4e4) $this->f2a3a2790d6($v3ff757a876, $v2ce6dc7e1f, $v0aa8b50da1); else { $v6f3a2700dd = self::f5585f54914($v658b8c0165, "src"); $v446afd1219 = $this->f837d57d72d($v6f3a2700dd); if ($v446afd1219) $v2ce6dc7e1f[] = array( "type" => "script", "url" => $v6f3a2700dd, "outter_start_pos" => $v5c57fb7f2a, "outter_end_pos" => $pa30ea55e, "close_start_pos" => $v859d647c1e, "close_end_pos" => null, "html" => null, ); else $this->f2a3a2790d6($v3ff757a876, $v2ce6dc7e1f, $v0aa8b50da1); } } } } } $this->f2a3a2790d6($v3ff757a876, $v53b6dc805a, $v0aa8b50da1); $this->f2a3a2790d6($v3ff757a876, $v2ce6dc7e1f, $v0aa8b50da1); if ($v0aa8b50da1) foreach ($v0aa8b50da1 as $v342a134247) if (!empty($v342a134247["html"])) $v3ff757a876 = str_replace($v342a134247["html"], "", $v3ff757a876); return $v3ff757a876; } private function f5585f54914($v658b8c0165, $v5e45ec9bb9) { $pe2ae3be9 = strlen($v658b8c0165); $v79b7cb19d1 = $v66327139f0 = $v17dca0865a = false; $v4430104888 = $pbaeb17fb = null; $pbdd1ceb6 = strlen($v5e45ec9bb9); $pff5830e4 = $pbdd1ceb6 ? strtolower($v5e45ec9bb9[0]) : ""; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pc288256e = $v658b8c0165[$v43dd7d0051]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isCharEscaped($v658b8c0165, $v43dd7d0051)) { $v79b7cb19d1 = !$v79b7cb19d1; if ($v79b7cb19d1) { if ($v17dca0865a) $v4430104888 = $v43dd7d0051 + 1; $pbd1bc7b0 = strpos($v658b8c0165, '"', $v43dd7d0051 + 1); $v43dd7d0051 = $pbd1bc7b0 !== false ? $pbd1bc7b0 - 1 : $pe2ae3be9; } else if ($v17dca0865a && !$v79b7cb19d1) { $pbaeb17fb = $v43dd7d0051 - 1; break; } } else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isCharEscaped($v658b8c0165, $v43dd7d0051)) { $v66327139f0 = !$v66327139f0; if ($v66327139f0) { if ($v17dca0865a) $v4430104888 = $v43dd7d0051 + 1; $pbd1bc7b0 = strpos($v658b8c0165, "'", $v43dd7d0051 + 1); $v43dd7d0051 = $pbd1bc7b0 !== false ? $pbd1bc7b0 - 1 : $pe2ae3be9; } else if ($v17dca0865a && !$v66327139f0){ $pbaeb17fb = $v43dd7d0051 - 1; break; } } else if ($pc288256e == $pff5830e4 && !$v79b7cb19d1 && !$v66327139f0 && strtolower(substr($v658b8c0165, $v43dd7d0051, $pbdd1ceb6)) == $v5e45ec9bb9 && isset($v658b8c0165[$v43dd7d0051 + $pbdd1ceb6]) && preg_match("/(\s|=)/", $v658b8c0165[$v43dd7d0051 + $pbdd1ceb6])) $v17dca0865a = true; } if (is_numeric($v4430104888)) { $pbaeb17fb = is_numeric($pbaeb17fb) ? $pbaeb17fb + 1 : $pe2ae3be9; return substr($v658b8c0165, $v4430104888, $pbaeb17fb - $v4430104888); } return ""; } private function f2a3a2790d6(&$pf8ed4912, &$pf72c1d58, &$v0aa8b50da1) { $pabf99c91 = count($pf72c1d58); if ($pabf99c91 > 1) { $v970893ce20 = $this->f4d05a74fcc($pf72c1d58); if ($v970893ce20) { $v6bfcc44e7b = isset($pf72c1d58[0]["type"]) && $pf72c1d58[0]["type"] == "link" ? "css" : "js"; foreach ($v970893ce20 as $peb6501c6) { $v446afd1219 = isset($peb6501c6["valid"]) ? $peb6501c6["valid"] : null; if ($v446afd1219) { $pfe52f392 = isset($peb6501c6["items"]) ? $peb6501c6["items"] : null; $pe4342c65 = isset($peb6501c6["urls"]) ? $peb6501c6["urls"] : null; $pde09f40b = isset($peb6501c6["all_files_url"]) ? $peb6501c6["all_files_url"] : null; $v3561c1653f = $v6bfcc44e7b == "css" ? '<link rel="stylesheet" type="text/css" href="' . $pde09f40b . '" />' : '<script language="javascript" type="text/javascript" src="' . $pde09f40b . '"></script>'; foreach ($pfe52f392 as $pe4981367) if (!empty($pe4981367["html"])) { $pbd1bc7b0 = strpos($pf8ed4912, $pe4981367["html"]); if ($pbd1bc7b0 !== false) { $pf8ed4912 = substr($pf8ed4912, 0, $pbd1bc7b0) . $v3561c1653f . substr($pf8ed4912, $pbd1bc7b0); $v0aa8b50da1 = array_merge($v0aa8b50da1, $pfe52f392); } break; } } } } } $pf72c1d58 = array(); } private function f4d05a74fcc($pf72c1d58) { if ($this->v4bf8d90f04) { $pbee67690 = md5(json_encode($pf72c1d58)); $pf3dc0762 = $this->v4bf8d90f04 . "/$pbee67690.groups"; if (file_exists($pf3dc0762)) { $v90096dca13 = json_decode(file_get_contents($pf3dc0762), true); if ($v90096dca13) return $v90096dca13; } $v970893ce20 = $this->ma5073e0f6793($pf72c1d58); if (!is_dir($this->v4bf8d90f04)) mkdir($this->v4bf8d90f04, 0755, true); file_put_contents($pf3dc0762, json_encode($v970893ce20)); } else $v970893ce20 = $this->ma5073e0f6793($pf72c1d58); return $v970893ce20; } private function ma5073e0f6793($pf72c1d58) { $pdc0d866f = array(); if ($pf72c1d58) { $v6bfcc44e7b = isset($pf72c1d58[0]["type"]) && $pf72c1d58[0]["type"] == "link" ? "css" : "js"; $pe4342c65 = array(); foreach ($pf72c1d58 as $pd69fb7d0 => $v342a134247) { $v6f3a2700dd = isset($v342a134247["url"]) ? trim($v342a134247["url"]) : ""; if ($v6f3a2700dd) $pe4342c65[$pd69fb7d0] = $v6f3a2700dd; } if (!is_dir($this->v4bf8d90f04)) mkdir($this->v4bf8d90f04, 0755, true); $v539082ff30 = self::f150934d881($pe4342c65, self::CURL_CONNECTION_TIMEOUT_SECS, self::CURL_MAX_HOST_CHUNK_REQUESTS); $pcb574175 = array(); $v8a0e61fbc8 = array(); $v4e9f92239b = array(); $v8c2ac697ee = ""; if ($v539082ff30) foreach ($v539082ff30 as $v04abdc18c8) { $v6f3a2700dd = isset($v04abdc18c8["url"]) ? $v04abdc18c8["url"] : null; $pcb574175[$v6f3a2700dd] = $v04abdc18c8; } foreach ($pf72c1d58 as $pd69fb7d0 => $v342a134247) { $v6f3a2700dd = $pe4342c65[$pd69fb7d0]; $v446afd1219 = false; if ($v6f3a2700dd) { $v04abdc18c8 = isset($pcb574175[$v6f3a2700dd]) ? $pcb574175[$v6f3a2700dd] : null; if ($v04abdc18c8 && empty($v04abdc18c8["error"]) && isset($v04abdc18c8["info"]["http_code"]) && $v04abdc18c8["info"]["http_code"] == 200) { $pae77d38c = isset($v04abdc18c8["content"]) ? trim($v04abdc18c8["content"]) : ""; $v446afd1219 = !empty($pae77d38c); $v805e4dc79b = "/*** File: $v6f3a2700dd ***/"; $v805e4dc79b .= $pae77d38c; if ($v6bfcc44e7b == "css") $v805e4dc79b = self::f75ff63ea38($v805e4dc79b, $v6f3a2700dd); else { $v446afd1219 = self::f1ae16ed3a7($v805e4dc79b); if ($v446afd1219) $v805e4dc79b = self::f8c3996caff($v805e4dc79b, $v6f3a2700dd); } } } if ($v446afd1219) { $v8c2ac697ee .= $v805e4dc79b . "\n"; $v8a0e61fbc8[] = $v6f3a2700dd; $v4e9f92239b[] = $v342a134247; } else if ($v8c2ac697ee) { $v02a79e444b = md5(json_encode($v8a0e61fbc8)); $v5a2a51d6d8 = $this->v4bf8d90f04 . "/" . $v02a79e444b . ".$v6bfcc44e7b"; $v5c1c342594 = file_put_contents($v5a2a51d6d8, $v8c2ac697ee) !== false; if ($v5c1c342594) { $pdc0d866f[] = array( "valid" => true, "items" => $v4e9f92239b, "urls" => $v8a0e61fbc8, "all_files_url" => $this->pfce4d1b3 . "/$v02a79e444b.$v6bfcc44e7b", ); $pdc0d866f[] = array( "valid" => false, "items" => array($v342a134247), "urls" => array($v6f3a2700dd), ); $v8c2ac697ee = ""; $v8a0e61fbc8 = array(); $v4e9f92239b = array(); } else return false; } } if ($v8c2ac697ee) { $v02a79e444b = md5(json_encode($v8a0e61fbc8)); $v5a2a51d6d8 = $this->v4bf8d90f04 . "/" . $v02a79e444b . ".$v6bfcc44e7b"; $v5c1c342594 = file_put_contents($v5a2a51d6d8, $v8c2ac697ee) !== false; if ($v5c1c342594) { $pdc0d866f[] = array( "valid" => true, "items" => $v4e9f92239b, "urls" => $v8a0e61fbc8, "all_files_url" => $this->pfce4d1b3 . "/$v02a79e444b.$v6bfcc44e7b", ); } else return false; } } return $pdc0d866f; } public function prepareHtmlWithOptimizedCssAndJSFilesViaDomHandler($pf8ed4912) { $v8d1f503e9f = !empty($this->v30857f7eca["encoding"]) ? $this->v30857f7eca["encoding"] : "utf-8"; $v335d5577bf = new HtmlDomHandler($pf8ed4912, $v8d1f503e9f); if ($v335d5577bf->isHTML()) { $v4a81532cb9 = $v335d5577bf->getDOMDocument(); $v50d32a6fc4 = $v4a81532cb9->childNodes; self::f935047dc42($v4a81532cb9, $v50d32a6fc4); $pf8ed4912 = $v335d5577bf->getHtml(); } return $pf8ed4912; } private function f935047dc42($v4a81532cb9, $v50d32a6fc4, &$v74a7ce50ce = array(), &$v86594302f6 = array(), $pf9851a9c = 0) { if ($v50d32a6fc4) { $pe2ae3be9 = $v50d32a6fc4->count(); $v6b8addb2d5 = array(); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $v6694236c2c = $v50d32a6fc4->item($v43dd7d0051); $v68e994bbc0 = strtolower($v6694236c2c->nodeName); if ($v68e994bbc0 == "link") { $v6f3a2700dd = trim($v6694236c2c->getAttribute("href")); $v446afd1219 = $this->f837d57d72d($v6f3a2700dd); if ($v446afd1219) $v74a7ce50ce[] = $v6694236c2c; else $this->f6ca68020a2($v4a81532cb9, $v74a7ce50ce, $v6b8addb2d5); } else if ($v68e994bbc0 == "style") { $v067674f4e4 = trim($v6694236c2c->textContent); if ($v067674f4e4) $this->f6ca68020a2($v4a81532cb9, $v74a7ce50ce, $v6b8addb2d5); } else if ($v68e994bbc0 == "script") { $v067674f4e4 = trim($v6694236c2c->textContent); if ($v067674f4e4) $this->mf20891824899($v4a81532cb9, $v86594302f6, $v6b8addb2d5); else { $v6f3a2700dd = trim($v6694236c2c->getAttribute("src")); $v446afd1219 = $this->f837d57d72d($v6f3a2700dd); if ($v446afd1219) $v86594302f6[] = $v6694236c2c; else $this->mf20891824899($v4a81532cb9, $v86594302f6, $v6b8addb2d5); } } else if ($v6694236c2c->hasChildNodes()) $this->f935047dc42($v4a81532cb9, $v6694236c2c->childNodes, $v74a7ce50ce, $v86594302f6, $pf9851a9c + 1); } if ($pf9851a9c == 0) { $this->f6ca68020a2($v4a81532cb9, $v74a7ce50ce, $v6b8addb2d5); $this->mf20891824899($v4a81532cb9, $v86594302f6, $v6b8addb2d5); } if ($v6b8addb2d5) foreach ($v6b8addb2d5 as $v6694236c2c) { $parent = $v6694236c2c->parentNode; $parent->removeChild($v6694236c2c); } } } private function f6ca68020a2($v4a81532cb9, &$v74a7ce50ce, &$v6b8addb2d5) { $pabf99c91 = count($v74a7ce50ce); if ($pabf99c91 > 1) { $v401491fc94 = $this->mb86107ba3361($v74a7ce50ce, $v6b8addb2d5); if ($v401491fc94) { $v948cbcb5c1 = $v4a81532cb9->createElement("link"); $v948cbcb5c1->setAttribute("rel", "stylesheet"); $v948cbcb5c1->setAttribute("type", "text/css"); $v948cbcb5c1->setAttribute("href", $v401491fc94); $v5602f62e86 = isset($v74a7ce50ce[0]) ? $v74a7ce50ce[0] : null; $parent = $v5602f62e86->parentNode; $parent->insertBefore($v948cbcb5c1, $v5602f62e86); } } $v74a7ce50ce = array(); } private function mf20891824899($v4a81532cb9, &$v86594302f6, &$v6b8addb2d5) { $pabf99c91 = count($v86594302f6); if ($pabf99c91 > 1) { $v401491fc94 = $this->mb86107ba3361($v86594302f6, $v6b8addb2d5); if ($v401491fc94) { $v948cbcb5c1 = $v4a81532cb9->createElement("script"); $v948cbcb5c1->setAttribute("language", "javascript"); $v948cbcb5c1->setAttribute("type", "text/javascript"); $v948cbcb5c1->setAttribute("src", $v401491fc94); $v5602f62e86 = isset($v86594302f6[0]) ? $v86594302f6[0] : null; $parent = $v5602f62e86->parentNode; $parent->insertBefore($v948cbcb5c1, $v5602f62e86); } } $v86594302f6 = array(); } private function mb86107ba3361($v50d32a6fc4, &$v6b8addb2d5) { if ($v50d32a6fc4) { $v6bfcc44e7b = isset($v50d32a6fc4[0]) && strtolower($v50d32a6fc4[0]->nodeName) == "link" ? "css" : "js"; $pe4342c65 = array(); foreach ($v50d32a6fc4 as $pd69fb7d0 => $v6694236c2c) { $v6f3a2700dd = trim($v6694236c2c->getAttribute($v6bfcc44e7b == "css" ? "href" : "src")); if ($v6f3a2700dd) $pe4342c65[$pd69fb7d0] = $v6f3a2700dd; } $v1a1ba767a8 = md5(json_encode($pe4342c65)); $v04e9f7c90d = $this->v4bf8d90f04 . "/$v1a1ba767a8.$v6bfcc44e7b"; $v98e186aef2 = $this->v4bf8d90f04 . "/$v1a1ba767a8.urls"; if (!file_exists($v04e9f7c90d) || !file_exists($v98e186aef2)) { $v539082ff30 = self::f150934d881($pe4342c65, self::CURL_CONNECTION_TIMEOUT_SECS, self::CURL_MAX_HOST_CHUNK_REQUESTS); $pcb574175 = array(); $v3b8e0b4970 = array(); if ($v539082ff30) foreach ($v539082ff30 as $v04abdc18c8) { $v6f3a2700dd = isset($v04abdc18c8["url"]) ? $v04abdc18c8["url"] : null; $pcb574175[$v6f3a2700dd] = $v04abdc18c8; } $v8c2ac697ee = ""; $pba68b0e4 = array(); foreach ($v50d32a6fc4 as $pd69fb7d0 => $v6694236c2c) { $v6f3a2700dd = $pe4342c65[$pd69fb7d0]; if ($v6f3a2700dd) { $v04abdc18c8 = $pcb574175[$v6f3a2700dd]; if ($v04abdc18c8 && empty($v04abdc18c8["error"]) && isset($v04abdc18c8["info"]["http_code"]) && $v04abdc18c8["info"]["http_code"] == 200) { $pae77d38c = isset($v04abdc18c8["content"]) ? trim($v04abdc18c8["content"]) : ""; $v446afd1219 = !empty($pae77d38c); $v805e4dc79b = "/*** File: $v6f3a2700dd ***/"; $v805e4dc79b .= $pae77d38c; if ($v6bfcc44e7b == "css") $v805e4dc79b = self::f75ff63ea38($v805e4dc79b, $v6f3a2700dd); else { $v446afd1219 = self::f1ae16ed3a7($v805e4dc79b); if ($v446afd1219) $v805e4dc79b = self::f8c3996caff($v805e4dc79b, $v6f3a2700dd); } if ($v446afd1219) { $v8c2ac697ee .= $v805e4dc79b . "\n"; $v3b8e0b4970[] = $v6f3a2700dd; $pba68b0e4[] = $v6694236c2c; } } } } $v8c2ac697ee = trim($v8c2ac697ee); if ($v8c2ac697ee) { if (!is_dir(dirname($v04e9f7c90d))) mkdir(dirname($v04e9f7c90d), 0755, true); $v5c1c342594 = file_put_contents($v04e9f7c90d, $v8c2ac697ee) !== false; if ($v5c1c342594) { $v5c1c342594 = file_put_contents($v98e186aef2, json_encode($v3b8e0b4970)) !== false; if ($v5c1c342594) { $v6b8addb2d5 = array_merge($v6b8addb2d5, $pba68b0e4); return $this->pfce4d1b3 . "/$v1a1ba767a8.$v6bfcc44e7b"; } } } } else { $v959f71c97e = json_decode(file_get_contents($v98e186aef2), true); foreach ($v50d32a6fc4 as $v6694236c2c) { $v6f3a2700dd = trim($v6694236c2c->getAttribute($v6bfcc44e7b == "css" ? "href" : "src")); if ($v6f3a2700dd && in_array($v6f3a2700dd, $v959f71c97e)) $v6b8addb2d5[] = $v6694236c2c; } return $this->pfce4d1b3 . "/$v1a1ba767a8.$v6bfcc44e7b"; } } } private static function f150934d881($pe4342c65, $pfe5382a0, $v6fbd9af3e8) { $v539082ff30 = array(); $v7a4d33f68a = array(); $v7c0d95d431 = explode(":", $_SERVER["HTTP_HOST"]); $v7c0d95d431 = $v7c0d95d431[0]; foreach ($pe4342c65 as $v6f3a2700dd) if (!in_array($v6f3a2700dd, $v7a4d33f68a)) { $v7a4d33f68a[] = $v6f3a2700dd; $v1fc19b96e1 = parse_url($v6f3a2700dd, PHP_URL_HOST); $v30857f7eca = array( "url" => $v6f3a2700dd, "cookie" => $v7c0d95d431 == $v1fc19b96e1 ? $_COOKIE : null, "settings" => array( "referer" => isset($_SERVER["HTTP_REFERER"]) ? $_SERVER["HTTP_REFERER"] : null, "follow_location" => 1, "connection_timeout" => $pfe5382a0, ) ); if (!empty($_SERVER["AUTH_TYPE"]) && !empty($_SERVER["PHP_AUTH_USER"])) { $v30857f7eca["settings"]["http_auth"] = $_SERVER["AUTH_TYPE"]; $v30857f7eca["settings"]["user_pwd"] = $_SERVER["PHP_AUTH_USER"] . ":" . (isset($_SERVER["PHP_AUTH_PW"]) ? $_SERVER["PHP_AUTH_PW"] : null); } $v539082ff30[] = $v30857f7eca; } $v56a64ecb97 = new MyCurl(); $v56a64ecb97->initMultiple($v539082ff30); $v56a64ecb97->get_contents(array("wait" => true, "max_host_chunk_requests" => $v6fbd9af3e8)); $v539082ff30 = $v56a64ecb97->getData(); return $v539082ff30; } private function f837d57d72d($v6f3a2700dd) { $v42990c1bcb = isset($this->v30857f7eca["urls_prefix"]) ? $this->v30857f7eca["urls_prefix"] : null; if ($v6f3a2700dd && (stripos($v6f3a2700dd, "http://") === 0 || stripos($v6f3a2700dd, "https://") === 0) && self::f753787e68a($v6f3a2700dd, $v42990c1bcb)) { if (!empty($this->v30857f7eca["url_strings_to_avoid"])) foreach ($this->v30857f7eca["url_strings_to_avoid"] as $v327f72fb62) if (stripos($v6f3a2700dd, $v327f72fb62) !== false) return false; return true; } return false; } private static function f753787e68a($v6f3a2700dd, $v42990c1bcb) { if ($v42990c1bcb && count($v42990c1bcb) > 0) { $v6f3a2700dd = trim($v6f3a2700dd); $pe2ae3be9 = count($v42990c1bcb); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pa7bf2a5b = trim($v42990c1bcb[$v43dd7d0051]); if (!$pa7bf2a5b || substr($v6f3a2700dd, 0, strlen($pa7bf2a5b)) == $pa7bf2a5b) return true; } return false; } return true; } private static function f159ca94138($v6490ea3a15, $pd404993b) { $v69e970e17e = self::mcaa04d258164($pd404993b); $pbd1bc7b0 = -1; $v18a456ffb2 = strlen("url"); do { $pbd1bc7b0 = stripos($v6490ea3a15, "url", $pbd1bc7b0 + 1); if ($pbd1bc7b0 > 0) { $v39c74422c9 = $v6490ea3a15[$pbd1bc7b0 - 1]; $v446afd1219 = $v39c74422c9 == ":" || $v39c74422c9 == " " || $v39c74422c9 == ","; if ($v446afd1219) { if (preg_match("/^\s*\(/", substr($v6490ea3a15, $pbd1bc7b0 + $v18a456ffb2), $pbae7526c, PREG_OFFSET_CAPTURE)) { $v4430104888 = $pbae7526c[0][1] + $pbd1bc7b0 + $v18a456ffb2; $pbaeb17fb = null; $pe2ae3be9 = strlen($v6490ea3a15); $v79b7cb19d1 = $v66327139f0 = false; for ($v43dd7d0051 = $v4430104888 + 1; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pc288256e = $v6490ea3a15[$v43dd7d0051]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isCharEscaped($v6490ea3a15, $v43dd7d0051)) $v79b7cb19d1 = !$v79b7cb19d1; else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isCharEscaped($v6490ea3a15, $v43dd7d0051)) $v66327139f0 = !$v66327139f0; else if ($pc288256e == ")" && !$v79b7cb19d1 && !$v66327139f0) { $pbaeb17fb = $v43dd7d0051; break; } } if ($pbaeb17fb) { $v6f3a2700dd = trim(substr($v6490ea3a15, $v4430104888 + 1, $pbaeb17fb - ($v4430104888 + 1))); $v446afd1219 = $v6f3a2700dd && !preg_match("/^data\s*:/", $v6f3a2700dd); if ($v446afd1219) { $pff5830e4 = $v6f3a2700dd[0]; $v6f3a2700dd = $pff5830e4 == '"' || $pff5830e4 == "'" ? trim(substr($v6f3a2700dd, 1, -1)) : $v6f3a2700dd; $v446afd1219 = !preg_match("/^([a-z]+:\/\/|\/\/)/i", $v6f3a2700dd); } if ($v446afd1219) { $v401491fc94 = self::ma3bdd2d49830("$v69e970e17e/$v6f3a2700dd"); $v401491fc94 = '"' . addcslashes($v401491fc94, '"') . '"'; $v6490ea3a15 = substr($v6490ea3a15, 0, $v4430104888 + 1) . $v401491fc94 . substr($v6490ea3a15, $pbaeb17fb); $pbd1bc7b0 = $v4430104888 + strlen($v401491fc94) + 1; } else $pbd1bc7b0 = $pbaeb17fb; } else $pbd1bc7b0 = $pe2ae3be9; } } } } while($pbd1bc7b0 > 0); $pbd1bc7b0 = -1; $v18a456ffb2 = strlen("@import"); do { $pbd1bc7b0 = stripos($v6490ea3a15, "@import", $pbd1bc7b0 + 1); if ($pbd1bc7b0 !== false) { $v4430104888 = $pbd1bc7b0 + $v18a456ffb2; $pbaeb17fb = null; $pe2ae3be9 = strlen($v6490ea3a15); $v79b7cb19d1 = $v66327139f0 = false; for ($v43dd7d0051 = $v4430104888; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pc288256e = $v6490ea3a15[$v43dd7d0051]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isCharEscaped($v6490ea3a15, $v43dd7d0051)) $v79b7cb19d1 = !$v79b7cb19d1; else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isCharEscaped($v6490ea3a15, $v43dd7d0051)) $v66327139f0 = !$v66327139f0; else if ($pc288256e == ";" && !$v79b7cb19d1 && !$v66327139f0) { $pbaeb17fb = $v43dd7d0051; break; } } if ($pbaeb17fb) { $v6f3a2700dd = trim(substr($v6490ea3a15, $v4430104888, $pbaeb17fb - $v4430104888)); $v446afd1219 = $v6f3a2700dd && !preg_match("/^data\s*:/", $v6f3a2700dd); if ($v446afd1219) { $pff5830e4 = $v6f3a2700dd[0]; $v6f3a2700dd = $pff5830e4 == '"' || $pff5830e4 == "'" ? trim(substr($v6f3a2700dd, 1, -1)) : $v6f3a2700dd; $v446afd1219 = !preg_match("/^([a-z]+:\/\/|\/\/)/i", $v6f3a2700dd); } if ($v446afd1219) { $v401491fc94 = self::ma3bdd2d49830("$v69e970e17e/$v6f3a2700dd"); $v401491fc94 = ' "' . addcslashes($v401491fc94, '"') . '"'; $v6490ea3a15 = substr($v6490ea3a15, 0, $v4430104888) . $v401491fc94 . substr($v6490ea3a15, $pbaeb17fb); $pbd1bc7b0 = $v4430104888 + strlen($v401491fc94); } else $pbd1bc7b0 = $pbaeb17fb; } else $pbd1bc7b0 = $pe2ae3be9; } } while($pbd1bc7b0 !== false); return $v6490ea3a15; } private static function mcaa04d258164($v6f3a2700dd) { $v6f3a2700dd = trim($v6f3a2700dd); if ($v6f3a2700dd) { $pbd1bc7b0 = strpos($v6f3a2700dd, "?"); $v6f3a2700dd = $pbd1bc7b0 !== false ? substr($v6f3a2700dd, 0, $pbd1bc7b0) : $v6f3a2700dd; $pbd1bc7b0 = strpos($v6f3a2700dd, "#"); $v6f3a2700dd = $pbd1bc7b0 !== false ? substr($v6f3a2700dd, 0, $pbd1bc7b0) : $v6f3a2700dd; $v6f3a2700dd = trim($v6f3a2700dd); while (substr($v6f3a2700dd, -1) == "/") $v6f3a2700dd = substr($v6f3a2700dd, 0, -1); $pac65f06f = strpos($v6f3a2700dd, "://"); $pac65f06f = $pac65f06f !== false ? $pac65f06f + 3 : (substr($v6f3a2700dd, 0, 2) == "//" ? 2 : 0); $pbd1bc7b0 = strrpos($v6f3a2700dd, "/", $pac65f06f); $v6f3a2700dd = $pbd1bc7b0 !== false ? substr($v6f3a2700dd, 0, $pbd1bc7b0) : $v6f3a2700dd; while (substr($v6f3a2700dd, -1) == "/") $v6f3a2700dd = substr($v6f3a2700dd, 0, -1); $pa32be502 = substr($v6f3a2700dd, $pac65f06f); while (strpos($pa32be502, "//")) $pa32be502 = str_replace("//", "/", $pa32be502); $v6f3a2700dd = substr($v6f3a2700dd, 0, $pac65f06f) . $pa32be502 . "/"; } return $v6f3a2700dd; } private static function ma3bdd2d49830($v6f3a2700dd) { $pbd1bc7b0 = strpos($v6f3a2700dd, "?"); $pbd1bc7b0 = $pbd1bc7b0 !== false ? $pbd1bc7b0 : strpos($v6f3a2700dd, "#"); if ($pbd1bc7b0 !== false) { $v7a23f99a77 = substr($v6f3a2700dd, 0, $pbd1bc7b0); $pc4fd88da = substr($v6f3a2700dd, $pbd1bc7b0, strlen($v6f3a2700dd)); } else { $v7a23f99a77 = $v6f3a2700dd; $pc4fd88da = ""; } $pbd1bc7b0 = strpos($v7a23f99a77, "://"); if ($pbd1bc7b0 !== false) { $v41abe84754 = substr($v7a23f99a77, 0, $pbd1bc7b0 + 3); $v7a23f99a77 = substr($v7a23f99a77, $pbd1bc7b0 + 3, strlen($v7a23f99a77)); } else $v41abe84754 = ""; $v7a23f99a77 = str_replace(array("//", "/./"), "/", $v7a23f99a77); do { $v4430104888 = strpos($v7a23f99a77, "/../"); if ($v4430104888 !== false) { $pbaeb17fb = strlen($v7a23f99a77); for ($v43dd7d0051 = $v4430104888 - 1; $v43dd7d0051 >= 0; $v43dd7d0051--) { if ($v7a23f99a77[$v43dd7d0051] == "/") { $pbaeb17fb = $v43dd7d0051; break; } } $v7a23f99a77 = substr($v7a23f99a77, 0, $pbaeb17fb + 1) . substr($v7a23f99a77, $v4430104888 + 4, strlen($v7a23f99a77)); } } while ($v4430104888 !== false); $v6f3a2700dd = $v41abe84754 . $v7a23f99a77 . $pc4fd88da; return $v6f3a2700dd; } private static function f1ae16ed3a7($v40b70e70c3) { $v0048939d59 = preg_match("/\.require\s*\(/", $v40b70e70c3) || strpos($v40b70e70c3, "scripts.length") !== false; return !$v0048939d59; } private static function f75ff63ea38($v6490ea3a15, $v6f3a2700dd) { $v6490ea3a15 = trim($v6490ea3a15); $v6490ea3a15 = self::f159ca94138($v6490ea3a15, $v6f3a2700dd); $v35342cfe3d = preg_match("/.min.css$/i", $v6f3a2700dd) || preg_match("/.pack.css$/i", $v6f3a2700dd); if (!$v35342cfe3d && (strpos($v6490ea3a15, "\n") !== false || strpos($v6490ea3a15, "\r") !== false || strpos($v6490ea3a15, "/*") !== false)) { $v5d3813882f = array( "remove_single_line_comments" => false, "remove_multiple_lines_comments" => true, "remove_white_spaces" => true ); $v6490ea3a15 = self::removeCommentsAndEndLines($v6490ea3a15, $v5d3813882f, "css"); } return $v6490ea3a15; } private static function f8c3996caff($v6490ea3a15, $v6f3a2700dd) { $v6490ea3a15 = trim($v6490ea3a15); $v35342cfe3d = preg_match("/.min.js$/i", $v6f3a2700dd) || preg_match("/.pack.js$/i", $v6f3a2700dd); if (!$v35342cfe3d && (strpos($v6490ea3a15, "\n") !== false || strpos($v6490ea3a15, "\r") !== false || strpos($v6490ea3a15, "/*") !== false || strpos($v6490ea3a15, "//") !== false)) { $v5d3813882f = array( "remove_single_line_comments" => true, "remove_multiple_lines_comments" => true, "remove_white_spaces" => true ); $v6490ea3a15 = self::removeCommentsAndEndLines($v6490ea3a15, $v5d3813882f, "js"); } return $v6490ea3a15; } public static function removeCommentsAndEndLines($v6490ea3a15, $v5d3813882f, $v3fb9f41470) { if (!empty($v5d3813882f["remove_single_line_comments"]) || !empty($v5d3813882f["remove_multiple_lines_comments"]) || !empty($v5d3813882f["remove_white_spaces"])) { $v07817cb118 = TextSanitizer::mbStrSplit($v6490ea3a15); $pe2ae3be9 = count($v07817cb118); $v79b7cb19d1 = $v66327139f0 = false; $pe466c198 = ""; $v6f3e16f956 = ""; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pe2ae3be9; $v43dd7d0051++) { $pc288256e = $v07817cb118[$v43dd7d0051]; if ($pc288256e == '"' && !$v66327139f0 && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v43dd7d0051, $v07817cb118)) $v79b7cb19d1 = !$v79b7cb19d1; else if ($pc288256e == "'" && !$v79b7cb19d1 && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v43dd7d0051, $v07817cb118)) $v66327139f0 = !$v66327139f0; else if ($pc288256e == "/" && !$v79b7cb19d1 && !$v66327139f0) { $pbdb99a55 = $v07817cb118[$v43dd7d0051 + 1]; if (!empty($v5d3813882f["remove_single_line_comments"]) && $pbdb99a55 == "/") { for ($v9d27441e80 = $v43dd7d0051 + 2; $v9d27441e80 < $pe2ae3be9; $v9d27441e80++) { $v9a8b7dc209 = $v07817cb118[$v9d27441e80]; if (($v9a8b7dc209 == "\n" || $v9a8b7dc209 == "\r") && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v9d27441e80, $v07817cb118)) break; } $v43dd7d0051 = $v9d27441e80 - 1; continue 1; } else if (!empty($v5d3813882f["remove_multiple_lines_comments"]) && $pbdb99a55 == "*") { for ($v9d27441e80 = $v43dd7d0051 + 3; $v9d27441e80 < $pe2ae3be9; $v9d27441e80++) if ($v07817cb118[$v9d27441e80 - 1] == "*" && $v07817cb118[$v9d27441e80] == "/") break; $v43dd7d0051 = $v9d27441e80; continue 1; } else if ($v3fb9f41470 == "js" && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v43dd7d0051, $v07817cb118)) { $pf71bbb46 = false; for ($v9d27441e80 = $v43dd7d0051 + 1; $v9d27441e80 < $pe2ae3be9; $v9d27441e80++) { $v9a8b7dc209 = $v07817cb118[$v9d27441e80]; if ($v9a8b7dc209 == "/" && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v9d27441e80, $v07817cb118)) { $pf71bbb46 = $v9d27441e80 > $v43dd7d0051 + 1; if ($pf71bbb46) for ($pc5166886 = $v9d27441e80 + 1; $pc5166886 < $pe2ae3be9; $pc5166886++) { $v9a8b7dc209 = $v07817cb118[$pc5166886]; if (preg_match("/[a-z\.;,\)\n\r]/i", $v9a8b7dc209)) break; else if ($v9a8b7dc209 != " " && $v9a8b7dc209 != "\t") { $pf71bbb46 = false; break; } } break; } else if (($v9a8b7dc209 == "\n" || $v9a8b7dc209 == "\r") && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v9d27441e80, $v07817cb118)) break; } if ($pf71bbb46) { $v6f3e16f956 .= implode("", array_slice($v07817cb118, $v43dd7d0051, ($v9d27441e80 + 1) - $v43dd7d0051)); $pe466c198 = $v07817cb118[$v9d27441e80]; $v43dd7d0051 = $v9d27441e80; continue 1; } } } else if (!empty($v5d3813882f["remove_white_spaces"]) && preg_match("/\s/", $pc288256e) && !$v79b7cb19d1 && !$v66327139f0 && !TextSanitizer::isMBCharEscaped($v6490ea3a15, $v43dd7d0051, $v07817cb118)) { $pbdb99a55 = $v43dd7d0051 + 1 < $pe2ae3be9 ? $v07817cb118[$v43dd7d0051 + 1] : null; $v6d10db0b6a = $v3fb9f41470 == "css" ? "/[\s\(\{\};]/" : "/[\s\(\)\{\};]/"; if (!preg_match($v6d10db0b6a, $pe466c198) && !preg_match("/[\s\(\)\{\};]/", $pbdb99a55)) { $v6f3e16f956 .= " "; $pe466c198 = " "; } continue 1; } $v6f3e16f956 .= $pc288256e; $pe466c198 = $pc288256e; } $v6490ea3a15 = $v6f3e16f956; } return $v6490ea3a15; } } ?>
