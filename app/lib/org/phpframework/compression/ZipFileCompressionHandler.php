<?php
/*
 * Copyright (c) 2024 Bloxtor - http://bloxtor.com
 * 
 * Please note that this code belongs to the Bloxtor framework and must comply with the Bloxtor license.
 * If you do not accept these provisions, or if the Bloxtor License is not present or cannot be found, you are not entitled to use this code and must stop and delete it immediately.
 */
include_once get_lib("org.phpframework.compression.IFileCompressionHandler"); include_once get_lib("org.phpframework.compression.ZipHandler"); class ZipFileCompressionHandler implements IFileCompressionHandler { protected $file_pointer = null; protected $file_name = null; protected $tmp_file = null; public function __construct() { } public function open($pf3dc0762) { $this->file_pointer = new ZipArchive(); $this->file_name = basename($pf3dc0762); $this->tmp_file = tmpfile(); if ($this->file_pointer === false || !$this->file_pointer->open($pf3dc0762, ZIPARCHIVE::CREATE) || !$this->file_pointer->addFromString($this->file_name, "") || !$this->tmp_file) throw new Exception("Could not open file! Please check if the '" . $this->file_name . "' file is writeable..."); return true; } public function write($v327f72fb62) { $v8d6672117e = fwrite($this->tmp_file, $v327f72fb62); if ($v8d6672117e === false) throw new Exception("Could not write to file! Please check if you have enough free space..."); return $v8d6672117e; } public function close() { fseek($this->tmp_file, 0); $v6490ea3a15 = ""; while (!feof($this->tmp_file)) $v6490ea3a15 .= fread($this->tmp_file, 8192); fclose($this->tmp_file); $v5c1c342594 = $this->file_pointer->addFromString($this->file_name, $v6490ea3a15); if ($v5c1c342594 === false) throw new Exception("Could not write to file! Please check if you have enough free space..."); return $this->file_pointer->close(); } } ?>
