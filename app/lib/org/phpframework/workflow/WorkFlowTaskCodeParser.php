<?php
/*
 * Copyright (c) 2024 Bloxtor - http://bloxtor.com
 * 
 * Please note that this code belongs to the Bloxtor framework and must comply with the Bloxtor license.
 * If you do not accept these provisions, or if the Bloxtor License is not present or cannot be found, you are not entitled to use this code and must stop and delete it immediately.
 */
include_once get_lib("org.phpframework.workflow.WorkFlowTaskHandler"); include_once get_lib("org.phpframework.workflow.PHPParserTraverserNodeVisitor"); include_once get_lib("org.phpframework.layer.presentation.cms.CMSFileHandler"); ini_set('xdebug.max_nesting_level', 2000); class WorkFlowTaskCodeParser { private $pecad7cca; private $v524bbc0f84; private $pb59a7c0b; private $v9362c1426c; private $v969a81b996; private $v683170574f; private $v5f04ef1cc1; private $v690fc6799d; private $v052656e632; private $pe44fc027; public $shared_objects; public function __construct($pecad7cca) { $this->pecad7cca = $pecad7cca; $pf1d2e1d9 = new PhpParser\Parser\Php5(new PhpParser\Lexer\Emulative); $v3c085bda5f = new PhpParser\Parser\Php7(new PhpParser\Lexer\Emulative); $this->v5f04ef1cc1 = new PhpParser\Parser\Multiple(array($pf1d2e1d9, $v3c085bda5f)); $this->v690fc6799d = new PhpParser\NodeTraverser; $this->v052656e632 = new PHPParserPrettyPrinter(); $this->v052656e632->disableNoIndentToken(); $this->v690fc6799d->addVisitor(new PHPParserTraverserNodeVisitor); $this->init(); } public function init() { if (empty($this->pecad7cca->getLoadedTasksSettings())) { $this->pecad7cca->initWorkFlowTasks(); } $this->v524bbc0f84 = $this->pecad7cca->getLoadedTasksSettings(); $this->pb59a7c0b = $this->f009b48d5e5(); $this->v9362c1426c = $this->f263086ba76(); $this->v969a81b996 = $this->f6a928e8c37(); $this->v683170574f = $this->mda55dcfa15af(); $this->pe44fc027 = $this->pecad7cca->getTasksByTag("code", 1); $this->pe44fc027 = $this->pe44fc027 && isset($this->pe44fc027[0]) ? $this->pe44fc027[0] : null; $this->shared_objects = array(); } public function getParsedCodeAsXml($v067674f4e4) { $v1d696dbd12 = $this->getParsedCodeAsArray($v067674f4e4); $pa694ba99 = new MyXMLArray($v1d696dbd12); $v241205aec6 = $pa694ba99->toXML(array("lower_case_keys" => true, "prefix_tab" => "\t")); $v241205aec6 = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<tasks>" . $v241205aec6 . "\n</tasks>"; return $v241205aec6; } public function getParsedCodeAsArray($v067674f4e4) { $v793f92423d = $this->v5f04ef1cc1->parse($v067674f4e4); $v793f92423d = $this->v690fc6799d->traverse($v793f92423d); $v6f3463dea9 = WorkFlowTask::createTasksPropertiesFromCodeStmts($v793f92423d, $this); $v6f3463dea9 = $this->cleanInvalidExitsFromTasks($v6f3463dea9); $v02b1baa17a = 1; if (!empty($v6f3463dea9[0])) { $v6f3463dea9[0]["start"] = $v02b1baa17a; } $v6f3463dea9 = array("task" => $v6f3463dea9); $v6f3463dea9 = MyXML::basicArrayToComplexArray($v6f3463dea9, array("lower_case_keys" => true)); return $v6f3463dea9; } public function createUndefinedXMLTask($v793f92423d, $v6939304e91 = null) { if ($this->pe44fc027) { $v067674f4e4 = ""; $v091a865e5f = ""; $pc37695cb = $v793f92423d ? count($v793f92423d) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v9073377656 = $this->pe44fc027["obj"]->createTaskPropertiesFromCodeStmt($v793f92423d[$v43dd7d0051], $this); if (!empty($v9073377656["code"])) { $v067674f4e4 .= ($v067674f4e4 ? "\n" : "") . $v9073377656["code"]; } if (!$v091a865e5f) { $v091a865e5f = isset($v9073377656["exits"]) ? $v9073377656["exits"] : null; } } $v4f1ce8d45c = $this->pe44fc027["obj"]->isLoopTask(); $v2142ff3fc7 = $this->pe44fc027["obj"]->isReturnTask(); $pa6f9adde = $this->pe44fc027["obj"]->isBreakTask(); } else { $v067674f4e4 = $this->v052656e632->prettyPrint($v793f92423d); $v091a865e5f = array( WorkFlowTask::DEFAULT_EXIT_ID => array( "color" => "#000", ) ); $v4f1ce8d45c = false; $v2142ff3fc7 = false; $pa6f9adde = false; } $v7f5911d32d = $this->pe44fc027; $v003bc751fd = $v7f5911d32d && isset($v7f5911d32d["type"]) ? $this->f0b846dc9ff($v7f5911d32d["type"]) : null; if (!$v003bc751fd) { $v003bc751fd = array( "label" => "Undefined", "tag" => "undefined", ); if (empty($v7f5911d32d)) $v7f5911d32d = array(); $v7f5911d32d["type"] = "undefined"; } $v72e6540353 = substr(str_replace(array("<?php", "<?", "?>"), "", $v067674f4e4), 0, 20) . "..."; $v4a2817e138 = array( "id" => $v7f5911d32d["type"] . "_" . hash("crc32b", $v067674f4e4) . "_" . rand(0, 1000), "label" => "Code: " . $v72e6540353, "type" => $v7f5911d32d["type"], "tag" => $v003bc751fd["tag"], "is_loop" => $v4f1ce8d45c, "is_return" => $v2142ff3fc7, "is_break" => $pa6f9adde, "properties" => array( "exits" => $v091a865e5f, "code" => $v067674f4e4, ), ); if ($v6939304e91) { $v4a2817e138["exits"] = $v6939304e91; } return $v4a2817e138; } public function createXMLTask($v7f5911d32d, $v9073377656, $v6939304e91 = null) { $v4f1ce8d45c = $v7f5911d32d["obj"]->isLoopTask(); $v2142ff3fc7 = $v7f5911d32d["obj"]->isReturnTask(); $pa6f9adde = $v7f5911d32d["obj"]->isBreakTask(); unset($v7f5911d32d["obj"]); $v003bc751fd = $this->f0b846dc9ff($v7f5911d32d["type"]); if (!$v003bc751fd) { return null; } $v4a2817e138 = array( "id" => !empty($v9073377656["id"]) ? $v9073377656["id"] : $v7f5911d32d["type"] . "_" . hash("crc32b", serialize($v9073377656)) . "_" . rand(0, 1000), "type" => $v7f5911d32d["type"], "tag" => $v003bc751fd["tag"], "is_loop" => $v4f1ce8d45c, "is_return" => $v2142ff3fc7, "is_break" => $pa6f9adde, ); if (!empty($v9073377656["label"])) { $v4a2817e138["label"] = $v9073377656["label"]; unset($v9073377656["label"]); } else { $v4a2817e138["label"] = isset($v003bc751fd["label"]) ? $v003bc751fd["label"] : null; } if (empty($v9073377656["exits"]) && !$v2142ff3fc7 && !$pa6f9adde) $v9073377656["exits"][WorkFlowTask::DEFAULT_EXIT_ID] = array(); unset($v9073377656["id"]); $v4a2817e138["properties"] = $v9073377656; if ($v6939304e91) { $v4a2817e138["exits"] = $v6939304e91; } return $v4a2817e138; } public function createConnectorXMLTask($v6939304e91 = null) { $v4a2817e138 = array( "id" => "connector_" . rand(0, 1000) . rand(0, 1000), "type" => WorkFlowTask::CONNECTOR_TASK_TYPE, "is_loop" => false, "is_return" => false, "is_break" => false, "properties" => array( "exits" => array( WorkFlowTask::DEFAULT_EXIT_ID => array(), ), ), ); if ($v6939304e91) { $v4a2817e138["exits"] = $v6939304e91; } return $v4a2817e138; } public function replaceNextTaskInNotBreakTasksExits(&$v1f377b389c, $v7e12e3e1a3 = false) { if ($v1f377b389c) foreach ($v1f377b389c as $pd69fb7d0 => $v7f5911d32d) if (empty($v7f5911d32d["is_break"])) $this->replaceNextTaskInTaskExits($v1f377b389c[$pd69fb7d0], $v7e12e3e1a3); } public function replaceNextTaskInTaskExits(&$v7ef59e63bd, $v7e12e3e1a3) { if ($v7ef59e63bd && !empty($v7e12e3e1a3["id"])) { $v6939304e91 = isset($v7ef59e63bd["properties"]["exits"]) ? $v7ef59e63bd["properties"]["exits"] : null; if (is_array($v6939304e91)) foreach ($v6939304e91 as $v7822e6467d => $pdcbd5e39) if (!empty($v7ef59e63bd["exits"][$v7822e6467d])) { if (isset($v7ef59e63bd["exits"][$v7822e6467d]["task_id"])) $v7ef59e63bd["exits"][$v7822e6467d] = array($v7ef59e63bd["exits"][$v7822e6467d]); $pc37695cb = count($v7ef59e63bd["exits"][$v7822e6467d]); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) if (isset($v7ef59e63bd["exits"][$v7822e6467d][$v43dd7d0051]["task_id"]) && $v7ef59e63bd["exits"][$v7822e6467d][$v43dd7d0051]["task_id"] == "#next_task#") $v7ef59e63bd["exits"][$v7822e6467d][$v43dd7d0051]["task_id"] = $v7e12e3e1a3["id"]; } } } public function addNextTaskToAllTaskExits(&$v7ef59e63bd, $v7e12e3e1a3 = false) { $pcca09e26 = !empty($v7e12e3e1a3["id"]) ? $v7e12e3e1a3["id"] : "#next_task#"; if ($v7ef59e63bd) { $v6939304e91 = isset($v7ef59e63bd["properties"]["exits"]) ? $v7ef59e63bd["properties"]["exits"] : null; if (is_array($v6939304e91)) foreach ($v6939304e91 as $v7822e6467d => $pdcbd5e39) { if (isset($v7ef59e63bd["exits"][$v7822e6467d]["task_id"])) $v7ef59e63bd["exits"][$v7822e6467d] = array($v7ef59e63bd["exits"][$v7822e6467d]); $v7ef59e63bd["exits"][$v7822e6467d][] = array("task_id" => $pcca09e26); } else $v7ef59e63bd["exits"][WorkFlowTask::DEFAULT_EXIT_ID][] = array("task_id" => $pcca09e26); } } public function addNextTaskToUndefinedTaskExits(&$v7ef59e63bd, $v7e12e3e1a3 = false) { $pcca09e26 = !empty($v7e12e3e1a3["id"]) ? $v7e12e3e1a3["id"] : "#next_task#"; if ($v7ef59e63bd && empty($v7ef59e63bd["is_return"]) && empty($v7ef59e63bd["is_break"])) { $v6939304e91 = isset($v7ef59e63bd["properties"]["exits"]) ? $v7ef59e63bd["properties"]["exits"] : null; if (is_array($v6939304e91)) { foreach ($v6939304e91 as $v7822e6467d => $pdcbd5e39) if (!isset($v7ef59e63bd["exits"][$v7822e6467d]["task_id"]) && !isset($v7ef59e63bd["exits"][$v7822e6467d][0]["task_id"])) $v7ef59e63bd["exits"][$v7822e6467d][0] = array("task_id" => $pcca09e26); } else $v7ef59e63bd["exits"][WorkFlowTask::DEFAULT_EXIT_ID][] = array("task_id" => $pcca09e26); } } public function stopLoopInnerTasksToBeConnectedToOtherOutsideTasks($v1f377b389c) { if ($v1f377b389c && empty($v1f377b389c[count($v1f377b389c) - 1]["is_break"])) $v1f377b389c[count($v1f377b389c) - 1]["is_return"] = true; return $v1f377b389c; } public function cleanInvalidExitsFromTasks($v1f377b389c) { $pc37695cb = $v1f377b389c ? count($v1f377b389c) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) $v1f377b389c[$v43dd7d0051] = $this->cleanInvalidExitsFromTask($v1f377b389c[$v43dd7d0051]); return $v1f377b389c; } public function cleanInvalidExitsFromTask($v7f5911d32d) { $v6939304e91 = isset($v7f5911d32d["exits"]) ? $v7f5911d32d["exits"] : null; if (is_array($v6939304e91)) { foreach ($v6939304e91 as $v7822e6467d => $pf72c1d58) { if (isset($pf72c1d58["task_id"])) $pf72c1d58 = array($pf72c1d58); $v2f228af834 = array(); $pc37695cb = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v9d27441e80 = 0; $v9d27441e80 < $pc37695cb; $v9d27441e80++) { $v8282c7dd58 = isset($pf72c1d58[$v9d27441e80]["task_id"]) ? $pf72c1d58[$v9d27441e80]["task_id"] : null; if ($v8282c7dd58 != "#next_task#") $v2f228af834[] = $pf72c1d58[$v9d27441e80]; } $v7f5911d32d["exits"][$v7822e6467d] = $v2f228af834; } } return $v7f5911d32d; } public function printCodeStatement($v5faa4b8a01, $v5a8476b36f = false) { return $this->v052656e632->prettyPrint(array($v5faa4b8a01), $v5a8476b36f); } public function printCodeExpr($v52ff2b3770) { return $this->v052656e632->prettyPrintExpr($v52ff2b3770); } public function printCodeNodeName($v6694236c2c) { if (is_object($v6694236c2c)) { if (is_object($v6694236c2c->name) && strtolower($v6694236c2c->name->getType()) == "name") return $this->v052656e632->pName($v6694236c2c->name); if (is_array($v6694236c2c->parts)) return $this->v052656e632->pName($v6694236c2c); return $v6694236c2c->name; } return $v6694236c2c; } public function getVariableName($v5faa4b8a01) { $v847e7d0a83 = $v5faa4b8a01->var; $v7f2aac9119 = strtolower($v847e7d0a83->getType()); if ($v7f2aac9119 == "expr_propertyfetch" || $v7f2aac9119 == "expr_staticpropertyfetch") { if ($v7f2aac9119 == "expr_staticpropertyfetch") { $v55c0c0e582 = $v847e7d0a83->class->name; if (!$v55c0c0e582 && is_array($v847e7d0a83->class->parts)) $v55c0c0e582 = implode("::", $v847e7d0a83->class->parts); } else $v55c0c0e582 = $this->printCodeExpr($v847e7d0a83->var); if (is_object($v847e7d0a83->name)) { $pe9716498 = $this->printCodeExpr($v847e7d0a83->name); $pe9716498 = substr($pe9716498, 0, 1) == '$' ? substr($pe9716498, 1) : $pe9716498; } else $pe9716498 = $v847e7d0a83->name; if ($v55c0c0e582 && $pe9716498) return array( "obj_name" => $v55c0c0e582, "prop_name" => $pe9716498, "static" => $v7f2aac9119 == "expr_staticpropertyfetch" ? 1 : 0, ); } else if ($v7f2aac9119 == "expr_variable") { $v1cfba8c105 = $v847e7d0a83->name; if ($v1cfba8c105) return array( "var_name" => $v1cfba8c105, ); } else if ($v7f2aac9119 == "expr_arraydimfetch") { $v1cfba8c105 = $this->printCodeExpr($v847e7d0a83); if ($v1cfba8c105) { $v1cfba8c105 = substr($v1cfba8c105, 0, 1) == '$' ? substr($v1cfba8c105, 1) : $v1cfba8c105; return array( "var_name" => $v1cfba8c105, ); } } return null; } public function getAssignmentType($v5faa4b8a01) { $pe83cda0c = strtolower($v5faa4b8a01->getType()); return $pe83cda0c == "expr_assignop_concat" ? "concatenate" : ($pe83cda0c == "expr_assignop_plus" ? "increment" : ($pe83cda0c == "expr_assignop_minus" ? "decrement" : "")); } public function getVariableNameProps($v5faa4b8a01) { $v9073377656 = null; if (strtolower($v5faa4b8a01->getType()) == "stmt_echo") { $v9073377656 = array( "result_echo" => true, ); } else if (strtolower($v5faa4b8a01->getType()) == "stmt_return") { $v9073377656 = array( "result_return" => true, ); } else { $v1cfba8c105 = $this->getVariableName($v5faa4b8a01); $v847e7d0a83 = $v5faa4b8a01->var; $v7f2aac9119 = strtolower($v847e7d0a83->getType()); if ($v7f2aac9119 == "expr_propertyfetch" || $v7f2aac9119 == "expr_staticpropertyfetch") { $v55c0c0e582 = isset($v1cfba8c105["obj_name"]) ? $v1cfba8c105["obj_name"] : null; $pe9716498 = isset($v1cfba8c105["prop_name"]) ? $v1cfba8c105["prop_name"] : null; if ($v55c0c0e582 && $pe9716498) { $v9073377656 = array( "result_obj_name" => $v55c0c0e582, "result_prop_name" => $pe9716498, "result_static" => $v7f2aac9119 == "expr_staticpropertyfetch" ? 1 : 0, "result_prop_assignment" => self::getAssignmentType($v5faa4b8a01), ); } } else { $v1cfba8c105 = isset($v1cfba8c105["var_name"]) ? $v1cfba8c105["var_name"] : null; if ($v1cfba8c105) { $v9073377656 = array( "result_var_name" => $v1cfba8c105, "result_var_assignment" => self::getAssignmentType($v5faa4b8a01), ); } } } return $v9073377656; } public function isAssignExpr($v5faa4b8a01) { $pe83cda0c = strtolower($v5faa4b8a01->getType()); return $pe83cda0c == "expr_assign" || $pe83cda0c == "expr_assignop_concat" || $pe83cda0c == "expr_assignop_plus" || $pe83cda0c == "expr_assignop_minus"; } public function getFunctionProps($v5faa4b8a01) { $pe83cda0c = strtolower($v5faa4b8a01->getType()); if ($this->isAssignExpr($v5faa4b8a01) || ($pe83cda0c == "stmt_echo" && count($v5faa4b8a01->exprs) == 1 && !$this->isAssignExpr($v5faa4b8a01->exprs[0]))) { $v52ff2b3770 = $pe83cda0c == "stmt_echo" ? (isset($v5faa4b8a01->exprs[0]) ? $v5faa4b8a01->exprs[0] : null) : $v5faa4b8a01->expr; $v74aa7d558c = strtolower($v52ff2b3770->getType()); if ($v74aa7d558c == "expr_funccall") { $v9073377656 = $this->getVariableNameProps($v5faa4b8a01); if ($v9073377656) { $v24b0e52635 = $this->printCodeNodeName($v52ff2b3770); $v86066462c3 = $this->getArgs($v52ff2b3770->args); if ($v24b0e52635) { $v9073377656["func_name"] = $v24b0e52635; $v9073377656["func_args"] = $v86066462c3; $v9073377656["label"] = "Call $v24b0e52635()"; return $v9073377656; } } } } else if ($pe83cda0c == "expr_funccall") { $v24b0e52635 = $this->printCodeNodeName($v5faa4b8a01); $v86066462c3 = $this->getArgs($v5faa4b8a01->args); if ($v24b0e52635) { return array( "func_name" => $v24b0e52635, "func_args" => $v86066462c3, "label" => "Call $v24b0e52635()", ); } } } public function getObjectMethodProps($v5faa4b8a01) { $pe83cda0c = strtolower($v5faa4b8a01->getType()); if ($this->isAssignExpr($v5faa4b8a01) || ($pe83cda0c == "stmt_echo" && count($v5faa4b8a01->exprs) == 1 && !$this->isAssignExpr($v5faa4b8a01->exprs[0]))) { $v52ff2b3770 = $pe83cda0c == "stmt_echo" ? (isset($v5faa4b8a01->exprs[0]) ? $v5faa4b8a01->exprs[0] : null) : $v5faa4b8a01->expr; $v74aa7d558c = strtolower($v52ff2b3770->getType()); if ($v74aa7d558c == "expr_methodcall" || $v74aa7d558c == "expr_staticcall") { $v9073377656 = $this->getVariableNameProps($v5faa4b8a01); if ($v9073377656) { if ($v74aa7d558c == "expr_staticcall") { $v55c0c0e582 = $this->printCodeNodeName($v52ff2b3770->class); } else { $v55c0c0e582 = $this->printCodeExpr($v52ff2b3770->var); } $v603bd47baf = $this->printCodeNodeName($v52ff2b3770); if ($v55c0c0e582 && $v603bd47baf) { $v86066462c3 = $this->getArgs($v52ff2b3770->args); $v9073377656["method_obj"] = $v55c0c0e582; $v9073377656["method_name"] = $v603bd47baf; $v9073377656["method_args"] = $v86066462c3; $v9073377656["method_static"] = $v74aa7d558c == "expr_staticcall" ? 1 : 0; $v9073377656["label"] = "Call $v55c0c0e582" . ($v74aa7d558c == "expr_staticcall" ? "::" : "->") . "$v603bd47baf(...)"; return $v9073377656; } } } } else if ($pe83cda0c == "expr_methodcall" || $pe83cda0c == "expr_staticcall") { if ($pe83cda0c == "expr_staticcall") $v55c0c0e582 = $this->printCodeNodeName($v5faa4b8a01->class); else $v55c0c0e582 = $this->printCodeExpr($v5faa4b8a01->var); $v603bd47baf = $this->printCodeNodeName($v5faa4b8a01); if ($v55c0c0e582 && $v603bd47baf) { $v86066462c3 = $this->getArgs($v5faa4b8a01->args); return array( "method_obj" => $v55c0c0e582, "method_name" => $v603bd47baf, "method_args" => $v86066462c3, "method_static" => $pe83cda0c == "expr_staticcall" ? 1 : 0, "label" => "Call $v55c0c0e582" . ($pe83cda0c == "expr_staticcall" ? "::" : "->") . "$v603bd47baf(...)", ); } } } public function getNewObjectProps($v5faa4b8a01) { $pe83cda0c = strtolower($v5faa4b8a01->getType()); if ($this->isAssignExpr($v5faa4b8a01) || ($pe83cda0c == "stmt_echo" && count($v5faa4b8a01->exprs) == 1 && !$this->isAssignExpr($v5faa4b8a01->exprs[0]))) { $v52ff2b3770 = $pe83cda0c == "stmt_echo" ? (isset($v5faa4b8a01->exprs[0]) ? $v5faa4b8a01->exprs[0] : null) : $v5faa4b8a01->expr; $v74aa7d558c = strtolower($v52ff2b3770->getType()); if ($v74aa7d558c == "expr_new") { $v9073377656 = $this->getVariableNameProps($v5faa4b8a01); if ($v9073377656) { $v1335217393 = $this->printCodeNodeName($v52ff2b3770->class); $v86066462c3 = $this->getArgs($v52ff2b3770->args); if ($v1335217393) { $v9073377656["class_name"] = $v1335217393; $v9073377656["class_args"] = $v86066462c3; $v9073377656["label"] = "Create $v1335217393 obj"; return $v9073377656; } } } } else if ($pe83cda0c == "expr_new") { $v1335217393 = $this->printCodeNodeName($v5faa4b8a01->class); $v86066462c3 = $this->getArgs($v5faa4b8a01->args); if ($v1335217393) { return array( "class_name" => $v1335217393, "class_args" => $v86066462c3, "label" => "Create $v1335217393 obj", ); } } } public function getArgs($pe896c6c8) { $v86066462c3 = array(); if (is_array($pe896c6c8)) { $pc37695cb = count($pe896c6c8); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pea70e132 = $pe896c6c8[$v43dd7d0051]; $v9439b47442 = strtolower($pea70e132->value->getType()); $v67db1bd535 = $this->v052656e632->pArg($pea70e132); $v67db1bd535 = $this->getStmtValueAccordingWithType($v67db1bd535, $v9439b47442); $pc3e857ed = $this->getStmtType($pea70e132->value); $v86066462c3[] = array( "value" => $v67db1bd535, "type" => $pc3e857ed, ); } } return $v86066462c3; } public function getArrayItems($pf72c1d58) { $v9073377656 = array(); $pc37695cb = $pf72c1d58 ? count($pf72c1d58) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v342a134247 = $pf72c1d58[$v43dd7d0051]; $pbfa01ed1 = $v342a134247->key; $v67db1bd535 = $v342a134247->value; $v1491940c54 = is_object($pbfa01ed1) ? strtolower($pbfa01ed1->getType()) : null; $pc3e857ed = is_object($v67db1bd535) ? strtolower($v67db1bd535->getType()) : null; if ($v1491940c54) { $pbfa01ed1 = $this->printCodeExpr($pbfa01ed1); $pbfa01ed1 = $this->getStmtValueAccordingWithType($pbfa01ed1, $v1491940c54); $v1491940c54 = $this->getStmtType($v342a134247->key); } else { $pbfa01ed1 = null; } if ($pc3e857ed) { if ($pc3e857ed == "expr_array") { $v67db1bd535 = $this->getArrayItems($v67db1bd535->items); } else { $v67db1bd535 = $this->printCodeExpr($v67db1bd535); $v67db1bd535 = $this->getStmtValueAccordingWithType($v67db1bd535, $pc3e857ed); } $pc3e857ed = $this->getStmtType($v342a134247->value); } else { $v67db1bd535 = null; } $pb4a546a4 = array( "key" => $pbfa01ed1, "key_type" => isset($pbfa01ed1) ? $v1491940c54 : "null" ); if (is_array($v67db1bd535)) { $pb4a546a4["items"] = $v67db1bd535; } else { $pb4a546a4["value"] = $v67db1bd535; $pb4a546a4["value_type"] = isset($v67db1bd535) ? $pc3e857ed : "null"; } $v9073377656[] = $pb4a546a4; } return $v9073377656; } public function getConditions($v9e394b2939) { $v9e394b2939 = $this->f2e7c947c1e($v9e394b2939); if (isset($v9e394b2939)) { $v9e394b2939 = isset($v9e394b2939["value"]) ? array("first" => $v9e394b2939, "operator" => "==", "second" => array("value" => "true", "type" => "")) : $v9e394b2939; $v9e394b2939 = array("group" => (isset($v9e394b2939["join"]) ? $v9e394b2939 : array("join" => "and", "item" => $v9e394b2939))); return $v9e394b2939; } return null; } private function f2e7c947c1e($v9e394b2939) { $v3cbbdf9379 = array( "expr_binaryop_booleanor" => "or", "expr_binaryop_booleanand" => "and", ); $pa75e95f5 = array( "expr_binaryop_equal" => "==", "expr_binaryop_notequal" => "!=", "expr_binaryop_greater" => ">", "expr_binaryop_greaterorequal" => ">=", "expr_binaryop_smaller" => "<", "expr_binaryop_smallerorequal" => "<=", "expr_binaryop_identical" => "===", "expr_binaryop_notidentical" => "!==", ); $v3fb9f41470 = strtolower($v9e394b2939->getType()); if (isset($pa75e95f5[$v3fb9f41470])) { $v19a7745bc6 = $pa75e95f5[$v3fb9f41470]; $v9ee95f7393 = $this->f2e7c947c1e($v9e394b2939->left); $pec02f9f5 = $this->f2e7c947c1e($v9e394b2939->right); if (!isset($v9ee95f7393) || !isset($pec02f9f5)) { return null; } $v9073377656 = array("operator" => $v19a7745bc6); if (isset($v9ee95f7393["join"])) { $v9073377656["group"] = $v9ee95f7393; } else { $v9073377656["first"] = $v9ee95f7393; } if (isset($pec02f9f5["join"])) { $v9073377656["group"] = isset($v9ee95f7393["join"]) ? array($v9073377656["group"], $pec02f9f5) : $pec02f9f5; } else { $v9073377656["second"] = $pec02f9f5; } return $v9073377656; } else if (isset($v3cbbdf9379[$v3fb9f41470])) { $v3c581c912b = $v3cbbdf9379[$v3fb9f41470]; $v9ee95f7393 = $this->f2e7c947c1e($v9e394b2939->left); $pec02f9f5 = $this->f2e7c947c1e($v9e394b2939->right); if (!isset($v9ee95f7393) || !isset($pec02f9f5)) { return null; } $v9073377656 = array("join" => $v3c581c912b); if (isset($v9ee95f7393["join"])) { $v9073377656["group"] = $v9ee95f7393; } else { $v9073377656["item"] = isset($v9ee95f7393["value"]) ? array("first" => $v9ee95f7393, "operator" => "==", "second" => array("value" => "true", "type" => "")) : $v9ee95f7393; } if (isset($pec02f9f5["join"])) { $v9073377656["group"] = isset($v9ee95f7393["join"]) ? array($v9073377656["group"], $pec02f9f5) : $pec02f9f5; } else { $pec02f9f5 = isset($pec02f9f5["value"]) ? array("first" => $pec02f9f5, "operator" => "==", "second" => array("value" => "true", "type" => "")) : $pec02f9f5; $v9073377656["item"] = !isset($v9ee95f7393["join"]) ? array($v9073377656["item"], $pec02f9f5) : $pec02f9f5; } return $v9073377656; } else { $v67db1bd535 = $this->printCodeExpr($v9e394b2939); $v67db1bd535 = $this->getStmtValueAccordingWithType($v67db1bd535, $v3fb9f41470); $pc3e857ed = $this->getStmtType($v9e394b2939); return array( "value" => $v67db1bd535, "type" => $pc3e857ed, ); } return null; } public function getStmtType($v5faa4b8a01) { $v3fb9f41470 = strtolower($v5faa4b8a01->getType()); return $v3fb9f41470 == "scalar_string" || $v3fb9f41470 == "scalar_encapsed" ? "string" : ( $v3fb9f41470 == "expr_variable" ? "variable" : ( $v3fb9f41470 == "expr_funccall" ? "function" : ( $v3fb9f41470 == "expr_methodcall" || $v3fb9f41470 == "expr_staticcall" ? "method" : ( $v3fb9f41470 == "expr_array" ? "array" : "" )))); } public function getStmtValueAccordingWithType($v67db1bd535, $pc3e857ed) { return CMSFileHandler::getStmtValueAccordingWithType($v67db1bd535, $pc3e857ed); } public function getStmtValueAccordingWithTypeOld($v67db1bd535, $pc3e857ed) { if ($pc3e857ed == "scalar_string" || $pc3e857ed == "scalar_encapsed") { $v34f0a629d3 = substr($v67db1bd535, 0, 1); $v67db1bd535 = str_replace('\t', "\t", str_replace('\n', "\n", substr($v67db1bd535, 1, -1))); $v67db1bd535 = stripslashes($v67db1bd535); $v67db1bd535 = str_replace('$', '\$', $v67db1bd535); if ($v34f0a629d3 == '"') $v67db1bd535 = str_replace('{\$', '{$', $v67db1bd535); } return $v67db1bd535; } private function f0b846dc9ff($pc8421459) { if ($pc8421459 && is_array($this->v524bbc0f84)) { foreach ($this->v524bbc0f84 as $v6b3fa373ec => $v0ad7416965) { if (!empty($v0ad7416965[$pc8421459])) { return $v0ad7416965[$pc8421459]; } } } return null; } private function f009b48d5e5() { $pca9181c5 = array(); if (is_array($this->v524bbc0f84)) foreach ($this->v524bbc0f84 as $v6b3fa373ec => $v0ad7416965) foreach ($v0ad7416965 as $pc8421459 => $v003bc751fd) if (!empty($v003bc751fd["code_parser"]["statements"])) { $pc37695cb = count($v003bc751fd["code_parser"]["statements"]); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $v5faa4b8a01 = $v003bc751fd["code_parser"]["statements"][$v43dd7d0051]; if ($v5faa4b8a01) { $v7f5911d32d = $this->pecad7cca->getTaskByType($pc8421459); $pf4ad0dfd = isset($v7f5911d32d["obj"]) ? $v7f5911d32d["obj"] : null; $v61684d371a = isset($v7f5911d32d["class"]) ? $v7f5911d32d["class"] : null; if (get_class($pf4ad0dfd) == $v61684d371a) $pca9181c5[ strtolower($v5faa4b8a01) ][] = $v7f5911d32d; } } } foreach ($pca9181c5 as $pe83cda0c => $v1d696dbd12) { usort($v1d696dbd12, function($pbde5fb24, $v7aeaf992f5) { return (!empty($pbde5fb24["obj"]) && !empty($v7aeaf992f5["obj"])) && (!$v7aeaf992f5["obj"]->getPriority() || $pbde5fb24["obj"]->getPriority() > $v7aeaf992f5["obj"]->getPriority()) ? -1 : 1; }); $pca9181c5[$pe83cda0c] = $v1d696dbd12; } return $pca9181c5; } private function f263086ba76() { $v9362c1426c = array(); if (is_array($this->v524bbc0f84)) { foreach ($this->v524bbc0f84 as $v6b3fa373ec => $v0ad7416965) { foreach ($v0ad7416965 as $pc8421459 => $v003bc751fd) { $v04a366a14b = isset($v003bc751fd["code_parser"]["reserved_static_method_class_names"]) ? $v003bc751fd["code_parser"]["reserved_static_method_class_names"] : null; if (is_array($v04a366a14b)) { $v9362c1426c = array_merge($v9362c1426c, $v04a366a14b); } } } } return $v9362c1426c; } private function f6a928e8c37() { $v969a81b996 = array(); if (is_array($this->v524bbc0f84)) { foreach ($this->v524bbc0f84 as $v6b3fa373ec => $v0ad7416965) { foreach ($v0ad7416965 as $pc8421459 => $v003bc751fd) { $v04a366a14b = isset($v003bc751fd["code_parser"]["reserved_object_method_names"]) ? $v003bc751fd["code_parser"]["reserved_object_method_names"] : null; if (is_array($v04a366a14b)) { $v969a81b996 = array_merge($v969a81b996, $v04a366a14b); } } } } return $v969a81b996; } private function mda55dcfa15af() { $v683170574f = array(); if (is_array($this->v524bbc0f84)) { foreach ($this->v524bbc0f84 as $v6b3fa373ec => $v0ad7416965) { foreach ($v0ad7416965 as $pc8421459 => $v003bc751fd) { $v04a366a14b = isset($v003bc751fd["code_parser"]["reserved_function_names"]) ? $v003bc751fd["code_parser"]["reserved_function_names"] : null; if (is_array($v04a366a14b)) { $v683170574f = array_merge($v683170574f, $v04a366a14b); } } } } return $v683170574f; } public function getAvailableStatements() { return $this->pb59a7c0b; } public function setAvailableStatements($pb59a7c0b) { $this->pb59a7c0b = $pb59a7c0b; } public function addAvailableStatement($pe83cda0c, $v189716ac66) { $pe83cda0c = strtolower($pe83cda0c); $v189716ac66 = is_array($v189716ac66) || !$v189716ac66 ? $v189716ac66 : array($v189716ac66); if ($v189716ac66) { $pc37695cb = count($v189716ac66); for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pc8421459 = trim($v189716ac66[$v43dd7d0051]); if ($pc8421459 && (empty($this->pb59a7c0b[$pe83cda0c]) || !in_array($pc8421459, $this->pb59a7c0b[$pe83cda0c])) ) { $v7f5911d32d = $this->pecad7cca->getTaskByType($pc8421459); $pf4ad0dfd = isset($v7f5911d32d["obj"]) ? $v7f5911d32d["obj"] : null; $v61684d371a = isset($v7f5911d32d["class"]) ? $v7f5911d32d["class"] : null; if (get_class($pf4ad0dfd) == $v61684d371a) $this->pb59a7c0b[$pe83cda0c][] = $v7f5911d32d; } } } } public function getReservedStaticMethodClassNames() { return $this->v9362c1426c; } public function setReservedStaticMethodClassNames($v9362c1426c) { $this->v9362c1426c = $v9362c1426c; } public function addReservedStaticMethodClassName($v40cbbe87a8) { $this->v9362c1426c[] = $v40cbbe87a8; } public function getReservedObjectMethodNames() { return $this->v969a81b996; } public function setReservedObjectMethodNames($v969a81b996) { $this->v969a81b996 = $v969a81b996; } public function addReservedObjectMethodName($pfcabf003) { $this->v969a81b996[] = $pfcabf003; } public function getReservedFunctionNames() { return $this->v683170574f; } public function setReservedFunctionNames($v683170574f) { $this->v683170574f = $v683170574f; } public function addReservedFunctionName($v38a3e9bb8c) { $this->v683170574f[] = $v38a3e9bb8c; } public function isReservedStaticMethodClassName($v41d322337c) { $v9362c1426c = $this->getReservedStaticMethodClassNames(); $v55c0c0e582 = isset($v41d322337c["method_obj"]) ? $v41d322337c["method_obj"] : null; $static = isset($v41d322337c["method_static"]) ? $v41d322337c["method_static"] : null; if ($v55c0c0e582 && $static && $v9362c1426c) return in_array($v55c0c0e582, $v9362c1426c); return false; } public function isReservedObjectMethodName($v41d322337c) { $v037f4db885 = $this->getReservedObjectMethodNames(); $v55c0c0e582 = isset($v41d322337c["method_obj"]) ? $v41d322337c["method_obj"] : null; $v603bd47baf = isset($v41d322337c["method_name"]) ? $v41d322337c["method_name"] : null; $static = isset($v41d322337c["method_static"]) ? $v41d322337c["method_static"] : null; if ($v603bd47baf && $v037f4db885) foreach ($v037f4db885 as $v473eb931e9) { $pbd1bc7b0 = strpos($v473eb931e9, "::"); $pe0749d73 = ""; if ($pbd1bc7b0 !== false) { $pe0749d73 = substr($v473eb931e9, 0, $pbd1bc7b0); $v473eb931e9 = substr($v473eb931e9, $pbd1bc7b0 + 2); if ($v473eb931e9 == $v603bd47baf && $static && $pe0749d73 == $v55c0c0e582) return true; } else { $pbd1bc7b0 = strpos($v473eb931e9, "->"); if ($pbd1bc7b0 !== false) { $v26629f73ad = substr($v473eb931e9, 0, $pbd1bc7b0); $v473eb931e9 = substr($v473eb931e9, $pbd1bc7b0 + 2); if ($v473eb931e9 == $v603bd47baf && !$static && $v26629f73ad == $v55c0c0e582) return true; } else if (!$static && $v473eb931e9 == $v603bd47baf) return true; } } return false; } public function getPHPParserEmulative() { return $this->v5f04ef1cc1; } public function getPHPParserTraverser() { return $this->v690fc6799d; } public function getPHPParserPrettyPrinter() { return $this->v052656e632; } } ?>
