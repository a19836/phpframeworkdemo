<?php
/*
 * Copyright (c) 2024 Bloxtor - http://bloxtor.com
 * 
 * Please note that this code belongs to the Bloxtor framework and must comply with the Bloxtor license.
 * If you do not accept these provisions, or if the Bloxtor License is not present or cannot be found, you are not entitled to use this code and must stop and delete it immediately.
 */
namespace WorkFlowTask\programming\createform; include_once get_lib("org.phpframework.workflow.WorkFlowTask"); include_once get_lib("org.phpframework.util.text.TextSanitizer"); class WorkFlowTaskImpl extends \WorkFlowTask { public function createTaskPropertiesFromCodeStmt($v5faa4b8a01, $pb16df866, &$v6939304e91 = null, &$v1f377b389c = null) { $v9073377656 = $pb16df866->getObjectMethodProps($v5faa4b8a01); if ($v9073377656) { $pb537c4d4 = strtolower($v9073377656["method_obj"]); $v603bd47baf = strtolower($v9073377656["method_name"]); if ($pb537c4d4 == "htmlformhandler" && $v603bd47baf == "createhtmlform") { $v86066462c3 = $v9073377656["method_args"]; $pcc572ecf = $v86066462c3[0]["value"]; $pf75a9136 = $v86066462c3[0]["type"]; $v8ae15da7de = $v86066462c3[1]["value"]; $v90fbc77a4d = $v86066462c3[1]["type"]; if ($pf75a9136 == "array") { $v2c36d33236 = $pb16df866->getPHPParserEmulative()->parse("<?php\n" . $pcc572ecf . "\n?>"); $pcc572ecf = $pb16df866->getArrayItems($v2c36d33236[0]->items); } if ($v90fbc77a4d == "array") { $pd820b3ee = $pb16df866->getPHPParserEmulative()->parse("<?php\n" . $v8ae15da7de . "\n?>"); $v8ae15da7de = $pb16df866->getArrayItems($pd820b3ee[0]->items); } unset($v9073377656["method_obj"]); unset($v9073377656["method_name"]); unset($v9073377656["method_args"]); unset($v9073377656["method_static"]); $v9073377656["form_settings_data"] = $pcc572ecf; $v9073377656["form_settings_data_type"] = self::getConfiguredParsedType($pf75a9136, array("", "string", "variable", "array", "settings", "ptl")); $v9073377656["form_input_data"] = $v8ae15da7de; $v9073377656["form_input_data_type"] = self::getConfiguredParsedType($v90fbc77a4d, array("", "string", "variable", "array")); $v9073377656["label"] = "Draw a form"; $v9073377656["exits"] = array( self::DEFAULT_EXIT_ID => array( "color" => "#426efa", ), ); return $v9073377656; } } } public function parseProperties(&$v7f5911d32d) { $v3c3af72a1c = $v7f5911d32d["raw_data"]; $pf75a9136 = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_settings_data_type"][0]["value"]; if ($pf75a9136 == "array") { $pcc572ecf = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_settings_data"]; $pcc572ecf = self::parseArrayItems($pcc572ecf); } else if ($pf75a9136 == "ptl") { $pcc572ecf = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_settings_data"]; $pcc572ecf = \MyXML::complexArrayToBasicArray($pcc572ecf[0]["childs"], array("lower_case_keys" => true)); if ($pcc572ecf["ptl"]) { $pc5a892eb = array(); if (is_array($pcc572ecf["ptl"]["external_vars"])) { if(isset($pcc572ecf["ptl"]["external_vars"]["key_type"])) $pcc572ecf["ptl"]["external_vars"] = array($pcc572ecf["ptl"]["external_vars"]); foreach ($pcc572ecf["ptl"]["external_vars"] as $v2e43e8c749) if ($v2e43e8c749["key"] && $v2e43e8c749["value"]) $pc5a892eb[ $v2e43e8c749["key"] ] = (substr($v2e43e8c749["value"], 0, 1) == '$' ? '' : '$') . $v2e43e8c749["value"]; } $pcc572ecf["ptl"]["external_vars"] = $pc5a892eb; } } else $pcc572ecf = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_settings_data"][0]["value"]; $v90fbc77a4d = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_input_data_type"][0]["value"]; if ($v90fbc77a4d == "array") { $v8ae15da7de = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_input_data"]; $v8ae15da7de = self::parseArrayItems($v8ae15da7de); } else $v8ae15da7de = $v3c3af72a1c["childs"]["properties"][0]["childs"]["form_input_data"][0]["value"]; $pef349725 = array( "form_settings_data" => $pcc572ecf, "form_settings_data_type" => $pf75a9136, "form_input_data" => $v8ae15da7de, "form_input_data_type" => $v90fbc77a4d, ); $pef349725 = self::parseResultVariableProperties($v3c3af72a1c, $pef349725); return $pef349725; } public function printCode($v1d696dbd12, $v56dcda6d50, $v54bb17785b = "", $v5d3813882f = null) { $v539082ff30 = $this->data; $pef349725 = $v539082ff30["properties"]; $v1cfba8c105 = self::getPropertiesResultVariableCode($pef349725); $pf75a9136 = $pef349725["form_settings_data_type"]; if ($pf75a9136 == "array") { if ($pef349725["form_settings_data"]) foreach ($pef349725["form_settings_data"] as $v43dd7d0051 => $pb4a546a4) if (($pb4a546a4["key"] == "form_css" || $pb4a546a4["key"] == "form_js") && $pb4a546a4["key_type"] == "string" && $pb4a546a4["value_type"] == "string") $pef349725["form_settings_data"][$v43dd7d0051]["value"] = \TextSanitizer::replaceIfNotEscaped('\n', '\\\n', $pb4a546a4["value"]); $pcc572ecf = self::getArrayString($pef349725["form_settings_data"], $v54bb17785b); } else if ($pf75a9136 == "ptl") $pcc572ecf = self::f3516a4987f($pef349725["form_settings_data"], $v54bb17785b); else $pcc572ecf = self::getVariableValueCode($pef349725["form_settings_data"], $pf75a9136); $v90fbc77a4d = $pef349725["form_input_data_type"]; if ($v90fbc77a4d == "array") $v8ae15da7de = self::getArrayString($pef349725["form_input_data"], $v54bb17785b); else $v8ae15da7de = self::getVariableValueCode($pef349725["form_input_data"], $v90fbc77a4d); $v067674f4e4 = $v54bb17785b . $v1cfba8c105; $v067674f4e4 .= "HtmlFormHandler::createHtmlForm("; $v067674f4e4 .= ($pcc572ecf ? $pcc572ecf : "null") . ", "; $v067674f4e4 .= $v8ae15da7de ? $v8ae15da7de : "null"; $v067674f4e4 .= ");\n"; return $v067674f4e4 . self::printTask($v1d696dbd12, $v539082ff30["exits"][self::DEFAULT_EXIT_ID], $v56dcda6d50, $v54bb17785b, $v5d3813882f); } private static function f3516a4987f($pcc572ecf, $v54bb17785b = "") { $v067674f4e4 = ""; if (is_array($pcc572ecf)) { $v067674f4e4 .= $v54bb17785b . "array("; $v866b2a3622 = true; foreach ($pcc572ecf as $pe5c5e2fe => $v956913c90f) { if ($pe5c5e2fe == "ptl" && is_array($v956913c90f)) $v956913c90f = substr(self::f3516a4987f($v956913c90f, "$v54bb17785b\t"), strlen("$v54bb17785b\t")); else if ($pe5c5e2fe == "external_vars" && is_array($v956913c90f)) { $v02a69d4e0f = "array("; $v1b08a89324 = true; foreach ($v956913c90f as $pf383a3a9 => $v2a500a7080) { $v02a69d4e0f .= ($v1b08a89324 ? "" : ", ") . "\n$v54bb17785b\t\t'$pf383a3a9' => $v2a500a7080"; $v1b08a89324 = false; } $v02a69d4e0f .= "\n$v54bb17785b\t)"; $v956913c90f = $v02a69d4e0f; } else if ($pe5c5e2fe == "code" || $pe5c5e2fe == "input_data_var_name" || $pe5c5e2fe == "idx_var_name") { if ((substr($v956913c90f, 0, 1) == '"' && substr($v956913c90f, -1) == '"') || (substr($v956913c90f, 0, 1) == "'" && substr($v956913c90f, -1) == "'")) $v956913c90f = $v956913c90f; else { $v956913c90f = \TextSanitizer::replaceIfNotEscaped('\"', '\\\"', $v956913c90f); $v956913c90f = "\"" . addcslashes($v956913c90f, '"') . "\""; $v956913c90f = \TextSanitizer::replaceIfNotEscaped('\n', '\\\n', $v956913c90f); } } else $v956913c90f = var_export($v956913c90f, true); $v067674f4e4 .= ($v866b2a3622 ? "" : ", ") . "\n$v54bb17785b\t" . (is_numeric($pe5c5e2fe) ? $pe5c5e2fe : '"' . $pe5c5e2fe . '"') . " => " . $v956913c90f; $v866b2a3622 = false; } $v067674f4e4 .= "\n$v54bb17785b)"; } return $v067674f4e4; } } ?>
