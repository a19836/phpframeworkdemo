<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

include_once get_lib("org.phpframework.layer.presentation.cms.CMSLayer"); class CMSBlockLayer { private $v874d5d2d79; private $v9158f5ed68; private $pfd929523; private $v6c261bd54c; private $pecf89374; private $v18ff984a20; private $v141e01930e; public function __construct(CMSLayer $v874d5d2d79) { $this->v874d5d2d79 = $v874d5d2d79; $this->v9158f5ed68 = array(); $this->pfd929523 = array(); $this->v6c261bd54c = null; $this->pecf89374 = array(); $this->v18ff984a20 = false; $this->v141e01930e = array(); } public function createBlock($pcd8c70bc, $v29fec2ceaa, &$v30857f7eca) { if ($this->isBlockExecutionValid($v29fec2ceaa)) { $this->v6c261bd54c = $v29fec2ceaa; $v18521bca9a = $this->v874d5d2d79->isCacheActive(); if ($v18521bca9a) { $pbc7e2f66 = $this->v874d5d2d79->getCacheLayer()->getCMSBlockCacheLayer(); if($pbc7e2f66->isValid($v29fec2ceaa, $v30857f7eca)) { $v9ad1385268 = $pbc7e2f66->get($v29fec2ceaa, $v30857f7eca); $v11486cddab = $v9ad1385268 ? true : false; } } if (!$v11486cddab) { $pbd87f603 = $v30857f7eca; $pfd76dfba = array( "module_id" => $pcd8c70bc, "block_id" => $v29fec2ceaa, ); $v9ad1385268 = $this->v874d5d2d79->getCMSModuleLayer()->executeModule($pcd8c70bc, $v30857f7eca, $pfd76dfba); if ($v18521bca9a) $pbc7e2f66->check($v29fec2ceaa, $pbd87f603, $v9ad1385268); } $this->v9158f5ed68[$v29fec2ceaa] = $v9ad1385268; $this->pfd929523[$v29fec2ceaa] = $v30857f7eca; } } public function createBlockHtml($v29fec2ceaa, $pf8ed4912, $pc4878285 = true) { if ($this->isBlockExecutionValid($v29fec2ceaa)) { $this->v6c261bd54c = $v29fec2ceaa; if ($pc4878285) { $v18521bca9a = $this->v874d5d2d79->isCacheActive(); if ($v18521bca9a) { $pbc7e2f66 = $this->v874d5d2d79->getCacheLayer()->getCMSBlockCacheLayer(); $pbc7e2f66->check($v29fec2ceaa, null, $pf8ed4912); } } $this->v9158f5ed68[$v29fec2ceaa] = $pf8ed4912; $this->pfd929523[$v29fec2ceaa] = null; } } public function getCachedBlock($v29fec2ceaa, $v30857f7eca) { $v18521bca9a = $this->v874d5d2d79->isCacheActive(); if($v18521bca9a) { $pbc7e2f66 = $this->v874d5d2d79->getCacheLayer()->getCMSBlockCacheLayer(); if($pbc7e2f66->isValid($v29fec2ceaa, $v30857f7eca)) return $pbc7e2f66->get($v29fec2ceaa, $v30857f7eca); } return null; } public function getCurrentBlockId() { return $this->v6c261bd54c; } public function getBlocks() { return $this->v9158f5ed68; } public function getBlock($v29fec2ceaa) { return $this->v9158f5ed68[$v29fec2ceaa]; } public function existsBlock($v29fec2ceaa) { return $this->v9158f5ed68 && array_key_exists($v29fec2ceaa, $this->v9158f5ed68); } public function getCurrentBlock() { $v29fec2ceaa = $this->getCurrentBlockId(); return $v29fec2ceaa ? $this->v9158f5ed68[$v29fec2ceaa] : null; } public function getBlocksSettings() { return $this->pfd929523; } public function getBlockSettings($v29fec2ceaa) { return $this->pfd929523[$v29fec2ceaa]; } public function getCurrentBlockSettings($v29fec2ceaa) { $v29fec2ceaa = $this->getCurrentBlockId(); return $v29fec2ceaa ? $this->pfd929523[$v29fec2ceaa] : null; } public function getBlockSetting($v29fec2ceaa, $v638d4e50bf) { return $this->pfd929523[$v29fec2ceaa][$v638d4e50bf]; } public function getCurrentBlockSetting($v29fec2ceaa, $v638d4e50bf) { $v29fec2ceaa = $this->getCurrentBlockId(); return $v29fec2ceaa ? $this->pfd929523[$v29fec2ceaa][$v638d4e50bf] : null; } public function getBlockIdFromFilePath($pf3dc0762, $v4eca125fbe = false) { $pf3dc0762 = normalize_windows_path_to_linux($pf3dc0762); if ($v4eca125fbe) $v29fec2ceaa = str_replace($this->v874d5d2d79->getEVC()->getBlocksPath($v4eca125fbe), "", $pf3dc0762); else { $v9ab35f1f0d = $this->v874d5d2d79->getEVC()->getPresentationLayer(); $paf0420d3 = $v9ab35f1f0d->getSelectedPresentationId(); $v4eca125fbe = str_replace($v9ab35f1f0d->getLayerPathSetting(), "", $pf3dc0762); $pbd1bc7b0 = strpos($v4eca125fbe, "/src/"); $v4eca125fbe = substr($v4eca125fbe, 0, $pbd1bc7b0); if ($v4eca125fbe != $paf0420d3) $v29fec2ceaa = $v4eca125fbe . "/" . str_replace($this->v874d5d2d79->getEVC()->getBlocksPath($v4eca125fbe), "", $pf3dc0762); else $v29fec2ceaa = str_replace($this->v874d5d2d79->getEVC()->getBlocksPath($paf0420d3), "", $pf3dc0762); } $v5442ff2fbd = pathinfo($v29fec2ceaa); $v29fec2ceaa = str_replace("." . $v5442ff2fbd["extension"], "", $v29fec2ceaa); return $v29fec2ceaa; } public function stopAllBlocks() { $this->v18ff984a20 = true; } public function startAllBlocks() { $this->v18ff984a20 = false; } public function stopBlock($v29fec2ceaa) { if ($v29fec2ceaa) $this->v141e01930e[$v29fec2ceaa] = true; } public function startBlock($v29fec2ceaa) { if ($v29fec2ceaa) $this->v141e01930e[$v29fec2ceaa] = false; } public function stopBlockRegions($v29fec2ceaa) { $this->stopBlock($v29fec2ceaa); if ($v29fec2ceaa && $this->pecf89374[$v29fec2ceaa]) { $v597a5a0497 = $this->v874d5d2d79->getCMSTemplateLayer(); foreach ($this->pecf89374[$v29fec2ceaa] as $v9f2c84d2ad => $v02a69d4e0f) $v597a5a0497->stopRegion($v9f2c84d2ad); } } public function startBlockRegions($v29fec2ceaa) { $this->startBlock($v29fec2ceaa); if ($v29fec2ceaa && $this->pecf89374[$v29fec2ceaa]) { $v597a5a0497 = $this->v874d5d2d79->getCMSTemplateLayer(); foreach ($this->pecf89374[$v29fec2ceaa] as $v9f2c84d2ad => $v02a69d4e0f) $v597a5a0497->startRegion($v9f2c84d2ad); } } public function stopCurrentBlock() { $this->stopBlock($this->v6c261bd54c); } public function startCurrentBlock() { $this->startBlock($this->v6c261bd54c); } public function stopCurrentBlockRegions() { $this->stopBlockRegions($this->v6c261bd54c); } public function startCurrentBlockRegions() { $this->startBlockRegions($this->v6c261bd54c); } public function isAllBlocksExecutionValid() { return !$this->v18ff984a20; } public function isBlockRegionsExecutionValid($v29fec2ceaa) { if ($v29fec2ceaa) { if ($this->pecf89374[$v29fec2ceaa]) { $pd0cb8ced = $this->v874d5d2d79->getCMSTemplateLayer(); foreach ($this->pecf89374[$v29fec2ceaa] as $v9f2c84d2ad => $v02a69d4e0f) if ($pd0cb8ced->isRegionExecutionValid($v9f2c84d2ad)) return true; return false; } return true; } return false; } public function isBlockExecutionValid($v29fec2ceaa) { return $this->isAllBlocksExecutionValid() && $v29fec2ceaa && empty($this->v141e01930e[$v29fec2ceaa]) && $this->isBlockRegionsExecutionValid($v29fec2ceaa); } public function isCurrentBlockExecutionValid() { return $this->isBlockExecutionValid($this->v6c261bd54c); } public function addBlockRegion($v29fec2ceaa, $v9f2c84d2ad) { if ($v29fec2ceaa && $v9f2c84d2ad) $this->pecf89374[$v29fec2ceaa][$v9f2c84d2ad] = true; } } ?>
