<?php
/*
 * Copyright (c) 2024 Bloxtor - http://bloxtor.com
 * 
 * Please note that this code belongs to the Bloxtor framework and must comply with the Bloxtor license.
 * If you do not accept these provisions, or if the Bloxtor License is not present or cannot be found, you are not entitled to use this code and must stop and delete it immediately.
 */
include_once get_lib("org.phpframework.layer.Layer"); class PresentationLayer extends Layer { private $pddb8c7d5; private $v490a140f44; public function __construct($v30857f7eca = array()) { parent::__construct($v30857f7eca); } public function setSelectedPresentationId($pddb8c7d5) { $this->pddb8c7d5 = $pddb8c7d5; $this->v490a140f44 = $this->getPresentationSettings($pddb8c7d5); } public function getSelectedPresentationId() { return $this->pddb8c7d5; } public function getSelectedPresentationSettings() { return $this->v490a140f44; } public function getSelectedPresentationSetting($v638d4e50bf) { return isset($this->v490a140f44[$v638d4e50bf]) ? $this->v490a140f44[$v638d4e50bf] : null; } public function getModulePath($pcd8c70bc) { return parent::getModulePathGeneric($pcd8c70bc, $this->getModulesFilePathSetting(), $this->getLayerPathSetting()); } public function getLayerPathSetting() { if (empty($this->settings["presentations_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentations_path]")); return $this->settings["presentations_path"]; } public function getModulesFilePathSetting() { if (empty($this->settings["presentations_modules_file_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentations_modules_file_path]")); return $this->settings["presentations_modules_file_path"]; } public function getCommonProjectName() { if (empty($this->settings["presentation_common_project_name"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_common_project_name]")); return $this->settings["presentation_common_project_name"]; } public function getPresentationPath($pcd8c70bc) { return $this->getModulePath($pcd8c70bc); } public function getPresentationSettings($pcd8c70bc) { if (empty($this->settings["presentation_configs_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_configs_path]")); else if (empty($this->settings["presentation_utils_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_utils_path]")); else if (empty($this->settings["presentation_controllers_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_controllers_path]")); else if (empty($this->settings["presentation_entities_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_entities_path]")); else if (empty($this->settings["presentation_views_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_views_path]")); else if (empty($this->settings["presentation_templates_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_templates_path]")); else if (empty($this->settings["presentation_blocks_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_blocks_path]")); else if (empty($this->settings["presentation_modules_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_modules_path]")); else if (empty($this->settings["presentation_webroot_path"])) launch_exception(new LayerException(2, "PresentationLayer->settings[presentation_webroot_path]")); $v237901192e = $this->getPresentationPath($pcd8c70bc); $v7e6c4c2b22 = array(); $v7e6c4c2b22["presentation_id"] = $pcd8c70bc; $v7e6c4c2b22["presentation_path"] = $v237901192e; $v7e6c4c2b22["presentation_relative_path"] = strstr($v237901192e, $this->getLayerPathSetting()); $v7e6c4c2b22["presentation_dir_name"] = basename($v7e6c4c2b22["presentation_relative_path"]); $v7e6c4c2b22["presentation_configs_path"] = $v237901192e . $this->settings["presentation_configs_path"]; $v7e6c4c2b22["presentation_utils_path"] = $v237901192e . $this->settings["presentation_utils_path"]; $v7e6c4c2b22["presentation_controllers_path"] = $v237901192e . $this->settings["presentation_controllers_path"]; $v7e6c4c2b22["presentation_entities_path"] = $v237901192e . $this->settings["presentation_entities_path"]; $v7e6c4c2b22["presentation_views_path"] = $v237901192e . $this->settings["presentation_views_path"]; $v7e6c4c2b22["presentation_templates_path"] = $v237901192e . $this->settings["presentation_templates_path"]; $v7e6c4c2b22["presentation_blocks_path"] = $v237901192e . $this->settings["presentation_blocks_path"]; $v7e6c4c2b22["presentation_modules_path"] = $v237901192e . $this->settings["presentation_modules_path"]; $v7e6c4c2b22["presentation_webroot_path"] = $v237901192e . $this->settings["presentation_webroot_path"]; $v7e6c4c2b22["presentation_files_extension"] = isset($this->settings["presentation_files_extension"]) ? $this->settings["presentation_files_extension"] : null; return $v7e6c4c2b22; } public function getPresentationFileExtension() { $v6bfcc44e7b = $this->getSelectedPresentationSetting("presentation_files_extension"); return isset($v6bfcc44e7b) && $v6bfcc44e7b ? $v6bfcc44e7b : "php"; } public function getPagePath($v41ac9fc8bf) { return $this->getSelectedPresentationSetting("presentation_path") . $v41ac9fc8bf . "." . $this->getPresentationFileExtension(); } public function callPage($EVC_OR_PRESENTATION_OBJ, $url, $page_code, $page_path, $parameters = array(), $external_vars = array(), $includes = array(), $includes_once = array()) { debug_log_function("PresentatioLayer->callPage", array($page_code, $page_path, $parameters)); if ($url == "_is_presentation_callpage") { echo 1; die(); } $has_cache = false; $is_cache_active = $this->isCacheActive(); if ($is_cache_active) { $CacheLayer = $this->getCacheLayer(); $headers = $CacheLayer->getHeaders($this->pddb8c7d5, $url); if ($headers && !headers_sent()) { $parts = explode("\n", $headers); foreach ($parts as $part) header( trim($part) ); } if ($CacheLayer->isValid($this->pddb8c7d5, $url, $parameters)) { $html = $CacheLayer->get($this->pddb8c7d5, $url, $parameters); $has_cache = $html ? true : false; } } if (!$has_cache) { $PVTOCACHE = array($page_code, $parameters); eval("\$".$this->getPHPFrameWorkObjName()." = \$this->getPHPFrameWork();"); $EVC = $EVC_OR_PRESENTATION_OBJ; $GLOBALS["EVC"] = $EVC; if (is_array($external_vars)) foreach($external_vars as $var_name => $var_value) ${$var_name} = $var_value; ob_start(null, 0); if ($includes) { $t = count($includes); for($i = 0; $i < $t; $i++) include $includes[$i]; } if ($includes_once) { $t = count($includes_once); for($i = 0; $i < $t; $i++) include $includes_once[$i]; } include $page_path; $html = ob_get_contents(); ob_end_clean(); if ($is_cache_active) $CacheLayer->check($this->pddb8c7d5, $url, $PVTOCACHE[1], $html); } return $html; } } ?>
