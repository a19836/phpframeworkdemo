<?php
/*
 * Copyright (c) 2007 PHPMyFrameWork - Joao Pinto
 * AUTHOR: Joao Paulo Lopes Pinto -- http://jplpinto.com
 * 
 * The use of this code must be allowed first by the creator Joao Pinto, since this is a private and proprietary code.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS 
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR 
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. IN NO EVENT SHALL 
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN 
 * AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
include_once get_lib("org.phpframework.module.ModuleCacheLayer"); include_once get_lib("org.phpframework.module.ModulePathHandler"); include_once get_lib("org.phpframework.PHPFrameWorkHandler"); include_once get_lib("org.phpframework.layer.ILayer"); include_once get_lib("org.phpframework.bean.BeanSettingsFileFactory"); include get_lib("org.phpframework.layer.exception.LayerException"); abstract class Layer implements ILayer { private $pbc7e2f66; private $pad21ece4; private $v401add5c13; private $pc4223ce1; private $v9ae260ddbd; public $settings; public $modules_path = array(); public function __construct($v30857f7eca) { $this->settings = $v30857f7eca; $this->pad21ece4 = new ModuleCacheLayer($this); $this->v401add5c13 = new PHPFrameWorkHandler(); $this->pc4223ce1 = array(); $this->v9ae260ddbd = false; } abstract public function getLayerPathSetting(); public function setCacheLayer($pbc7e2f66) {$this->pbc7e2f66 = $pbc7e2f66;} public function getCacheLayer() {return $this->pbc7e2f66;} public function isCacheActive() {return $this->pbc7e2f66 ? true : false;} public function getModuleCachedLayerDirPath() { return $this->isCacheActive() ? $this->getCacheLayer()->getCachedDirPath() : false; } public function getModuleCacheLayer() {return $this->pad21ece4;} public function getErrorHandler() { global $GlobalErrorHandler; return $GlobalErrorHandler; } public function setPHPFrameWork($v2a9b6f4e3b) {return $this->v401add5c13->setPHPFrameWork($v2a9b6f4e3b);} public function getPHPFrameWork() {return $this->v401add5c13->getPHPFrameWork();} public function setPHPFrameWorkObjName($v077f7f1e6b) {$this->v401add5c13->setPHPFrameWorkObjName($v077f7f1e6b);} public function getPHPFrameWorkObjName() {return $this->v401add5c13->getPHPFrameWorkObjName();} public function getModulePathGeneric($pcd8c70bc, $v810cb863ed, $pa2bba2ac, $pab3bfc5f = true) { if ($pab3bfc5f) { $pa32be502 = ModulePathHandler::getModuleFolderPath($pcd8c70bc, $v810cb863ed, $pa2bba2ac, $this->modules_path, $this->settings, $this->getModuleCacheLayer()); if (substr($pa32be502, -1) != "/") $pa32be502 .= "/"; return $pa32be502; } return ModulePathHandler::getModuleFilePath($pcd8c70bc, $v810cb863ed, $pa2bba2ac, $this->modules_path, $this->settings, $this->getModuleCacheLayer()); } public function prepareModulePathAFolder($pcd8c70bc, &$pab3bfc5f, &$v873b3f8d0d, $pee3fb492 = null) { $v873b3f8d0d = $pcd8c70bc; if ($pcd8c70bc) { $v967da4f618 = str_replace(".", "/", $pcd8c70bc); $pa2bba2ac = $this->getLayerPathSetting(); if (is_dir($pa2bba2ac . $pcd8c70bc) || is_dir($pa2bba2ac . $v967da4f618)) { $pab3bfc5f = true; return; } $v6bfcc44e7b = pathinfo($pcd8c70bc, PATHINFO_EXTENSION); if ($v6bfcc44e7b) { if (is_file($pa2bba2ac . $pcd8c70bc)) { $pab3bfc5f = false; return; } $pe2ae3be9 = strlen($v6bfcc44e7b) + 1; $v1aa304d917 = substr($v967da4f618, 0, - $pe2ae3be9) . "." . $v6bfcc44e7b; if (is_file($pa2bba2ac . $v1aa304d917)) { $pab3bfc5f = false; return; } else if ($pee3fb492) { if (is_file($pa2bba2ac . $v967da4f618 . "." . $pee3fb492)){ $v873b3f8d0d .= "." . $pee3fb492; $pab3bfc5f = false; return; } } } else if ($pee3fb492) { if (is_file($pa2bba2ac . $pcd8c70bc . "." . $pee3fb492) || is_file($pa2bba2ac . $v967da4f618 . "." . $pee3fb492)){ $v873b3f8d0d .= "." . $pee3fb492; $pab3bfc5f = false; return; } } } $pab3bfc5f = true; } public static function getModulesAlias($v810cb863ed) { $v70210c15fa = array(); if (!empty($v810cb863ed) && file_exists($v810cb863ed)) { $pfb662071 = XMLFileParser::parseXMLFileToArray($v810cb863ed); $pc37695cb = !empty($pfb662071["modules"][0]["childs"]["module"]) ? count($pfb662071["modules"][0]["childs"]["module"]) : 0; for ($v43dd7d0051 = 0; $v43dd7d0051 < $pc37695cb; $v43dd7d0051++) { $pc8b88eb4 = $pfb662071["modules"][0]["childs"]["module"][$v43dd7d0051]; $v70ebc6f169 = isset($pc8b88eb4["@"]["id"]) ? $pc8b88eb4["@"]["id"] : null; $pe0404e31 = isset($pc8b88eb4["value"]) ? $pc8b88eb4["value"] : null; $pe0404e31 = substr($pe0404e31, 0, 1) == "/" ? substr($pe0404e31, 1) : $pe0404e31; $pe0404e31 = substr($pe0404e31, strlen($pe0404e31) - 1) == "/" ? substr($pe0404e31, 0, strlen($pe0404e31) - 1) : $pe0404e31; if ($pe0404e31 != $v70ebc6f169) $v70210c15fa[ $pa32be502 . $pe0404e31 ][] = $v70ebc6f169; } } return $v70210c15fa; } public function addBroker($pd922c2f7, $v2b2cf4c0eb = false) { if(empty($v2b2cf4c0eb) && $v2b2cf4c0eb !== 0) $this->pc4223ce1[] = $pd922c2f7; else $this->pc4223ce1[$v2b2cf4c0eb] = $pd922c2f7; } public function getBroker($v2b2cf4c0eb = false, $v906ceb4474 = false) { $v2b2cf4c0eb = !empty($v2b2cf4c0eb) || $v2b2cf4c0eb === 0 ? $v2b2cf4c0eb : $this->v9ae260ddbd; if (empty($v2b2cf4c0eb) && $v2b2cf4c0eb !== 0) { $v9994512d98 = array_keys($this->pc4223ce1); $v2b2cf4c0eb = isset($v9994512d98) ? $v9994512d98[0] : null; } else if (is_numeric($v2b2cf4c0eb) && !isset($this->pc4223ce1[$v2b2cf4c0eb])) { $v9994512d98 = array_keys($this->pc4223ce1); $v2b2cf4c0eb = isset($v9994512d98[$v2b2cf4c0eb - 1]) ? $v9994512d98[$v2b2cf4c0eb - 1] : null; } if (isset($this->pc4223ce1[$v2b2cf4c0eb])) return $this->pc4223ce1[$v2b2cf4c0eb]; if (!$v906ceb4474) launch_exception(new LayerException(1, $v2b2cf4c0eb)); return false; } public function getBrokers() { return $this->pc4223ce1; } public function setDefaultBrokerName($v9ae260ddbd, $v906ceb4474 = true) { if (!$v9ae260ddbd && $v9ae260ddbd !== 0) { $this->v9ae260ddbd = false; return true; } else if(isset($this->pc4223ce1[$v9ae260ddbd])) { $this->v9ae260ddbd = $v9ae260ddbd; return true; } if (!$v906ceb4474) launch_exception(new LayerException(1, $v9ae260ddbd)); return false; } public function getDefaultBrokerName() { return $this->v9ae260ddbd; } } ?>
