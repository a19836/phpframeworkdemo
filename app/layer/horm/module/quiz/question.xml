<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<sql_mapping>
	<class name="Question" table="mq_question">
		<id column="question_id"></id>
	
		<relationships>
			<one_to_many name="question_answers">
				<attribute column="*" table="mq_answer" />
				
				<key pcolumn="question_id" fcolumn="question_id" ftable="mq_answer" />
			</one_to_many>
		</relationships>
		
		<queries>
			<select id="get_questions_by_object">
				select oq.*, q.* 
				from mq_question q
				inner join mq_object_question oq on oq.question_id=q.question_id and oq.object_type_id=#object_type_id# and oq.object_id=#object_id#
			</select>
			
			<select id="count_questions_by_object">
				select count(q.question_id) total
				from mq_question q
				inner join mq_object_question oq on oq.question_id=q.question_id and oq.object_type_id=#object_type_id# and oq.object_id=#object_id#
			</select>
	
			<select id="get_questions_by_object_group">
				select oq.*, q.* 
				from mq_question q
				inner join mq_object_question oq on oq.question_id=q.question_id and oq.object_type_id=#object_type_id# and oq.object_id=#object_id# and oq.`group`=#group#
			</select>
	
			<select id="count_questions_by_object_group">
				select count(q.question_id) total
				from mq_question q
				inner join mq_object_question oq on oq.question_id=q.question_id and oq.object_type_id=#object_type_id# and oq.object_id=#object_id# and oq.`group`=#group#
			</select>
		</queries>
	</class>
</sql_mapping>
