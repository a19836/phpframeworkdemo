<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<sql_mapping>
	<class name="Comment" table="mc_comment">
		<id column="comment_id"></id>
	
		<relationships>
			<one_to_many name="objects">
				<attribute column="*" table="mc_object_comment" />
				
				<key pcolumn="comment_id" fcolumn="comment_id" ftable="mc_object_comment" />
			</one_to_many>
		</relationships>
	
		<queries>
			<delete id="delete_comments_by_object">
				delete c 
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
			</delete>
			
			<select id="get_comments_by_object">
				select c.*, oc.`group` `group`, oc.`order` `order`
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
			</select>
			
			<select id="get_comments_by_object_group">
				select c.*, oc.`group` `group`, oc.`order` `order`
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id# and oc.`group`=#group#
			</select>
			
			<select id="get_parent_object_comments_by_object">
				select c.*, oc.`group` `group`, oc.`order` `order`
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
				inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id#
			</select>
	
			<select id="get_parent_object_comments_by_object_group">
				select c.*, oc.`group` `group`, oc.`order` `order`
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id# and oc.`group`=#group#
				inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id#
			</select>
	
			<select id="get_parent_object_group_comments_by_object">
				select c.*, oc.`group` `group`, oc.`order` `order`
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
				inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id# and poc.`group`=#parent_group#
			</select>
	
			<select id="get_parent_object_group_comments_by_object_group">
				select c.*, oc.`group` `group`, oc.`order` `order`
				from mc_comment c
				inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id# and oc.`group`=#group#
				inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id# and poc.`group`=#parent_group#
			</select>
		</queries>
	</class>
</sql_mapping>
