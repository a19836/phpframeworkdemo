<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<sql_mapping>
	<class name="Attachment" table="mat_attachment">
		<id column="attachment_id"></id>
	
		<relationships>
			<one_to_many name="objects">
				<attribute column="*" table="mat_object_attachment" />
				
				<key pcolumn="attachment_id" fcolumn="attachment_id" ftable="mat_object_attachment" />
			</one_to_many>
		</relationships>
		
		<queries>
			<select id="get_attachments_by_object">
				select a.*, oa.`group` `group`, oa.`order` `order`
				from mat_attachment a 
				inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id=#object_id#
			</select>
	
			<select id="get_attachments_by_objects">
				select a.*, oa.object_type_id, oa.object_id, oa.`group` `group`, oa.`order` `order`
				from mat_attachment a 
				inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id in (#object_ids#)
			</select>
			
			<select id="get_attachments_by_object_group">
				select a.*, oa.`group` `group`, oa.`order` `order`
				from mat_attachment a 
				inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id=#object_id# and oa.`group`=#group#
			</select>
	
			<select id="get_attachments_by_objects_group">
				select a.*, oa.object_type_id, oa.object_id, oa.`group` `group`, oa.`order` `order`
				from mat_attachment a 
				inner join mat_object_attachment oa on oa.attachment_id=a.attachment_id and oa.object_type_id=#object_type_id# and oa.object_id in (#object_ids#) and oa.`group` in (#groups#)
			</select>
		</queries>
	</class>
</sql_mapping>
