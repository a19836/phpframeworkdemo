<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<sql_mapping>
	<class name="City" table="mz_city">
		<id column="city_id"></id>
	
		<relationships>
			<many_to_one name="state">
				<attribute column="*" table="mz_state" />
				
				<key pcolumn="state_id" fcolumn="state_id" ftable="mz_state" />
			</many_to_one>
			
			<one_to_many name="zones">
				<attribute column="*" table="mz_zone" />
				
				<key pcolumn="city_id" fcolumn="city_id" ftable="mz_zone" />
			</one_to_many>
		</relationships>
		
		<queries>	
			<delete id="delete_cities_by_country_id">
				delete ci.*
				from mz_state st on st.country_id=#country_id#
				inner join mz_city ci on ci.state_id=st.state_id
			</delete>
			
			<select id="get_city">
				select ci.*, st.state_id, st.name as 'state', co.country_id, co.name as 'country'
				from mz_city ci
				inner join mz_state st on st.state_id=ci.state_id
				inner join mz_country co on co.country_id=st.country_id
				where ci.city_id=#city_id#
			</select>
			
			<select id="get_full_cities">
				select ci.*, st.state_id, st.name as 'state', co.country_id, co.name as 'country'
				from mz_city ci
				inner join mz_state st on st.state_id=ci.state_id
				inner join mz_country co on co.country_id=st.country_id
			</select>
		</queries>
	</class>
</sql_mapping>
