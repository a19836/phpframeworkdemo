<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<sql_mapping>
	<class name="Zip" table="mz_zip">
		<id column="zip_id"></id>
		<id column="country_id"></id>
	
		<relationships>
			<many_to_one name="zone">
				<attribute column="*" table="mz_zone" />
				
				<key pcolumn="zone_id" fcolumn="zone_id" ftable="mz_zone" />
			</many_to_one>
			
			<many_to_one name="country">
				<attribute column="*" table="mz_country" />
				
				<key pcolumn="country_id" fcolumn="country_id" ftable="mz_country" />
			</many_to_one>
		</relationships>
		
		<queries>
			<delete id="delete_zips_by_city_id">
				delete zi.*
				from join mz_zone zo on zo.city_id=#city_id#
				inner join mz_zip zi on zi.zone_id=zo.zone_id
			</delete>
	
			<delete id="delete_zips_by_state_id">
				delete zi.*
				from mz_city ci on ci.state_id=#state_id#
				inner join mz_zone zo on zo.city_id=ci.city_id
				inner join mz_zip zi on zi.zone_id=zo.zone_id
			</delete>
	
			<delete id="delete_zips_by_country_id">
				delete zi.*
				from mz_state st on st.country_id=#country_id#
				inner join mz_city ci on ci.state_id=st.state_id
				inner join mz_zone zo on zo.city_id=ci.city_id
				inner join mz_zip zi on zi.zone_id=zo.zone_id
			</delete>
			
			<select id="get_zip">
				select zi.*, zo.name as 'zone', ci.city_id, ci.name as 'city', st.state_id, st.name as 'state', co.name as 'country'
				from mz_zip zi
				inner join mz_zone zo on zo.zone_id=zi.zone_id
				inner join mz_city ci on ci.city_id=zo.city_id
				inner join mz_state st on st.state_id=ci.state_id
				inner join mz_country co on co.country_id=st.country_id
				where zi.zip_id='#zip_id#' and zi.country_id=#country_id#
			</select>
		</queries>
	</class>
</sql_mapping>
