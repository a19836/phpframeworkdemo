<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sql_mapping>
	<insert id="insert_menu_item">
		insert into mmenu_item (group_id, parent_id, label, title, class, url, previous_html, next_html, `order`, created_date, modified_date) values (#group_id#, #parent_id#, '#label#', '#title#', '#class#', '#url#', '#previous_html#', '#next_html#', #order#, '#created_date#', '#modified_date#')
	</insert>
	
	<update id="update_menu_item">
		update mmenu_item set group_id=#group_id#, parent_id=#parent_id#, label='#label#', title='#title#', class='#class#', url='#url#', previous_html='#previous_html#', next_html='#next_html#', `order`=#order#, modified_date='#modified_date#' where item_id=#item_id#
	</update>
	
	<delete id="delete_menu_item">
		delete from mmenu_item where item_id=#item_id#
	</delete>
	
	<delete id="delete_menu_items_by_group_id">
		delete from mmenu_item where group_id=#group_id#
	</delete>
	
	<delete id="delete_menu_items_by_parent_id">
		delete from mmenu_item where parent_id=#parent_id#
	</delete>
	
	<select id="get_menu_item">
		select * from mmenu_item where item_id=#item_id#
	</select>
	
	<select id="get_all_menu_items">
		select * from mmenu_item
	</select>
	
	<select id="count_all_menu_items">
		select count(item_id) total from mmenu_item
	</select>
	
	<select id="get_menu_items_by_group_id">
		select * from mmenu_item where group_id=#group_id#
	</select>
	
	<select id="get_menu_items_by_ids">
		select * from mmenu_item where item_id in (#item_ids#)
	</select>
	
	<select id="get_menu_items_by_conditions">
		select * from mmenu_item where #conditions#
	</select>
	
	<select id="count_menu_items_by_conditions">
		select count(item_id) total from mmenu_item where #conditions#
	</select>
	
	<select id="get_menu_items_by_first_group_of_object">
		select i.* 
		from mmenu_item i
		inner join (
			select group_id from mmenu_object_group where object_type_id=#object_type_id# and object_id=#object_id# limit 1
		) og on og.group_id=i.group_id
	</select>
	
	<select id="get_menu_items_by_first_group_of_object_group">
		select i.* 
		from mmenu_item i
		inner join (
			select group_id from mmenu_object_group where object_type_id=#object_type_id# and object_id=#object_id# and `group`=#group# limit 1
		) og on og.group_id=i.group_id
	</select>
</sql_mapping>
