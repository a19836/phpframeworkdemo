<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sql_mapping>
	<insert id="insert_comment">
		insert into mc_comment (user_id, comment, created_date, modified_date) values (#user_id#, '#comment#', '#created_date#', '#modified_date#')
	</insert>
	
	<update id="update_comment">
		update mc_comment set user_id=#user_id#, comment='#comment#', modified_date='#modified_date#' where comment_id=#comment_id#
	</update>
	
	<delete id="delete_comment">
		delete from mc_comment where comment_id=#comment_id#
	</delete>
	
	<delete id="delete_comments_by_object">
		delete c 
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
	</delete>
	
	<select id="get_comment">
		select * from mc_comment where comment_id=#comment_id#
	</select>
	
	<select id="get_all_comments">
		select * from mc_comment
	</select>
	
	<select id="count_all_comments">
		select count(comment_id) total from mc_comment
	</select>
	
	<select id="get_comments_by_ids">
		select * from mc_comment where comment_id in (#comment_ids#)
	</select>
	
	<select id="get_comments_by_conditions">
		select * from mc_comment where #conditions#
	</select>
	
	<select id="count_comments_by_conditions">
		select count(comment_id) total from mc_comment where #conditions#
	</select>
	
	<select id="get_comments_by_object">
		select c.*, oc.`group` `group`, oc.`order` `order`
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
	</select>
	
	<select id="get_comments_by_object_group">
		select c.*, oc.`group` `group`, oc.`order` `order`
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id# and oc.`group`=#group#
	</select>
	
	<select id="get_parent_object_comments_by_object">
		select c.*, oc.`group` `group`, oc.`order` `order`
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
		inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id#
	</select>
	
	<select id="get_parent_object_comments_by_object_group">
		select c.*, oc.`group` `group`, oc.`order` `order`
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id# and oc.`group`=#group#
		inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id#
	</select>
	
	<select id="get_parent_object_group_comments_by_object">
		select c.*, oc.`group` `group`, oc.`order` `order`
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id#
		inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id# and poc.`group`=#parent_group#
	</select>
	
	<select id="get_parent_object_group_comments_by_object_group">
		select c.*, oc.`group` `group`, oc.`order` `order`
		from mc_comment c
		inner join mc_object_comment oc on oc.comment_id=c.comment_id and oc.object_type_id=#object_type_id# and oc.object_id=#object_id# and oc.`group`=#group#
		inner join mc_object_comment poc on poc.comment_id=c.comment_id and poc.object_type_id=#parent_object_type_id# and poc.object_id=#parent_object_id# and poc.`group`=#parent_group#
	</select>
</sql_mapping>
